<!DOCTYPE HTML>
<html lang="zh-hans">
 <head>
  <meta charset="utf-8"/>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   对象什么时候加入自动释放池 &middot; NoteBook
  </title>
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
   <meta content="" name="description"/>
   <meta content="GitBook 3.2.3" name="generator"/>
   <meta content="vhuichen" name="author"/>
   <link href="../gitbook/style.css" rel="stylesheet"/>
   <link href="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.css" rel="stylesheet"/>
   <link href="../gitbook/gitbook-plugin-search-pro/search.css" rel="stylesheet"/>
   <link href="../gitbook/gitbook-plugin-highlight/website.css" rel="stylesheet"/>
   <link href="../gitbook/gitbook-plugin-fontsettings/website.css" rel="stylesheet"/>
   <meta content="true" name="HandheldFriendly">
    <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <link href="../gitbook/images/apple-touch-icon-precomposed-152.png" rel="apple-touch-icon-precomposed" sizes="152x152"/>
    <link href="../gitbook/images/favicon.ico" rel="shortcut icon" type="image/x-icon"/>
    <link href="../网络协议/网络协议.html" rel="next">
     <link href="自定义对象去重.html" rel="prev">
     </link>
    </link>
   </meta>
  </meta>
 </head>
 <body>
  <div class="book">
   <div class="book-summary">
    <div id="book-search-input" role="search">
     <input placeholder="输入并搜索" type="text"/>
    </div>
    <nav role="navigation">
     <ul class="summary">
      <li class="chapter" data-level="1.1" data-path="../">
       <a href="../">
        Introduction
       </a>
      </li>
      <li class="chapter" data-level="1.2" data-path="../Algorithm/Algorithm.html">
       <a href="../Algorithm/Algorithm.html">
        Algorithm
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.2.1" data-path="../Algorithm/尾调用优化.html">
         <a href="../Algorithm/尾调用优化.html">
          尾调用优化
         </a>
        </li>
        <li class="chapter" data-level="1.2.2" data-path="../Algorithm/时间复杂度.html">
         <a href="../Algorithm/时间复杂度.html">
          时间复杂度
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.3" data-path="../C++/C++.html">
       <a href="../C++/C++.html">
        C++
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.3.1" data-path="../C++/问题集.html">
         <a href="../C++/问题集.html">
          问题集
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.4" data-path="../Computer/Computer.html">
       <a href="../Computer/Computer.html">
        Computer
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.4.1" data-path="../Computer/Homebrew.html">
         <a href="../Computer/Homebrew.html">
          Homebrew
         </a>
        </li>
        <li class="chapter" data-level="1.4.2" data-path="../Computer/yum.html">
         <a href="../Computer/yum.html">
          yum
         </a>
        </li>
        <li class="chapter" data-level="1.4.3" data-path="../Computer/编码/编码.html">
         <a href="../Computer/编码/编码.html">
          编码
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.4.3.1" data-path="../Computer/编码/Base64.html">
           <a href="../Computer/编码/Base64.html">
            Base64
           </a>
          </li>
          <li class="chapter" data-level="1.4.3.2" data-path="../Computer/编码/哈夫曼编码.html">
           <a href="../Computer/编码/哈夫曼编码.html">
            哈夫曼编码
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.4.4" data-path="../Computer/加密解密/加密解密.html">
         <a href="../Computer/加密解密/加密解密.html">
          加密解密
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.4.4.1" data-path="../Computer/加密解密/AES、DES.html">
           <a href="../Computer/加密解密/AES、DES.html">
            AES、DES
           </a>
          </li>
          <li class="chapter" data-level="1.4.4.2" data-path="../Computer/加密解密/MD5.html">
           <a href="../Computer/加密解密/MD5.html">
            MD5
           </a>
          </li>
          <li class="chapter" data-level="1.4.4.3" data-path="../Computer/加密解密/SHA256.html">
           <a href="../Computer/加密解密/SHA256.html">
            SHA256
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.4.5" data-path="../Computer/操作系统/操作系统.html">
         <a href="../Computer/操作系统/操作系统.html">
          操作系统
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.4.5.1" data-path="../Computer/操作系统/线程&amp;进程.html">
           <a href="../Computer/操作系统/线程&amp;进程.html">
            线程&amp;进程
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.4.6" data-path="../Computer/计算机基础/计算机基础.html">
         <a href="../Computer/计算机基础/计算机基础.html">
          计算机基础
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.4.6.1" data-path="../Computer/计算机基础/SSH.html">
           <a href="../Computer/计算机基础/SSH.html">
            SSH
           </a>
          </li>
          <li class="chapter" data-level="1.4.6.2" data-path="../Computer/计算机基础/文本流&amp;二进制流.html">
           <a href="../Computer/计算机基础/文本流&amp;二进制流.html">
            文本流&amp;二进制流
           </a>
          </li>
          <li class="chapter" data-level="1.4.6.3" data-path="../Computer/计算机基础/正则表达式.html">
           <a href="../Computer/计算机基础/正则表达式.html">
            正则表达式
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.5" data-path="../C语言/C语言.html">
       <a href="../C语言/C语言.html">
        C语言
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.5.1" data-path="../C语言/time.html">
         <a href="../C语言/time.html">
          time
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.6" data-path="../Daily/Daily.html">
       <a href="../Daily/Daily.html">
        Daily
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.6.1" data-path="../Daily/2023.html">
         <a href="../Daily/2023.html">
          2023
         </a>
        </li>
        <li class="chapter" data-level="1.6.2" data-path="../Daily/2024.html">
         <a href="../Daily/2024.html">
          2024
         </a>
        </li>
        <li class="chapter" data-level="1.6.3">
         <span>
          Record
         </span>
         <ul class="articles">
          <li class="chapter" data-level="1.6.3.1" data-path="../Daily/Record/2024-03.html">
           <a href="../Daily/Record/2024-03.html">
            2024-03
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.7" data-path="../DesignPattern/DesignPattern.html">
       <a href="../DesignPattern/DesignPattern.html">
        DesignPattern
       </a>
      </li>
      <li class="chapter" data-level="1.8" data-path="../Flutter/Flutter.html">
       <a href="../Flutter/Flutter.html">
        Flutter
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.8.1" data-path="../Flutter/Channel.html">
         <a href="../Flutter/Channel.html">
          Channel
         </a>
        </li>
        <li class="chapter" data-level="1.8.2" data-path="../Flutter/Dart知识点.html">
         <a href="../Flutter/Dart知识点.html">
          Dart知识点
         </a>
        </li>
        <li class="chapter" data-level="1.8.3" data-path="../Flutter/Flutter知识点.html">
         <a href="../Flutter/Flutter知识点.html">
          Flutter知识点
         </a>
        </li>
        <li class="chapter" data-level="1.8.4" data-path="../Flutter/Flutter高级进阶实战.html">
         <a href="../Flutter/Flutter高级进阶实战.html">
          Flutter高级进阶实战
         </a>
        </li>
        <li class="chapter" data-level="1.8.5" data-path="../Flutter/Widget.html">
         <a href="../Flutter/Widget.html">
          Widget
         </a>
        </li>
        <li class="chapter" data-level="1.8.6" data-path="../Flutter/Widget生命周期.html">
         <a href="../Flutter/Widget生命周期.html">
          Widget生命周期
         </a>
        </li>
        <li class="chapter" data-level="1.8.7" data-path="../Flutter/树.html">
         <a href="../Flutter/树.html">
          树
         </a>
        </li>
        <li class="chapter" data-level="1.8.8" data-path="../Flutter/课程/课程.html">
         <a href="../Flutter/课程/课程.html">
          课程
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.8.8.1" data-path="../Flutter/课程/Flutter核心技术与实战.html">
           <a href="../Flutter/课程/Flutter核心技术与实战.html">
            Flutter核心技术与实战
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.8.9" data-path="../Flutter/实例.html">
         <a href="../Flutter/实例.html">
          实例
         </a>
        </li>
        <li class="chapter" data-level="1.8.10" data-path="../Flutter/问题集.html">
         <a href="../Flutter/问题集.html">
          问题集
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.9" data-path="../Ruby/Ruby.html">
       <a href="../Ruby/Ruby.html">
        Ruby
       </a>
      </li>
      <li class="chapter" data-level="1.10" data-path="../Shell/Shell.html">
       <a href="../Shell/Shell.html">
        Shell
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.10.1" data-path="../Shell/命令/命令.html">
         <a href="../Shell/命令/命令.html">
          命令
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.10.1.1" data-path="../Shell/命令/array.html">
           <a href="../Shell/命令/array.html">
            array
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.2" data-path="../Shell/命令/cp.html">
           <a href="../Shell/命令/cp.html">
            cp
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.3" data-path="../Shell/命令/echo.html">
           <a href="../Shell/命令/echo.html">
            echo
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.4" data-path="../Shell/命令/find.html">
           <a href="../Shell/命令/find.html">
            find
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.5" data-path="../Shell/命令/for.html">
           <a href="../Shell/命令/for.html">
            for
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.6" data-path="../Shell/命令/grep.html">
           <a href="../Shell/命令/grep.html">
            grep
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.7" data-path="../Shell/命令/iconv.html">
           <a href="../Shell/命令/iconv.html">
            iconv
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.8" data-path="../Shell/命令/if.html">
           <a href="../Shell/命令/if.html">
            if
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.9" data-path="../Shell/命令/ln.html">
           <a href="../Shell/命令/ln.html">
            ln
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.10" data-path="../Shell/命令/mv.html">
           <a href="../Shell/命令/mv.html">
            mv
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.11" data-path="../Shell/命令/read.html">
           <a href="../Shell/命令/read.html">
            read
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.12" data-path="../Shell/命令/rename.html">
           <a href="../Shell/命令/rename.html">
            rename
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.13" data-path="../Shell/命令/rm.html">
           <a href="../Shell/命令/rm.html">
            rm
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.14" data-path="../Shell/命令/sed.html">
           <a href="../Shell/命令/sed.html">
            sed
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.15" data-path="../Shell/命令/unzip.html">
           <a href="../Shell/命令/unzip.html">
            unzip
           </a>
          </li>
          <li class="chapter" data-level="1.10.1.16" data-path="../Shell/命令/xargs.html">
           <a href="../Shell/命令/xargs.html">
            xargs
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.10.2" data-path="../Shell/用例.html">
         <a href="../Shell/用例.html">
          用例
         </a>
        </li>
        <li class="chapter" data-level="1.10.3" data-path="../Shell/基本语法.html">
         <a href="../Shell/基本语法.html">
          基本语法
         </a>
        </li>
        <li class="chapter" data-level="1.10.4" data-path="../Shell/组合命令.html">
         <a href="../Shell/组合命令.html">
          组合命令
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.11" data-path="../Swift/Swift.html">
       <a href="../Swift/Swift.html">
        Swift
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.11.1" data-path="../Swift/ABI稳定、模块稳定.html">
         <a href="../Swift/ABI稳定、模块稳定.html">
          ABI稳定、模块稳定
         </a>
        </li>
        <li class="chapter" data-level="1.11.2" data-path="../Swift/as.html">
         <a href="../Swift/as.html">
          as
         </a>
        </li>
        <li class="chapter" data-level="1.11.3">
         <span>
          第三方库
         </span>
         <ul class="articles">
          <li class="chapter" data-level="1.11.3.1" data-path="../Swift/第三方库/Alamofire.html">
           <a href="../Swift/第三方库/Alamofire.html">
            Alamofire
           </a>
          </li>
          <li class="chapter" data-level="1.11.3.2" data-path="../Swift/第三方库/PromiseKit.html">
           <a href="../Swift/第三方库/PromiseKit.html">
            PromiseKit
           </a>
          </li>
          <li class="chapter" data-level="1.11.3.3" data-path="../Swift/第三方库/RxSwift/RxSwift.html">
           <a href="../Swift/第三方库/RxSwift/RxSwift.html">
            RxSwift
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.11.3.3.1" data-path="../Swift/第三方库/RxSwift/Interview.html">
             <a href="../Swift/第三方库/RxSwift/Interview.html">
              Interview
             </a>
            </li>
            <li class="chapter" data-level="1.11.3.3.2" data-path="../Swift/第三方库/RxSwift/Relay.html">
             <a href="../Swift/第三方库/RxSwift/Relay.html">
              Relay
             </a>
            </li>
            <li class="chapter" data-level="1.11.3.3.3" data-path="../Swift/第三方库/RxSwift/Subject.html">
             <a href="../Swift/第三方库/RxSwift/Subject.html">
              Subject
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.11.4" data-path="../Swift/访问权限修饰符.html">
         <a href="../Swift/访问权限修饰符.html">
          访问权限修饰符
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.12" data-path="../Thinking/Thinking.html">
       <a href="../Thinking/Thinking.html">
        Thinking
       </a>
      </li>
      <li class="chapter" data-level="1.13" data-path="../Tool/Tool.html">
       <a href="../Tool/Tool.html">
        Tool
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.13.1" data-path="../Tool/Fastlane/Fastlane.html">
         <a href="../Tool/Fastlane/Fastlane.html">
          Fastlane
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.1.1" data-path="../Tool/Fastlane/Fastlane问题记录.html">
           <a href="../Tool/Fastlane/Fastlane问题记录.html">
            Fastlane问题记录
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.13.2" data-path="../Tool/Git/Git.html">
         <a href="../Tool/Git/Git.html">
          Git
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.2.1" data-path="../Tool/Git/rebase.html">
           <a href="../Tool/Git/rebase.html">
            rebase
           </a>
          </li>
          <li class="chapter" data-level="1.13.2.2" data-path="../Tool/Git/reset.html">
           <a href="../Tool/Git/reset.html">
            reset
           </a>
          </li>
          <li class="chapter" data-level="1.13.2.3" data-path="../Tool/Git/submodule.html">
           <a href="../Tool/Git/submodule.html">
            submodule
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.13.3" data-path="../Tool/Markdown/Markdown.html">
         <a href="../Tool/Markdown/Markdown.html">
          Markdown
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.3.1" data-path="../Tool/Markdown/Flow.html">
           <a href="../Tool/Markdown/Flow.html">
            Flow
           </a>
          </li>
          <li class="chapter" data-level="1.13.3.2" data-path="../Tool/Markdown/Mermaid.html">
           <a href="../Tool/Markdown/Mermaid.html">
            Mermaid
           </a>
          </li>
          <li class="chapter" data-level="1.13.3.3" data-path="../Tool/Markdown/PlantUML.html">
           <a href="../Tool/Markdown/PlantUML.html">
            PlantUML
           </a>
          </li>
          <li class="chapter" data-level="1.13.3.4" data-path="../Tool/Markdown/UML.html">
           <a href="../Tool/Markdown/UML.html">
            UML
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.13.4" data-path="../Tool/博客搭建/博客搭建.html">
         <a href="../Tool/博客搭建/博客搭建.html">
          博客搭建
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.4.1" data-path="../Tool/博客搭建/GitBook/GitBook.html">
           <a href="../Tool/博客搭建/GitBook/GitBook.html">
            GitBook
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.13.4.1.1" data-path="../Tool/博客搭建/GitBook/plugins.html">
             <a href="../Tool/博客搭建/GitBook/plugins.html">
              plugins
             </a>
            </li>
           </ul>
          </li>
          <li class="chapter" data-level="1.13.4.2" data-path="../Tool/博客搭建/Hexo/Hexo.html">
           <a href="../Tool/博客搭建/Hexo/Hexo.html">
            Hexo
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.13.4.2.1" data-path="../Tool/博客搭建/Hexo/基础.html">
             <a href="../Tool/博客搭建/Hexo/基础.html">
              基础
             </a>
            </li>
            <li class="chapter" data-level="1.13.4.2.2" data-path="../Tool/博客搭建/Hexo/进阶.html">
             <a href="../Tool/博客搭建/Hexo/进阶.html">
              进阶
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.13.5" data-path="../Tool/工具软件/工具软件.html">
         <a href="../Tool/工具软件/工具软件.html">
          工具软件
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.5.1" data-path="../Tool/工具软件/Clash.html">
           <a href="../Tool/工具软件/Clash.html">
            Clash
           </a>
          </li>
          <li class="chapter" data-level="1.13.5.2" data-path="../Tool/工具软件/Mac.html">
           <a href="../Tool/工具软件/Mac.html">
            Mac
           </a>
          </li>
          <li class="chapter" data-level="1.13.5.3" data-path="../Tool/工具软件/VSCode/VSCode.html">
           <a href="../Tool/工具软件/VSCode/VSCode.html">
            VSCode
           </a>
          </li>
          <li class="chapter" data-level="1.13.5.4" data-path="../Tool/工具软件/zsh.html">
           <a href="../Tool/工具软件/zsh.html">
            zsh
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.13.6" data-path="../Tool/高效学习/高效学习.html">
         <a href="../Tool/高效学习/高效学习.html">
          高效学习
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.13.6.1" data-path="../Tool/高效学习/费曼学习法.html">
           <a href="../Tool/高效学习/费曼学习法.html">
            费曼学习法
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.15" data-path="../Web3.0/Web3.0.html">
       <a href="../Web3.0/Web3.0.html">
        Web3.0
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.15.1" data-path="../Web3.0/CSS/CSS.html">
         <a href="../Web3.0/CSS/CSS.html">
          CSS
         </a>
        </li>
        <li class="chapter" data-level="1.15.2" data-path="../Web3.0/HTML/HTML.html">
         <a href="../Web3.0/HTML/HTML.html">
          HTML
         </a>
        </li>
        <li class="chapter" data-level="1.15.3" data-path="../Web3.0/JavaScript/JavaScript.html">
         <a href="../Web3.0/JavaScript/JavaScript.html">
          JavaScript
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.16" data-path="../Windows/Windows.html">
       <a href="../Windows/Windows.html">
        Windows
       </a>
      </li>
      <li class="chapter" data-level="1.17" data-path="iOS.html">
       <a href="iOS.html">
        iOS
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.17.1" data-path="Allocations.html">
         <a href="Allocations.html">
          Allocations
         </a>
        </li>
        <li class="chapter" data-level="1.17.2" data-path="CocoaPods之Profile.html">
         <a href="CocoaPods之Profile.html">
          CocoaPods之Profile
         </a>
        </li>
        <li class="chapter" data-level="1.17.3" data-path="CocoaPods之podspec.html">
         <a href="CocoaPods之podspec.html">
          CocoaPods之podspec
         </a>
        </li>
        <li class="chapter" data-level="1.17.4" data-path="CocoaPods安装.html">
         <a href="CocoaPods安装.html">
          CocoaPods安装
         </a>
        </li>
        <li class="chapter" data-level="1.17.5" data-path="MVC、MVP、MVVM.html">
         <a href="MVC、MVP、MVVM.html">
          MVC、MVP、MVVM
         </a>
        </li>
        <li class="chapter" data-level="1.17.6" data-path="Mac开发.html">
         <a href="Mac开发.html">
          Mac开发
         </a>
        </li>
        <li class="chapter" data-level="1.17.7" data-path="Modules.html">
         <a href="Modules.html">
          Modules
         </a>
        </li>
        <li class="chapter" data-level="1.17.8" data-path="Notification.html">
         <a href="Notification.html">
          Notification
         </a>
        </li>
        <li class="chapter" data-level="1.17.9" data-path="Resume/Resume.html">
         <a href="Resume/Resume.html">
          Resume
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.9.1" data-path="Resume/Flutter.html">
           <a href="Resume/Flutter.html">
            Flutter
           </a>
          </li>
          <li class="chapter" data-level="1.17.9.2" data-path="Resume/Record.html">
           <a href="Resume/Record.html">
            Record
           </a>
          </li>
          <li class="chapter" data-level="1.17.9.3" data-path="Resume/Swift.html">
           <a href="Resume/Swift.html">
            Swift
           </a>
          </li>
          <li class="chapter" data-level="1.17.9.4" data-path="Resume/iOS.html">
           <a href="Resume/iOS.html">
            iOS
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.10" data-path="WebAssembly/WebAssembly.html">
         <a href="WebAssembly/WebAssembly.html">
          WebAssembly
         </a>
        </li>
        <li class="chapter" data-level="1.17.11" data-path="WebView/WebView.html">
         <a href="WebView/WebView.html">
          WebView
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.11.1" data-path="WebView/原生与WebView交互.html">
           <a href="WebView/原生与WebView交互.html">
            原生与WebView交互
           </a>
          </li>
          <li class="chapter" data-level="1.17.11.2" data-path="WebView/原生获取console.log日志.html">
           <a href="WebView/原生获取console.log日志.html">
            原生获取console.log日志
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.12" data-path="Xcode.html">
         <a href="Xcode.html">
          Xcode
         </a>
        </li>
        <li class="chapter" data-level="1.17.13" data-path="iOS经验.html">
         <a href="iOS经验.html">
          iOS经验
         </a>
        </li>
        <li class="chapter" data-level="1.17.14" data-path="libffi探究.html">
         <a href="libffi探究.html">
          libffi探究
         </a>
        </li>
        <li class="chapter" data-level="1.17.15" data-path="property.html">
         <a href="property.html">
          property
         </a>
        </li>
        <li class="chapter" data-level="1.17.16" data-path="书籍/书籍.html">
         <a href="书籍/书籍.html">
          书籍
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.16.1" data-path="书籍/Effective Objective-C 2.0/Effective Objective-C 2.0.html">
           <a href="书籍/Effective Objective-C 2.0/Effective Objective-C 2.0.html">
            Effective Objective-C 2.0
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.17.16.1.1" data-path="书籍/Effective Objective-C 2.0/Chapter 1-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 1-1.html">
              Chapter 1-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.2" data-path="书籍/Effective Objective-C 2.0/Chapter 2-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 2-1.html">
              Chapter 2-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.3" data-path="书籍/Effective Objective-C 2.0/Chapter 2-2.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 2-2.html">
              Chapter 2-2
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.4" data-path="书籍/Effective Objective-C 2.0/Chapter 2-3.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 2-3.html">
              Chapter 2-3
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.5" data-path="书籍/Effective Objective-C 2.0/Chapter 3-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 3-1.html">
              Chapter 3-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.6" data-path="书籍/Effective Objective-C 2.0/Chapter 4-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 4-1.html">
              Chapter 4-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.7" data-path="书籍/Effective Objective-C 2.0/Chapter 5-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 5-1.html">
              Chapter 5-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.8" data-path="书籍/Effective Objective-C 2.0/Chapter 5-2.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 5-2.html">
              Chapter 5-2
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.9" data-path="书籍/Effective Objective-C 2.0/Chapter 5-3.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 5-3.html">
              Chapter 5-3
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.10" data-path="书籍/Effective Objective-C 2.0/Chapter 6-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 6-1.html">
              Chapter 6-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.11" data-path="书籍/Effective Objective-C 2.0/Chapter 6-2.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 6-2.html">
              Chapter 6-2
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.12" data-path="书籍/Effective Objective-C 2.0/Chapter 6-3.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 6-3.html">
              Chapter 6-3
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.13" data-path="书籍/Effective Objective-C 2.0/Chapter 7-1.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 7-1.html">
              Chapter 7-1
             </a>
            </li>
            <li class="chapter" data-level="1.17.16.1.14" data-path="书籍/Effective Objective-C 2.0/Chapter 7-2.html">
             <a href="书籍/Effective Objective-C 2.0/Chapter 7-2.html">
              Chapter 7-2
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.17" data-path="工具/工具.html">
         <a href="工具/工具.html">
          工具
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.17.1" data-path="工具/Class-dump.html">
           <a href="工具/Class-dump.html">
            Class-dump
           </a>
          </li>
          <li class="chapter" data-level="1.17.17.2" data-path="工具/WebDriverAgent.html">
           <a href="工具/WebDriverAgent.html">
            WebDriverAgent
           </a>
          </li>
          <li class="chapter" data-level="1.17.17.3" data-path="工具/Xcodeproj.html">
           <a href="工具/Xcodeproj.html">
            Xcodeproj
           </a>
          </li>
          <li class="chapter" data-level="1.17.17.4" data-path="工具/fastlane.html">
           <a href="工具/fastlane.html">
            fastlane
           </a>
          </li>
          <li class="chapter" data-level="1.17.17.5" data-path="工具/pbxproj.html">
           <a href="工具/pbxproj.html">
            pbxproj
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.18" data-path="模块/模块.html">
         <a href="模块/模块.html">
          模块
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.18.1" data-path="模块/一键登录.html">
           <a href="模块/一键登录.html">
            一键登录
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.19" data-path="重构/重构.html">
         <a href="重构/重构.html">
          重构
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.19.1" data-path="重构/下拉刷新逻辑重构.html">
           <a href="重构/下拉刷新逻辑重构.html">
            下拉刷新逻辑重构
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.20" data-path="一个Workspace多个Project.html">
         <a href="一个Workspace多个Project.html">
          一个Workspace多个Project
         </a>
        </li>
        <li class="chapter" data-level="1.17.21" data-path="多线程/多线程.html">
         <a href="多线程/多线程.html">
          多线程
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.21.1" data-path="多线程/GCD.html">
           <a href="多线程/GCD.html">
            GCD
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.22" data-path="系统类/系统类.html">
         <a href="系统类/系统类.html">
          系统类
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.22.1" data-path="系统类/JavaScriptCore.html">
           <a href="系统类/JavaScriptCore.html">
            JavaScriptCore
           </a>
          </li>
          <li class="chapter" data-level="1.17.22.2" data-path="系统类/NSFileHandle.html">
           <a href="系统类/NSFileHandle.html">
            NSFileHandle
           </a>
          </li>
          <li class="chapter" data-level="1.17.22.3" data-path="系统类/NSKeyedArchiver.html">
           <a href="系统类/NSKeyedArchiver.html">
            NSKeyedArchiver
           </a>
          </li>
          <li class="chapter" data-level="1.17.22.4" data-path="系统类/NSUserDefaults.html">
           <a href="系统类/NSUserDefaults.html">
            NSUserDefaults
           </a>
          </li>
          <li class="chapter" data-level="1.17.22.5" data-path="系统类/UIGestureRecognizer.html">
           <a href="系统类/UIGestureRecognizer.html">
            UIGestureRecognizer
           </a>
          </li>
          <li class="chapter" data-level="1.17.22.6" data-path="系统类/UIStatusBarStyle.html">
           <a href="系统类/UIStatusBarStyle.html">
            UIStatusBarStyle
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.23" data-path="音视频/音视频.html">
         <a href="音视频/音视频.html">
          音视频
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.23.1" data-path="音视频/AAC.html">
           <a href="音视频/AAC.html">
            AAC
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.2" data-path="音视频/FFmpeg/FFmpeg.html">
           <a href="音视频/FFmpeg/FFmpeg.html">
            FFmpeg
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.17.23.2.1" data-path="音视频/FFmpeg/源码解读.html">
             <a href="音视频/FFmpeg/源码解读.html">
              源码解读
             </a>
            </li>
           </ul>
          </li>
          <li class="chapter" data-level="1.17.23.3" data-path="音视频/FLV.html">
           <a href="音视频/FLV.html">
            FLV
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.4" data-path="音视频/H264.html">
           <a href="音视频/H264.html">
            H264
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.5" data-path="音视频/MP4.html">
           <a href="音视频/MP4.html">
            MP4
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.6" data-path="音视频/PCM.html">
           <a href="音视频/PCM.html">
            PCM
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.7" data-path="音视频/TS.html">
           <a href="音视频/TS.html">
            TS
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.8" data-path="音视频/WAV.html">
           <a href="音视频/WAV.html">
            WAV
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.9" data-path="音视频/WebRTC/WebRTC.html">
           <a href="音视频/WebRTC/WebRTC.html">
            WebRTC
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.17.23.9.1" data-path="音视频/WebRTC/CritScope锁.html">
             <a href="音视频/WebRTC/CritScope锁.html">
              CritScope锁
             </a>
            </li>
            <li class="chapter" data-level="1.17.23.9.2" data-path="音视频/WebRTC/从0打造音视频直播系统.html">
             <a href="音视频/WebRTC/从0打造音视频直播系统.html">
              从0打造音视频直播系统
             </a>
            </li>
           </ul>
          </li>
          <li class="chapter" data-level="1.17.23.10" data-path="音视频/YUV.html">
           <a href="音视频/YUV.html">
            YUV
           </a>
          </li>
          <li class="chapter" data-level="1.17.23.11" data-path="音视频/课程/课程.html">
           <a href="音视频/课程/课程.html">
            课程
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.17.23.11.1" data-path="音视频/课程/音视频小白系统入门课.html">
             <a href="音视频/课程/音视频小白系统入门课.html">
              音视频小白系统入门课
             </a>
            </li>
           </ul>
          </li>
          <li class="chapter" data-level="1.17.23.12" data-path="音视频/流媒体/流媒体.html">
           <a href="音视频/流媒体/流媒体.html">
            流媒体
           </a>
           <ul class="articles">
            <li class="chapter" data-level="1.17.23.12.1" data-path="音视频/流媒体/HLS.html">
             <a href="音视频/流媒体/HLS.html">
              HLS
             </a>
            </li>
            <li class="chapter" data-level="1.17.23.12.2" data-path="音视频/流媒体/HTTP-FLV.html">
             <a href="音视频/流媒体/HTTP-FLV.html">
              HTTP-FLV
             </a>
            </li>
            <li class="chapter" data-level="1.17.23.12.3" data-path="音视频/流媒体/RTMP.html">
             <a href="音视频/流媒体/RTMP.html">
              RTMP
             </a>
            </li>
            <li class="chapter" data-level="1.17.23.12.4" data-path="音视频/流媒体/RTP-RTCP-RTSP.html">
             <a href="音视频/流媒体/RTP-RTCP-RTSP.html">
              RTP-RTCP-RTSP
             </a>
            </li>
           </ul>
          </li>
          <li class="chapter" data-level="1.17.23.13" data-path="音视频/音视频同步.html">
           <a href="音视频/音视频同步.html">
            音视频同步
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.24" data-path="代码块.html">
         <a href="代码块.html">
          代码块
         </a>
        </li>
        <li class="chapter" data-level="1.17.25" data-path="问题集.html">
         <a href="问题集.html">
          问题集
         </a>
        </li>
        <li class="chapter" data-level="1.17.26" data-path="第三方库/第三方库.html">
         <a href="第三方库/第三方库.html">
          第三方库
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.26.1" data-path="第三方库/AFNetWorking.html">
           <a href="第三方库/AFNetWorking.html">
            AFNetWorking
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.27" data-path="系统组件/系统组件.html">
         <a href="系统组件/系统组件.html">
          系统组件
         </a>
         <ul class="articles">
          <li class="chapter" data-level="1.17.27.1" data-path="系统组件/UIButton.html">
           <a href="系统组件/UIButton.html">
            UIButton
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.2" data-path="系统组件/UICollectionView.html">
           <a href="系统组件/UICollectionView.html">
            UICollectionView
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.3" data-path="系统组件/UIDatePicker.html">
           <a href="系统组件/UIDatePicker.html">
            UIDatePicker
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.4" data-path="系统组件/UINavigationController.html">
           <a href="系统组件/UINavigationController.html">
            UINavigationController
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.5" data-path="系统组件/UISearchController.html">
           <a href="系统组件/UISearchController.html">
            UISearchController
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.6" data-path="系统组件/UISheetPresentationController.html">
           <a href="系统组件/UISheetPresentationController.html">
            UISheetPresentationController
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.7" data-path="系统组件/UIStatusBar.html">
           <a href="系统组件/UIStatusBar.html">
            UIStatusBar
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.8" data-path="系统组件/UITabBarController.html">
           <a href="系统组件/UITabBarController.html">
            UITabBarController
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.9" data-path="系统组件/UITextField.html">
           <a href="系统组件/UITextField.html">
            UITextField
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.10" data-path="系统组件/UITextView.html">
           <a href="系统组件/UITextView.html">
            UITextView
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.11" data-path="系统组件/UIView.html">
           <a href="系统组件/UIView.html">
            UIView
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.12" data-path="系统组件/UIViewController.html">
           <a href="系统组件/UIViewController.html">
            UIViewController
           </a>
          </li>
          <li class="chapter" data-level="1.17.27.13" data-path="系统组件/WKWebview.html">
           <a href="系统组件/WKWebview.html">
            WKWebview
           </a>
          </li>
         </ul>
        </li>
        <li class="chapter" data-level="1.17.28" data-path="内存相关.html">
         <a href="内存相关.html">
          内存相关
         </a>
        </li>
        <li class="chapter" data-level="1.17.29" data-path="地图坐标系.html">
         <a href="地图坐标系.html">
          地图坐标系
         </a>
        </li>
        <li class="chapter" data-level="1.17.30" data-path="自定义转场.html">
         <a href="自定义转场.html">
          自定义转场
         </a>
        </li>
        <li class="chapter" data-level="1.17.31" data-path="内存管理机制.html">
         <a href="内存管理机制.html">
          内存管理机制
         </a>
        </li>
        <li class="chapter" data-level="1.17.32" data-path="单例完整写法.html">
         <a href="单例完整写法.html">
          单例完整写法
         </a>
        </li>
        <li class="chapter" data-level="1.17.33" data-path="检测未使用的类.html">
         <a href="检测未使用的类.html">
          检测未使用的类
         </a>
        </li>
        <li class="chapter" data-level="1.17.34" data-path="自定义对象去重.html">
         <a href="自定义对象去重.html">
          自定义对象去重
         </a>
        </li>
        <li class="chapter active" data-level="1.17.35" data-path="对象什么时候加入自动释放池.html">
         <a href="对象什么时候加入自动释放池.html">
          对象什么时候加入自动释放池
         </a>
        </li>
       </ul>
      </li>
      <li class="chapter" data-level="1.18" data-path="../网络协议/网络协议.html">
       <a href="../网络协议/网络协议.html">
        网络协议
       </a>
       <ul class="articles">
        <li class="chapter" data-level="1.18.1" data-path="../网络协议/HTTP.html">
         <a href="../网络协议/HTTP.html">
          HTTP
         </a>
        </li>
        <li class="chapter" data-level="1.18.2" data-path="../网络协议/KCP.html">
         <a href="../网络协议/KCP.html">
          KCP
         </a>
        </li>
        <li class="chapter" data-level="1.18.3" data-path="../网络协议/SRWebSocket源码解析.html">
         <a href="../网络协议/SRWebSocket源码解析.html">
          SRWebSocket源码解析
         </a>
        </li>
        <li class="chapter" data-level="1.18.4" data-path="../网络协议/Socket.html">
         <a href="../网络协议/Socket.html">
          Socket
         </a>
        </li>
        <li class="chapter" data-level="1.18.5" data-path="../网络协议/TCP.html">
         <a href="../网络协议/TCP.html">
          TCP
         </a>
        </li>
        <li class="chapter" data-level="1.18.6" data-path="../网络协议/WebSocket.html">
         <a href="../网络协议/WebSocket.html">
          WebSocket
         </a>
        </li>
       </ul>
      </li>
      <li class="divider">
      </li>
      <li>
       <a class="gitbook-link" href="https://www.gitbook.com" target="blank">
        本书使用 GitBook 发布
       </a>
      </li>
     </ul>
    </nav>
   </div>
   <div class="book-body">
    <div class="body-inner">
     <div class="book-header" role="navigation">
      <!-- Title -->
      <h1>
       <i class="fa fa-circle-o-notch fa-spin">
       </i>
       <a href="..">
        对象什么时候加入自动释放池
       </a>
      </h1>
     </div>
     <div class="page-wrapper" role="main" tabindex="-1">
      <div class="page-inner">
       <div id="book-search-results">
        <div class="search-noresults">
         <section class="normal markdown-section">
          <h1 id="arc下，对象什么时候加入自动释放池">
           ARC下，对象什么时候加入自动释放池
          </h1>
          <h3 id="arc">
           ARC
          </h3>
          <p>
           ARC (Automatic Reference Counting) 是由编译器跟运行时共同完成的（运行时标记）；编译器会在编译时会自动加上 retain、release、autorelease、dealloc 操作。
          </p>
          <h3 id="autoreleasing">
           __autoreleasing
          </h3>
          <p>
           如果一个变量被用关键字修饰 __autoreleasing 修饰，那么变量会立即加入到自动释放池中
          </p>
          <h3 id="arc规则">
           ARC规则
          </h3>
          <ol>
           <li>
            <p>
             若方法名以下列词语开头，则其返回的对象归调用者所有：
             <code>
              alloc
             </code>
             <code>
              new
             </code>
             <code>
              copy
             </code>
             <code>
              mutableCopy
             </code>
             。归调用者所有的意思是：调用上述四种方法的那段代码要负责释放方法所返回的对象。
            </p>
           </li>
           <li>
            <p>
             除了会自动调用&ldquo;保留&rdquo;与&ldquo;释放&rdquo;方法外，ARC 还可以执行一些手工操作很难甚至无法完成的优化。如果发现在同一个对象上执行多次&ldquo;保留&rdquo;与&ldquo;释放&rdquo;操作，那么ARC有时可以成对地移除这两个操作。
             <br/>
             一般，在方法中返回自动释放的对象时，要执行一个特殊函数。此时不直接调用对象的 autorelease 方法，而是改为调用 objc_autoreleaseReturnValue 。此函数会检视当前方法返回之后即将要执行的那段代码。若发现那段代码在返回的对象上执行 retain 操作，则设置全局数据结构（此数据结构的具体内容因处理器而异）中的一个标志位而不执行 autorelease 操作。与之相似，如果方法返回了一个自动释放的对象，而调用方法的代码要保留此对象，那么此时不直接执行 retain，而是改为执行 objc_retainAutoreleaseReturnValue 函数。此函数要检测刚才提到的那个标志位，若已经置位，则不执行 retain 操作。设置并检测标志位，要比调用 autorelease 和 retain 更快。
             <br/>
             <strong>
              备注
             </strong>
             ：objc_autoreleaseReturnValue 优化不一定开启，会根据不同CPU类型决定
             <br/>
             <strong>
              另外，这个标记位存在哪里呢？关键字：线程局部存储（TLS）
             </strong>
            </p>
           </li>
          </ol>
          <h4 id="objcautoreleasereturnvalue-相关代码逻辑">
           objc_autoreleaseReturnValue 相关代码逻辑
          </h4>
          <pre><code>// Prepare a value at +1 for return through a +0 autoreleasing convention.
id objc_autoreleaseReturnValue(id obj) {
    if (prepareOptimizedReturn(ReturnAtPlus1)) return obj;
    return objc_autorelease(obj);
}

static ALWAYS_INLINE bool prepareOptimizedReturn(ReturnDisposition disposition) {
    ASSERT(getReturnDisposition() == ReturnAtPlus0);
    //callerAcceptsOptimizedReturn 是个条件编译选项，不同CPU类型代码完全不一样
    if (callerAcceptsOptimizedReturn(__builtin_return_address(0))) {
        if (disposition) setReturnDisposition(disposition);
        return true;
    }
    return false;
}
</code></pre>
          <h4 id="例子">
           例子
          </h4>
          <pre><code>// 方法名以关键字 new 开头，ARC 不会加入 retain、release 或 autorelease 语句。
+ (VCHPerson *)newPerson {
    VCHPerson *person = [[VCHPerson alloc] init];
    return person;
}
// 方法名不以关键字开头，ARC 会自动加上 autorelease 语句。
+ (VCHPerson *)somePerson {
    VCHPerson *person = [[VCHPerson alloc] init];
    return person;
}
// ARC 会在函数末尾给 personOne 加上 release 语句。
// 而 somePerson 已经在方法内部加入到释放池中了
- (void)doSomething {
    VCHPerson *personOne = [VCHPerson newPerson];
    VCHPerson *personTwo = [VCHPerson somePerson];
}
</code></pre>
          <p>
           内部的实现逻辑可以用以下代码代替
          </p>
          <pre><code>//非关键字开头
+ (instancetype)object {
    return [[NSObject alloc] init];
    // 实际会变成
    return objc_autoreleaseReturnValue([[NSObject alloc] init]);
}
NSObject *object = [NSObject object];
// 实际会变成
NSObject *object = objc_retainAutoreleasedReturnValue([NSObject object]);
</code></pre>
          <h3 id="再来看看汇编">
           再来看看汇编
          </h3>
          <h5 id="一、外部方法非关键字开头，内部方法关键字开头">
           一、外部方法非关键字开头，内部方法关键字开头
          </h5>
          <ol>
           <li>
            NSMutableArray 以 alloc 方式生成对象，引用计数为1，此时没有加入到自动释放池中
           </li>
           <li>
            init方法不做任何处理，猜测是编译器行为
           </li>
           <li>
            当前方法名不以关键字开头，return时需要加入到自动释放池中，表示当前方法内持有对象，并负责释放对象。
           </li>
          </ol>
          <p>
           但是由于编译器优化，不会立即加入到自动释放池中，而是调用 objc_autoreleaseReturnValue 方法标记对象（从下面的汇编代码可以看出确实调用了 objc_autoreleaseReturnValue 方法）。
如果对象返回后，又有别的变量需要 retain 这个对象，则编译器会调用这个方法 objc_retainAutoreleasedReturnValue，此时会检查对象的是否已经被标记，如果已经被标记，则相互抵消，并将标记位清除，如果没有被标记则最终调用 retain 方法。
          </p>
          <pre><code>- (id)getObjectWithAlloc {
    id obj = [[NSMutableArray alloc] init];
    return obj;//断点
    /*
     VCHTest`-[AppDelegate getObjectWithAlloc]:
         0x10027e210 &lt;+0&gt;:  pushq  %rbp
         0x10027e211 &lt;+1&gt;:  movq   %rsp, %rbp
         0x10027e214 &lt;+4&gt;:  subq   $0x20, %rsp
         0x10027e218 &lt;+8&gt;:  movq   %rdi, -0x8(%rbp)
         0x10027e21c &lt;+12&gt;: movq   %rsi, -0x10(%rbp)
         0x10027e220 &lt;+16&gt;: movq   0x9c41(%rip), %rdi        ; (void *)0x00007fff801e6298: NSMutableArray
         0x10027e227 &lt;+23&gt;: callq  0x10027f814               ; symbol stub for: objc_alloc_init
         0x10027e22c &lt;+28&gt;: movq   %rax, -0x18(%rbp)
     -&gt;  0x10027e230 &lt;+32&gt;: movq   -0x18(%rbp), %rdi
         0x10027e234 &lt;+36&gt;: movq   0x3df5(%rip), %rax        ; (void *)0x00007fff20191840: objc_retain
         0x10027e23b &lt;+43&gt;: callq  *%rax
         0x10027e23d &lt;+45&gt;: xorl   %ecx, %ecx
         0x10027e23f &lt;+47&gt;: movl   %ecx, %esi
         0x10027e241 &lt;+49&gt;: leaq   -0x18(%rbp), %rdi
         0x10027e245 &lt;+53&gt;: movq   %rax, -0x20(%rbp)
         0x10027e249 &lt;+57&gt;: callq  0x10027f86e               ; symbol stub for: objc_storeStrong
         0x10027e24e &lt;+62&gt;: movq   -0x20(%rbp), %rdi
         0x10027e252 &lt;+66&gt;: addq   $0x20, %rsp
         0x10027e256 &lt;+70&gt;: popq   %rbp
         0x10027e257 &lt;+71&gt;: jmp    0x10027f826               ; symbol stub for: objc_autoreleaseReturnValue
     */
}
</code></pre>
          <h5 id="二、外部方法非关键字开头，内部方法非关键字开头">
           二、外部方法非关键字开头，内部方法非关键字开头
          </h5>
          <ol>
           <li>
            NSMutableArray 以 array 方式生成对象，引用计数为1，并加入到自动释放池中（标记）
           </li>
           <li>
            调用 objc_retainAutoreleasedReturnValue，因为临时变量需要持有对象，此时标记位清除
           </li>
           <li>
            由于方法名不以关键字开头，return 时调用 objc_autoreleaseReturnValue 加入到自动释放池中（同样也是先标记）
           </li>
          </ol>
          <pre><code>
- (id)getObjectWithArray {
    id obj = [NSMutableArray array];
    return obj;//断点
    /*
     VCHTest`-[AppDelegate getObjectWithArray]:
         0x10027e260 &lt;+0&gt;:  pushq  %rbp
         0x10027e261 &lt;+1&gt;:  movq   %rsp, %rbp
         0x10027e264 &lt;+4&gt;:  subq   $0x20, %rsp
         0x10027e268 &lt;+8&gt;:  movq   %rdi, -0x8(%rbp)
         0x10027e26c &lt;+12&gt;: movq   %rsi, -0x10(%rbp)
         0x10027e270 &lt;+16&gt;: movq   0x9bf1(%rip), %rdi        ; (void *)0x00007fff801e6298: NSMutableArray
         0x10027e277 &lt;+23&gt;: movq   0x9aba(%rip), %rsi        ; "array"
         0x10027e27e &lt;+30&gt;: movq   0x3d9b(%rip), %rax        ; (void *)0x00007fff20175280: objc_msgSend
         0x10027e285 &lt;+37&gt;: callq  *%rax
         0x10027e287 &lt;+39&gt;: movq   %rax, %rdi
         0x10027e28a &lt;+42&gt;: callq  0x10027f85c               ; symbol stub for: objc_retainAutoreleasedReturnValue
         0x10027e28f &lt;+47&gt;: movq   %rax, -0x18(%rbp)
     -&gt;  0x10027e293 &lt;+51&gt;: movq   -0x18(%rbp), %rdi
         0x10027e297 &lt;+55&gt;: movq   0x3d92(%rip), %rax        ; (void *)0x00007fff20191840: objc_retain
         0x10027e29e &lt;+62&gt;: callq  *%rax
         0x10027e2a0 &lt;+64&gt;: xorl   %ecx, %ecx
         0x10027e2a2 &lt;+66&gt;: movl   %ecx, %esi
         0x10027e2a4 &lt;+68&gt;: leaq   -0x18(%rbp), %rdi
         0x10027e2a8 &lt;+72&gt;: movq   %rax, -0x20(%rbp)
         0x10027e2ac &lt;+76&gt;: callq  0x10027f86e               ; symbol stub for: objc_storeStrong
         0x10027e2b1 &lt;+81&gt;: movq   -0x20(%rbp), %rdi
         0x10027e2b5 &lt;+85&gt;: addq   $0x20, %rsp
         0x10027e2b9 &lt;+89&gt;: popq   %rbp
         0x10027e2ba &lt;+90&gt;: jmp    0x10027f826               ; symbol stub for: objc_autoreleaseReturnValue
     */
}
</code></pre>
          <h5 id="三、外部方法关键字开头，内部方法关键字开头">
           三、外部方法关键字开头，内部方法关键字开头
          </h5>
          <ol>
           <li>
            NSMutableArray 使用 alloc 生成对象，引用计数为1，内部没有加入 AutoreleasePool 中；
           </li>
           <li>
            随后调用 init 方法，这里 init 方法返回对象时没有加入到自动释放池中，猜测是编译器行为；
           </li>
           <li>
            由于当前方法以 copy 开头，return 时既不调用 release，也不调用 autorelease；
           </li>
          </ol>
          <pre><code>- (id)copyObjectWithAlloc {
    id obj = [[NSMutableArray alloc] init];
    return obj;//断点
    /*
     VCHTest`-[AppDelegate copyObjectWithAlloc]:
         0x10027e160 &lt;+0&gt;:  pushq  %rbp
         0x10027e161 &lt;+1&gt;:  movq   %rsp, %rbp
         0x10027e164 &lt;+4&gt;:  subq   $0x20, %rsp
         0x10027e168 &lt;+8&gt;:  movq   %rdi, -0x8(%rbp)
         0x10027e16c &lt;+12&gt;: movq   %rsi, -0x10(%rbp)
         0x10027e170 &lt;+16&gt;: movq   0x9cf1(%rip), %rax        ; (void *)0x00007fff801e6298: NSMutableArray
         0x10027e177 &lt;+23&gt;: movq   %rax, %rdi
         0x10027e17a &lt;+26&gt;: callq  0x10027f814               ; symbol stub for: objc_alloc_init
         0x10027e17f &lt;+31&gt;: movq   %rax, -0x18(%rbp)
     -&gt;  0x10027e183 &lt;+35&gt;: movq   -0x18(%rbp), %rdi
         0x10027e187 &lt;+39&gt;: callq  *0x3ea3(%rip)             ; (void *)0x00007fff20191840: objc_retain
         0x10027e18d &lt;+45&gt;: xorl   %ecx, %ecx
         0x10027e18f &lt;+47&gt;: movl   %ecx, %esi
         0x10027e191 &lt;+49&gt;: leaq   -0x18(%rbp), %rdi
         0x10027e195 &lt;+53&gt;: movq   %rax, -0x20(%rbp)
         0x10027e199 &lt;+57&gt;: callq  0x10027f86e               ; symbol stub for: objc_storeStrong
         0x10027e19e &lt;+62&gt;: movq   -0x20(%rbp), %rax
         0x10027e1a2 &lt;+66&gt;: addq   $0x20, %rsp
         0x10027e1a6 &lt;+70&gt;: popq   %rbp
         0x10027e1a7 &lt;+71&gt;: retq
     */
}
</code></pre>
          <h5 id="四、外部方法关键字开头，内部方法非关键字开头">
           四、外部方法关键字开头，内部方法非关键字开头
          </h5>
          <ol>
           <li>
            NSMutableArray 使用 array 生成对象，引用计数为1，内部已经加入 AutoreleasePool 中（其实还没有加入，只是被标记了而已）；
           </li>
           <li>
            通过下面的汇编代码可以看出，方法内调用了 objc_retainAutoreleasedReturnValue （因为有个临时变量需要持有当前对象），此时发现该对象已经被标记，则相互抵消，清除标志位，不加入自动释放池中；
           </li>
           <li>
            由于当前方法以 copy 开头，return 时既不调用 release，也不调用 autorelease；
           </li>
          </ol>
          <pre><code>- (id)copyObjectWithArray {
    id obj = [NSMutableArray array];
    return obj;//断点
    /*
     VCHTest`-[AppDelegate copyObjectWithArray]:
         0x10027e1b0 &lt;+0&gt;:  pushq  %rbp
         0x10027e1b1 &lt;+1&gt;:  movq   %rsp, %rbp
         0x10027e1b4 &lt;+4&gt;:  subq   $0x20, %rsp
         0x10027e1b8 &lt;+8&gt;:  movq   %rdi, -0x8(%rbp)
         0x10027e1bc &lt;+12&gt;: movq   %rsi, -0x10(%rbp)
         0x10027e1c0 &lt;+16&gt;: movq   0x9ca1(%rip), %rax        ; (void *)0x00007fff801e6298: NSMutableArray
         0x10027e1c7 &lt;+23&gt;: movq   0x9b6a(%rip), %rsi        ; "array"
         0x10027e1ce &lt;+30&gt;: movq   %rax, %rdi
         0x10027e1d1 &lt;+33&gt;: callq  *0x3e49(%rip)             ; (void *)0x00007fff20175280: objc_msgSend
         0x10027e1d7 &lt;+39&gt;: movq   %rax, %rdi
         0x10027e1da &lt;+42&gt;: callq  0x10027f85c               ; symbol stub for: objc_retainAutoreleasedReturnValue
         0x10027e1df &lt;+47&gt;: movq   %rax, -0x18(%rbp)
     -&gt;  0x10027e1e3 &lt;+51&gt;: movq   -0x18(%rbp), %rdi
         0x10027e1e7 &lt;+55&gt;: callq  *0x3e43(%rip)             ; (void *)0x00007fff20191840: objc_retain
         0x10027e1ed &lt;+61&gt;: xorl   %ecx, %ecx
         0x10027e1ef &lt;+63&gt;: movl   %ecx, %esi
         0x10027e1f1 &lt;+65&gt;: leaq   -0x18(%rbp), %rdi
         0x10027e1f5 &lt;+69&gt;: movq   %rax, -0x20(%rbp)
         0x10027e1f9 &lt;+73&gt;: callq  0x10027f86e               ; symbol stub for: objc_storeStrong
         0x10027e1fe &lt;+78&gt;: movq   -0x20(%rbp), %rax
         0x10027e202 &lt;+82&gt;: addq   $0x20, %rsp
         0x10027e206 &lt;+86&gt;: popq   %rbp
         0x10027e207 &lt;+87&gt;: retq
     */
}
</code></pre>
          <h3 id="测试">
           测试
          </h3>
          <p>
           下面代码执行会怎样
          </p>
          <pre><code>    id __unsafe_unretained obj0 = nil;
    id __unsafe_unretained obj1 = nil;
    {
        NSArray *array0 = [self getObjectWithAlloc];
        obj0 = array0;
        //
        NSArray *array1 = [self copyObjectWithAlloc];
        obj1 = array1;
    }
    NSLog(@"vhuichen obj0 = %@", obj0);
    NSLog(@"vhuichen obj1 = %@", obj1);
</code></pre>
         </section>
        </div>
        <div class="search-results">
         <div class="has-results">
          <h1 class="search-results-title">
           <span class="search-results-count">
           </span>
           results matching "
           <span class="search-query">
           </span>
           "
          </h1>
          <ul class="search-results-list">
          </ul>
         </div>
         <div class="no-results">
          <h1 class="search-results-title">
           No results matching "
           <span class="search-query">
           </span>
           "
          </h1>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
    <a aria-label="Previous page: 自定义对象去重" class="navigation navigation-prev" href="自定义对象去重.html">
     <i class="fa fa-angle-left">
     </i>
    </a>
    <a aria-label="Next page: 网络协议" class="navigation navigation-next" href="../网络协议/网络协议.html">
     <i class="fa fa-angle-right">
     </i>
    </a>
   </div>
   <script>
    var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"对象什么时候加入自动释放池","level":"1.17.35","depth":2,"next":{"title":"网络协议","level":"1.18","depth":1,"path":"网络协议/网络协议.md","ref":"网络协议/网络协议.md","articles":[{"title":"HTTP","level":"1.18.1","depth":2,"path":"网络协议/HTTP.md","ref":"网络协议/HTTP.md","articles":[]},{"title":"KCP","level":"1.18.2","depth":2,"path":"网络协议/KCP.md","ref":"网络协议/KCP.md","articles":[]},{"title":"SRWebSocket源码解析","level":"1.18.3","depth":2,"path":"网络协议/SRWebSocket源码解析.md","ref":"网络协议/SRWebSocket源码解析.md","articles":[]},{"title":"Socket","level":"1.18.4","depth":2,"path":"网络协议/Socket.md","ref":"网络协议/Socket.md","articles":[]},{"title":"TCP","level":"1.18.5","depth":2,"path":"网络协议/TCP.md","ref":"网络协议/TCP.md","articles":[]},{"title":"WebSocket","level":"1.18.6","depth":2,"path":"网络协议/WebSocket.md","ref":"网络协议/WebSocket.md","articles":[]}]},"previous":{"title":"自定义对象去重","level":"1.17.34","depth":2,"path":"iOS/自定义对象去重.md","ref":"iOS/自定义对象去重.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-lunr","-search","expandable-chapters","search-pro"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"expandable-chapters":{},"search-pro":{},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}},"theme":"default","author":"vhuichen","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"NoteBook","language":"zh-hans","gitbook":"*","description":"笔记、分享"},"file":{"path":"iOS/对象什么时候加入自动释放池.md","mtime":"2023-02-25T09:15:23.099Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-07-07T11:52:44.602Z"},"basePath":"..","book":{"language":""}});
        });
   </script>
  </div>
  <script src="../gitbook/gitbook.js">
  </script>
  <script src="../gitbook/theme.js">
  </script>
  <script src="../gitbook/gitbook-plugin-expandable-chapters/expandable-chapters.js">
  </script>
  <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js">
  </script>
  <script src="../gitbook/gitbook-plugin-search-pro/search.js">
  </script>
  <script src="../gitbook/gitbook-plugin-sharing/buttons.js">
  </script>
  <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js">
  </script>
 </body>
</html>
