{"./":{"url":"./","title":"Introduction","keywords":"","body":"Introduction ç¬”è®°ã€åˆ†äº« "},"æµåª’ä½“/æµåª’ä½“.html":{"url":"æµåª’ä½“/æµåª’ä½“.html","title":"æµåª’ä½“","keywords":"","body":"æµåª’ä½“ åª’ä½“æœåŠ¡å™¨ä¸æ™®é€šçš„æœåŠ¡å™¨åŒºåˆ« åª’ä½“æœåŠ¡å™¨ï¼šæ”¯æŒæµå¼éŸ³é¢‘å’Œè§†é¢‘çš„ä¼ é€ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¾¹ä¸‹è½½è¾¹æ’­æ”¾ã€‚ æ™®é€šæœåŠ¡å™¨ï¼šä¸‹è½½éŸ³è§†é¢‘éœ€è¦å°†æ•´ä¸ªæ–‡ä»¶ä¸‹è½½å®Œæ‰èƒ½è¿›è¡Œæ’­æ”¾ã€‚ "},"æµåª’ä½“/HLS.html":{"url":"æµåª’ä½“/HLS.html","title":"HLS","keywords":"","body":"HLS åè®® HTTP Live Streamingï¼Œè‹¹æœå…¬å¸æå‡ºçš„åŸºäº HTTP çš„æµåª’ä½“ç½‘ç»œä¼ è¾“åè®®ã€‚ HLSå…¶å®æ˜¯ä¸€ä¸ªâ€œæ–‡æœ¬åè®®â€ï¼Œè€Œå¹¶ä¸æ˜¯ä¸€ä¸ªæµåª’ä½“åè®®ã€‚HLSçš„æ•°æ®æ˜¯åˆ‡ç‰‡æ–‡ä»¶ï¼Œå¹¶éè¿ç»­æµã€‚ æ¦‚è¿° æœåŠ¡ç«¯å°†åª’ä½“æµæŒ‰ç…§ä¸åŒçš„ç ç‡åˆ‡æˆä¸åŒçš„å°ç‰‡æ®µåè¿›è¡Œä¼ è¾“ï¼Œå®¢æˆ·ç«¯æ’­æ”¾æµæ—¶ï¼Œæ ¹æ®è‡ªèº«çš„å¸¦å®½åŠæ€§èƒ½é™åˆ¶ï¼Œé€‰æ‹©åˆé€‚çš„ç ç‡è¿›è¡Œä¸‹è½½æ’­æ”¾ã€‚åœ¨ä¼šè¯å¼€å§‹æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šå…ˆä¸‹è½½æè¿°è§†é¢‘æµçš„å…ƒæ•°æ®ï¼ˆm3u8ç´¢å¼•æ–‡ä»¶ï¼‰ï¼Œè§†é¢‘æ–‡ä»¶å­˜æ”¾åœ¨ .ts æ–‡ä»¶ä¸­ã€‚ å¯¹æ¯”RTMP RTMP åè®®ä½¿ç”¨éæ ‡å‡†çš„ HTTP æ¥å£ä¼ è¾“æ•°æ®ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šçš„ç½‘ç»œç¯å¢ƒä¸‹å¯èƒ½ä¼šè¢«é˜²ç«å¢™å±è”½ã€‚è€Œ HLS ç”±äºä½¿ç”¨çš„ HTTP åè®®ä¼ è¾“æ•°æ®ï¼Œä¸€èˆ¬ä¸ä¼šè¢«é˜²ç«å¢™å±è”½ï¼ˆ80ç«¯å£ï¼‰ã€‚ è´Ÿè½½å‡è¡¡ï¼ŒRTMP æ˜¯æœ‰çŠ¶æ€åè®®ï¼Œå¾ˆéš¾å¯¹è§†é¢‘æœåŠ¡å™¨è¿›è¡Œå¹³æ»‘æ‰©å±•ï¼Œéœ€è¦ç»´æŠ¤æ¯ä¸€ä¸ªæ’­æ”¾è§†é¢‘æµçš„çŠ¶æ€ã€‚è€Œ HLS åŸºäºæ— çŠ¶æ€åè®®ï¼ˆHTTPï¼‰ï¼Œå®¢æˆ·ç«¯åªæ˜¯æŒ‰ç…§é¡ºåºä¸‹è½½å­˜å‚¨åœ¨æœåŠ¡å™¨çš„TSæ–‡ä»¶å³å¯ã€‚ æ­¤å¤–ï¼ŒHLSå®ç°äº†ç ç‡è‡ªé€‚åº”ã€‚ HLSä¸»è¦ç”¨äºæ‹‰æµï¼ŒRTMPå¯ä»¥ç”¨äºæ‹‰æµæˆ–æ¨æµã€‚ HLS ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šæœåŠ¡å™¨ç»„ä»¶ã€åˆ†å‘ç»„ä»¶ã€å®¢æˆ·ç«¯è½¯ä»¶ã€‚ åª’ä½“æµä»è®¾å¤‡ä¼ è¾“åˆ° Server å¯ä»¥é€šè¿‡ä»»æ„æ–¹å¼ä¼ è¾“ Media encoder åº”è¯¥å°†éŸ³é¢‘è·Ÿè§†é¢‘ç¼–ç æˆå¯¹åº”çš„æ ¼å¼ï¼Œä¸€èˆ¬å°±æ˜¯AACè·ŸH264ã€‚ Stream Segment è¿™ä¸ªæ¨¡å—åº”è¯¥æ˜¯å°†æ–‡ä»¶åˆ‡ç‰‡äº†ï¼ŒåŸºäºMPEG-2çš„å°è£…æ ¼å¼ï¼Œä¹Ÿå«MPEG-TS index æ–‡ä»¶å°±æ˜¯ m3u8 æ–‡ä»¶ï¼Œå…ˆä¸‹è½½ä¸€çº§ index æ–‡ä»¶ï¼ˆmaster_playlist.m3u8ï¼‰ï¼Œé‡Œé¢è®°å½•äº†ä¸åŒç ç‡å¯¹åº”çš„äºŒçº§ç´¢å¼•æ–‡ä»¶ï¼ˆAlternate-Aã€Bã€Cï¼‰ï¼Œç„¶åæ ¹æ®ç½‘ç»œå¸¦å®½ç­‰å› ç´ ï¼Œä¸‹è½½æŒ‡å®šçš„äºŒçº§ç´¢å¼•æ–‡ä»¶ï¼Œè€ŒäºŒçº§ç´¢å¼•æ–‡ä»¶åˆ™æ˜¯è®°å½•äº†TSæ–‡ä»¶çš„ä¸‹è½½åœ°å€ï¼Œè¿™æ ·å°±å¯ä»¥æ‹¿åˆ°å®Œæ•´çš„è§†é¢‘æµäº†ã€‚ master_playlist.m3u8 å­—æ®µ #EXTM3U // ç¬¬ä¸€è¡Œæ ‡ç¤º #EXT-X-VERSION:3 // åè®®ç‰ˆæœ¬ï¼Œä¸å­˜åœ¨è¯´æ˜æ˜¯ç‰ˆæœ¬1 #EXT-X-STREAM-INF:PROGRAM-ID=0,BANDWIDTH=354986,RESOLUTION=320x180 //æµä¿¡æ¯ #EXTM3U #EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=1064000 1000kbps.m3u8 #EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=564000 500kbps.m3u8 #EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=282000 250kbps.m3u8 #EXT-X-STREAM-INF:PROGRAM-ID=1,BANDWIDTH=2128000 2000kbps.m3u8 äºŒçº§æ–‡ä»¶ v.f230.m3u8 å­—æ®µ v.f210.m3u8 #EXT-X-STREAM-INF:PROGRAM-ID=0,BANDWIDTH=633293,RESOLUTION=640x360 v.f220.m3u8 #EXT-X-STREAM-INF:PROGRAM-ID=0,BANDWIDTH=1198319,RESOLUTION=1280x720 v.f230.m3u8 #EXTM3U #EXT-X-PLAYLIST-TYPE:VOD #EXT-X-TARGETDURATION:10 // TSæ–‡ä»¶è§†é¢‘æœ€å¤§æ—¶é•¿ #EXTINF:10, // TSæ–‡ä»¶è§†é¢‘æ—¶é•¿ 2000kbps-00001.ts #EXTINF:10, 2000kbps-00002.ts ... ... #EXTINF:10, 2000kbps-00099.ts #EXTINF:10, 2000kbps-00100.ts #ZEN-TOTAL-DURATION:999.66667 #ZEN-AVERAGE-BANDWIDTH:2190954 #ZEN-MAXIMUM-BANDWIDTH:3536205 #EXT-X-ENDLIST //è§†é¢‘ç»“æŸæ ‡å¿—ï¼Œæœ‰è¿™ä¸ªå€¼è¯´æ˜æ˜¯éç›´æ’­æµ #EXT-X-MEDIA-SEQUENCE:0 //åºåˆ—å· #EXT-X-KEY:METHOD=AES-128 //æ˜¯å¦åŠ å¯†ï¼Œå–å€¼ï¼ˆNONEã€AES-128ã€SAMPLE-AESï¼‰ï¼Œè¡¨ç¤ºå½“å‰æ ‡ç­¾åˆ°ä¸‹ä¸€ä¸ªæ ‡ç­¾ä¹‹é—´ç”¨è¿™ç§åŠ å¯†æ–¹å¼ æ’­æ”¾æ¨¡å¼ ç‚¹æ’­VOD å¯ä»¥ç›´æ¥è·å–æ‰€æœ‰ä¸€çº§äºŒçº§é™æ€æ–‡ä»¶ï¼Œä¹Ÿå°±å¯ä»¥è®¿é—®ä»»æ„TSæ–‡ä»¶ã€‚ Liveç›´æ’­ å®æ—¶åŠ¨æ€ç”ŸæˆäºŒçº§ index æ–‡ä»¶ã€‚ "},"æµåª’ä½“/HTTP-FLV.html":{"url":"æµåª’ä½“/HTTP-FLV.html","title":"HTTP-FLV","keywords":"","body":"HTTP-FLV åè®® é€šè¿‡åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œé€šè¿‡HTTPåè®®ä¼ è¾“FLVæ ¼å¼ å¯¹æ¯”RTMP ä¸€å®šç¨‹åº¦ä¸Šé¿å…é˜²ç«å¢™çš„å¹²æ‰°ï¼› å…¼å®¹HTTP 302 è·³è½¬ï¼› HTTPS åŠ å¯†ï¼› "},"æµåª’ä½“/RTMP.html":{"url":"æµåª’ä½“/RTMP.html","title":"RTMP","keywords":"","body":"RTMP åè®® Real Time Messaging Protocol å®æ—¶æ¶ˆæ¯ä¼ è¾“åè®®ï¼Œæ˜¯ä¸€ç§ç”¨æ¥è¿›è¡Œå®æ—¶æ•°æ®é€šä¿¡çš„ç½‘ç»œåè®®ã€‚ä¸€èˆ¬ä¼ è¾“FLVæ ¼å¼çš„éŸ³è§†é¢‘ã€‚ RTMPå¯ä»¥ç†è§£ä¸ºåè®®æ—ï¼ŒåŒ…å«æœ‰ï¼šRTMPT/RTMPS/RTMPE ç­‰åè®®ã€‚ é»˜è®¤ç«¯å£ï¼š1935ï¼ˆå¯èƒ½ä¼šè¢«é˜²ç«å¢™å±è”½ï¼‰ RTMPä¸€èˆ¬åœ¨ TCP ä¸€ä¸ªé€šé“ä¸Šä¼ è¾“å‘½ä»¤å’Œæ•°æ® åè¯è§£æ Payload (æœ‰æ•ˆè´Ÿè½½) åŒ…å«äºä¸€ä¸ªæ•°æ®åŒ…ä¸­çš„æ•°æ® Packet (æ•°æ®åŒ…) æ•°æ®åŒ…ç”±ä¸€ä¸ªå›ºå®šå¤´å’Œæœ‰æ•ˆè´Ÿè½½æ•°æ®ç»„æˆ chunkï¼ˆå—ï¼‰ ä¸€ä¸ª chunk å°±æ˜¯ä¸€ä¸ª RTMP åŒ… Metadata (å…ƒæ•°æ®) æµä¿¡æ¯æè¿°ï¼ŒåŒ…æ‹¬åç§°ã€æ—¶é•¿ã€åˆ›å»ºæ—¶é—´ç­‰ã€‚ Multiplexing (æ··åˆ) å°†éŸ³é¢‘è·Ÿè§†é¢‘æ•´åˆä¸ºç»Ÿä¸€çš„éŸ³è§†é¢‘æµï¼Œä»¥ä½¿å¤šä¸ªéŸ³è§†é¢‘æµå¯ä»¥åŒæ­¥ä¼ è¾“ã€‚ DeMultiplexing (åˆ†è§£) å°†éŸ³é¢‘å’Œè§†é¢‘æ•°æ®è¿˜åŸæˆåŸå§‹éŸ³é¢‘å’Œè§†é¢‘æ•°æ®çš„æ ¼å¼ã€‚ RTMP å—æµï¼ˆRTMP Chunk Streamï¼‰ ä¸ºä¸Šå±‚å¤šåª’ä½“æµåè®®æä¾›æ··åˆå’Œåˆ†åŒ…çš„åŠŸèƒ½ï¼Œæ¶ˆæ¯åŒ…å« timestamp å’Œ payload ç±»å‹æ ‡è¯†ã€‚ æ¶ˆæ¯æ ¼å¼ Message Format æ¶ˆæ¯æ ¼å¼å–å†³äºä¸Šå±‚åè®®ï¼Œæ¶ˆæ¯å¯ä»¥è¢«åˆ†æˆå¤šä¸ªå—ä»¥æ”¯æŒæ··åˆã€‚æ¶ˆæ¯æ ¼å¼å¿…é¡»åŒ…å«ä»¥ä¸‹åˆ›å»ºå—æ‰€éœ€çš„å­—æ®µï¼š æ—¶é—´æˆ³ï¼ˆTimestampï¼‰: å 4ä¸ªå­—èŠ‚ï¼› é•¿åº¦ï¼ˆLengthï¼‰: æœ‰æ•ˆè´Ÿè½½é•¿åº¦ï¼ŒåŒ…å«æ¶ˆæ¯å¤´çš„é•¿åº¦ï¼Œå 3ä¸ªå­—èŠ‚ï¼› ç±»å‹IDï¼ˆType Idï¼‰: å 1ä¸ªå­—èŠ‚ï¼› æ¶ˆæ¯æµIDï¼ˆMessage Stream IDï¼‰: æ··åˆåˆ°åŒä¸€ä¸ªå—æµçš„æ¶ˆæ¯æµï¼Œä¼šæ ¹æ®æ¶ˆæ¯æµIDè¿›è¡Œåˆ†è§£ã€‚å 4ä¸ªå­—èŠ‚ï¼Œå°ç«¯ï¼› æ¡æ‰‹ ä¸€ä¸ª RTMP è¿æ¥ä»¥æ¡æ‰‹å¼€å§‹ï¼Œç”±ä¸‰ä¸ªå›ºå®šé•¿åº¦çš„å—ç»„æˆã€‚ ä»¥å®¢æˆ·ç«¯å‘é€ C0 å’Œ C1 å—å¼€å§‹ã€‚ å®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…æ¥æ”¶åˆ° S1 æ‰èƒ½å‘é€ C2ã€‚ å®¢æˆ·ç«¯å¿…é¡»ç­‰å¾…æ¥æ”¶åˆ° S2 æ‰èƒ½å‘é€ä»»ä½•å…¶ä»–æ•°æ®ã€‚ æœåŠ¡å™¨å¿…é¡»ç­‰å¾…æ¥æ”¶åˆ° C0 æ‰èƒ½å‘é€ S0 å’Œ S1ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥æ”¶åˆ° C1 åå‘é€ã€‚ æœåŠ¡å™¨å¿…é¡»ç­‰å¾…æ¥æ”¶åˆ° C1 æ‰èƒ½å‘é€ S2ã€‚ æœåŠ¡å™¨å¿…é¡»ç­‰å¾…æ¥æ”¶åˆ° C2 æ‰èƒ½å‘é€å…¶ä»–æ•°æ®ã€‚ //ä¸ºäº†å°½é‡å‡å°‘é€šä¿¡çš„æ¬¡æ•°ï¼Œå‘é€é¡ºåºå¯ä»¥ä¼˜åŒ–æˆä¸‰æ­¥ å®¢æˆ·ç«¯å‘é€ C0 + C1 æœåŠ¡å™¨å‘é€ S0 + S1 + S2 å®¢æˆ·ç«¯å‘é€ C2 æ¡æ‰‹ç¤ºæ„å›¾ ç®€åŒ–åçš„æ¡æ‰‹ç¤ºæ„å›¾ c0 å’Œ s0 éƒ½æ˜¯ 8-bit çš„æ•´å‹å­—æ®µï¼›åˆ†åˆ«è¡¨ç¤º client/server æ”¯æŒçš„ versionï¼Œé€šå¸¸ä¸º3ï¼› c1 å’Œ s1 éƒ½æ˜¯ 1536 å­—èŠ‚ï¼›1. æ—¶é—´æˆ³ï¼ˆTimeï¼Œ4 bytesï¼Œé€šå¸¸ä¸º0ï¼Œæ˜¯ä¹‹åå‘é€chunkæµçš„å‚è€ƒæ—¶é—´ï¼‰ï¼›2. Zeroï¼ˆ4 bytesï¼Œæ’ä¸º0ï¼‰ï¼›3. Random dataï¼ˆ1528 bytesï¼Œéšæœºæ•°ï¼‰ï¼› c2 å’Œ s2 éƒ½æ˜¯ 1536 å­—èŠ‚ï¼›1. æ—¶é—´æˆ³ï¼ˆTimeï¼Œ4 bytesï¼Œc2å¡«å…¥s1åŒ…é‡Œçš„æ—¶é—´æˆ³ï¼Œs2å¡«å…¥c1åŒ…é‡Œçš„æ—¶é—´æˆ³ï¼‰ï¼›2.æ—¶é—´æˆ³2ï¼ˆ4 bytesï¼Œc2å¡«å…¥s1åŒ…é‡Œçš„æ—¶é—´æˆ³ï¼Œs2å¡«å…¥c1åŒ…é‡Œçš„æ—¶é—´æˆ³ï¼‰ï¼›3. Random echoï¼ˆ1528 bytesï¼Œ c2å¡«å…¥s1åŒ…é‡Œçš„éšæœºæ•°ï¼Œs2å¡«å…¥c1åŒ…é‡Œçš„éšæœºæ•°ï¼‰ RTMPå»ºç«‹è¿æ¥æµç¨‹ åˆ†å— Chunking message éœ€è¦æ ¹æ® chunk size æ‹†åˆ†æˆ chunk å‘é€ï¼Œchunk å¿…é¡»æŒ‰é¡ºåºå‘é€ï¼Œæ‰€ä»¥ chunk æ˜¯æ•°æ®å°åŒ…åŠå‘é€çš„æœ€å°å•ä½ã€‚æ¯ä¸ª chunk å«æœ‰msidï¼Œæ¥æ”¶ç«¯ä¼šæŒ‰ç…§è¿™ä¸ª id å°† chunk ç»„è£…æˆ messageã€‚ å¥½å¤„æ˜¯é¿å…ä¸€äº›æ•°æ®é‡å¤§ä½†ä¼˜å…ˆçº§è¾ƒä½çš„æ¶ˆæ¯ï¼ˆvideoï¼‰é˜»å¡æ•°æ®é‡å°ä½†ä¼˜å…ˆçº§è¾ƒé«˜çš„æ¶ˆæ¯ï¼ˆaudioå’Œcontrolï¼‰ chunk size é»˜è®¤128å­—èŠ‚ï¼Œå¯ä»¥æ ¹æ®ç½‘ç»œå¸¦å®½ã€CPUåˆ©ç”¨ç‡ç­‰ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´ chunk sizeã€‚ Chunk æ ¼å¼ Chunk = Chunk Header + Chunk Data Chunk Header = Basic Header + Message Header + Extended Timestamp Basic Header = fmtï¼ˆchunk typeï¼‰ + Chunk Stream ID "},"æµåª’ä½“/RTP-RTCP-RTSP.html":{"url":"æµåª’ä½“/RTP-RTCP-RTSP.html","title":"RTP-RTCP-RTSP","keywords":"","body":"RTP-RTCP-RTSP åè®® RTP(Real-time Transport Protocol å®æ—¶ä¼ è¾“åè®®) ä¸»è¦ç”¨æ¥ä¼ è¾“éŸ³è§†é¢‘æ•°æ®ï¼ŒæŒ‡æ˜äº†ç½‘ç»œä¼ è¾“ä¸­ï¼ŒéŸ³é¢‘ã€è§†é¢‘çš„æ ‡å‡†æ•°æ®åŒ…æ ¼å¼ã€‚é»˜è®¤ä½¿ç”¨UDPï¼Œå¹¶ä½¿ç”¨å¶æ•°ç«¯å£ã€‚ RTCP(Real-time Transport Control Protocol å®æ—¶ä¼ è¾“æ§åˆ¶åè®®) ä¸»è¦ç”¨æ¥åé¦ˆå®æ—¶æµåª’ä½“ä¼ è¾“è¿‡ç¨‹ä¸­çš„è´¨é‡ï¼ˆå»¶æ—¶ã€ä¸¢åŒ…ç­‰ï¼‰ï¼Œä»¥ä¾¿ä¼˜åŒ–æ’­æ”¾ä½“éªŒï¼Œæ¯”å¦‚å»¶æ—¶ç‡ã€ä¸¢åŒ…ç‡é«˜æ—¶ï¼Œé™ä½å®æ—¶æµåª’ä½“ç ç‡ã€‚ä¸€èˆ¬ä½¿ç”¨UDPï¼Œè·ŸRTPä¸€èµ·ç§°ä¸ºå§å¦¹åè®®ï¼Œä¸€èˆ¬ä½¿ç”¨å¥‡æ•°ç«¯å£ã€‚ RTSP(Real Time Streaming Protocol å®æ—¶æµä¼ è¾“åè®®) ä¸»è¦ç”¨æ¥ç»™å®æ—¶æµåª’ä½“æ·»åŠ æ’­æ”¾ã€æš‚åœã€åé€€ã€å‰è¿›ç­‰åŠŸèƒ½ï¼Œä¹Ÿæ˜¯æ§åˆ¶åè®®ï¼ŒåŸºäºTCPã€‚ å®šä¹‰äº†ä¸€å¯¹å¤šåº”ç”¨ç¨‹åºé€šè¿‡IPç½‘ç»œä¼ é€å¤šåª’ä½“æ•°æ®çš„æ–¹å¼ï¼Œå¯¹æµåª’ä½“æä¾›äº†æ’­æ”¾ã€æš‚åœã€åé€€ã€å‰è¿›ç­‰åŠŸèƒ½ï¼Œå› æ­¤ RTSP åˆç§°ä¸ºâ€œå› ç‰¹ç½‘å½•åƒæœºé¥æ§åè®®â€ã€‚ ä¸»è¦ç”¨äºï¼Œè¿œç¨‹æ‘„åƒå¤´ã€åœ¨çº¿è§†é¢‘ã€äº’è”ç½‘ç›´æ’­ç­‰ã€‚ RTSPä¼ è¾“ä¸€èˆ¬éœ€è¦2-3ä¸ªé€šé“ï¼Œå‘½ä»¤å’Œæ•°æ®é€šé“åˆ†ç¦»ã€‚ RTSPæŠ¥æ–‡ åŸºäºæ–‡æœ¬çš„åè®®ï¼Œç”¨CRLF(å›è½¦æ¢è¡Œ)ä½œä¸ºæ¯ä¸€è¡Œçš„ç»“æŸç¬¦ï¼ˆä¼˜ç‚¹ï¼šæ–¹ä¾¿å¢åŠ è‡ªå®šä¹‰å‚æ•°ï¼Œä¹Ÿæ–¹ä¾¿æŠ“åŒ…åˆ†æï¼‰ã€‚æŠ¥æ–‡æœ‰ä¸¤ç±»ï¼šè¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ï¼ŒåŒå‘é€šä¿¡ï¼› RTSP æŠ¥æ–‡ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå³å¼€å§‹è¡Œï¼ˆè¯·æ±‚è¡Œï¼‰ã€é¦–éƒ¨è¡Œå’Œå®ä½“ä¸»ä½“ã€‚ æ–‡æ¡£ å®˜æ–¹æŒ‡å¯¼æ–‡æ¡£ Real Time Streaming Protocol (RTSP) "},"éŸ³è§†é¢‘/éŸ³è§†é¢‘.html":{"url":"éŸ³è§†é¢‘/éŸ³è§†é¢‘.html","title":"éŸ³è§†é¢‘","keywords":"","body":"éŸ³è§†é¢‘ éŸ³é¢‘æ¦‚å¿µ é‡‡æ ·ç‡ 1ç§’é’Ÿé‡‡é›†å¤šå°‘ä¸ªæ•°æ® é‡‡æ ·ä½æ•° æ¯æ¬¡é‡‡æ ·çš„æ•°æ®ç”¨å¤šå°‘ä½å­˜å‚¨ å£°é“æ•° æœ‰å¤šå°‘ä¸ªå£°é“ï¼Œä¸€èˆ¬å•å£°é“æˆ–è€…å·¦å£°é“å’Œå³å£°é“ï¼›æ¯ä¸ªå£°é“çš„æ•°æ®æ—¶ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥éœ€è¦å­˜å‚¨ä¸¤ä»½ã€‚ ç ç‡ï¼ˆæ¯”ç‰¹ç‡ï¼‰ æ¯ç§’é’Ÿä¼ è¾“çš„æ•°æ®å¤§å°ï¼Œç ç‡ = é‡‡æ ·ç‡ âˆ— é‡‡æ ·ä½æ•° âˆ— å£°é“æ•°ï¼›bpså°±æ˜¯æ¯”ç‰¹ç‡ã€‚bå°±æ˜¯æ¯”ç‰¹ï¼ˆbitï¼‰ï¼Œså°±æ˜¯ç§’ï¼ˆsecondï¼‰ï¼Œpå°±æ˜¯æ¯ï¼ˆperï¼‰ï¼Œä¸€ä¸ªå­—èŠ‚ç›¸å½“äº8ä¸ªbitä½ã€‚ å¸§ æ²¡æœ‰æ˜ç¡®æ¦‚å¿µï¼Œä¸€èˆ¬AACå¸§å¤§å°ä¸º1024ä¸ªé‡‡æ ·ç‚¹ï¼ŒMP3ä¸º1152ä¸ªé‡‡æ ·ç‚¹ï¼› å°±æ˜¯ä¸€ä¸ªå‹ç¼©åŒ…çš„ sample ä¸ªæ•° éŸ³é¢‘åŸºæœ¬åè¯ PTS DTS PTSï¼ˆPresentation Time Stampï¼‰æ˜¾ç¤ºæ—¶é—´æˆ³DTSï¼ˆDecoding Time Stampï¼‰è§£ç æ—¶é—´æˆ³ å¯¹äºéŸ³é¢‘æ¥è¯´ï¼ŒPTS == DTSè€Œå¯¹äºè§†é¢‘æ¥è¯´ï¼Œå†æœ‰ B å¸§çš„æƒ…å†µä¸‹ï¼ŒPTS ä¸ä¸€å®šç­‰äº DTS ä»€ä¹ˆæ˜¯ IPB å¸§ I å¸§ï¼šintra pictureï¼Œå¸§å†…ç¼–ç å¸§ï¼›å¯ä»¥ç‹¬ç«‹è§£ç ï¼Œå‹ç¼©æ—¶ä¹Ÿæ˜¯è‡ªå·±å†…éƒ¨å‹ç¼©ï¼Œæ‰€ä»¥ä¸€èˆ¬è§†é¢‘çš„ç¬¬ä¸€å¸§å°±æ˜¯ I å¸§ã€‚å‹ç¼©ç‡è¾ƒä½ã€‚ P å¸§ï¼špredictive-frameï¼Œå‰å‘é¢„æµ‹ç¼–ç å¸§ï¼›éœ€è¦åŠ ä¸Šå‰ä¸€ä¸ª I å¸§ æˆ–è€… P å¸§è¾…åŠ©æ‰èƒ½è§£å‹ï¼Œå‹ç¼©ç‡æ¯” I å¸§é«˜ B å¸§ï¼šbi-directional interpolated prediction frameï¼ŒåŒå‘é¢„æµ‹å†…æ’ç¼–ç å¸§ï¼›éœ€è¦å‰ä¸€ä¸ª I æˆ–è€… P å¸§åŠå…¶åé¢çš„ä¸€ä¸ª P å¸§æ‰èƒ½è§£å‹ï¼Œå‹ç¼©ç‡æœ€é«˜ å½“è§†é¢‘æµBå¸§åˆ°æ¥æ—¶ï¼Œéœ€è¦ç­‰å¾…å…¶ I å¸§è·Ÿ åé¢çš„ På¸§è§£å‹å®Œæ‰èƒ½è§£å‹ï¼Œæ‰€ä»¥å°±éœ€è¦ DTS è·Ÿ PTSæ¥è¯†åˆ«ï¼ŒDTSè¡¨ç¤ºå¯ä»¥è§£å‹äº†ï¼Œè§£å‹åï¼Œæ’å…¥åˆ°å·²è§£å‹çš„é˜Ÿåˆ—ä¸­ï¼Œæ˜¾ç¤ºæ—¶æ ¹æ® PTS å¤§å°æ˜¾ç¤º ç¤ºä¾‹ è§†é¢‘é‡‡é›†å¸§é¡ºåºï¼šI B B P B B På¯¹åº”çš„PTSï¼š1 2 3 4 5 6 7ç¼–ç é¡ºåºä¸ºï¼š1 4 2 3 7 5 6 ä¹Ÿå°±æ˜¯ I P B B P B Bç¼–ç é¡ºåºå¯¹åº”çš„DTSï¼š1 2 3 4 5 6 7æ¨æµå‡ºå»çš„é¡ºåº(ç­‰äºç¼–ç é¡ºåº)ï¼šI P B B P B Bæ”¶çš„å¸§é¡ºåºï¼šI P B B P B Bæ”¶çš„PTSé¡ºåºï¼š1 4 2 3 7 5 6æ”¶çš„DTSé¡ºåºï¼š1 2 3 4 5 6 7 GOPï¼ˆGroup Of Pictureï¼Œå›¾åƒåºåˆ—ï¼‰ ä¸¤ä¸ª I å¸§ä¹‹é—´å½¢æˆä¸€ä¸ª GOP IDRï¼ˆInstantaneous Decoding Refreshï¼Œå³æ—¶è§£ç åˆ·æ–°ï¼‰ IDRå¸§ä¼šå¯¼è‡´DPBï¼ˆDecoded Picture Bufferï¼‰æ¸…ç©ºï¼Œåœ¨ IDR å¸§ä¹‹åçš„æ‰€æœ‰å¸§éƒ½ä¸èƒ½å¼•ç”¨ä»»ä½• IDR å¸§ä¹‹å‰çš„å¸§çš„å†…å®¹ã€‚æ’­æ”¾å™¨å¯ä»¥ä»ä¸€ä¸ªIDRå¸§æ’­æ”¾ï¼Œå…·æœ‰éšæœºè®¿é—®çš„èƒ½åŠ›ã€‚ä¸€ä¸ª GOP çš„ç¬¬ä¸€ä¸ªå›¾åƒå«åš IDR å›¾åƒï¼ˆç«‹å³åˆ·æ–°å›¾åƒï¼‰ï¼ŒIDR å›¾åƒéƒ½æ˜¯ I å¸§å›¾åƒ "},"éŸ³è§†é¢‘/PCM.html":{"url":"éŸ³è§†é¢‘/PCM.html","title":"PCM","keywords":"","body":"PCM PCMï¼ˆPulse Code Modulationï¼Œè„‰å†²ç¼–ç è°ƒåˆ¶ï¼‰ ä¹Ÿå°±æ˜¯é‡‡é›†åˆ°çš„åŸå§‹éŸ³é¢‘æ•°æ®ï¼Œæ˜¯ç”±æ¨¡æ‹Ÿä¿¡å·ç»è¿‡é‡‡æ ·ã€é‡åŒ–ã€ç¼–ç è½¬æ¢æˆçš„æ ‡å‡†æ•°å­—éŸ³é¢‘æ•°æ®ã€‚ æè¿°PCM Sample Rate : é‡‡æ ·é¢‘ç‡ã€‚ Sample Size : ä½æ•°ï¼Œå¸¸è§å€¼ï¼š8bitã€16bitã€‚ Number of Channels : é€šé“æ•°ã€‚ç«‹ä½“å£°(stereo)å’Œå•å£°é“(mono)ï¼Œç«‹ä½“å£°åŒ…å«å·¦å£°é“å’Œå³å£°é“ã€‚ Sign : ç¬¦å·ä½ï¼Œæœ‰ç¬¦å·è¡¨ç¤ºèŒƒå›´ä¸º-128 ~ 127ï¼Œæ— ç¬¦å·åˆ™æ˜¯0 ~ 255ã€‚ Byte Ordering : å­—èŠ‚åºï¼Œå¤§ç«¯big-endian ã€é€šå¸¸ä¸ºå°ç«¯little-endianã€‚ Integer Or Floating Point : æ•´å½¢ã€æµ®ç‚¹å‹è¡¨ç¤ºã€‚ é€šè¿‡ pcm éŸ³é¢‘æ•°æ®è®¡ç®—åˆ†è´ å…¶å®å°±æ˜¯æ ¹æ®éŸ³é¢‘å€¼å¤§å°æ¥è®¡ç®—ï¼Œä½†ç”±äºéŸ³é¢‘å¤§å°éƒ½æ˜¯å½’ä¸€åŒ–åçš„æ•°æ®ï¼Œæ‰€ä»¥æœ€ç»ˆæ•°æ®åªæ˜¯ä¸€ä¸ªç›¸å¯¹å€¼ "},"éŸ³è§†é¢‘/AAC.html":{"url":"éŸ³è§†é¢‘/AAC.html","title":"AAC","keywords":"","body":"AAC AAC(Advanced Audio Codingï¼Œé«˜çº§éŸ³é¢‘ç¼–ç )æ˜¯ä¸€ç§å£°éŸ³æ•°æ®çš„æ–‡ä»¶å‹ç¼©æ ¼å¼ï¼Œåˆåˆ†ä¸º ADIF å’Œ ADTS ä¸¤ç§æ ¼å¼ã€‚ ADIFï¼šAudio Data Interchange Format éŸ³é¢‘æ•°æ®äº¤æ¢æ ¼å¼ï¼›åªæœ‰æ–‡ä»¶çš„å¼€å§‹å¤„æœ‰ header å­—èŠ‚ï¼Œè§£ç åªèƒ½åœ¨å¤´å­—èŠ‚å¤„å¼€å§‹è¿›è¡Œï¼Œå¸¸ç”¨åœ¨ç£ç›˜æ–‡ä»¶ä¸­ã€‚ ADTSï¼šAudio Data Transport Stream éŸ³é¢‘æ•°æ®ä¼ è¾“æµï¼›æ¯ä¸€å•å…ƒéŸ³é¢‘æ•°æ®éƒ½æœ‰ä¸€ä¸ª header å­—èŠ‚ï¼Œä»»ä½•ä¸€ä¸ªéŸ³é¢‘æ•°æ®éƒ½å¯ä»¥å•ç‹¬è§£ç ã€‚ "},"éŸ³è§†é¢‘/éŸ³è§†é¢‘åŒæ­¥.html":{"url":"éŸ³è§†é¢‘/éŸ³è§†é¢‘åŒæ­¥.html","title":"éŸ³è§†é¢‘åŒæ­¥","keywords":"","body":"ç›´æ’­éŸ³è§†é¢‘åŒæ­¥ éŸ³é¢‘è·Ÿè§†é¢‘æ˜¯ç‹¬ç«‹æ’­æ”¾çš„ï¼Œå¯ä»¥è®¤ä¸ºå¤§éƒ¨åˆ†æ—¶å€™éŸ³è§†é¢‘éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä½†åªè¦è¯¯å·®åœ¨ä¸€å®šçš„èŒƒå›´å†…ï¼Œäººæ˜¯æ— æ³•æ„ŸçŸ¥çš„ï¼› åŒæ­¥æ–¹å¼æœ‰ä¸‰ç§ 1ã€å°†éŸ³é¢‘åŒæ­¥åˆ°è§†é¢‘ä¸Šï¼Œä»¥è§†é¢‘çš„æ’­æ”¾é€Ÿåº¦ä¸ºåŸºå‡†åŒæ­¥éŸ³é¢‘ã€‚ 2ã€å°†è§†é¢‘åŒæ­¥åˆ°éŸ³é¢‘ä¸Šï¼Œä»¥éŸ³é¢‘çš„æ’­æ”¾é€Ÿåº¦ä¸ºåŸºå‡†åŒæ­¥è§†é¢‘ã€‚ 3ã€ä½¿ç”¨ä¸€ä¸ªå¤–éƒ¨æ—¶é’Ÿï¼Œå°†éŸ³è§†é¢‘éƒ½ä»¥è¯¥æ—¶é’Ÿä¸ºåŸºå‡†ã€‚ ä¸€èˆ¬å‘ç°éŸ³é¢‘å»¶æ—¶äº†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨sonicåŠ é€ŸéŸ³é¢‘ã€‚ ç†è®ºä¸Šï¼Œè§†é¢‘çš„fpsæ¯”è¾ƒä½ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œæ‰€ä»¥åŠ é€Ÿè§†é¢‘æ’­æ”¾æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æ ¹æ®PTSåˆ¤æ–­å³å¯ é—®é¢˜1ï¼šåªæ¨é€éŸ³é¢‘æˆ–è€…è§†é¢‘ æ‹‰æµæ—¶å‘ç°å¦‚æœæ¨æµç«¯åªæ¨é€éŸ³é¢‘æˆ–è€…è§†é¢‘ï¼Œé‚£ä¹ˆè¿™æ—¶å€™åªèƒ½ä½¿ç”¨å¤–éƒ¨æ—¶é’Ÿï¼Ÿç›®å‰è¿˜ä¸çŸ¥é“æ€ä¹ˆå¤„ç†è¿™ä¸ªé—®é¢˜ "},"éŸ³è§†é¢‘/H264.html":{"url":"éŸ³è§†é¢‘/H264.html","title":"H264","keywords":"","body":"H264 ä¸€ç§é«˜åº¦å‹ç¼©çš„ç¼–è§£ç å™¨æ ‡å‡†ã€‚ H.264ä¸­ï¼Œè§†é¢‘ç¼–ç åçš„æ•°æ®ç§°ä¸ºç¼–ç å±‚ï¼ˆVCLï¼‰ï¼ŒVCLå°è£…åçš„æ•°æ®ç§°ä¸ºç½‘ç»œé€‚é…å±‚ï¼ˆNALï¼‰ VCL è´Ÿè´£å‹ç¼©æ•°æ® åˆ‡åˆ†æ•°æ® åŒ…è£…NAL NALU NALU = NAL unit = NALU header + NALU payload "},"éŸ³è§†é¢‘/FLV.html":{"url":"éŸ³è§†é¢‘/FLV.html","title":"FLV","keywords":"","body":"FLV Flash Videoï¼ŒAdobe å…¬å¸è®¾è®¡éŸ³è§†é¢‘å°è£…æ ¼å¼ï¼Œå…·æœ‰ä½“ç§¯è½»å·§ã€å°è£…ç®€å•ç­‰ç‰¹ç‚¹ã€‚ FLV = FLV Header + FLV Body FLV Header Header å 9ä¸ªå­—èŠ‚ï¼Œè®°å½•äº†ç±»å‹ã€ç‰ˆæœ¬ã€æµä¿¡æ¯ã€é•¿åº¦ç­‰ä¿¡æ¯ã€‚å¤§äº9ä¸ªå­—èŠ‚åˆ™è¡¨ç¤ºè¿˜å­˜å‚¨æ‰©å±•æ•°æ® FLV Body FLV Body = PreviousTag+Tagï¼ŒPreviousTag å­˜æ”¾å‰é¢ä¸€ä¸ª Tag çš„å¤§å°ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œè¯»å–æ•°æ®å°±åªèƒ½ä»åé¢å¼€å§‹è¯»å–äº† Tag FLV Tag = Tag Header + Tag Dataã€‚ Tag Header å­˜æ”¾äº†ç±»å‹ã€æ•°æ®é•¿åº¦ã€æ—¶é—´æˆ³ã€æ—¶é—´æˆ³æ‰©å±•ã€StreamsIDç­‰ä¿¡æ¯ã€‚ Tag Data å­˜æ”¾ Audioã€Videoã€Script ä¸‰è€…ä¹‹ä¸€ã€‚ Audio Tag Data Audio Tag Data = AudioTagHeader + Dataã€‚ AudioTagHeader å­˜æ”¾äº†éŸ³é¢‘æ ¼å¼æè¿°ã€é¢‘ç‡ã€é‡‡æ ·ä½ã€å£°é“ç±»å‹ç­‰ Video Tag Data Video Tag = VideoTagHeader + Videoã€‚ VideoTagHeader å­˜æ”¾Frameç±»å‹ è·Ÿ ç¼–ç ç±»å‹ Script Tag Data "},"éŸ³è§†é¢‘/MP4.html":{"url":"éŸ³è§†é¢‘/MP4.html","title":"MP4","keywords":"","body":"MP4 (MPEG-4) MP4å®šåˆ¶äº†ä¸€å¥—ç”¨äºéŸ³é¢‘ã€è§†é¢‘å‹ç¼©ç¼–ç æ ‡å‡† ï¼Œç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰å’Œå›½é™…ç”µå·¥å§”å‘˜ä¼šï¼ˆIECï¼‰ä¸‹å±çš„â€œåŠ¨æ€å›¾åƒä¸“å®¶ç»„â€ï¼ˆMoving Picture Experts Groupï¼‰ã€‚ box mp4ç”±å¤šä¸ª box ç»„æˆï¼Œbox ç”± header å’Œ body ç»„æˆï¼Œå¹¶å¯ä»¥åµŒå¥—ã€‚ "},"éŸ³è§†é¢‘/TS.html":{"url":"éŸ³è§†é¢‘/TS.html","title":"TS","keywords":"","body":"TS Transport Streamï¼Œä¼ è¾“æµï¼Œæ˜¯ä¸€ç§åŸºäº MPEG-2 çš„éŸ³è§†é¢‘å°è£…æ ¼å¼ã€‚ ç»“æ„ ESå±‚ï¼ˆElementary Streamï¼‰ å‹ç¼©åçš„éŸ³è§†é¢‘æ•°æ®ï¼Œä¸€ä¸ª ES æµä¸­åªåŒ…å«ä¸€ç§ç±»å‹çš„æ•°æ®ï¼ˆè§†é¢‘ã€éŸ³é¢‘ã€å­—å¹•ï¼‰ PESå±‚ï¼ˆPacket Elemental Streamï¼‰ åœ¨ ESå±‚ å±‚çš„åŸºç¡€ä¸ŠåŠ ä¸Šæ—¶é—´æˆ³(PTS/DTS)ç­‰ä¿¡æ¯ï¼ŒåŒ…å«ä¸€ä¸ªPESå¤´+å¤šä¸ªESåŒ…ã€‚ TSå±‚ï¼ˆTransport Streamï¼‰ PESå±‚çš„åŸºç¡€ä¸ŠåŠ å…¥äº†æ•°æ®æµè¯†åˆ«ä¿¡æ¯å’Œä¼ è¾“ä¿¡æ¯ã€‚ TSåŒ…å¤§å°å›ºå®šä¸º188å­—èŠ‚ï¼Œåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šts headerã€adaptation fieldã€payloadã€‚ ts header å›ºå®š4ä¸ªå­—èŠ‚ï¼›æ¯188å­—èŠ‚å•å…ƒå°±æœ‰ä¸€ä¸ªts headerã€‚ adaptation field å¯èƒ½ä¸å­˜åœ¨ï¼Œä¸»è¦ä½œç”¨æ˜¯ç»™ä¸è¶³188å­—èŠ‚çš„æ•°æ®åšå¡«å……ã€‚ payload æ˜¯ PES æ•°æ®ï¼Œæˆ–è€… PATï¼ŒPMT ç­‰ã€‚PATã€PMT æ˜¯è§£æ TS å¯»æ‰¾éŸ³è§†é¢‘æµå¾ˆé‡è¦çš„è¡¨ã€‚ åˆ†æè½¯ä»¶ easyiceï¼Œä½†å¥½åƒæ²¡æœ‰Macç‰ˆ "},"éŸ³è§†é¢‘/YUV.html":{"url":"éŸ³è§†é¢‘/YUV.html","title":"YUV","keywords":"","body":"YUV YUVï¼ˆYCbCrï¼‰ æ˜¯ä¸€ç§é¢œè‰²ç¼–ç æ–¹å¼ï¼Œå°†äº®åº¦å‚é‡ï¼ˆYï¼‰å’Œè‰²åº¦å‚é‡ï¼ˆUVï¼‰åˆ†å¼€è¿›è¡Œè¡¨ç¤ºçš„åƒç´ ç¼–ç æ ¼å¼ã€‚å¯ä»¥æ›´å¥½çš„è¿›è¡Œç›¸å…³å›¾åƒå¤„ç†ç®—æ³•çš„å®ç°ï¼Œé€šè¿‡å‡å°‘è‰²åº¦çš„é‡‡æ ·ä¹Ÿå¯ä»¥é™ä½è§†é¢‘çš„ä¼ è¾“å¸¦å®½ã€‚ YUV 4:4:4 æ¯4ä¸ªYå¯¹åº”4ä¸ªUï¼Œ4ä¸ªVï¼Œæ¯ä¸ªåƒç´ éƒ½æœ‰YUVï¼Œå 3ä¸ªå­—èŠ‚ [ Y U V ] [ Y U V ] [ Y U V ] [ Y U V ] YUV 4:2:2 æ¯4ä¸ªYï¼Œç›¸å¯¹2ä¸ªUï¼Œ2ä¸ªVï¼Œæ¯ä¸¤ä¸ªYå…±ç”¨ä¸€ä¸ªUVåˆ†é‡ [ Y U V ] [ Y ] [ Y U V ] [ Y ] YUV 4:2:0 æ¯4ä¸ªYç›¸å¯¹åº”1ä¸ªUå’Œ1ä¸ªV [ Y U V ] [ Y ] [ Y ] [ Y ] "},"iOS/iOS.html":{"url":"iOS/iOS.html","title":"iOS","keywords":"","body":"# iOS "},"iOS/ç³»ç»Ÿç»„ä»¶/ç³»ç»Ÿç»„ä»¶.html":{"url":"iOS/ç³»ç»Ÿç»„ä»¶/ç³»ç»Ÿç»„ä»¶.html","title":"ç³»ç»Ÿç»„ä»¶","keywords":"","body":"ç³»ç»Ÿç»„ä»¶ "},"iOS/ç³»ç»Ÿç»„ä»¶/UIViewController.html":{"url":"iOS/ç³»ç»Ÿç»„ä»¶/UIViewController.html","title":"UIViewController","keywords":"","body":"UIViewController presentedViewController & presentingViewController A.present(B) => A.presentedViewController = B => B.presentingViewController = A dismissViewControllerAnimated A.present(B) B.present(C) C.present(D) //æ­¤æ—¶ A.dismiss ï¼Œä¼šç›´æ¥å°† B C D åŒæ—¶ dismiss æ‰ï¼Œå¹¶ä¸”ä¸ä¼šç»™äººæœ‰ä»»ä½•å¡é¡¿ //è°ƒç”¨ D.presenting.presenting dismissï¼Œä¼šå°† C D åŒæ—¶ dismissï¼›å› ä¸º D.presenting.presenting == B //å±‚çº§å…³ç³»ï¼Œæ¯ä¸ªé¡µé¢éƒ½æ˜¯ present å‡ºæ¥çš„ å±‚çº§0; å±‚çº§0; å±‚çº§1; å®ƒçš„presentingæ˜¯å±‚çº§0 å±‚çº§1; å®ƒçš„presentingæ˜¯å±‚çº§0 å±‚çº§2 å®ƒçš„presentingæ˜¯å±‚çº§1 å±‚çº§3 å®ƒçš„presentingæ˜¯å±‚çº§2 "},"iOS/ç³»ç»Ÿç»„ä»¶/UITextView.html":{"url":"iOS/ç³»ç»Ÿç»„ä»¶/UITextView.html","title":"UITextView","keywords":"","body":"UITextView å¯Œæ–‡æœ¬ //è®¾ç½®æ®µè½æ ·å¼ NSMutableParagraphStyle *paragraphStyle = [NSMutableParagraphStyle new]; paragraphStyle.lineBreakMode = NSLineBreakByWordWrapping; NSString *text = @\"è¯·æ‚¨åŠ¡å¿…å……åˆ†ç†è§£ã€ŠæœåŠ¡åè®®ã€‹ä¸ã€Šéšç§æ”¿ç­–ã€‹å„é¡¹æ¡æ¬¾\"; NSRange range1 = [text rangeOfString:@\"ã€ŠæœåŠ¡åè®®ã€‹\"]; NSRange range2 = [text rangeOfString:@\"ã€Šéšç§æ”¿ç­–ã€‹\"]; // NSMutableAttributedString *mutAttString = [[NSMutableAttributedString alloc] initWithString:text]; [mutAttString addAttributes:@{NSForegroundColorAttributeName:kRGB(0x333333), NSParagraphStyleAttributeName:paragraphStyle, NSFontAttributeName:kRegularFont(16)} range:NSMakeRange(0, mutAttString.length)]; // if (range1.location != NSNotFound) { [mutAttString addAttributes:@{NSForegroundColorAttributeName:kRGB(0x1C0000), NSLinkAttributeName:kAgreementLink} range:range1]; } if (range2.location != NSNotFound) { [mutAttString addAttributes:@{NSForegroundColorAttributeName:kRGB(0x1C0000), NSLinkAttributeName:kPolicyLink} range:range2]; } self.textView.attributedText = mutAttString; #pragma mark - - (BOOL)textView:(UITextView *)textView shouldInteractWithURL:(NSURL *)URL inRange:(NSRange)characterRange interaction:(UITextItemInteraction)interaction { if ([URL.absoluteString isEqualToString:kAgreementLink] || [URL.absoluteString isEqualToString:kPolicyLink]) { FCBWebViewController *vc = [[FCBWebViewController alloc] initWithURL:URL.absoluteString]; [self.navigationController pushViewController:vc animated:YES]; } return NO; } "},"iOS/ç³»ç»Ÿç»„ä»¶/UITextField.html":{"url":"iOS/ç³»ç»Ÿç»„ä»¶/UITextField.html","title":"UITextField","keywords":"","body":"UITextField //å·¦ä¾§ç©ºå‡ºé—´è· textField.leftView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 10, 1)]; textField.leftViewMode = UITextFieldViewModeAlways; //placeholder textField.placeholder = @\"ç¤ºä¾‹ï¼šhttps://example.com\"; UILabel *placeholderLabel = [textField valueForKey:@\"placeholderLabel\"]; placeholderLabel.textColor = kRGB(0xC6C6C6); "},"iOS/ä¹¦ç±/ä¹¦ç±.html":{"url":"iOS/ä¹¦ç±/ä¹¦ç±.html","title":"ä¹¦ç±","keywords":"","body":"iOS ç›¸å…³ä¹¦ç± "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Effective Objective-C 2.0.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Effective Objective-C 2.0.html","title":"Effective Objective-C 2.0","keywords":"","body":"Effective Objective-C 2.0 "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 1-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 1-1.html","title":"Chapter 1-1","keywords":"","body":"ç¬¬ä¸€ç« ï¼šç†Ÿæ‚‰ Objective-C è¯­è¨€ ç¬¬1æ¡ï¼šäº†è§£ Objective-C è¯­è¨€çš„èµ·æº æ¶ˆæ¯ç»“æ„ Objective-C ä½¿ç”¨çš„æ˜¯â€œæ¶ˆæ¯ç»“æ„â€ï¼ˆmessaging structureï¼‰è€Œéâ€œå‡½æ•°è°ƒç”¨â€ï¼ˆfunction callingï¼‰ã€‚ä½¿ç”¨æ¶ˆæ¯ç»“æ„çš„è¯­è¨€ï¼Œå…¶è¿è¡Œæ—¶æ‰€æ‰§è¡Œçš„ä»£ç ç”±è¿è¡Œç¯å¢ƒå†³å®šã€‚è€Œä½¿ç”¨å‡½æ•°è°ƒç”¨çš„è¯­è¨€ï¼Œåˆ™ç”±ç¼–è¯‘å™¨å†³å®šã€‚ åœ¨C/C++ä¸­ï¼Œå¦‚æœä½¿ç”¨çš„å‡½æ•°æ˜¯å¤šæ€ï¼Œé‚£ä¹ˆè¿è¡Œæ—¶ä¼šæ ¹æ®â€œè™šæ–¹æ³•è¡¨â€ï¼ˆvirtual tableï¼‰æ¥æŸ¥æ‰¾åº”è¯¥æ‰§è¡Œå“ªä¸ªå‡½æ•°å®ç°ã€‚è€Œé‡‡ç”¨æ¶ˆæ¯ç»“æ„çš„è¯­è¨€åˆ™éƒ½æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™æ‰æŸ¥æ‰¾è¦æ‰§è¡Œçš„æ–¹æ³•ã€‚ è¿è¡ŒæœŸç»„ä»¶ï¼ˆruntime componentï¼‰ Objective-C ä¸­é‡è¦å·¥ä½œéƒ½ç”±è¿è¡ŒæœŸç»„ä»¶å®Œæˆï¼Œè€Œéç¼–è¯‘å™¨ã€‚é‡Œé¢åŒ…å«äº†é¢å‘å¯¹è±¡æ‰€éœ€çš„å…¨éƒ¨æ•°æ®ç»“æ„åŠå‡½æ•°ã€‚å…¶æœ¬è´¨æ˜¯ä¸å¼€å‘è€…æ‰€ç¼–å†™çš„ä»£ç ç›¸é“¾æ¥çš„åŠ¨æ€åº“ã€‚ å¯¹è±¡å†…å­˜åˆ†é… å¯¹è±¡æ‰€å æœ‰çš„å†…å­˜æ€»æ˜¯åˆ†é…åˆ°å †ç©ºé—´ï¼ˆHeadï¼‰ä¸­ï¼Œè€ŒæŒ‡å‘å¯¹è±¡çš„æŒ‡é’ˆåˆ™æ˜¯åˆ†é…åˆ°æ ˆï¼ˆstackï¼‰ä¸­ã€‚åˆ†é…åˆ°å †ä¸­çš„å†…å­˜å¿…é¡»è¿›è¡Œç®¡ç†ï¼Œåˆ†é…åˆ°æ ˆä¸Šç”¨äºä¿å­˜å¯¹è±¡åœ°å€çš„å†…å­˜ï¼Œåˆ™ä¼šåœ¨æ ˆå¸§å¼¹å‡ºæ—¶è‡ªåŠ¨å¤„ç†ã€‚å½“é‡åˆ°éæŒ‡é’ˆç±»å‹å˜é‡çš„æ—¶å€™ï¼Œå˜é‡å¯èƒ½ä¼šåˆ†é…åˆ°æ ˆç©ºé—´ï¼Œæ¯”å¦‚ï¼šç»“æ„ä½“ã€‚ ç¬¬2æ¡ï¼šåœ¨ç±»çš„å¤´æ–‡ä»¶ä¸­å°½é‡å°‘å¼•ç”¨å…¶ä»–å¤´æ–‡ä»¶ å‘å‰å£°æ˜ï¼ˆforward declaringï¼‰ å¦‚æœåªéœ€è¦çŸ¥é“æœ‰é‚£ä¹ˆä¸€ä¸ªç±»åï¼Œåˆ™ä¸éœ€è¦å¼•ç”¨è¯¥ç±»åçš„å¤´æ–‡ä»¶ï¼ˆä¸éœ€è¦çŸ¥é“å…¶ä»–ç»†èŠ‚ï¼‰ï¼Œè¿™æ—¶å¯ä»¥å‘å‰å£°æ˜è¯¥ç±»ï¼Œæ—¢ä½¿ç”¨ï¼š @class className; ç„¶ååœ¨å®ç°æ–‡ä»¶ä¸­å¼•å…¥è¯¥å¤´æ–‡ä»¶ã€‚è¿™æ ·å¯ä»¥é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆã€‚å¼•å…¥å¤´æ–‡ä»¶çš„æ—¶æœºåº”è¯¥å°½é‡å»¶åï¼Œåªæœ‰å½“ç¡®å®šè¦å¼•ç”¨è¯¥å¤´æ–‡ä»¶çš„æ—¶å€™æ‰å¼•ç”¨ã€‚å°†å¤§é‡çš„å¤´æ–‡ä»¶å¼•å…¥åˆ°å¤´æ–‡ä»¶ä¸­ï¼Œä¼šå¢åŠ æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œä»è€Œå¢åŠ ç¼–è¯‘æ—¶é—´ã€‚ å¾ªç¯å¼•ç”¨ å‘å‰ç”³æ˜å¯ä»¥è§£å†³ä¸¤ä¸ªç±»ä¹‹é—´çš„å¾ªç¯å¼•ç”¨ã€‚æ–‡ç« è¯´é“ï¼š ä½¿ç”¨ #import è™½ç„¶ä¸ä¼šå¯¼è‡´å¼•ç”¨å¾ªç¯ï¼Œä½†å´æ„å‘³ç€ä¸¤ä¸ªç±»æœ‰ä¸€ä¸ªä¸èƒ½è¢«æ­£ç¡®ç¼–è¯‘ã€‚ ä¸è¿‡ï¼Œè¿™å¥è¯æˆ‘ã€‚ã€‚ã€‚ã€‚æ— æ³•ç†è§£ï¼ï¼ï¼ å¤´æ–‡ä»¶éœ€è¦å¼•ç”¨åè®® å¦‚æœè¦ä½¿ç”¨æŸä¸ªåè®®ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨å‘å‰å£°æ˜ï¼Œä¸ºäº†ä¸å¼•ç”¨æ•´ä¸ªå¤´æ–‡ä»¶ï¼Œå¯ä»¥å°†åè®®æ”¾åˆ°â€œclass-continuation åˆ†ç±»â€ä¸­ï¼Œæˆ–è€…å•ç‹¬æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œç„¶åä½¿ç”¨ #import å¼•ç”¨å¤´æ–‡ä»¶ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¸Šé¢è¯´çš„é—®é¢˜ã€‚ ç¬¬3æ¡ï¼šå¤šç”¨å­—é¢é‡è¯­æ³•ï¼Œå°‘ç”¨ä¸ä¹‹ç­‰ä»·çš„æ–¹æ³• ä½¿ç”¨å­—é¢é‡è¯­æ³•å¯ä»¥ç¼©å‡ä»£ç é•¿åº¦ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚ä¹Ÿè¦ç¡®ä¿åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¸èƒ½ä¸ºnilã€‚ NSString *string0 = [[NSString alloc] initWithString:@\"123\"]; NSString *string1 = @\"123\"; NSNumber *number0 = [NSNumber numberWithInt:1]; NSNumber *number1 = @1; NSArray *array0 = [NSArray arrayWithObjects:@\"cat\", @\"dog\", @\"fish\", nil]; NSString *cat0 = [array0 objectAtIndex:0]; NSArray *array1 = @[@\"cat\", @\"dog\", @\"fish\"]; NSString *cat1 = array1[0]; NSDictionary *dictionary0 = [NSDictionary dictionaryWithObjectsAndKeys:@\"key0\", @\"value0\", @\"key1\", @\"value1\", nil]; NSString *value0 = [dictionary0 objectForKey:@\"key0\"]; NSDictionary *dictionary1 = @{@\"key0\":@\"value0\", @\"key1\":@\"value1\"}; NSString *value1 = dictionary1[@\"key1\"]; ç¬¬4æ¡ï¼šå¤šç”¨ç±»å‹å¸¸é‡ï¼Œå°‘ç”¨ #define é¢„å¤„ç†æŒ‡ä»¤ ä½¿ç”¨ #define æ— æ³•ç¡®å®šç±»å‹ä¿¡æ¯ æ¯”å¦‚ä¸‹é¢çš„ä»£ç ç”¨ #define æ— æ³•é¢„çŸ¥ kAnimationDuration çš„æ•°æ®ç±»å‹ï¼Œä¸åˆ©äºç¼–å†™å¼€å‘æ–‡æ¡£ã€‚ #define kAnimationDuration 0.1 static const NSTimeInterval kAnimationDuration = 0.1; static const float kAnimationDuration = 0.1; static const ä¿®é¥° å¦‚æœä¸€ä¸ªå˜é‡ç”¨ static const ä¿®é¥°ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨ä¸ä¼šåˆ›å»ºç¬¦å·ï¼Œè€Œæ˜¯ä¼šåƒ #define é¢„å¤„ç†æŒ‡ä»¤ä¸€æ ·ï¼Œåœ¨ç¼–è¯‘çš„æ—¶å€™å°†æ‰€æœ‰çš„å˜é‡æ›¿æ¢æˆå¸¸å€¼ã€‚ extern å£°æ˜å…¨å±€å˜é‡ ä½¿ç”¨ static const ä¿®é¥°çš„å˜é‡åªèƒ½åœ¨æœ¬æ–‡ä»¶å†…ä½¿ç”¨ï¼Œä½†æœ‰æ—¶å€™éœ€è¦å¯¹å¤–å…¬å¸ƒè¿™ä¸ªå˜é‡ï¼Œæ¯”å¦‚è¯¥å˜é‡ä½œä¸ºâ€œé€šçŸ¥â€çš„keyçš„æ—¶å€™ï¼Œæ­¤æ—¶å¯ä»¥ç¨å¾®æ”¹ä¸€ä¸‹ã€‚ // .hæ–‡ä»¶ å£°æ˜ä¸€ä¸ªå˜é‡ extern NSString *const VCHLoginNotification; // .mæ–‡ä»¶ å®šä¹‰ä¸€ä¸ªå˜é‡ NSString *const VCHLoginNotification = @\"kLoginNotification\"; è¿™ç§å˜é‡ä¼šä¿å­˜åœ¨â€œå…¨å±€ç¬¦å·è¡¨â€ä¸­ã€‚ä¸ºäº†é¿å…å‘½åå†²çªï¼Œè¿™ç§å˜é‡åº”è¯¥åŠ ä¸Šç±»åå‰ç¼€ã€‚ åˆ¤æ–­ const ä¿®é¥°çš„æ˜¯å¯¹è±¡è¿˜æ˜¯æŒ‡é’ˆ(è‡ªå·±ç†è§£) const ä¿®é¥°çš„æ˜¯å³è¾¹çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ float const valueFloat0 = 0.1; //[1] const float valueFloat1 = 0.1; //[2] NSString const * string0 = @\"abc\"; //[3] NSString * const string1 = @\"abc\"; //[4] const NSString * string2 = @\"abc\"; //[5] const NSString * const string3 = @\"abc\"; //[6] const NSString const * string4 = @\"abc\"; //[7] [1] const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ valueFloat0ï¼Œè¡¨ç¤º valueFloat0 é‡Œé¢çš„å€¼æ˜¯ä¸å˜çš„ã€‚valueFloat0 ä¸èƒ½æ˜¯å·¦å€¼ã€‚[2] const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ floatï¼Œè€Œ float æŒ‡çš„å°±æ˜¯ valueFloat1ï¼Œæ‰€ä»¥ valueFloat1 çš„å€¼æ˜¯ä¸å˜çš„ã€‚valueFloat1 ä¸èƒ½æ˜¯å·¦å€¼ã€‚[3] const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ string0ï¼Œstring0 æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œæ‰€ä»¥ string0 æŒ‡å‘çš„åœ°å€æ˜¯ä¸å˜çš„ã€‚string0 ä¸èƒ½æ˜¯å·¦å€¼ã€‚[4] const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ string1ï¼ˆæŒ‡é’ˆï¼‰ï¼Œæ‰€ä»¥ string1 æŒ‡å‘çš„åœ°å€æ˜¯ä¸å˜çš„ã€‚string1 ä¸èƒ½æ˜¯å·¦å€¼ã€‚[5] const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ NSStringï¼Œè¡¨ç¤ºçš„æ˜¯ @\"abc\" è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥ @\"abc æ˜¯ä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯ä»¥é€šè¿‡ string2 è¿™ä¸ªæŒ‡é’ˆæ¥ä¿®æ”¹å®ƒæŒ‡å‘çš„å¯¹è±¡çš„å†…å®¹ã€‚(è¿™é‡Œåˆšå¥½ @\"abc\" æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå°±ç®—æŒ‡å‘çš„å¯¹è±¡æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ï¼Œä¹Ÿä¸èƒ½é€šè¿‡ const ä¿®é¥°çš„æŒ‡é’ˆå»ä¿®æ”¹)[6] ç¬¬ä¸€ä¸ª const å³è¾¹ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯ NSStringï¼Œ ç­‰åŒäº [5]ã€‚ç¬¬äºŒä¸ª const ç­‰åŒäº [4]ã€‚[7] ç­‰åŒäº [6] ç¬¬5æ¡ï¼šç”¨æšä¸¾è¡¨ç¤ºçŠ¶æ€ã€é€‰é¡¹ã€çŠ¶æ€ç  æšä¸¾å¯ä»¥æé«˜ä»£ç å¯è¯»æ€§ã€‚ // çŠ¶æ€ã€çŠ¶æ€ç  typedef NS_ENUM(NSInteger, UIViewAnimationTransition) { UIViewAnimationTransitionNone, UIViewAnimationTransitionFlipFromLeft, UIViewAnimationTransitionFlipFromRight, UIViewAnimationTransitionCurlUp, UIViewAnimationTransitionCurlDown, }; // å¯ç»„åˆé€‰é¡¹ typedef NS_OPTIONS(NSUInteger, UIViewAutoresizing) { UIViewAutoresizingNone = 0, UIViewAutoresizingFlexibleLeftMargin = 1 enum ç”¨æ¥è¡¨ç¤ºçŠ¶æ€ï¼Œoptions ç”¨æ¥è¡¨ç¤ºå¯ç»„åˆçš„é€‰é¡¹ã€‚ æ³¨æ„ 1ã€ç”¨æšä¸¾å¤„ç† switch çš„æ—¶å€™ä¸è¦å®ç° default åˆ†æ”¯ã€‚è¿™æ ·åŠ å…¥æ–°çš„åˆ†æ”¯åï¼Œç¼–è¯‘å™¨å°±ä¼šæç¤ºå¼€å‘è€…ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-1.html","title":"Chapter 2-1","keywords":"","body":"ç¬¬äºŒç« ï¼šå¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ(1) â€œå¯¹è±¡â€æ˜¯åŸºæœ¬æ„é€ å•å…ƒï¼Œå¯ä»¥é€šè¿‡å¯¹è±¡æ¥å­˜å‚¨æ•°æ®å’Œä¼ é€’æ•°æ®ã€‚å¯¹è±¡ä¹‹é—´ä¼ é€’æ•°æ®å¹¶æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹å°±å«åšâ€œæ¶ˆæ¯ä¼ é€’â€ã€‚ ç¬¬6æ¡ï¼šç†è§£ â€œå±æ€§â€ è¿™ä¸€æ¦‚å¿µ â€œå±æ€§â€ æ˜¯ Objective-C çš„ä¸€é¡¹ç‰¹æ€§ï¼Œç”¨æ¥å°è£…å¯¹è±¡ä¸­çš„æ•°æ®ã€‚å±æ€§æœ€ç»ˆæ˜¯é€šè¿‡å®ä¾‹å˜é‡æ¥å®ç°çš„ï¼Œå±æ€§åªæ˜¯æä¾›äº†ä¸€ç§ç®€æ´çš„æŠ½è±¡æœºåˆ¶ã€‚ å¯¹è±¡å¸ƒå±€ å¯¹è±¡å¸ƒå±€åœ¨ç¼–è¯‘æœŸå°±å·²ç»ç¡®å®šäº†ï¼Œå½“ä»£ç éœ€è¦è®¿é—®å®ä¾‹å˜é‡çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæŠŠå…¶æ›¿æ¢æˆåç§»é‡ï¼Œè¿™ä¸ªåç§»é‡æ˜¯â€œç¡¬ç¼–ç â€ï¼Œè¡¨ç¤ºè¯¥å˜é‡è·ç¦»å¯¹è±¡å†…å­˜èµ·å§‹åœ°å€æœ‰å¤šè¿œã€‚å½“ç±»å¢åŠ äº†å®ä¾‹å˜é‡æ—¶ï¼ŒåŸæ¥çš„åç§»é‡å°±å·²ç»ä¸å†é€‚ç”¨ï¼Œæ‰€ä»¥è¿™æ—¶å€™éœ€è¦é‡æ–°ç¼–è¯‘ã€‚åç§»é‡ä¿å­˜åœ¨ç±»å¯¹è±¡ä¸­ï¼Œä¼šåœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ã€‚ åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼ŒABIï¼‰ åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£æè¿°äº†åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´ï¼Œä¸€ä¸ªåº”ç”¨å’Œå®ƒçš„åº“ä¹‹é—´ï¼Œæˆ–è€…åº”ç”¨çš„ç»„æˆéƒ¨åˆ†ä¹‹é—´çš„ä½å±‚æ¥å£ã€‚ABIä¸åŒäºåº”ç”¨ç¨‹åºæ¥å£ï¼ˆAPIï¼‰ï¼ŒAPIå®šä¹‰äº†æºä»£ç å’Œåº“ä¹‹é—´çš„æ¥å£ï¼Œå› æ­¤åŒæ ·çš„ä»£ç å¯ä»¥åœ¨æ”¯æŒè¿™ä¸ªAPIçš„ä»»ä½•ç³»ç»Ÿä¸­ç¼–è¯‘ï¼Œç„¶è€ŒABIå…è®¸ç¼–è¯‘å¥½çš„ç›®æ ‡ä»£ç åœ¨ä½¿ç”¨å…¼å®¹ABIçš„ç³»ç»Ÿä¸­æ— éœ€æ”¹åŠ¨å°±èƒ½è¿è¡Œã€‚ï¼ˆç™¾åº¦ç™¾ç§‘ï¼‰ ABIå®šä¹‰äº†è®¸å¤šå†…å®¹ï¼ˆæ ‡å‡†ï¼‰ï¼Œå…¶ä¸­ä¸€é¡¹å°±æ˜¯ç”Ÿæˆä»£ç æ—¶æ‰€åº”éµå¾ªçš„è§„èŒƒï¼Œæœ‰äº†è¿™ç§è§„èŒƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åˆ†ç±»å’Œå®ç°æ–‡ä»¶å®šä¹‰å®ä¾‹å˜é‡ï¼Œå¯ä»¥å°†å®ä¾‹å˜é‡ä»æ¥å£æ–‡ä»¶ä¸­ç§»å¼€ï¼Œä»¥ä¾¿ä¿æŠ¤å’Œç±»å®ç°ç›¸å…³çš„å†…éƒ¨ä¿¡æ¯ã€‚ @synthesize & @dynamic @implementation @synthesize firstName = _myFirstName; @dynamic firstName; @end @synthesize ç”¨æ¥æŒ‡å®šå®ä¾‹å˜é‡çš„åç§°ã€‚@dynamic å‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦è‡ªåŠ¨ç”Ÿæˆå®ä¾‹å˜é‡ï¼Œä¹Ÿä¸è¦ç”Ÿæˆ setter å’Œ getter æ–¹æ³•ã€‚è¿™æ—¶ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾ã€‚ å±æ€§ç‰¹è´¨ åŸå­æ€§ï¼Œè¯»å†™æƒé™ï¼Œå†…å­˜ç®¡ç†ï¼ˆassignã€strongã€weakã€unsafe_unretainedã€copyï¼‰ï¼Œæ–¹æ³•å åŸå­æ€§ iOS å¼€å‘çš„æ—¶å€™åº”è¯¥å°½é‡ä½¿ç”¨ nonatomicï¼Œä½¿ç”¨ atomic ä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚ è¯»å†™æƒé™ readwrite åŒæ—¶ç”Ÿæˆsetter å’Œ getter æ–¹æ³•ã€‚readonly åªç”Ÿæˆ getter æ–¹æ³•ã€‚ copy å½“å±æ€§ç±»å‹ä¸º NSString æ—¶ï¼Œä¸€å®šè¦ç”¨ copy ä¿®é¥°ï¼Œé˜²æ­¢å½“ä¼ é€’è¿‡æ¥çš„å€¼æ˜¯ NSMutableString ç±»å‹ï¼Œä»è€Œå¯èƒ½ä¼šåœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ›´æ”¹å±æ€§çš„å€¼ã€‚ ç¬¬7æ¡ï¼šåœ¨å¯¹è±¡å†…éƒ¨å°½é‡ç›´æ¥è®¿é—®å®ä¾‹å˜é‡ï¼ˆæ„Ÿè§‰æœ‰æ­§ä¹‰ï¼‰ åœ¨å¯¹è±¡å¤–é¢ï¼Œåº”è¯¥é€šè¿‡å±æ€§è®¿é—®å®ä¾‹å˜é‡ã€‚åœ¨å¯¹è±¡å†…éƒ¨ï¼Œé™¤äº†å‡ ç§ç‰¹æ®Šçš„æƒ…å†µä¸‹ï¼Œè¯»å–å®ä¾‹å˜é‡åº”è¯¥é‡‡ç”¨ç›´æ¥è®¿é—®çš„å½¢å¼ï¼Œè®¾ç½®å®ä¾‹å˜é‡åˆ™é‡‡ç”¨å±æ€§æ¥è®¾ç½®ã€‚ å¯¹è±¡å†…éƒ¨ä¸è¦ç›´æ¥è®¾ç½®å®ä¾‹ï¼ˆæœ‰æ­§ä¹‰ï¼‰ è¿™æ ·åšä¸ä¼šè°ƒç”¨ setter æ–¹æ³•ï¼Œä¹Ÿå°±ç»•è¿‡äº†ç›¸å…³å±æ€§å®šä¹‰çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€ï¼Œæ¯”å¦‚ä½¿ç”¨äº† copy ç‰¹è´¨ï¼Œç›´æ¥è®¿é—®ä¸ä¼šæ‹·è´è¯¥å±æ€§ï¼Œåªä¼šä¿ç•™æ–°å€¼å¹¶é‡Šæ”¾æ—§å€¼ã€‚æ­¤å¤–å½“è®¾ç½®äº†KVOæ—¶ï¼Œç›´æ¥è®¾ç½®å®ä¾‹ä¹Ÿä¸ä¼šè§¦å‘KVOã€‚ åˆå§‹åŒ–æ—¶åº”è¯¥ç›´æ¥è®¿é—®å®ä¾‹ å¦‚æœçˆ¶ç±»åˆå§‹åŒ–ä½¿ç”¨ setter æ–¹æ³•è®¾ç½®å±æ€§ï¼Œè€Œå­ç±»åˆé‡å†™äº†è¿™ä¸ª setter æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»åˆå§‹åŒ–æ—¶ï¼Œçˆ¶ç±»ä¹Ÿä¼šåˆå§‹åŒ–ï¼Œè¿™æ—¶çˆ¶ç±»å°†ä¼šè°ƒç”¨å­ç±»çš„ setter æ–¹æ³•ã€‚ä¾‹å¤–ï¼šå¦‚æœå¾…åˆå§‹åŒ–çš„å®ä¾‹å˜é‡ç”³æ˜åœ¨çˆ¶ç±»ä¸­ï¼Œè€Œå­ç±»æ— æ³•ç›´æ¥è®¿é—®æ­¤å®ä¾‹å˜é‡ï¼Œè¿™æ—¶å°±éœ€è¦è°ƒç”¨ setter æ–¹æ³•äº†ã€‚ dealloc æ–¹æ³•ä¸­ä¹Ÿåº”è¯¥ç›´æ¥è¯»å†™å®ä¾‹å˜é‡ æ‡’åŠ è½½ å¦‚æœæŸä¸ªå±æ€§ä½¿ç”¨äº†æ‡’åŠ è½½ï¼Œé‚£å°±å¿…é¡»ä½¿ç”¨ getter æ–¹æ³•äº†ã€‚ ç¬¬8æ¡ï¼šç†è§£ â€œå¯¹è±¡åŒç­‰æ€§â€ è¿™ä¸€æ¦‚å¿µ â€œå¯¹è±¡åŒç­‰æ€§â€ å¯ä»¥ç†è§£ä¸ºæŸç§æ„ä¹‰ä¸Šä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œè¿™ä¸ªâ€œç›¸ç­‰â€æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ã€‚å®˜æ–¹ç»™æˆ‘ä»¬å®šä¹‰äº†ä¸€äº›åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦â€œç›¸ç­‰â€çš„æ–¹æ³• // NSString - (BOOL)isEqualToString:(NSString *)aString; // NSData - (BOOL)isEqualToData:(NSData *)other; // NSDictionary - (BOOL)isEqualToDictionary:(NSDictionary *)otherDictionary; å¯¹è±¡å®Œå…¨ç›¸ç­‰ ç”¨ \"==\" åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™é‡Œåˆ¤æ–­çš„æ˜¯æŒ‡é’ˆã€‚ è‡ªå®šä¹‰ â€œç›¸ç­‰â€ é€šè¿‡ NSObject åè®®ä¸­çš„ä¸¤ä¸ªæ–¹æ³•è‡ªå®šä¹‰ â€œç›¸ç­‰â€ã€‚ - (BOOL)isEqual:(id)object; @property (readonly) NSUInteger hash; è‡ªå®šä¹‰ä¸€ä¸ª Person ç±»ï¼ŒåŒ…å«ä¸€ä¸ª email å±æ€§ã€‚ @interface Person() @property (nonatomic, copy) NSString *email; @end å‡å®šå¯¹è±¡çš„ email å±æ€§å€¼ç›¸åŒï¼Œå°±è®¤ä¸ºè¿™ä¸¤ä¸ªç±»â€œç›¸åŒâ€ï¼Œé‚£ä¹ˆè‡ªå®šä¹‰æ–¹æ³•å¦‚ä¸‹ï¼š - (BOOL)isEqualToPerson:(Person *)otherPerson { if (nil == otherPerson) return NO; if (self == otherPerson) return YES; if ([_email isEqualToString:otherPerson.email]) return YES; return NO; } - (BOOL)isEqual:(id)object { if ([self class] != [object class]) return NO; [self isEqualToPerson:object]; return NO; } // å¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™å…¶å“ˆå¸Œç ä¸€å®šç›¸åŒã€‚åä¹‹ï¼Œå¦‚æœå“ˆå¸Œç ç›¸åŒï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸åŒã€‚ // è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ï¼Œhash æ–¹æ³•è¦ä¿è¯é«˜æ•ˆç‡ - (NSUInteger)hash { // æ­¤å¤„é€»è¾‘å¯ä»¥è‡ªå®šä¹‰ return [_email hash]; } å…¸å‹åº”ç”¨ // NSArray - (BOOL)containsObject:(ObjectType)anObject; // NSSet - (BOOL)containsObject:(ObjectType)anObject; ä½¿ç”¨ NSArray è°ƒç”¨ containsObject è¿™ä¸ªæ–¹æ³•ï¼Œä¼šç›´æ¥è°ƒç”¨ isEqual æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ã€‚æµ‹è¯•å‘ç°è¿™é‡Œå¹¶æ²¡æœ‰è°ƒç”¨ hash æ–¹æ³•ï¼ŒåŸå› ä¸æ˜ï¼Œä¾‹å­å¦‚ä¸‹ï¼š NSMutableArray *array = [NSMutableArray array]; Person *aPerson = nil; for (int i = 0; i å†ä½¿ç”¨ NSSet çœ‹çœ‹æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ã€‚ NSMutableSet *sets = [NSMutableSet set]; Person *aPerson = nil; for (int i = 0; i NSSet åœ¨ addObject å’Œ containsObject æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨ hash æ–¹æ³•ã€‚å† addObject æ–¹æ³•ä¸­ä¼šè°ƒç”¨ isEqual æ–¹æ³•ï¼Œè€Œ containsObject æ–¹æ³•ä¸­åˆ™ä¸å†è°ƒç”¨ã€‚NSArray åˆ™æ˜¯åœ¨ containsObject æ–¹æ³•ä¸­è°ƒç”¨ isEqual æ–¹æ³•ã€‚ ä¸åŒçš„é›†åˆä¼šä½¿ç”¨ä¸åŒçš„é€»è¾‘åˆ¤æ–­æ˜¯å¦â€œç›¸ç­‰â€ã€‚ æ³¨æ„ åœ¨ NSSet ä¸­ï¼Œ hash æ–¹æ³•æ˜¯åˆ¤æ–­çš„ç¬¬ä¸€æ­¥ï¼Œåº”è¯¥ä¿è¯æ­¤æ–¹æ³•çš„é«˜æ•ˆæ€§ï¼ŒåŒæ—¶ä¹Ÿè¦è€ƒè™‘ å“ˆå¸Œç¢°æ’ å‘ç”Ÿçš„æ¦‚ç‡ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-2.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-2.html","title":"Chapter 2-2","keywords":"","body":"ç¬¬äºŒç« ï¼šå¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ(2) ç¬¬9æ¡ï¼šä»¥ â€œç±»æ—æ¨¡å¼â€ æ¨¡å¼éšè—å®ç°ç»†èŠ‚ ç±»æ—æ¨¡å¼å¯ä»¥æŠŠå®ç°ç»†èŠ‚éšè—åœ¨ä¸€å¥—ç®€å•çš„å…¬å…±æ¥å£åé¢ã€‚Objective-C çš„ç³»ç»Ÿæ¡†æ¶æ™®éä½¿ç”¨æ­¤æ¨¡å¼ã€‚ä¾‹å¦‚ï¼šUIButton NSArray NSNumber ç­‰ç­‰ã€‚ è‡ªå®šä¹‰ â€œç±»æ—æ¨¡å¼â€ å®šä¹‰ä¸€ä¸ª Person åŸºç±»ä»¥åŠä¸‰ä¸ªå­ç±» PersonA, PersonB, PersonC ã€‚ä¸‰ä¸ªå­ç±»åˆ†åˆ«å®ç°è‡ªå·±çš„ doWork ä»»åŠ¡ã€‚ // Person @interface Person : NSObject + (instancetype)personWithType:(PersonType)personType; - (void)doWork; @end @implementation Person + (instancetype)personWithType:(PersonType)personType { switch (personType) { case PersonTypeA: return [PersonA new]; break; case PersonTypeB: return [PersonB new]; break; case PersonTypeC: return [PersonC new]; break; } } - (void)doWork { //SubClasses implement this } @end // // Subclass PersonA @interface PersonA : Person @end @implementation PersonA - (void)doWork { NSLog(@\"do PersonA Work\"); } // // Subclass PersonB @interface PersonB : Person @end @implementation PersonB - (void)doWork { NSLog(@\"do PersonB Work\"); } // // Subclass PersonC @interface PersonC : Person @end @implementation PersonC - (void)doWork { NSLog(@\"do PersonC Work\"); } @end æ¥å£è°ƒç”¨å¦‚ä¸‹ï¼š Person *personA = [Person personWithType:PersonTypeA]; Person *personB = [Person personWithType:PersonTypeB]; Person *personC = [Person personWithType:PersonTypeC]; NSLog(@\"%@\",[personA class]); NSLog(@\"%@\",[personB class]); NSLog(@\"%@\",[personC class]); [personA doWork]; [personB doWork]; [personC doWork]; // è¾“å‡º // PersonA // PersonB // PersonC // do PersonA Work // do PersonB Work // do PersonC Work è¿™æ ·å°±åªéœ€è¦ä¼ å…¥ä¸åŒçš„ Type å°±å¯ä»¥å®ç°ä¸åŒçš„ä»»åŠ¡ã€‚è¿™ç§å®ç°æ¨¡å¼å°±å«åšâ€œç±»æ—æ¨¡å¼â€ã€‚ ç¬¬10æ¡ï¼šåœ¨æ—¢æœ‰ç±»ä¸­ä½¿ç”¨å…³è”å¯¹è±¡å­˜æ”¾è‡ªå®šä¹‰æ•°æ® å¯ä»¥é€šè¿‡â€œå…³è”å¯¹è±¡â€è¿™é¡¹ç‰¹æ€§ï¼Œç»™æŸä¸ªç±»å…³è”å¤šä¸ªå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥é€šè¿‡ key åŒºåˆ†ã€‚åœ¨å…³è”å¯¹è±¡çš„æ—¶å€™éœ€è¦æŒ‡æ˜å¯¹è±¡çš„â€œå­˜å‚¨ç­–ç•¥â€ï¼Œç”¨æ¥ç»´æŠ¤ç›¸åº”çš„â€œå†…å­˜ç®¡ç†è¯­ä¹‰â€ã€‚â€œå­˜å‚¨ç­–ç•¥â€ç”± objc_AssociationPolicy è¿™ä¸ªæšä¸¾ç»´æŠ¤ã€‚ä¸‹é¢ç»™å‡º objc_AssociationPolicy æšä¸¾çš„å–å€¼ä»¥åŠç­‰æ•ˆçš„ @property å±æ€§ã€‚ /** * Policies related to associative references. * These are options to objc_setAssociatedObject() */ typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) { OBJC_ASSOCIATION_ASSIGN = 0, /** å¯¹åº”çš„3ä¸ªæ–¹æ³•ä¸ºï¼š // è®¾ç½®å…³è”å¯¹è±¡ void objc_setAssociatedObject(id _Nonnull object, const void * _Nonnull key,id _Nullable value, objc_AssociationPolicy policy); // è·å–å…³è”å¯¹è±¡ id objc_getAssociatedObject(id _Nonnull object, const void * _Nonnull key); // ç§»é™¤å…³è”å¯¹è±¡ void objc_removeAssociatedObjects(id _Nonnull object) ç³»ç»Ÿæ²¡æœ‰ç»™å‡ºç§»é™¤å•ä¸ªå…³è”å¯¹è±¡çš„æ¥å£ï¼Œå¦‚æœè¦ç§»é™¤æŸä¸ªå…³è”å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ç»™è¯¥å…³è”å¯¹è±¡çš„ key è®¾ç½®ä¸€ä¸ªç©ºå€¼æ¥å®ç°ã€‚void objc_setAssociatedObject(object, key, nil, policy); ç¤ºä¾‹ å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨ UIAlertView æ—¶ï¼Œä¸€èˆ¬ä¼šè¿™æ ·å†™ï¼š - (void)showAlert { UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@\"title\" message:@\"message\" delegate:self cancelButtonTitle:@\"Cancel\" otherButtonTitles:@\"Confirm\", nil]; [alertView show]; } - (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex { if (buttonIndex == 0) { } else if (buttonIndex == 1) { } } å½“å­˜åœ¨å¤šä¸ª UIAlertView æ—¶ï¼Œå§”æ‰˜æ–¹æ³•é‡Œé¢å°±éœ€è¦å¯¹ alertView è¿›è¡Œåˆ¤æ–­ã€‚ä½¿ç”¨å…³è”å¯¹è±¡å¯ä»¥ç®€åŒ–è¿™é‡Œçš„é€»è¾‘ #import static const void *kAlertKey = @\"kAlertKey\"; - (void)showAlert { UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@\"title\" message:@\"message\" delegate:self cancelButtonTitle:@\"Cancel\" otherButtonTitles:@\"confirm\", nil]; void (^block)(NSInteger) = ^(NSInteger buttonIndex) { if (buttonIndex == 0) { } else if (buttonIndex == 1) { } }; objc_setAssociatedObject(alertView, kAlertKey, block, OBJC_ASSOCIATION_COPY); [alertView show]; } - (void)alertView:(UIAlertView *)alertView clickedButtonAtIndex:(NSInteger)buttonIndex { void (^block)(NSInteger) = objc_getAssociatedObject(alertView, kAlertKey); block(buttonIndex); } æ³¨æ„ å½“å…³è”å¯¹è±¡éœ€è¦æ•è·äº†å…¶ä»–å˜é‡ï¼Œå¯èƒ½ä¼šé€ æˆå¼•ç”¨å¾ªç¯ã€‚ä½¿ç”¨å…³è”å¯¹è±¡ä¼šé™ä½ä»£ç çš„å¯è¯»æ€§ï¼Œå¢åŠ è°ƒè¯•çš„éš¾åº¦ã€‚åº”è°¨æ…ä½¿ç”¨ã€‚ ç¬¬11æ¡ï¼šç†è§£ objc_msgSend çš„ä½œç”¨ ç»™å¯¹è±¡å‘æ¶ˆæ¯ id returnValue = [someObject msgName:parameter]; ç¼–è¯‘å™¨ä¼šè½¬æ¢ä¸º id returnValue = objc_msgSend(someObject, @selector(msgName:), parameter); objc_msgSend ä¼šåœ¨æ¥å—è€…ç±»ä¸­æœå¯»â€œæ–¹æ³•åˆ—è¡¨â€ï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ï¼Œåˆ™è½¬è·³å®ç°ä»£ç ã€‚å¦‚æœæ²¡æ‰¾åˆ°å°±æ²¿ç€ç»§æ‰¿ç±»å‘ä¸Šæ‰¾ã€‚å¦‚æœæœ€ç»ˆè¿˜æ˜¯æ‰¾ä¸åˆ°è¯¥æ–¹æ³•ï¼Œåˆ™è¿›è¡Œâ€œæ¶ˆæ¯è½¬å‘â€ã€‚åŒæ—¶ objc_msgSend è¿˜ä¼šå°†æ‰¾åˆ°çš„æ–¹æ³•ç¼“å­˜åœ¨â€œå¿«é€Ÿæ˜ å°„è¡¨â€ï¼Œå¦‚æœä¸‹æ¬¡è¿˜éœ€è¦æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œå°±ä¼šå…ˆä»â€œå¿«é€Ÿæ˜ å°„è¡¨â€ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·æ‰§è¡Œèµ·æ¥ä¼šå¿«å¾ˆå¤šã€‚æ¯ä¸ªç±»éƒ½ä¼šæœ‰ä¸€å¼ ç±»ä¼¼äºå­—å…¸ä¸€æ ·çš„è¡¨æ ¼ï¼Œæ–¹æ³•åæ˜¯ Key ï¼Œå¯¹åº”çš„ Value åˆ™ä¿å­˜ç€å‡½æ•°æŒ‡é’ˆã€‚objc_msgSend å°±æ˜¯é€šè¿‡è¿™ä¸ªè¡¨æ ¼æ¥å¯»æ‰¾åº”è¯¥æ‰§è¡Œçš„æ–¹æ³•å¹¶è·³è½¬å…¶å®ç°çš„ã€‚è¿™äº›å·¥ä½œç”±â€œåŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿâ€æ¥å¤„ç†ã€‚ å°¾è°ƒç”¨ä¼˜åŒ– â€œå°¾è°ƒç”¨â€æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°æœ€åä¸€é¡¹æ“ä½œæ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œå³è¢«è°ƒç”¨çš„å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å½“å‰å‡½æ•°çš„è¿”å›å€¼ã€‚å¦‚æœå‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨çš„æ˜¯è‡ªèº«ï¼Œé‚£ä¹ˆå°±å«åšâ€œå°¾é€’å½’â€ã€‚å°¾è°ƒç”¨ä¼˜åŒ–æ˜¯æŒ‡ä¸éœ€è¦åœ¨å½“å‰è°ƒç”¨æ ˆä¸Šå¼€è¾Ÿæ–°çš„æ ˆç©ºé—´ï¼Œè€Œæ˜¯æ›´æ–°åŸæœ‰æ ˆï¼ˆåŸæœ‰æ ˆçš„æ•°æ®å·²ç»ä¸éœ€è¦äº†ï¼‰ï¼Œå†æŠŠè°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€æ›¿æ¢æˆå½“å‰å‡½æ•°çš„è¿”å›åœ°å€ã€‚ä½¿ç”¨â€œå°¾è°ƒç”¨ä¼˜åŒ–â€æŠ€æœ¯ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå¯ä»¥é¿å…äº†æ ˆæº¢å‡ºã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-3.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 2-3.html","title":"Chapter 2-3","keywords":"","body":"ç¬¬äºŒç« ï¼šå¯¹è±¡ã€æ¶ˆæ¯ã€è¿è¡ŒæœŸ(3) ç¬¬12æ¡ï¼šç†è§£æ¶ˆæ¯è½¬å‘æœºåˆ¶ å½“ä¸€ä¸ªå¯¹è±¡æ¥æ”¶åˆ°æ— æ³•è§£è¯»çš„æ¶ˆæ¯åï¼Œå°±ä¼šå¼€å¯â€œæ¶ˆæ¯è½¬å‘â€æœºåˆ¶ã€‚å¦‚æœæ¶ˆæ¯è½¬å‘ä¹Ÿæ— æ³•è§£è¯»æ¶ˆæ¯ï¼Œç¨‹åºå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š unrecognized selector sent to instance xxxx æ¶ˆæ¯è½¬å‘åˆ†ä¸ºä¸¤å¤§é˜¶æ®µï¼š ç¬¬ä¸€é˜¶æ®µï¼šåŠ¨æ€æ–¹æ³•è§£æ å¾è¯¢æ¥å—è€…èƒ½å¦åŠ¨æ€æ·»åŠ æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚æ­¤æ—¶ä¼šè°ƒç”¨ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ä¹‹ä¸€ï¼š // ä»¥ç±»æ–¹æ³•è°ƒç”¨æ—¶è§¦å‘ + (BOOL)resolveClassMethod:(SEL)sel // ä»¥å®ä¾‹æ–¹æ³•è°ƒç”¨æ—¶è§¦å‘ + (BOOL)resolveInstanceMethod:(SEL)sel å¦‚æœéœ€è¦åœ¨åŠ¨æ€è§£ææ—¶å¤„ç†æ¶ˆæ¯ï¼Œé‚£ä¹ˆå®ç°ä»£ç å¦‚ä¸‹ï¼š void run(id self, SEL _cmd) { NSLog(@\"missRun -- run\"); } + (BOOL)resolveInstanceMethod:(SEL)sel { if (sel == NSSelectorFromString(@\"missRun\")) { NSLog(@\"sel == %@\",NSStringFromSelector(sel)); class_addMethod([self class], sel, (IMP)run, \"v@:\"); return YES; } return [super resolveInstanceMethod:sel]; } // æ³¨æ„è¿™é‡Œ class_addMethod çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ [self superclass] + (BOOL)resolveClassMethod:(SEL)sel { if (sel == NSSelectorFromString(@\"missRun\")) { NSLog(@\"sel == %@\",NSStringFromSelector(sel)); class_addMethod([self superclass], sel, (IMP)run, \"v@:\"); return YES; } return [super resolveInstanceMethod:sel]; } å¤–éƒ¨è°ƒç”¨ //Person *person = [[Person alloc] init]; //[person performSelector:NSSelectorFromString(@\"missRun\") withObject:nil]; [Person performSelector:NSSelectorFromString(@\"missRun\") withObject:nil]; æ­¤æ—¶åœ¨å¤–éƒ¨è°ƒç”¨ missRun æ–¹æ³•ï¼Œæœ€ç»ˆå°†ä¼šè®¿é—® void run(id self, SEL _cmd) æ–¹æ³•ã€‚ IMP æŒ‡å‘çš„å‡½æ•°å¿…é¡»è¦æœ‰ id self, SEL _cmd è¿™ä¸¤ä¸ªå‚æ•°ã€‚ class_addMethod çš„æœ€åä¸€ä¸ªå‚æ•° \"v@:\" ä¸­ï¼Œv è¡¨ç¤ºè¿”å›å€¼ void ï¼Œ @ è¡¨ç¤ºç¬¬ä¸€ä¸ªå‚æ•°ç±»å‹ä¸º id ï¼Œ: è¡¨ç¤º SEL ã€‚å…·ä½“å¯çœ‹æ–‡æ¡£ Type Encodings ç¬¬äºŒé˜¶æ®µï¼šå®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶ æ¥å—è€…å°è¯•èƒ½å¦å°†è¿™æ¡æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–æ¥å—è€…æ¥æ”¶ï¼Œå¦‚æœä¸è¡Œå°±å¯ç”¨â€œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘â€ã€‚ å¤‡ç”¨æ¥å—è€… æ­¤æ—¶ä¼šè°ƒç”¨ä¸‹é¢çš„æ–¹æ³• - (id)forwardingTargetForSelector:(SEL)aSelector { Sutdent *student = [[Sutdent alloc] init]; if ([student respondsToSelector:aSelector]) { return student; } return [super forwardingTargetForSelector:aSelector]; } å®Œæ•´çš„æ¶ˆæ¯è½¬å‘ - (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector { if (aSelector == NSSelectorFromString(@\"missRun\")) { return [NSMethodSignature signatureWithObjCTypes:\"v@:\"]; } return [super methodSignatureForSelector:aSelector]; } - (void)forwardInvocation:(NSInvocation *)anInvocation { if ([anInvocation selector] == NSSelectorFromString(@\"missRun\")) { Sutdent *student = [[Sutdent alloc] init]; [anInvocation invokeWithTarget:student]; } } â€œå¤‡ç”¨æ¥å—è€…â€å’Œâ€œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘â€åŒºåˆ«åœ¨äºï¼Œâ€œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘â€ä¸­å¯ä»¥æ”¹å˜æ¶ˆæ¯çš„å†…å®¹ã€‚ æ¶ˆæ¯è½¬å‘æµç¨‹å›¾ æ¥å—è€…åœ¨æ¯ä¸€æ­¥å‡æœ‰æœºä¼šå¤„ç†æ¶ˆæ¯ï¼Œè¶Šåˆ°æœ€åï¼Œå¤„ç†çš„ä»£ä»·ä¼šè¶Šé«˜ã€‚ Demo GitHub: MessageForwarding ç¬¬13æ¡ï¼šç”¨ â€œæ–¹æ³•è°ƒé…æŠ€æœ¯â€ è°ƒè¯• â€œé»‘ç›’æ–¹æ³•â€ï¼ˆmethod swizzlingï¼‰ ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ä¼šå°†â€œæ–¹æ³•åâ€æ˜ å°„å¸¦ç›¸åº”çš„æ–¹æ³•å®ç°ä¸Šï¼Œâ€œåŠ¨æ€æ¶ˆæ¯æ´¾å‘ç³»ç»Ÿâ€ä¼šæ ¹æ®è¿™ä¸ªè¡¨æ‰¾åˆ°ç›¸åº”çš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å‡ä»¥å‡½æ•°æŒ‡é’ˆçš„æ–¹å¼è¡¨ç¤ºã€‚è¿™ç§æŒ‡é’ˆå°±æ˜¯ IMP ã€‚ä¸‹å›¾æ˜¯ NSString çš„éƒ¨åˆ†æ–¹æ³•æ˜ å°„è¡¨ã€‚Objective-C è¿è¡Œæ—¶ç³»ç»Ÿæä¾›äº†å‡ ä¸ªæ–¹æ³•å¯ä»¥ç”¨æ¥æ“ä½œè¿™å¼ è¡¨ã€‚å¼€å‘è€…å¯ä»¥åœ¨è¿è¡Œæ—¶æ–°å¢æ–¹æ³•ï¼Œæ”¹å˜æ–¹æ³•å¯¹åº”çš„å®ç°ï¼Œä¹Ÿå¯ä»¥äº¤æ¢ä¸¤ä¸ªæ–¹æ³•çš„å…·ä½“å®ç°ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥è®©æ–¹æ³•æ˜ å°„è¡¨å˜æˆä¸‹å›¾è¿™æ ·å®ç°èµ·æ¥ä¹Ÿæ˜¯å¾ˆç®€å•çš„ï¼Œåˆ›å»ºä¸€ä¸ª NSString çš„åˆ†ç±»ï¼Œåœ¨ +load æ–¹æ³•ä¸­å®ç° + (void)load { Method originalMethod = class_getInstanceMethod([NSString class], @selector(lowercaseString)); Method swappedMethod = class_getInstanceMethod([NSString class], @selector(uppercaseString)); method_exchangeImplementations(originalMethod, swappedMethod); } è°ƒç”¨ NSString *string = @\"This is a String\"; NSLog(@\"lowercaseString = %@\",string.lowercaseString); NSLog(@\"uppercaseString = %@\",string.uppercaseString); // è¾“å‡º // lowercaseString = THIS IS A STRING // uppercaseString = this is a string æ­¤æ—¶ lowercaseString å’Œ uppercaseString çš„æ–¹æ³•å®ç°å·²ç»æ›¿æ¢è¿‡æ¥äº†ã€‚lowercaseString æ–¹æ³•å¯¹åº”çš„æ˜¯ uppercaseString çš„æ–¹æ³•å®ç°ã€‚uppercaseString æ–¹æ³•å¯¹åº”çš„æ˜¯ lowercaseString çš„æ–¹æ³•å®ç°ã€‚æ‰€ä»¥æ‰“å°å‡ºæ¥çš„logæ˜¯åè¿‡æ¥çš„ã€‚å½“ç„¶è¿™ä¸ªæ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ ä¸‹é¢å®ç°ä¸€ä¸ªåŠŸèƒ½ï¼šæ¯æ¬¡è°ƒç”¨ lowercaseString éƒ½æ‰“å°å‡ºç›¸åº”çš„logå‡ºæ¥ + (void)load { Method originalMethod = class_getInstanceMethod([NSString class], @selector(lowercaseString)); Method swappedMethod = class_getInstanceMethod([NSString class], @selector(vch_lowercaseString)); method_exchangeImplementations(originalMethod, swappedMethod); } - (NSString *)vch_lowercaseString { NSString *string = [self vch_lowercaseString]; NSLog(@\"----%@\",string); return string; } è°ƒç”¨ NSString *string = @\"This is a String\"; NSLog(@\"lowercaseString = %@\",string.lowercaseString); // è¾“å‡º // ----this is a string // lowercaseString = this is a string ç”±äº lowercaseString å’Œ vch_lowercaseString äº¤æ¢äº†æ–¹æ³•å®ç°ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨ lowercaseString æ–¹æ³•çš„æ—¶å€™ï¼Œæ‰§è¡Œçš„æ˜¯ vch_lowercaseString é‡Œé¢çš„æ–¹æ³•ã€‚æ‰€ä»¥æ‰ä¼šæ‰“å°å‡º log å‡ºæ¥ã€‚ ç”¨é€” ä½¿ç”¨ method swizzling â€œé»‘é­”æ³•â€ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åŸæœ‰å®ç°ä¸­æ·»åŠ æ–°çš„åŠŸèƒ½ã€‚ ç¬¬14æ¡ï¼šç†è§£ â€œç±»å¯¹è±¡â€ çš„æœ¬è´¨ çœ‹çœ‹ä¸‹é¢çš„ä¸¤ä¸ªè¯­å¥ NSString *string0 = @\"this is a string\"; id string1 = @\"this is a string\"; ä¸¤ä¸ªè¯­å¥éƒ½åˆ›å»ºäº†ä¸€ä¸ª NSSring ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°† string0 æŒ‰ç…§ NSString ç±»å‹æ¥æ£€æµ‹ï¼Œstring1 æŒ‰ç…§ id ç±»å‹æ¥æ£€æµ‹ã€‚string0 ç›´æ¥è°ƒç”¨ NSString çš„æ–¹æ³•ç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œstring1 ç›´æ¥è°ƒç”¨ NSString çš„æ–¹æ³•åˆ™ç¼–è¯‘å™¨æŠ¥é”™ã€‚ è€Œåœ¨è¿è¡Œæ—¶ä¸¤ä¸ªå¯¹è±¡è¡¨ç¤ºçš„æ„æ€æ˜¯ä¸€æ ·çš„ã€‚ åœ¨ objc.h ä¸­æ˜¯è¿™æ ·å®šä¹‰ id ç±»å‹çš„ // objc.h /// An opaque type that represents an Objective-C class. typedef struct objc_class *Class; /// Represents an instance of a class. struct objc_object { Class _Nonnull isa OBJC_ISA_AVAILABILITY; }; /// A pointer to an instance of a class. typedef struct objc_object *id; å¯ä»¥çœ‹å‡º id æ˜¯ objc_object ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆï¼Œobjc_object åŒ…å«äº†ä¸€ä¸ª Class ç±»å‹çš„å˜é‡ isa ï¼ŒClass æ˜¯ objc_class ç±»å‹çš„æŒ‡é’ˆã€‚å†çœ‹çœ‹ NSObject.h ä¸­çš„å®šä¹‰ // NSObject.h @interface NSObject { #pragma clang diagnostic push #pragma clang diagnostic ignored \"-Wobjc-interface-ivars\" Class isa OBJC_ISA_AVAILABILITY; #pragma clang diagnostic pop } è¿™é‡Œé¢åŒ…å«äº†ä¸€ä¸ª Class ç±»å‹çš„å˜é‡ isa ã€‚è¿™ä¸ª Class ä¹Ÿå°±æ˜¯ objc_class ç±»å‹çš„æŒ‡é’ˆã€‚äº‹å®ä¸Šæ¯ä¸ªå®ä¾‹å˜é‡éƒ½ä¼šåŒ…å«ä¸€ä¸ª objc_object ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡å°±æ˜¯ isa æŒ‡é’ˆã€‚æ—¢ç„¶æ˜¯æŒ‡é’ˆï¼Œé‚£ä¹ˆ objc_class ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œç±»å¯¹è±¡â€ï¼Œè¿™ä¸ªç±»å¯¹è±¡æ˜¯ä¸€ä¸ªå•ä¾‹ï¼Œç¨‹åºè¿è¡Œä¸­åªå­˜åœ¨ä¸€ä»½ã€‚ å†çœ‹çœ‹ runtime.h æ˜¯æ€ä¹ˆå®šä¹‰ objc_class ç»“æ„ä½“çš„ã€‚ // runtime.h struct objc_class { Class _Nonnull isa OBJC_ISA_AVAILABILITY; #if !__OBJC2__ Class _Nullable super_class OBJC2_UNAVAILABLE; const char * _Nonnull name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; struct objc_method_list * _Nullable * _Nullable methodLists OBJC2_UNAVAILABLE; struct objc_cache * _Nonnull cache OBJC2_UNAVAILABLE; struct objc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE; #endif } OBJC2_UNAVAILABLE; objc_class çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ä¹Ÿæ˜¯ isa æŒ‡é’ˆã€‚å®ƒæŒ‡å‘çš„æ˜¯ç±»çš„å…ƒç±»ï¼ˆmetaclassï¼‰ã€‚objc_class è´Ÿè´£ä¿å­˜ç±»çš„å®ä¾‹å˜é‡ã€æ–¹æ³•åˆ—è¡¨ã€ç¼“å­˜æ–¹æ³•åˆ—è¡¨ã€åè®®åˆ—è¡¨ç­‰ã€‚å…ƒç±»ï¼ˆmetaclassï¼‰åˆ™è´Ÿè´£ä¿å­˜ç±»æ–¹æ³•åˆ—è¡¨ã€‚ ç»§æ‰¿ä½“ç³»å›¾ æ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª isa æŒ‡é’ˆæŒ‡å‘å…¶ç±»å¯¹è±¡ï¼Œç”¨æ¥è¡¨æ˜å…¶ç±»å‹ï¼Œç±»å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ª isa æŒ‡é’ˆï¼ŒæŒ‡å‘å…¶å…ƒç±»ï¼Œå…ƒç±»åŒæ ·å­˜åœ¨ä¸€ä¸ª isa æŒ‡é’ˆï¼ŒæŒ‡å‘å…¶æ ¹å…ƒç±»ï¼Œæ ¹å…ƒç±»çš„ isa æŒ‡é’ˆåˆ™æŒ‡å‘è‡ªèº«ã€‚è¿™äº›ç±»å¯¹è±¡åˆ™æ„æˆäº†ç±»çš„ç»§æ‰¿ä½“ç³»ã€‚ åœ¨ç»§æ‰¿ä½“ç³»ä¸­æŸ¥è¯¢ç±»å‹ä¿¡æ¯ isMemberOfClass ä¸åŒ…å«çˆ¶ç±»ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æŸä¸ªç‰¹å®šç±»çš„å®ä¾‹ã€‚ï¼ˆéœ€è¦è€ƒè™‘â€œç±»æ—â€ï¼‰isKindOfClass åŒ…å«çˆ¶ç±»ï¼Œç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æŸä¸ªç‰¹å®šç±»æˆ–è€…æ´¾ç”Ÿç±»çš„å®ä¾‹ã€‚ æ€»ç»“ 1ã€ç±»æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆç±»å¯¹è±¡ï¼‰ã€‚2ã€ç±»å¯¹è±¡ä¼šåœ¨ç¨‹åºç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºä¸€æ¬¡ï¼Œæ˜¯ä¸ªå•ä¾‹ã€‚3ã€ç±»å¯¹è±¡æ˜¯ä¸€ç§æ•°æ®ç»“æ„ã€‚å­˜å‚¨äº†ç±»çš„ç‰ˆæœ¬ã€æè¿°ä¿¡æ¯ã€å¤§å°ã€å˜é‡åˆ—è¡¨ã€æ–¹æ³•åˆ—è¡¨ã€æ–¹æ³•ç¼“å­˜ã€åè®®åˆ—è¡¨ç­‰ã€‚4ã€å…ƒç±»ä¸­ä¿å­˜äº†ç±»æ–¹æ³•åˆ—è¡¨ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 3-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 3-1.html","title":"Chapter 3-1","keywords":"","body":"ç¬¬ä¸‰ç« ï¼šæ¥å£ä¸ API è®¾è®¡ ç¬¬15æ¡ï¼šç”¨å‰ç¼€é¿å…å‘½åå†²çª é€‰æ‹©ä¸å…¬å¸ã€åº”ç”¨ç¨‹åºæˆ–äºŒè€…çš†æœ‰å…³è”çš„åç§°ä½œä¸ºç±»åçš„å‰ç¼€ï¼Œå¹¶åœ¨æ‰€æœ‰çš„ä»£ç ä¸­ä½¿ç”¨è¿™ä¸€å‰ç¼€ã€‚ä¹Ÿä¸ä»…ä»…æ˜¯ç±»åï¼Œåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰åç§°éƒ½åº”è¯¥åŠ å‰ç¼€ã€‚ è‹¹æœå®£ç§°ä¿ç•™ä½¿ç”¨æ‰€æœ‰â€œä¸¤ä¸ªå­—æ¯å‰ç¼€â€çš„æƒåˆ©ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å‰ç¼€å¿…é¡»å¤šäºä¸¤ä¸ªå­—æ¯ã€‚ é¡¶çº§ç¬¦å· åœ¨ç¼–è¯‘å¥½çš„ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œç±»å®ç°æ–‡ä»¶æ‰€ç”¨çš„çº¯ C å‡½æ•°å’Œå…¨å±€å˜é‡çš„åç§°è¦ç®—ä½œâ€œé¡¶çº§ç¬¦å·â€ã€‚æ¯”å¦‚åœ¨ç±»ä¸­åˆ›å»ºäº†åä¸º â€œcompletionâ€ çš„çº¯ C å‡½æ•°ï¼Œä¼šç¼–è¯‘æˆ â€œ_completionâ€ å­˜åœ¨ç¬¦å·è¡¨ä¸­ã€‚æ­¤æ—¶å¦‚æœåœ¨åˆ«çš„æ–‡ä»¶ä¸­ä¹Ÿåˆ›å»ºä¸€ä¸ªåä¸º â€œcompletionâ€ çš„å‡½æ•°ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ª â€œduplicate symbolâ€ çš„é”™è¯¯ã€‚ é¿å…ç¬¬ä¸‰æ–¹åº“å†²çª å¦‚æœä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“åŒæ—¶å¼•å…¥äº†ç›¸åŒçš„ç¬¬ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå‡ºç° â€œduplicate symbolâ€ çš„é”™è¯¯ã€‚å½“è‡ªå·±çš„ç¬¬ä¸‰æ–¹åº“å¼•å…¥äº†åˆ«çš„ç¬¬ä¸‰æ–¹åº“çš„æ—¶å€™ï¼Œåº”è¯¥ç»™é‚£ä»½ç¬¬ä¸‰æ–¹åº“çš„ä»£ç åŠ ä¸Šè‡ªå·±çš„å‰ç¼€ã€‚ï¼ˆğŸ˜†ã€‚ã€‚ã€‚æ²¡çœ‹æ‡‚ï¼‰ ç¬¬16æ¡ï¼šæä¾› â€œæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•â€ é‚£äº›å¯ä»¥ä¸ºå¯¹è±¡æä¾›å¿…è¦ä¿¡æ¯ä»¥ä¾¿å…¶èƒ½å®Œæˆå·¥ä½œçš„åˆå§‹åŒ–æ–¹æ³•å°±å«â€œæŒ‡å®šåˆå§‹åŒ–æ–¹æ³•â€ï¼Œè¿™ç±»åˆå§‹åŒ–æ–¹æ³•ä¸€èˆ¬åœ¨åé¢ä¼šæœ‰ NS_DESIGNATED_INITIALIZER è¿™ä¸ªå®å®šä¹‰ã€‚ ç›¸å…³æ–‡ç«  ä¹‹å‰å·²ç»å†™è¿‡ä¸€ç¯‡ç›¸å…³çš„æ–‡ç« ï¼Œå¯ä»¥å»è¿™ç¯‡æ–‡ç« çœ‹çœ‹ iOSå¼€å‘ä¹‹Designated Initializer(æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•) è¡¥å…… å¦‚æœå­ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•å’Œçˆ¶ç±»çš„æŒ‡å®šåˆå§‹åŒ–æ–¹æ³•ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆéœ€è¦åœ¨å­ç±»ä¸­é‡å†™çˆ¶ç±»çš„åˆå§‹åŒ–æ–¹æ³•ã€‚ ç¬¬17æ¡ï¼šå®ç° description æ–¹æ³• description æ–¹æ³•å®šä¹‰åœ¨ NSObject çš„åè®®é‡Œé¢ã€‚å½“æƒ³æ‰“å°æŸä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šè¿™æ ·åš Person *p = [[Person alloc] initWithEmail:@\"123@163.com\"]; NSLog(@\"%@\",p); // è¾“å‡º // ç›´æ¥æ‰“å°å¯¹è±¡å®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº† description æ–¹æ³•ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦é‡å†™è¿™ä¸ªæ–¹æ³•å°±å¯ä»¥æ‰“å°å‡ºæ„Ÿå…´è¶£çš„ä¿¡æ¯å‡ºæ¥ã€‚ description - (NSString *)description { return [NSString stringWithFormat:@\"\", [self class], self, _email]; } // è¾“å‡º // å¦‚ä¸Šï¼Œåªè¦æˆ‘ä»¬é‡å†™äº† description æ–¹æ³•ï¼Œå°±å¯ä»¥æ‰“å°å‡ºç‰¹å®šçš„ä¿¡æ¯å‡ºæ¥ã€‚ debugDescription åœ¨åˆé€‚çš„åœ°æ–¹åŠ å…¥æ–­ç‚¹ï¼Œç„¶ååœ¨è°ƒè¯•æ§åˆ¶å°è¾“å…¥lldbçš„ \"po\" å‘½ä»¤ï¼Œå°±å¯ä»¥æ‰“å°å‡º debugDescription é‡Œé¢çš„ä¿¡æ¯å‡ºæ¥ - (NSString *)debugDescription { return [NSString stringWithFormat:@\"\", [self class], self, _email]; } // è¾“å‡º // // (lldb) po p // // (lldb) ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥åœ¨ description é‡Œé¢æ‰“å°ä¸»è¦çš„ä¿¡æ¯ï¼Œè€Œåœ¨ debugDescription é‡Œé¢æ‰“å°æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚ ç¬¬18æ¡ï¼šå°½é‡ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ å¦‚æœå±æ€§æ˜¯ä¸å¯å˜çš„ï¼Œé‚£ä¹ˆå°±åº”è¯¥å°†å®ƒè®¾ç½®æˆ readonly ã€‚å¦‚æœæŠŠå¯å˜å¯¹è±¡æ”¾åˆ° collection ä¸­ï¼Œç„¶ååˆä¿®æ”¹å…¶å†…å®¹ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“ç ´å collection çš„å†…éƒ¨ç»“æ„ï¼Œæ¯”å¦‚ï¼šNSSet çœ‹ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠä»£ç è®¾è®¡æˆæœ€åˆé€»è¾‘çš„ã€‚ ç¬¬19æ¡ï¼šä½¿ç”¨æ¸…æ™°è€Œåè°ƒçš„å‘½åæ–¹å¼ 1ã€å‘½åè¦æ¸…æ™°ã€æ˜“æ‡‚ã€‚2ã€å‘½åä¸è¦å¤ªå•°å—¦ã€‚3ã€é©¼å³°å‘½åï¼ˆç±»åé¦–å­—æ¯è¦å¤§äº›ï¼Œå¹¶ä¸”è¦åŠ ä¸Šå‰ç¼€ï¼‰ã€‚4ã€æ˜¯å¦è¦ç®€å†™è¦çœ‹å…·ä½“æƒ…å†µã€‚5ã€åŠ å‰ç¼€ï¼Œå°½é‡é¿å…å‘½åå†²çªã€‚ ç¬¬20æ¡ï¼šä¸ºç§æœ‰æ–¹æ³•ååŠ å‰ç¼€ ç”±äº Objective-C æ²¡æœ‰ private å…³é”®å­—ã€‚å¦‚æœçˆ¶ç±»çš„ç§æœ‰æ–¹æ³•å’Œå­ç±»çš„æ–¹æ³•é‡åäº†ï¼Œé‚£ä¹ˆçˆ¶ç±»çš„ç§æœ‰æ–¹æ³•å°†æ— æ³•æ‰§è¡Œã€‚ è‹¹æœè‡ªå·±æ˜¯é€šè¿‡åœ¨ç§æœ‰æ–¹æ³•å‰åŠ ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰æ¥æ ‡è¯†çš„ï¼Œå› æ­¤æˆ‘ä»¬å°±ä¸èƒ½å†è¿™æ ·åšäº†ã€‚ æ€æ ·æœ‰æ•ˆé¿å…è¿™ä¸ªé—®é¢˜ æ–‡ç« ç»™å‡ºä¸¤ä¸ªæ–¹æ³•ã€‚ åŠ å‰ç¼€ \"p_\" å³ private çš„é¦–å­—æ¯åŠ ä¸‹åˆ’çº¿ä½œä¸ºå‰ç¼€ã€‚ é¡¹ç›®å‰ç¼€åŠ ä¸‹åˆ’çº¿ æ¯”å¦‚æˆ‘çš„é¡¹ç›®å‰ç¼€æ˜¯ \"VCH\"ï¼Œé‚£ä¹ˆå°±å¯ä»¥åŠ  \"vch_\" ä½œä¸ºå‰ç¼€ã€‚ä¸è¿‡å…¶å®åˆ†ç±»çš„æ–¹æ³•å¾ˆå¤šä¹Ÿæ˜¯ä½¿ç”¨å‰ç¼€åŠ ä¸‹åˆ’çº¿æ¥åŒºåˆ«åŸç±»çš„ã€‚ ç¬¬21æ¡ï¼šç†è§£ Objective-C é”™è¯¯æ¨¡å‹ è‡´å‘½æ€§é”™è¯¯ ä½¿ç”¨ @throw åªæœ‰åœ¨æç«¯æƒ…å†µä¸‹ï¼Œæ‰ä½¿ç”¨ @throw æŠ›å‡ºå¼‚å¸¸ï¼ŒåŒæ—¶ä¹Ÿå°±æ„å‘³ç€ç¨‹åºç»“æŸï¼Œå´©æºƒã€‚ @throw [NSException exceptionWithName:@\"errorName\" reason:@\"errorReason\" userInfo:@{@\"key\":@\"value\"}]; éè‡´å‘½æ€§é”™è¯¯ è¿”å› nil æˆ– 0 ä¸€èˆ¬å¯¹äºä¸€äº›éè‡´å‘½æ€§é”™è¯¯ï¼Œå¯ä»¥è¿”å› nil æˆ– 0 æ¥æç¤ºã€‚ NSError å½“æˆ‘ä»¬è¿›è¡Œä¸€äº›ç½‘ç»œè¯·æ±‚æ—¶ï¼Œä¼šè¿”å›ä¸€äº›é”™è¯¯ï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ NSError æŠŠé”™è¯¯ä¿¡æ¯å°è£…èµ·æ¥ï¼Œå†äº¤ç»™æ¥å—è€…å¤„ç†ã€‚ Error domain é”™è¯¯çš„èŒƒå›´ï¼Œä¸€èˆ¬ä¼šå®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡æ¥æŒ‡ç¤ºã€‚ Error code é”™è¯¯ç ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ªæšä¸¾è¡¨ç¤ºã€‚ Error info åŒ…å«é”™è¯¯çš„é¢å¤–ä¿¡æ¯ï¼Œå­—å…¸ç±»å‹ã€‚ Error å¸¸è§å¤„ç†æ–¹æ³• äº¤ç»™å§”æ‰˜å¤„ç† å¯ä»¥æŠŠé”™è¯¯ä¼ é€’ç»™å§”æ‰˜å¯¹è±¡å¤„ç†ï¼Œè‡³äºæ€ä¹ˆå»å¤„ç†è¿™ä¸ªé”™è¯¯ç”±å§”æ‰˜å¯¹è±¡å†³å®šã€‚ è¿”å›ç»™è°ƒç”¨è€… ä¹Ÿå¯ä»¥é€šè¿‡è¿”å›å€¼ã€blockç­‰å°†é”™è¯¯è¿”å›ç»™è°ƒç”¨è€…ï¼Œäº¤ç”±è°ƒç”¨è€…å¤„ç†é”™è¯¯ã€‚ ç¬¬22æ¡ï¼šç†è§£ NSCopying åè®® å½“æˆ‘ä»¬è‡ªå·±çš„ç±»éœ€è¦æ”¯æŒæ‹·è´æ“ä½œæ—¶ï¼Œå°±éœ€è¦å®ç° NSCopying åè®®ï¼Œåè®®å°±ä¸€ä¸ªæ–¹æ³•ã€‚ @protocol NSCopying - (id)copyWithZone:(nullable NSZone *)zone; @end å…·ä½“å®ç°å¦‚ä¸‹ // .h @interface Person : NSObject - (instancetype)initWithEmail:(NSString *)email; @property (nonatomic, copy) NSString *email; @property (nonatomic, copy) NSString *name; @end // .m - (id)copyWithZone:(NSZone *)zone { Person *person = [[[self class] allocWithZone:zone] initWithEmail:_email]; person.name = [_name copy]; return person; } ä½¿ç”¨ NSCopying åè®®å¤åˆ¶å‡ºæ¥çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ã€‚ NSMutableCopying åè®® å½“æˆ‘ä»¬éœ€è¦å¤åˆ¶çš„æ˜¯å¯å˜å¯¹è±¡æ—¶ï¼Œå°±éœ€è¦å®ç° NSMutableCopying è¿™ä¸ªåè®®ã€‚ @protocol NSMutableCopying - (id)mutableCopyWithZone:(nullable NSZone *)zone; @end å¦‚æœè‡ªå®šä¹‰å¯¹è±¡åˆ†å¯å˜ç‰ˆæœ¬å’Œä¸å¯å˜ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±è¦åŒæ—¶å®ç° NSCopying å’Œ NSMutableCopying åè®®ã€‚ æ·±æ‹·è´ & æµ…æ‹·è´ æµ…æ‹·è´åªä¼šå¤åˆ¶æŒ‡é’ˆï¼Œæ‹·è´åçš„å¯¹è±¡å’ŒåŸå§‹å¯¹è±¡ä¸ºåŒä¸€å¯¹è±¡ã€‚æ·±æ‹·è´åˆ™æ˜¯å°†å¯¹è±¡ä¹Ÿæ‹·è´äº†ä¸€ä»½ã€‚Foundation æ¡†æ¶ä¸‹æ‰€æœ‰çš„ collection ç±»åœ¨é»˜è®¤æƒ…å†µä¸‹éƒ½æ‰§è¡Œæµ…æ‹·è´ã€‚å®ç° collection æ·±æ‹·è´çš„æ–¹æ³•ç±»ä¼¼å¦‚ä¸‹ - (instancetype)initWithSet:(NSSet *)set copyItems:(BOOL)flag; - (instancetype)initWithArray:(NSArray *)array copyItems:(BOOL)flag; "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 4-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 4-1.html","title":"Chapter 4-1","keywords":"","body":"ç¬¬å››ç« ï¼šåè®®ä¸åˆ†ç±» Objective-C è¯­è¨€æœ‰ä¸€é¡¹ç‰¹æ€§å« â€œåè®®â€ï¼ˆprotocolï¼‰ï¼Œä¸ Java çš„â€œæ¥å£â€ï¼ˆinterfaceï¼‰ç±»ä¼¼ã€‚ Javaæ¥å£æ˜¯ä¸€ç³»åˆ—æ–¹æ³•çš„å£°æ˜ï¼Œæ˜¯ä¸€äº›æ–¹æ³•ç‰¹å¾çš„é›†åˆï¼Œä¸€ä¸ªæ¥å£åªæœ‰æ–¹æ³•çš„ç‰¹å¾æ²¡æœ‰æ–¹æ³•çš„å®ç°ï¼Œå› æ­¤è¿™äº›æ–¹æ³•å¯ä»¥åœ¨ä¸åŒçš„åœ°æ–¹è¢«ä¸åŒçš„ç±»å®ç°ï¼Œè€Œè¿™äº›å®ç°å¯ä»¥å…·æœ‰ä¸åŒçš„è¡Œä¸ºï¼ˆåŠŸèƒ½ï¼‰ã€‚ protocol å®šä¹‰äº†ä¸€å¥—å…¬ç”¨çš„æ¥å£ï¼Œå’Œ Java çš„æ¥å£åŒæ ·ï¼Œä¸€ä¸ªæ¥å£åªæœ‰æ–¹æ³•ç‰¹å¾æ²¡æœ‰æ–¹æ³•çš„å®ç°ï¼Œä¸åŒçš„ç±»å¯ä»¥å®ç°ä¸åŒçš„è¡Œä¸ºã€‚æœ¬è´¨ä¸Šå’Œ Java çš„æ¥å£æ˜¯ç›¸åŒçš„ã€‚ Objective-C ä¸æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æŸä¸ªç±»åº”è¯¥å®ç°çš„ä¸€ç³»åˆ—æ–¹æ³•å®šä¹‰åœ¨åè®®é‡Œé¢ã€‚åè®®æœ€å¸¸è§çš„ç”¨é€”å°±æ˜¯å®ç°å§”æ‰˜æ¨¡å¼ã€‚ â€œåˆ†ç±»â€ä¹Ÿæ˜¯ Objective-C çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ã€‚åˆ©ç”¨åˆ†ç±»æœºåˆ¶ï¼Œæˆ‘ä»¬æ— éœ€ç»§æ‰¿å­ç±»å³å¯ç›´æ¥ä¸ºå½“å‰ç±»æ·»åŠ æ–¹æ³•ã€‚ ç¬¬23æ¡ï¼šé€šè¿‡å§”æ‰˜ä¸æ•°æ®æºåè®®è¿›è¡Œå¯¹è±¡é—´é€šä¿¡ å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ä½¿ç”¨æœ€å¹¿æ³›çš„å°±æ˜¯â€œå§”æ‰˜æ¨¡å¼â€ã€‚å®šä¹‰ä¸€å¥—æ¥å£ï¼ŒæŸå¯¹è±¡è‹¥æƒ³æ¥å—å¦ä¸€å¯¹è±¡çš„å§”æ‰˜ï¼Œåˆ™éœ€éµå¾ªæ­¤æ¥å£ï¼Œä»¥ä¾¿å…¶æˆä¸ºâ€œå§”æ‰˜å¯¹è±¡â€ã€‚æ­¤æ¨¡å¼å¯å°†æ•°æ®ä¸ä¸šåŠ¡é€»è¾‘è§£è€¦ã€‚ å®šä¹‰ å§”æ‰˜å±æ€§ä¸€å®šè¦ç”¨ weak ä¿®é¥°ï¼Œä¸ç„¶ä¼šé€ æˆå¾ªç¯å¼•ç”¨ã€‚ @protocol PersonDelegate @required - (NSDate *)whatTimeIsIt; @optional - (BOOL)isNiceDay; @end @interface Person : NSObject @property (nonatomic, weak) id personDelegate; @end å®ç° å§”æ‰˜åè®®çš„æ–¹æ³•ä¸€èˆ¬ä¼šå®šä¹‰â€œå¯é€‰çš„â€ï¼ˆoptionalï¼‰ï¼Œå½“æˆ‘ä»¬åœ¨è°ƒç”¨è¿™äº›æ–¹æ³•ä¹‹å‰å°±éœ€è¦å…ˆåˆ¤æ–­å§”æ‰˜å¯¹è±¡æ˜¯å¦æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ã€‚ @implementation Person - (void)doWork { NSDate *date = [self.personDelegate whatTimeIsIt]; NSLog(@\"date = %@\",date); if ([self.personDelegate respondsToSelector:@selector(isNiceDay)]) { BOOL isNiceDay = [self.personDelegate isNiceDay]; NSLog(@\"isNiceDay:%zd\",isNiceDay); } } @end å¦‚æœéœ€è¦ç»å¸¸è°ƒç”¨æŸä¸ªå¯é€‰æ–¹æ³•ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªçŠ¶æ€å˜é‡æ¥ä¿å­˜â€œæ˜¯å¦å®ç°è¿™ä¸ªæ–¹æ³•â€çš„çŠ¶æ€ï¼Œå¦‚æœæœ‰å¤šä¸ªå¯é€‰æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨ç»“æ„ä½“æ¥ä¿å­˜çŠ¶æ€ã€‚è¿™æ ·åšå¯ä»¥å¤§å¤§æé«˜ç¨‹åºæ•ˆç‡ã€‚ è°ƒç”¨ å§”æ‰˜å¯¹è±¡éœ€è¦å…ˆéµå®ˆè¿™ä¸ªåè®®ã€‚ @interface ViewController () @end @implementation ViewController Person *person = [[Person alloc] initWithEmail:@\"123@163.com\"]; person.personDelegate = self; [person doWork]; @end // log // date = Thu May 3 19:43:05 2018 // isNiceDay:1 ç¬¬24æ¡ï¼šå°†ç±»çš„å®ç°ä»£ç åˆ†æ•£åˆ°ä¾¿äºç®¡ç†çš„æ•°ä¸ªåˆ†ç±»ä¸­ å¯ä»¥å°†ç±»ç›¸åŒåŠŸèƒ½éƒ¨åˆ†åˆ†æ•£åˆ°å•ç‹¬çš„åˆ†ç±»ä¸­ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚ä¹Ÿåº”è¯¥å°†ç§æœ‰æ–¹æ³•æ”¾åˆ°åä¸º \"private\" çš„åˆ†ç±»ä¸­ï¼Œä»¥â€œéšè—â€å®ç°ç»†èŠ‚ã€‚å®˜æ–¹çš„ NSString å°±åˆ†æˆäº†å¥½å‡ ä¸ªåˆ†ç±»ã€‚ @interface NSString : NSObject // 0 @end @interface NSString (NSStringExtensionMethods) // 1 @end @interface NSString (NSStringEncodingDetection) // 2 @end @interface NSString (NSItemProvider) // 3 @end @interface NSString (NSExtendedStringPropertyListParsing) // 4 @end @interface NSString (NSStringDeprecated) // 5 @end ç¬¬25æ¡ï¼šæ€»æ˜¯ä¸ºç¬¬ä¸‰æ–¹ç±»çš„åˆ†ç±»åç§°åŠ å‰ç¼€ å‘ç¬¬ä¸‰æ–¹ç±»ä¸­æ·»åŠ åˆ†ç±»æ—¶ï¼Œåº”ç»™åˆ†ç±»åç§°ä»¥åŠæ–¹æ³•åŠ ä¸Šé¡¹ç›®ä¸“ç”¨çš„åç§°ã€‚ @interface UIWindow (VCHAnimalWindow) - (void)vch_setRootViewController:(UIViewController *)rootViewController withOglFlipSubtype:(NSString *)subtype; - (void)vch_setRootViewController:(UIViewController *)rootViewController animalType:(NSString *)type subtype:(NSString *)subtype duration:(CFTimeInterval)duration; @end è¿™æ ·åšå¾ˆå¤§ç¨‹åº¦ä¸Šé¿å…äº†åˆ†ç±»æ–¹æ³•å’ŒåŸç±»æ–¹æ³•ç›¸åŒçš„å¯èƒ½ã€‚ ç¬¬26æ¡ï¼šå‹¿åœ¨åˆ†ç±»ä¸­ç”³æ˜å±æ€§ ç›´æ¥åœ¨åˆ†ç±»ä¸­ç”³æ˜å±æ€§ç¼–è¯‘å™¨åªä¼šç»™ä¸€ä¸ªç¼–è¯‘è­¦å‘Šã€‚ // åœ¨åˆ†ç±»ä¸­å®šä¹‰ä¸€ä¸ªå±æ€§ @interface Person (Special) @property (nonatomic, weak) NSString *name; @end // Property 'name' requires method 'name' to be defined - use @dynamic or provide a method implementation in this category // Property 'name' requires method 'setName:' to be defined - use @dynamic or provide a method implementation in this category æç¤ºä½¿ç”¨ @dynamic ä¿®é¥°å±æ€§æˆ–è€…æä¾›å±æ€§çš„ getter å’Œ setter æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆç¨‹åºä¼šåœ¨è¿è¡Œæ—¶æ£€æµ‹ã€‚ å…³è”å¯¹è±¡ é€šè¿‡å…³è”å¯¹è±¡å¯ä»¥ä¸ºåˆ†ç±»å®ç°å±æ€§çš„åŠŸèƒ½ã€‚ä½¿ç”¨æ—¶åº”æ³¨æ„å†…å­˜ç®¡ç†é—®é¢˜ã€‚è¿™ç§æ–¹æ³•åº”è¯¥åœ¨å¿…è¦çš„æƒ…å†µä¸‹æ‰ä½¿ç”¨ã€‚ - (void)setName:(NSString *)name { objc_setAssociatedObject(self, \"kPersonSpecial_name\", name, OBJC_ASSOCIATION_COPY); } - (NSString *)name { return objc_getAssociatedObject(self, \"kPersonSpecial_name\"); } æ€»ä¹‹,åœ¨å¿…è¦çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡å…³è”å¯¹è±¡å£°æ˜å±æ€§ï¼Œä½†è¿™ç§æ–¹æ³•åº”è¯¥å°½é‡å°‘ç”¨ã€‚ ç¬¬27æ¡ï¼šä½¿ç”¨ â€œclass-continuation åˆ†ç±»â€ éšè—å®ç°ç»†èŠ‚ ç±»ä¸­ç»å¸¸ä¼šåŒ…å«ä¸€äº›æ— éœ€å¯¹å¤–å…¬å¸ƒçš„æ–¹æ³•åŠå®ä¾‹å˜é‡ã€‚è¿™äº›å†…å®¹å¯ä»¥å¯¹å¤–å…¬å¸ƒï¼Œå¹¶å†™æ˜å…¶ä¸ºç§æœ‰ã€‚Objective-C çš„åŠ¨æ€æ¶ˆæ¯ç³»ç»Ÿæ–¹å¼å†³å®šäº†å…¶ä¸å¯èƒ½å®ç°çœŸæ­£çš„ç§æœ‰æ–¹æ³•å’Œç§æœ‰å®ä¾‹å˜é‡ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æœ€å¥½è¿˜æ˜¯åªæŠŠç¡®å®šéœ€è¦å…¬å¸ƒçš„é‚£éƒ¨åˆ†å†…å®¹å…¬å¼€ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°†è¿™éƒ¨åˆ†å†…å®¹æ”¾åˆ°â€œclass-continuation åˆ†ç±»â€ä¸­ã€‚â€œclass-continuation åˆ†ç±»â€ ä¸å…¶ä»–çš„åˆ†ç±»ä¸åŒï¼Œå®ƒå¿…é¡»å®šä¹‰åœ¨å®ç°æ–‡ä»¶ä¸­ï¼Œè¿™æ˜¯å”¯ä¸€èƒ½å£°æ˜å®ä¾‹å˜é‡çš„åˆ†ç±»ï¼Œè€Œä¸”æ­¤åˆ†ç±»æ²¡æœ‰ç‰¹å®šçš„å®ç°æ–‡ä»¶ï¼Œå…¶ä¸­çš„æ–¹æ³•éƒ½åº”è¯¥å®šä¹‰åœ¨ä¸»å®ç°æ–‡ä»¶é‡Œã€‚è‹¥å¯¹è±¡éµå¾ªçš„åè®®åªåº”è§†ä¸ºç§æœ‰ï¼Œä¹Ÿå¯åœ¨â€œclass-continuation åˆ†ç±»â€ä¸­å£°æ˜ã€‚ @interface ViewController () { int _count; } @property (nonatomic, copy) Person *person; @end ç¬¬28æ¡ï¼šé€šè¿‡åè®®æä¾›åŒ¿åå¯¹è±¡ åè®®å®šä¹‰äº†ä¸€ç³»åˆ—æ–¹æ³•ï¼Œéµä»æ­¤åè®®çš„å¯¹è±¡åº”è¯¥å®ç°å®ƒä»¬ï¼Œå¦‚æœè¿™äº›æ–¹æ³•ä¸æ˜¯å¯é€‰çš„ï¼Œé‚£ä¹ˆå°±å¿…é¡»å®ç°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨åè®®æŠŠè‡ªå·±æ‰€å†™çš„APIä¹‹ä¸­çš„å®ç°ç»†èŠ‚éšè—èµ·æ¥ï¼Œå°†è¿”å›çš„å¯¹è±¡è®¾è®¡ä¸ºéµä»æ­¤åè®®çš„çº¯idç±»å‹ã€‚è¿™æ ·çš„è¯ï¼Œæƒ³è¦éšè—çš„ç±»åå°±ä¸ä¼šå‡ºç°åœ¨APIä¹‹ä¸­äº†ã€‚è‹¥æ˜¯æ¥å£èƒŒåæœ‰å¤šä¸ªä¸åŒçš„å®ç°ç±»ï¼Œè€Œä½ åˆä¸æƒ³æŒ‡æ˜å…·ä½“ä½¿ç”¨å“ªä¸ªç±»ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ç”¨è¿™ä¸ªåŠæ³•ï¼Œå› ä¸ºæœ‰æ—¶å€™è¿™äº›ç±»å¯èƒ½ä¼šå˜ï¼Œæœ‰æ—¶å€™å®ƒä»¬åˆæ— æ³•å®¹çº³äºæ ‡å‡†çš„ç±»ç»§æ‰¿ä½“ç³»ä¸­ï¼Œå› è€Œä¸èƒ½ä»¥æŸä¸ªå…¬å…±åŸºç±»æ¥ç»Ÿä¸€è¡¨ç¤ºã€‚æ­¤æ¦‚å¿µç§°ä¸ºâ€œåŒ¿åå¯¹è±¡â€ã€‚ä¾‹å¦‚åœ¨å®šä¹‰â€œå—å§”æ‰˜è€…â€è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š @property (nonatomic, weak) id delegate; ä»»ä½•éµå¾ªäº† VCHDelegate è¿™ä¸ªåè®®çš„å¯¹è±¡éƒ½å¯ä»¥å……å½“è¿™ä¸ªå±æ€§ã€‚å¯¹äºå…·å¤‡æ­¤å±æ€§çš„ç±»æ¥è¯´ï¼Œdelegateå°±æ˜¯\"åŒ¿åçš„\"ã€‚å¤„ç†æ•°æ®åº“è¿æ¥(database connection)çš„ç¨‹åºåº“ä¹Ÿç”¨è¿™ä¸ªæ€è·¯ï¼Œä»¥åŒ¿åå¯¹è±¡æ¥è¡¨ç¤ºä»å¦ä¸€ä¸ªåº“ä¸­æ‰€è¿”å›çš„å¯¹è±¡ã€‚å¯¹äºå¤„ç†è¿æ¥æ‰€ç”¨çš„é‚£ä¸ªç±»ï¼Œä½ ä¹Ÿè®¸ä¸æƒ³è®©å¤–äººçŸ¥é“å…¶åå­—ï¼Œå› ä¸ºä¸åŒçš„æ•°æ®åº“å¯èƒ½è¦ç”¨åˆ°ä¸åŒçš„ç±»æ¥å¤„ç†ã€‚å¦‚æœæ²¡åŠæ³•ä»¤å…¶éƒ½ç»§æ‰¿è‡ªåŒä¸€åŸºç±»ï¼Œé‚£ä¹ˆå°±å¾—è¿”å›idç±»å‹ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰æ•°æ®åº“è¿æ¥éƒ½å…·å¤‡çš„é‚£äº›æ–¹æ³•æ”¾åˆ°åè®®ä¸­ï¼Œä»¤è¿”å›çš„å¯¹è±¡éµä»æ­¤åè®®ã€‚åè®®å¯ä»¥è¿™æ ·å†™: @protocol EOCDatabaseConnection - (void)connect; - (void)disconnect; - (BOOL)isConnected; - (NSArray *)performQuery:(NSString *)query; @end ç„¶åå¯ä»¥ç”¨â€œæ•°æ®åº“å¤„ç†å™¨â€å•ä¾‹æ¥æä¾›æ•°æ®åº“è¿æ¥ï¼Œæ¥å£å¯ä»¥è¿™æ ·å†™ï¼š @protocol EOCDatabaseConnection; @interface EOCDatabaseManger:NSObject + (id)sharedInstance; - (id) connectionWithIdentifier:(NSString *)identifier; @end; è¿™æ ·çš„è¯ï¼Œå¤„ç†æ•°æ®åº“è¿æ¥æ‰€ç”¨çš„ç±»çš„åç§°å°±ä¸ä¼šæ³„æ¼äº†ï¼Œæœ‰å¯èƒ½æ¥è‡ªä¸åŒæ¡†æ¶çš„é‚£äº›ç±»ç°åœ¨å‡å¯ä»¥ç»ç”±åŒä¸€ä¸ªæ–¹æ³•æ¥è¿”å›ã€‚ä½¿ç”¨æ­¤APIçš„äººä»…ä»…è¦æ±‚æ‰€è¿”å›çš„å¯¹è±¡èƒ½ç”¨æ¥è¿æ¥ã€æ–­å¼€å¹¶æŸ¥è¯¢æ•°æ®åº“å³å¯ã€‚è‡³äºä½¿ç”¨çš„å“ªç§æ•°æ®åº“åˆ™ä¸éœ€è¦å…³å¿ƒã€‚å¦‚æœåç»­éœ€è¦æ›´æ”¹æ•°æ®åº“ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¹Ÿä¸éœ€è¦æ›´æ”¹æ¥å£ã€‚æˆ‘ä»¬å…³å¿ƒçš„å¹¶ä¸æ˜¯å¯¹è±¡çš„ç±»å‹ï¼Œè€Œæ˜¯å¯¹è±¡æœ‰æ²¡æœ‰å®ç°ç›¸å…³çš„æ–¹æ³•ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-1.html","title":"Chapter 5-1","keywords":"","body":"ç¬¬äº”ç« ï¼šå†…å­˜ç®¡ç†(1) ARC å‡ ä¹æŠŠæ‰€æœ‰å†…å­˜ç®¡ç†äº‹å®œéƒ½äº¤ç”±ç¼–è¯‘å™¨æ¥å†³å®šï¼Œå¼€å‘è€…åªéœ€ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚ ç¬¬29æ¡ï¼šç†è§£å¼•ç”¨è®¡æ•° Objective-C è¯­è¨€ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¥ç®¡ç†å†…å­˜ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸ªå¯ä»¥é€’å¢æˆ–é€’å‡çš„è®¡æ•°å™¨ã€‚å¦‚æœæƒ³ä½¿æŸä¸ªå¯¹è±¡ç»§ç»­å­˜æ´»ï¼Œé‚£å°±é€’å¢å…¶å¼•ç”¨è®¡æ•°ï¼›ç”¨å®Œäº†ä¹‹åï¼Œå°±é€’å‡å…¶è®¡æ•°ã€‚è®¡æ•°å˜ä¸º0ï¼Œå°±è¡¨ç¤ºæ²¡äººå…³æ³¨æ­¤å¯¹è±¡äº†ï¼Œäºæ˜¯ï¼Œå°±å¯ä»¥æŠŠå®ƒé”€æ¯ã€‚ å¼•ç”¨è®¡æ•°çš„å·¥ä½œåŸç† åœ¨å¼•ç”¨è®¡æ•°æ¶æ„ä¸‹ï¼Œå¯¹è±¡æœ‰ä¸ªè®¡æ•°å™¨ï¼Œç”¨ä»¥è¡¨ç¤ºå½“å‰æœ‰å¤šå°‘ä¸ªäº‹ç‰©æƒ³ä»¤æ­¤å¯¹è±¡ç»§ç»­å­˜æ´»ä¸‹å»ã€‚è¿™åœ¨ Objective-C ä¸­å«åšâ€œå¼•ç”¨è®¡æ•°â€ï¼ˆreference countï¼‰ã€‚NSObjectåè®®å£°æ˜äº†ä¸‹é¢ä¸‰ä¸ªæ–¹æ³•ç”¨äºæ“ä½œè®¡æ•°å™¨ï¼Œä»¥é€’å¢æˆ–é€’å‡å…¶å€¼ï¼šretainï¼šé€’å¢ä¿ç•™è®¡æ•°ã€‚releaseï¼šé€’å‡ä¿ç•™è®¡æ•°ã€‚autoreleaseï¼šå¾…ç¨åæ¸…ç†â€œè‡ªåŠ¨é‡Šæ”¾æ± â€ï¼ˆautorelease poolï¼‰æ—¶ï¼Œå†é€’å‡ä¿ç•™è®¡æ•°ã€‚ @protocol NSObject - (instancetype)retain OBJC_ARC_UNAVAILABLE; - (oneway void)release OBJC_ARC_UNAVAILABLE; - (instancetype)autorelease OBJC_ARC_UNAVAILABLE; @end å¯¹è±¡åˆ›å»ºå‡ºæ¥æ—¶ï¼Œå…¶å¼•ç”¨è®¡æ•°è‡³å°‘ä¸º1ã€‚è‹¥æƒ³ä»¤å…¶ç»§ç»­å­˜æ´»ï¼Œåˆ™è°ƒç”¨ retain æ–¹æ³•ã€‚è¦æ˜¯æŸéƒ¨åˆ†ä»£ç ä¸å†ä½¿ç”¨æ­¤å¯¹è±¡ï¼Œä¸æƒ³ä»¤å…¶ç»§ç»­å­˜æ´»ï¼Œé‚£å°±è°ƒç”¨ release æˆ– autorelease æ–¹æ³•ã€‚æœ€ç»ˆå½“å¼•ç”¨è®¡æ•°å½’é›¶æ—¶ï¼Œå¯¹è±¡å°±å›æ”¶äº†ï¼ˆdeallocatedï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿä¼šå°†å…¶å ç”¨çš„å†…å­˜æ ‡è®°ä¸ºâ€œå¯é‡ç”¨â€ï¼ˆreuseï¼‰ã€‚æ­¤æ—¶ï¼Œæ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨ä¹Ÿéƒ½å˜å¾—æ— æ•ˆäº†ã€‚ è°ƒç”¨ release ä¹‹åï¼Œå°±å·²ç»æ— æ³•ä¿è¯æ‰€æŒ‡çš„å¯¹è±¡ä»ç„¶å­˜æ´» ä¾‹å¦‚ï¼š NSNumber *number = [[NSNumber alloc] initWithInt:1234]; [array addObject:number]; [number release]; NSLog(@\"number = %@\",number); è°ƒç”¨ release ä¹‹åï¼Œå…¶å¼•ç”¨è®¡æ•°é™è‡³0ï¼Œé‚£ä¹ˆ number å¯¹è±¡æ‰€å å†…å­˜ä¹Ÿè®¸ä¼šå›æ”¶ï¼Œé‚£ä¹ˆå†è°ƒç”¨NSLogå¯èƒ½ä¼šä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚è¿™é‡Œè¯´â€œå¯èƒ½â€ï¼Œæ˜¯å› ä¸ºå¯¹è±¡æ‰€å çš„å†…å­˜åœ¨â€œè§£é™¤åˆ†é…â€ï¼ˆdeallocatedï¼‰ä¹‹åï¼Œåªæ˜¯æ”¾å›â€œå¯ç”¨å†…å­˜æ± â€ï¼ˆavaliable poolï¼‰ã€‚å¦‚æœæ‰§è¡Œ NSLog æ—¶å°šæœªè¦†å†™å¯¹è±¡å†…å­˜ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä»ç„¶æœ‰æ•ˆï¼Œè¿™æ—¶ç¨‹åºä¸ä¼šå´©æºƒã€‚ å±æ€§å­˜å–æ–¹æ³•ä¸­çš„å†…å­˜ç®¡ç† - (void)setFoo:(id)foo { [foo retain]; [_foo release]; _foo = foo; } è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯å¿…é¡»å…ˆ retain å¯¹è±¡ï¼Œç„¶åå† release ã€‚åŸå› å°±æ˜¯æ–°å¯¹è±¡å’Œæ—§å¯¹è±¡å¯èƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶å¦‚æœå…ˆ release è¿™ä¸ªå¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿæ°¸ä¹…å›æ”¶å¯¹è±¡ã€‚ä¹‹åå† retain ä¹Ÿæ— æ³•å†å¤ç”Ÿã€‚ è‡ªåŠ¨é‡Šæ”¾æ±  è°ƒç”¨ release ä¼šç«‹åˆ»é€’å‡å¯¹è±¡çš„ä¿ç•™è®¡æ•°ï¼Œè€Œä¸”è¿˜æœ‰å¯èƒ½ä»¤ç³»ç»Ÿå›æ”¶æ­¤å¯¹è±¡ï¼Œç„¶è€Œæœ‰æ—¶å€™å¯ä»¥ä¸è°ƒç”¨å®ƒï¼Œæ”¹ä¸ºè°ƒç”¨ autorelease ï¼Œæ­¤æ–¹æ³•ä¼šåœ¨ç¨åé€’å‡è®¡æ•°ï¼Œé€šå¸¸æ˜¯åœ¨ä¸‹ä¸€æ¬¡â€œäº‹ä»¶å¾ªç¯â€ï¼ˆevent loopï¼‰æ—¶é€’å‡ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½æ‰§è¡Œå¾—æ›´æ—©äº›ï¼ˆwhy ï¼Ÿï¼Ÿåé¢ä¼šæåˆ°ï¼‰ã€‚è¿™ä¸ªç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼š - (NSString *)stringValue { NSString *str = [[NSString alloc] initWithFormat:@\"I am this: %@\",self]; return str; } åœ¨ MRC ç¯å¢ƒä¸‹ï¼Œæ­¤æ—¶ str å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¼šæ¯”æœŸæœ›å€¼å¤š1 ï¼Œå› ä¸º alloc ä¼šä½¿å¼•ç”¨è®¡æ•°åŠ 1ï¼Œä½†å´æ²¡æœ‰é‡Šæ”¾ã€‚è¿™æ—¶å°±åº”è¯¥ç”¨ autorelease ã€‚æ­¤æ–¹æ³•å¯ä»¥ä¿è¯å¯¹è±¡åœ¨è·¨è¶Šâ€œæ–¹æ³•è°ƒç”¨è¾¹ç•Œâ€ï¼ˆmethod call boundaryï¼‰åä¸€å®šå­˜æ´»ã€‚å®é™…ä¸Šï¼Œé‡Šæ”¾æ“ä½œä¼šåœ¨æ¸…ç©ºæœ€å¤–å±‚çš„è‡ªåŠ¨é‡Šæ”¾æ± æ—¶æ‰§è¡Œï¼Œé™¤éä½ æœ‰è‡ªå·±çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¦åˆ™è¿™ä¸ªæ—¶æœºæŒ‡çš„å°±æ˜¯å½“å‰çº¿ç¨‹çš„ä¸‹ä¸€æ¬¡äº‹ä»¶å¾ªç¯ã€‚ - (NSString *)stringValue { NSString *str = [[NSString alloc] initWithFormat:@\"I am this: %@\",self]; return [str autorelease]; } å¼•ç”¨å¾ªç¯ ä½¿ç”¨å¼•ç”¨è®¡æ•°æœºåˆ¶æ—¶ï¼Œç»å¸¸è¦æ³¨æ„çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯â€œå¼•ç”¨å¾ªç¯â€ï¼ˆretain cycleï¼‰ï¼Œä¹Ÿå°±æ˜¯å‘ˆç¯çŠ¶ç›¸äº’å¼•ç”¨çš„å¤šä¸ªå¯¹è±¡ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚è¿™å°†å¯¼è‡´å†…å­˜æ³„éœ²ï¼Œå› ä¸ºå¾ªç¯ä¸­çš„å¯¹è±¡å…¶å¼•ç”¨è®¡æ•°éƒ½ä¸ä¼šä¸º0ã€‚ æ€»ç»“ å¼•ç”¨è®¡æ•°æœºåˆ¶é€šè¿‡å¯ä»¥é€’å¢é€’å‡çš„è®¡æ•°æœºåˆ¶æ¥ç®¡ç†å†…å­˜ã€‚å¯¹è±¡åˆ›å»ºå¥½ä¹‹åï¼Œå…¶å¼•ç”¨è®¡æ•°è‡³å°‘ä¸º1ã€‚è‹¥å¼•ç”¨è®¡æ•°ä¸ºæ­£ï¼Œåˆ™å¯¹è±¡ç»§ç»­å­˜æ´»ã€‚å½“å¼•ç”¨è®¡æ•°é™ä¸º0æ—¶ï¼Œå¯¹è±¡å°±è¢«é”€æ¯äº†ã€‚åœ¨å¯¹è±¡ç”Ÿå‘½æœŸä¸­ï¼Œå…¶ä½™å¯¹è±¡é€šè¿‡å¼•ç”¨æ¥ä¿ç•™æˆ–é‡Šæ”¾æ­¤å¯¹è±¡ã€‚ä¿ç•™ä¸é‡Šæ”¾æ“ä½œåˆ†åˆ«ä¼šé€’å¢åŠé€’å‡ä¿ç•™è®¡æ•°ã€‚ ç¬¬30æ¡ï¼šç”¨ ARC ç®€åŒ–å¼•ç”¨è®¡æ•° åœ¨ MRC ç¯å¢ƒä¸‹ï¼Œä¸‹é¢ä»£ç ä¼šå‡ºç°å†…å­˜æ³„æ¼é—®é¢˜ if ([self showLogMsg]) { NSString *str = [[NSString alloc] initWithFormat:@\"I am this: %@\",self]; NSLog(@\"%@\",str); } åŸå› æ˜¯ if è¯­å¥ç»“æŸåï¼Œå¹¶æ²¡æœ‰é‡Šæ”¾ str å¯¹è±¡ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰‹åŠ¨å»é‡Šæ”¾ if ([self showLogMsg]) { NSString *str = [[NSString alloc] initWithFormat:@\"I am this: %@\",self]; NSLog(@\"%@\",str); [str release]; } è€Œè¿™ä¸ªæ“ä½œå®Œå…¨å¯ä»¥äº¤ç»™ ARC (Automatic Reference Counting)æ¥å®Œæˆï¼Œä¹Ÿå°±æ˜¯åœ¨ ARC ç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨åŠ ä¸Šå†…å­˜ç®¡ç†è¯­å¥ã€‚ç”±äº ARC ä¼šè‡ªåŠ¨æ‰§è¡Œretainã€releaseã€autoreleaseç­‰æ“ä½œï¼Œæ‰€ä»¥ç›´æ¥åœ¨ ARC ä¸‹è°ƒç”¨è¿™äº›å†…å­˜ç®¡ç†æ–¹æ³•æ˜¯éæ³•çš„ã€‚å…·ä½“æ¥è¯´ï¼Œä¸èƒ½è°ƒç”¨ä¸‹åˆ—æ–¹æ³•ï¼šretainreleaseautoreleasedeallocå®é™…ä¸Šï¼ŒARCåœ¨è°ƒç”¨è¿™äº›æ–¹æ³•æ—¶ï¼Œå¹¶ä¸é€šè¿‡æ™®é€šçš„ Objective-C æ¶ˆæ¯æ´¾å‘æœºåˆ¶ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨å…¶åº•å±‚Cè¯­è¨€ç‰ˆæœ¬ã€‚è¿™æ ·åšæ€§èƒ½æ›´å¥½ï¼Œå› ä¸ºä¿ç•™åŠé‡Šæ”¾æ“ä½œéœ€è¦é¢‘ç¹æ‰§è¡Œï¼Œæ‰€ä»¥ç›´æ¥è°ƒç”¨åº•å±‚å‡½æ•°èƒ½èŠ‚çœå¾ˆå¤šCPUå‘¨æœŸã€‚ ä½¿ç”¨ ARC æ—¶å¿…é¡»éµå¾ªçš„æ–¹æ³•å‘½åè§„åˆ™ å°†å†…å­˜ç®¡ç†è¯­ä¹‰åœ¨æ–¹æ³•åä¸­è¡¨ç¤ºå‡ºæ¥æ—©å·²æˆä¸º Objective-C çš„æƒ¯ä¾‹ï¼Œè€Œ ARC åˆ™å°†ä¹‹ç¡®ç«‹ä¸ºç¡¬æ€§è§„å®šã€‚è¿™äº›è§„åˆ™ç®€å•åœ°ä½“ç°åœ¨æ–¹æ³•åä¸Šã€‚è‹¥æ–¹æ³•åä»¥ä¸‹åˆ—è¯è¯­å¼€å¤´ï¼Œåˆ™å…¶è¿”å›çš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼šallocnewcopymutableCopyå½’è°ƒç”¨è€…æ‰€æœ‰çš„æ„æ€æ˜¯ï¼šè°ƒç”¨ä¸Šè¿°å››ç§æ–¹æ³•çš„é‚£æ®µä»£ç è¦è´Ÿè´£é‡Šæ”¾æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œæ¼”ç¤ºäº†ARCçš„ç”¨æ³•ï¼š // æ–¹æ³•åä»¥å…³é”®å­— new å¼€å¤´ï¼ŒARC ä¸ä¼šåŠ å…¥ retainã€release æˆ– autorelease è¯­å¥ã€‚ + (EOCPerson *)newPerson { EOCPerson *person = [[EOCPerson alloc] init]; return person; } // æ–¹æ³•åä¸ä»¥å…³é”®å­—å¼€å¤´ï¼ŒARC ä¼šè‡ªåŠ¨åŠ ä¸Š autorelease è¯­å¥ã€‚ + (EOCPerson *)somePerson { EOCPerson *person = [[EOCPerson alloc] init]; return person; } // ARC ä¼šåœ¨å‡½æ•°æœ«å°¾ç»™ personOne åŠ ä¸Š release è¯­å¥ã€‚ - (void)doSomething { EOCPerson *personOne = [EOCPerson newPerson]; EOCPerson *personTwo = [EOCPerson somePerson]; } é™¤äº†ä¼šè‡ªåŠ¨è°ƒç”¨â€œä¿ç•™â€ä¸â€œé‡Šæ”¾â€æ–¹æ³•å¤–ï¼ŒARC è¿˜å¯ä»¥æ‰§è¡Œä¸€äº›æ‰‹å·¥æ“ä½œå¾ˆéš¾ç”šè‡³æ— æ³•å®Œæˆçš„ä¼˜åŒ–ã€‚å¦‚æœå‘ç°åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šæ‰§è¡Œå¤šæ¬¡â€œä¿ç•™â€ä¸â€œé‡Šæ”¾â€æ“ä½œï¼Œé‚£ä¹ˆARCæœ‰æ—¶å¯ä»¥æˆå¯¹åœ°ç§»é™¤è¿™ä¸¤ä¸ªæ“ä½œã€‚ ä¸€èˆ¬ï¼Œåœ¨æ–¹æ³•ä¸­è¿”å›è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡æ—¶ï¼Œè¦æ‰§è¡Œä¸€ä¸ªç‰¹æ®Šå‡½æ•°ã€‚æ­¤æ—¶ä¸ç›´æ¥è°ƒç”¨å¯¹è±¡çš„ autorelease æ–¹æ³•ï¼Œè€Œæ˜¯æ”¹ä¸ºè°ƒç”¨ objc_autoreleaseReturnValue ã€‚æ­¤å‡½æ•°ä¼šæ£€è§†å½“å‰æ–¹æ³•è¿”å›ä¹‹åå³å°†è¦æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚è‹¥å‘ç°é‚£æ®µä»£ç åœ¨è¿”å›çš„å¯¹è±¡ä¸Šæ‰§è¡Œ retain æ“ä½œï¼Œåˆ™è®¾ç½®å…¨å±€æ•°æ®ç»“æ„ï¼ˆæ­¤æ•°æ®ç»“æ„çš„å…·ä½“å†…å®¹å› å¤„ç†å™¨è€Œå¼‚ï¼‰ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½è€Œä¸æ‰§è¡Œ autorelease æ“ä½œã€‚ä¸ä¹‹ç›¸ä¼¼ï¼Œå¦‚æœæ–¹æ³•è¿”å›äº†ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œè€Œè°ƒç”¨æ–¹æ³•çš„ä»£ç è¦ä¿ç•™æ­¤å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸ç›´æ¥æ‰§è¡Œ retainï¼Œè€Œæ˜¯æ”¹ä¸ºæ‰§è¡Œobjc_retainAutoreleaseReturnValue å‡½æ•°ã€‚æ­¤å‡½æ•°è¦æ£€æµ‹åˆšæ‰æåˆ°çš„é‚£ä¸ªæ ‡å¿—ä½ï¼Œè‹¥å·²ç»ç½®ä½ï¼Œåˆ™ä¸æ‰§è¡Œ retain æ“ä½œã€‚è®¾ç½®å¹¶æ£€æµ‹æ ‡å¿—ä½ï¼Œè¦æ¯”è°ƒç”¨ autorelease å’Œ retain æ›´å¿«ã€‚ ARC å¦‚ä½•æ¸…ç†å®ä¾‹å˜é‡ ARC ä¼šåœ¨ dealloc æ–¹æ³•ä¸­è‡ªåŠ¨ç”Ÿæˆå›æ”¶å¯¹è±¡æ—¶æ‰€æ‰§è¡Œçš„ä»£ç ã€‚ARC ä¼šå€Ÿç”¨ Objective-C++ çš„ä¸€é¡¹ç‰¹æ€§æ¥ç”Ÿæˆæ¸…ç†ä¾‹ç¨‹ï¼ˆcleanup routimeï¼‰ã€‚å›æ”¶ Objective-C++ å¯¹è±¡æ—¶ï¼Œå¾…å›æ”¶çš„å¯¹è±¡ä¼šè°ƒç”¨æ‰€æœ‰C++å¯¹è±¡çš„ææ„å‡½æ•°ï¼ˆdestructorï¼‰ã€‚ç¼–è¯‘å™¨å¦‚æœå‘ç°æŸä¸ªå¯¹è±¡é‡Œå«æœ‰C++å¯¹è±¡ï¼Œå°±ä¼šç”Ÿæˆåä¸º.cxx_destructçš„æ–¹æ³•ã€‚è€ŒARCåˆ™å€ŸåŠ©æ­¤ç‰¹æ€§ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ç”Ÿæˆæ¸…ç†å†…å­˜æ‰€éœ€çš„ä»£ç ã€‚å¦‚æœæœ‰é Objective-C çš„å¯¹è±¡ï¼Œæ¯”å¦‚ CoreFoundation ä¸­çš„å¯¹è±¡æˆ–æ˜¯ç”±malloc()åˆ†é…åœ¨å †ä¸­çš„å†…å­˜ï¼Œé‚£ä¹ˆä»ç„¶éœ€è¦æ‰‹åŠ¨æ¸…ç†ã€‚ æ€»ç»“ ç”¨ARCç®¡ç†å†…å­˜ï¼Œå¯çœå»ç±»ä¸­çš„è®¸å¤šçš„â€œæ ·æ¿ä»£ç â€ã€‚ARCä¼šåœ¨åˆé€‚çš„åœ°æ–¹æ’å…¥â€œä¿ç•™â€åŠâ€œé‡Šæ”¾â€å¯¹è±¡ã€‚CoreFoundation å¯¹è±¡ä¸å½’ ARC ç®¡ç†ï¼Œå¼€å‘è€…å¿…é¡»å®æ—¶è°ƒç”¨ CFRetain/CFRelease æ‰‹åŠ¨é‡Šæ”¾ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-2.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-2.html","title":"Chapter 5-2","keywords":"","body":"ç¬¬äº”ç« ï¼šå†…å­˜ç®¡ç†(2) ç¬¬31æ¡ï¼šåœ¨ dealloc æ–¹æ³•ä¸­åªé‡Šæ”¾å¼•ç”¨å¹¶è§£é™¤ç›‘å¬ å¯¹è±¡ç»å†å…¶ç”Ÿå‘½æœŸåï¼Œæœ€ç»ˆä¼šä¸ºç³»ç»Ÿæ‰€å›æ”¶ï¼Œè¿™æ—¶å€™å°±ä¼šæ‰§è¡Œ dealloc æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯å¼•ç”¨è®¡æ•°ä¸º0æ—¶è°ƒç”¨ï¼Œä¸”åœ¨ç”Ÿå‘½æœŸå†…ä»…è°ƒç”¨ä¸€æ¬¡ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿæ— æ³•æ§åˆ¶å…¶ä»€ä¹ˆæ—¶å€™è°ƒç”¨ã€‚ åœ¨è¿™ä¸ªæ–¹æ³•é‡Œä¼šé‡Šæ”¾æ‰€æœ‰çš„æ–¹æ³•å¼•ç”¨ï¼Œä¹Ÿå°±æ˜¯æŠŠ Objective-C å¯¹è±¡å…¨éƒ¨é‡Šæ”¾ã€‚ARC ä¼šç”Ÿæˆä¸€ä¸ª .cxx_destruct æ–¹æ³•ï¼Œåœ¨ dealloc ä¸­ä¸ºä½ è‡ªåŠ¨æ·»åŠ è¿™äº›é‡Šæ”¾ä»£ç ã€‚ä½†ä¹Ÿæœ‰ä¸€äº›å¯¹è±¡æ˜¯éœ€è¦è‡ªå·±æ‰‹åŠ¨é‡Šæ”¾ã€‚ é‡Šæ”¾ CoreFoundation å¯¹è±¡ CoreFoundation å¯¹è±¡å¿…é¡»æ‰‹åŠ¨é‡Šæ”¾ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯ç”±çº¯Cç”Ÿæˆçš„ã€‚è¿™äº›å¯¹è±¡æœ€å¥½åœ¨ä¸éœ€è¦æ—¶å°±ç«‹åˆ»é‡Šæ”¾æ‰ï¼Œæ²¡å¿…è¦ç­‰åˆ° dealloc æ‰é‡Šæ”¾ã€‚ é‡Šæ”¾ KVO && NSNotificationCenter å¦‚æœæœ‰ KVO é‚£ä¹ˆæœ€è¿Ÿåº”è¯¥åœ¨è¿™é‡Œå°†å…¶é‡Šæ”¾ã€‚å¦‚æœæ³¨å†Œäº†é€šçŸ¥ä¹Ÿåº”è¯¥æœ€è¿Ÿåœ¨è¿™é‡Œç§»é™¤ã€‚ä¸ç„¶å¯èƒ½ä¼šé€ æˆç¨‹åºå´©æºƒã€‚ é‡Šæ”¾ç”±å¯¹è±¡ç®¡ç†çš„èµ„æº å¦‚æœæ­¤å¯¹è±¡ç®¡ç†è€…æŸäº›èµ„æºï¼Œé‚£ä¹ˆä¹Ÿè¦åœ¨è¿™é‡Œé‡Šæ”¾æ‰ã€‚ æ³¨æ„ ä¸è¦åœ¨ dealloc ä¸­è°ƒç”¨å±æ€§çš„å­˜å–æ–¹æ³•ã€‚ä¸è¦åœ¨è¿™é‡Œè°ƒç”¨å¼‚æ­¥æ–¹æ³•ï¼Œå› ä¸ºå¯¹è±¡å·²ç»å¤„äºå›æ”¶çŠ¶æ€äº†ã€‚ ä¸éœ€è¦ç”¨çš„èµ„æºåº”è¯¥åŠæ—¶é‡Šæ”¾ï¼Œç³»ç»Ÿä¸èƒ½ä¿è¯æ¯ä¸ª dealloc æ–¹æ³•éƒ½ä¼šæ‰§è¡Œã€‚ ç¬¬32æ¡ï¼šç¼–å†™â€œå¼‚å¸¸å®‰å…¨ä»£ç â€æ—¶ç•™æ„å†…å­˜ç®¡ç†é—®é¢˜ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦ç¼–å†™å¼‚å¸¸ä»£ç æ¥æ•è·å¹¶å¤„ç†å¼‚å¸¸ï¼Œå‘ç”Ÿå¼‚å¸¸æ—¶åº”è¯¥å¦‚ä½•ç®¡ç†å†…å­˜æ˜¯ä¸ªå€¼å¾—æ·±ç©¶çš„é—®é¢˜ã€‚å…ˆçœ‹çœ‹åœ¨MRCç¯å¢ƒä¸‹åº”è¯¥æ€ä¹ˆå¤„ç†ï¼Œç›´æ¥ä¸Šä»£ç  @try { EOCSomeClass *object = [[EOCSomeClass alloc]init]; [object doSomethingThatMayThrow]; [object release]; } @catch (NSException *exception) { NSLog(@\"there was an error.\"); } äº‹å®ä¸Šå½“ doSomethingThatMayThrow å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå°±ä¼šç›´æ¥è·³å‡ºï¼Œä¸ä¼šå†å¾€ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥ release æ–¹æ³•æ— æ³•æ‰§è¡Œï¼Œä¹Ÿå°±å‡ºç°å†…å­˜æ³„æ¼äº†ã€‚ä½¿ç”¨ @finally å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ EOCSomeClass *object = nil; @try { object = [[EOCSomeClass alloc] init]; [object doSomethingThatMayThrow]; } @catch (NSException *exception) { NSLog(@\"there was an error.\"); } @finally { [object release]; } åœ¨ ARC ç¯å¢ƒä¸‹ï¼Œä¹Ÿä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜ï¼Œç”±äº ARC ä¸èƒ½è°ƒç”¨ release æ–¹æ³•ã€‚ä¸Šé¢çš„ä»£ç åŒæ ·ä¼šå‡ºé—®é¢˜ @try { EOCSomeClass *object = [[EOCSomeClass alloc] init]; [object doSomethingThatMayThrow]; } @catch (NSException *exception) { NSLog(@\"there was an error.\"); } @finally { } é»˜è®¤æƒ…å†µä¸‹ å¦‚æœ doSomethingThatMayThrow å‡ºç°å¼‚å¸¸äº†ï¼Œé‚£ä¹ˆ ARC ä¹Ÿä¸ä¼šè‡ªåŠ¨å»å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚å¯¼è‡´ object è¿™ä¸ªå¯¹è±¡æ— æ³•å›æ”¶ã€‚è™½ç„¶é»˜è®¤çŠ¶å†µä¸‹ä¸èƒ½å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½†ARCä¾ç„¶èƒ½ç”Ÿæˆè¿™ç§å®‰å…¨å¤„ç†å¼‚å¸¸æ‰€ç”¨çš„é™„åŠ ä»£ç ã€‚-fobjc-arc-exception è¿™ä¸ªç¼–è¯‘å™¨æ ‡å¿—ç”¨æ¥å¼€å¯æ­¤åŠŸèƒ½ã€‚æ‰“å¼€è¿™ä¸ªæ ‡å¿—ä¼šåŠ å…¥å¤§é‡çš„æ ·ä¾‹ä»£ç ï¼Œä¼šå½±å“è¿è¡ŒæœŸçš„æ€§èƒ½ã€‚å¤„äº Objective-C++ æ¨¡å¼æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æŠŠ -fobjc-arc-exception æ ‡å¿—æ‰“å¼€ï¼Œå› ä¸ºC++å¤„ç†å¼‚å¸¸æ‰€ç”¨çš„ä»£ç ä¸ARCå®ç°çš„é™„åŠ ä»£ç ç±»ä¼¼ï¼Œæ‰€ä»¥ä»¤ARCåŠ å…¥è‡ªå·±çš„ä»£ç ä»¥å®‰å…¨å¤„ç†å¼‚å¸¸ï¼Œå…¶æ€§èƒ½æŸå¤±å¹¶ä¸å¤ªå¤§ã€‚ è¿™é‡Œéœ€è¦äº†è§£çš„æ˜¯ï¼ŒObjective-Cä¸­ï¼Œåªæœ‰å½“åº”ç”¨ç¨‹åºå¿…é¡»å› å¼‚å¸¸çŠ¶å†µè€Œç»ˆæ­¢æ—¶æ‰æŠ›å‡ºå¼‚å¸¸ã€‚å› æ­¤ï¼Œå¦‚æœåº”ç”¨ç¨‹åºå³å°†ç»ˆæ­¢ï¼Œé‚£ä¹ˆæ˜¯å¦è¿˜ä¼šå‘ç”Ÿå†…å­˜æ³„éœ²å°±å·²ç»æ— å…³ç´§è¦äº†ã€‚åœ¨åº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³ç»ˆæ­¢çš„æƒ…å†µä¸‹ï¼Œè¿˜å»æ·»åŠ å®‰å…¨å¤„ç†å¼‚å¸¸æ‰€ç”¨çš„é™„åŠ ä»£ç æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ æ€»ç»“ æ•è·å¼‚å¸¸æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å°†tryå—å†…æ‰€åˆ›ç«‹çš„å¯¹è±¡æ¸…ç†å¹²å‡€ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼ŒARCä¸ç”Ÿæˆå®‰å…¨å¤„ç†å¼‚å¸¸æ‰€éœ€çš„æ¸…ç†ä»£ç ã€‚å¼€å¯ç¼–è¯‘å™¨æ ‡å¿—åï¼Œå¯ç”Ÿæˆè¿™ç§ä»£ç ï¼Œä¸è¿‡ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºå˜å¤§ï¼Œè€Œä¸”ä¼šé™ä½è¿è¡Œæ•ˆç‡ã€‚ ç¬¬33æ¡ï¼šç”¨å¼±å¼•ç”¨é¿å…å¾ªç¯å¼•ç”¨ å¯¹è±¡å›¾é‡Œç»å¸¸ä¼šå‡ºç°ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯å‡ ä¸ªå¯¹è±¡éƒ½ä»¥æŸç§æ–¹å¼äº’ç›¸å¼•ç”¨ï¼Œä»è€Œå½¢æˆâ€ç¯â€œã€‚ç”±äº Objective-C å†…å­˜ç®¡ç†æ¨¡å‹ä½¿ç”¨å¼•ç”¨è®¡æ•°æ¶æ„ï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µé€šå¸¸ä¼šæ³„éœ²å†…å­˜ï¼Œå› ä¸ºæœ€åæ²¡æœ‰åˆ«çš„ä¸œè¥¿ä¼šå¼•ç”¨ç¯ä¸­çš„å¯¹è±¡ã€‚è¿™æ ·çš„è¯ï¼Œç¯é‡Œçš„å¯¹è±¡å°±æ— æ³•ä¸ºå¤–ç•Œæ‰€è®¿é—®äº†ï¼Œä½†å¯¹è±¡ä¹‹é—´å°šæœ‰å¼•ç”¨ï¼Œè¿™äº›å¼•ç”¨ä½¿å¾—ä»–ä»¬éƒ½èƒ½ç»§ç»­å­˜æ´»ä¸‹å»ï¼Œè€Œä¸ä¼šä¸ºç³»ç»Ÿæ‰€å›æ”¶ã€‚å¦‚ä¸‹å›¾æ˜¯æœ€ç®€å•çš„ä¸€ç§å†…å­˜æ³„æ¼ï¼Œä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œæ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚ å¼±å¼•ç”¨ é¿å…å¾ªç¯å¼•ç”¨çš„æœ€ä½³æ–¹å¼å°±æ˜¯å¼±å¼•ç”¨ï¼Œå³è¡¨ç¤ºâ€œéæ‹¥æœ‰å…³ç³»â€ã€‚æœ‰ä¸¤ä¸ªå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°è¿™ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ unsafe_unretained å’Œ weak ã€‚ unsafe_unretained ç”¨ unsafe_unretained ä¿®é¥°çš„å±æ€§ç‰¹è´¨ï¼Œå…¶è¯­ä¹‰åŒ assign ç‰¹è´¨ç­‰ä»·ï¼Œç„¶è€Œ assign é€šå¸¸åªç”¨äºæ•°å€¼ç±»å‹ï¼Œunsafe_unretained åˆ™å¤šç”¨äºå¯¹è±¡ç±»å‹ã€‚è¿™ä¸ªè¯æœ¬èº«å°±è¡¨æ˜å…¶æ‰€ä¿®é¥°çš„å±æ€§å¯èƒ½æ— æ³•å®‰å…¨ä½¿ç”¨ã€‚ä¹Ÿå°±æ˜¯ unsafe_unretained ä¿®é¥°çš„å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡å³ä½¿å·²ç»é‡Šæ”¾ï¼Œunsafe_unretained ä¿®é¥°çš„å±æ€§çš„å€¼ä¹Ÿä¸ä¼šè‡ªåŠ¨ç½®nil(ç›¸å¯¹äºweak)ã€‚ weak weak å’Œ unsafe_unretained åŒæ ·ç”¨äºä¿®é¥°å¯¹è±¡ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå½“ weak ä¿®é¥°çš„å±æ€§æ‰€æŒ‡çš„å¯¹è±¡è¢«ç³»ç»Ÿå›æ”¶æ—¶ï¼Œweakä¼šè‡ªåŠ¨ç½®nilã€‚ ä¸‹å›¾å¯ä»¥çœ‹å‡ºä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ã€‚ å½“å¯¹è±¡é‡Šæ”¾æ—¶ï¼Œunsafe_unretained å±æ€§ä»ç„¶æŒ‡å‘é‚£ä¸ªå·²ç»å›æ”¶çš„å®ä¾‹ï¼Œè€Œweakå±æ€§åˆ™æŒ‡å‘nilã€‚æ‰€ä»¥ ä½¿ç”¨ weak æ¯” unsafe_unretained å®‰å…¨ã€‚ æ€»ç»“ å¦‚æœæŸå¯¹è±¡ä¸å½’ä½ æ‰€æ‹¥æœ‰ï¼Œè€Œåªæ˜¯éœ€è¦ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±åº”è¯¥ç”¨â€œå¼±å¼•ç”¨â€ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-3.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 5-3.html","title":"Chapter 5-3","keywords":"","body":"ç¬¬äº”ç« ï¼šå†…å­˜ç®¡ç†(3) ç¬¬34æ¡ï¼šä»¥â€œè‡ªåŠ¨é‡Šæ”¾æ± å—â€é™ä½å†…å­˜ Objective-C å¯¹è±¡çš„ç”Ÿå‘½æœŸå–å†³äºå…¶å¼•ç”¨è®¡æ•°ã€‚åœ¨ Objective-C çš„å¼•ç”¨è®¡æ•°æ¶æ„ä¸­ï¼Œæœ‰ä¸€é¡¹ç‰¹æ€§å«åšâ€œè‡ªåŠ¨é‡Šæ”¾æ± â€ï¼ˆautorelease poolï¼‰ã€‚é‡Šæ”¾å¯¹è±¡æœ‰ä¸¤ç§æ–¹å¼ï¼šä¸€ç§æ˜¯è°ƒç”¨ release æ–¹æ³•ï¼Œä½¿å…¶å¼•ç”¨è®¡æ•°ç«‹å³é€’å‡ï¼›å¦ä¸€ç§æ˜¯è°ƒç”¨ autorelease æ–¹æ³•ï¼Œå°†å…¶åŠ å…¥â€œè‡ªåŠ¨é‡Šæ”¾æ± â€ä¸­ã€‚è‡ªåŠ¨é‡Šæ”¾æ± ç”¨äºå­˜æ”¾é‚£äº›éœ€è¦åœ¨ç¨åæŸä¸ªæ—¶åˆ»é‡Šæ”¾çš„å¯¹è±¡ã€‚æ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± æ—¶ï¼Œç³»ç»Ÿä¼šå‘å…¶ä¸­çš„å¯¹è±¡å‘é€ release æ¶ˆæ¯ã€‚æ¯ä¸€æ¬¡è¿è¡Œå¾ªç¯å¼€å§‹åï¼Œç³»ç»Ÿéƒ½ä¼šåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå½“ä¸€ä¸ªå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åå°±ä¼šåŠ å…¥åˆ°æœ€è¿‘çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè¿è¡Œå¾ªç¯ç»“æŸå‰ä¼šé‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ï¼ˆæ± å­æ»¡äº†ä¹Ÿä¼šé‡Šæ”¾ï¼‰ã€‚è‡ªåŠ¨é‡Šæ”¾æ± å·¥ä½œçš„åŸç†å°±æ˜¯ï¼Œç»™æ¯ä¸€ä¸ªæ± å­çš„æ¯ä¸€ä¸ªå¯¹è±¡å‘é€ release æ¶ˆæ¯ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œåœ¨ä¸€ä¸ªè¿è¡Œå¾ªç¯ä¸­åˆ›å»ºäº†å¤§é‡çš„ä¸´æ—¶å˜é‡ï¼Œè¿™æ—¶å°±ä¼šå¯¼è‡´å†…å­˜å³°å€¼å¾ˆé«˜ã€‚ä¾‹å¦‚ï¼š for(int i = 0; i å½“å¾ªç¯ç»“æŸæ—¶ï¼Œå¤§é‡çš„å¯¹è±¡æ”¾åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå ç”¨äº†å¤§é‡çš„å†…å­˜ã€‚å¢åŠ ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± å¯ä»¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ for(int i = 0; i åœ¨å¾ªç¯ä¸­åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œæ¯æ¬¡å¾ªç¯ç»“æŸå‰éƒ½ä¼šå›æ”¶å½“å‰æ± å­ä¸­çš„å¯¹è±¡ã€‚è¿™æ ·ç¨‹åºåœ¨æ‰§è¡Œå¾ªç¯æ—¶çš„å³°å€¼å°±ä¼šé™ä½ã€‚è‡ªåŠ¨é‡Šæ”¾æ± æœºåˆ¶å°±åƒâ€œæ ˆâ€ï¼ˆstackï¼‰ä¸€æ ·ã€‚ç³»ç»Ÿåˆ›å»ºå¥½è‡ªåŠ¨é‡Šæ”¾æ± ä¹‹åï¼Œå°±å°†å…¶æ¨å…¥æ ˆä¸­ï¼Œè€Œæ¸…ç©ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œåˆ™ç›¸å½“äºå°†å…¶ä»æ ˆä¸­å¼¹å‡ºã€‚åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œè‡ªåŠ¨é‡Šæ”¾æ“ä½œï¼Œå°±ç­‰äºå°†å…¶æ”¾å…¥æ ˆé¡¶çš„é‚£ä¸ªæ± é‡Œã€‚ åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ä¼šå¢åŠ é¢å¤–çš„å¼€é”€ï¼Œæ˜¯å¦éœ€è¦åˆ›å»ºè¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ¥ã€‚ æ€»ç»“ è‡ªåŠ¨é‡Šæ”¾æ± æ’å¸ƒåœ¨æ ˆä¸­ï¼Œå¯¹è±¡æ”¶åˆ° autorelease æ¶ˆæ¯åï¼Œç³»ç»Ÿå°†å…¶æ”¾å…¥åˆ°æœ€é¡¶ç«¯çš„æ± é‡Œã€‚åˆç†è¿ç”¨è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¯é™ä½åº”ç”¨ç¨‹åºçš„å†…å­˜å³°å€¼ã€‚ ç¬¬35æ¡ï¼šç”¨â€œåƒµå°¸å¯¹è±¡â€è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜ å‘å·²å›æ”¶çš„å¯¹è±¡å‘é€æ¶ˆæ¯æ˜¯ä¸å®‰å…¨çš„ã€‚è¿™ä¹ˆåšæœ‰æ—¶å¯ä»¥ï¼Œæœ‰æ—¶ä¸è¡Œã€‚å…·ä½“å¯è¡Œä¸å¦ï¼Œå®Œå…¨å–å†³äºå¯¹è±¡æ‰€å å†…å­˜æœ‰æ²¡æœ‰è¢«å…¶ä»–å†…å®¹æ‰€å¤å†™ã€‚è€Œè¿™å—å†…å­˜æœ‰æ²¡æœ‰ç§»ä½œä»–ç”¨ï¼Œåˆæ— æ³•ç¡®å®šï¼Œå› æ­¤ï¼Œåº”ç”¨ç¨‹åºåªæ˜¯å¶å°”å´©æºƒã€‚åœ¨æ²¡æœ‰å´©æºƒçš„æƒ…å†µä¸‹ï¼Œé‚£å—å†…å­˜å¯èƒ½åªå¤ç”¨äº†å…¶ä¸­ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥éƒ¨åˆ†å¯¹è±¡ä¸­çš„æŸäº›äºŒè¿›åˆ¶æ•°æ®ä¾ç„¶æœ‰æ•ˆã€‚è¿˜æœ‰ä¸€ç§å¯èƒ½ï¼Œå°±æ˜¯é‚£å—å†…å­˜æ°å¥½ä¸ºå¦å¤–ä¸€ä¸ªæœ‰æ•ˆä¸”å­˜è´§çš„å¯¹è±¡æ‰€å æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ¶ˆæ¯è½¬å‘åˆ°æ–°å¯¹è±¡é‚£é‡Œï¼Œè€Œæ­¤å¯¹è±¡ä¹Ÿè®¸èƒ½åº”ç­”ï¼Œä¹Ÿè®¸ä¸èƒ½ã€‚å¦‚æœèƒ½ï¼Œé‚£ç¨‹åºå°±ä¸å´©æºƒï¼Œå¯ä½ ä¼šè§‰å¾—å¥‡æ€ªï¼šä¸ºä»€ä¹ˆæ”¶åˆ°æ¶ˆæ¯çš„å¯¹è±¡ä¸æ˜¯é¢„æƒ³çš„é‚£ä¸ªå‘¢ï¼Ÿè‹¥æ–°å¯¹è±¡æ— æ³•å“åº”é€‰æ‹©å­ï¼Œåˆ™ç¨‹åºä¾ç„¶ä¼šå´©æºƒã€‚ Cocoaæä¾›äº†â€œåƒµå°¸å¯¹è±¡â€ï¼ˆZombie Objectï¼‰è¿™ä¸ªéå¸¸æ–¹ä¾¿çš„åŠŸèƒ½ã€‚å¯ç”¨è¿™é¡¹è°ƒè¯•åŠŸèƒ½ä¹‹åï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¼šæŠŠæ‰€æœ‰å·²ç»å›æ”¶çš„å®ä¾‹è½¬åŒ–ä¸ºç‰¹æ®Šçš„â€œåƒµå°¸å¯¹è±¡â€ï¼Œè€Œä¸æ˜¯çœŸæ­£å›æ”¶ä»–ä»¬ã€‚è¿™ç§å¯¹è±¡æ‰€åœ¨çš„æ ¸å¿ƒå†…å­˜æ— æ³•é‡ç”¨ï¼Œå› æ­¤ä¸å¯èƒ½é­åˆ°å¤å†™ã€‚åƒµå°¸å¯¹è±¡æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå…¶ä¸­å‡†ç¡®è¯´æ˜äº†å‘é€è¿‡æ¥çš„æ¶ˆæ¯ï¼Œå¹¶æè¿°äº†å›æ”¶ä¹‹å‰çš„é‚£ä¸ªå¯¹è±¡ã€‚åƒµå°¸å¯¹è±¡æ˜¯è°ƒè¯•å†…å­˜ç®¡ç†é—®é¢˜çš„æœ€ä½³æ–¹å¼ã€‚ ç‚¹å‡» Scheme -> Edit Scheme -> Run -> Diagnostics é‡Œé¢å¯ä»¥è®¾ç½®åƒµå°¸æ¨¡å¼ã€‚ Zombie Object å·¥ä½œåŸç† Zombie Object çš„å®ç°ä»£ç æ·±æ¤äº Objective - C çš„è¿è¡ŒæœŸç¨‹åºåº“ã€Foundation æ¡†æ¶ä»¥åŠ CoreFoundation æ¡†æ¶ä¸­ã€‚ç³»ç»Ÿåœ¨å³å°†å›æ”¶å¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°é€šè¿‡ç¯å¢ƒå˜é‡å¯ç”¨äº†åƒµå°¸å¯¹è±¡åŠŸèƒ½ï¼Œé‚£ä¹ˆè¿˜å°†æ‰§è¡Œä¸€ä¸ªé™„åŠ æ­¥éª¤ã€‚è¿™ä¸€æ­¥å°±æ˜¯æŠŠå¯¹è±¡è½¬åŒ–ä¸ºåƒµå°¸å¯¹è±¡ï¼Œè€Œä¸å½»åº•å›æ”¶ã€‚ åƒµå°¸ç±»å¦‚ä½•å°†æŠŠå¾…å›æ”¶çš„å¯¹è±¡è½¬æ¢æˆåƒµå°¸å¯¹è±¡ è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯ NSObject çš„ dealloc æ–¹æ³•æ‰€åšçš„äº‹ã€‚è¿è¡ŒæœŸç³»ç»Ÿå¦‚æœå‘ç° NSZombieEnabled ç¯å¢ƒå˜é‡å·²è®¾ç½®ï¼Œé‚£ä¹ˆå°±æŠŠ dealloc æ–¹æ³•çš„â€œè°ƒé…â€œï¼ˆswizzleï¼‰æˆä¸€ä¸ªä¼šæ‰§è¡Œç‰¹å®šä»£ç çš„æ–¹æ³•ã€‚æ‰§è¡Œåˆ°ç¨‹åºæœ«å°¾æ—¶ï¼Œå¯¹è±¡æ‰€å±çš„ç±»å·²ç»å˜ä¸º_NSZombie_OriginalClassäº†ï¼Œå…¶ä¸­ OriginalClass æŒ‡çš„æ˜¯åŸç±»åã€‚ ä»£ç ä¸­çš„å…³é”®ä¹‹å¤„åœ¨äºï¼šå¯¹è±¡æ‰€å å†…å­˜æ²¡æœ‰é€šè¿‡è°ƒç”¨ free() æ–¹æ³•é‡Šæ”¾ï¼Œå› æ­¤ï¼Œè¿™å—å†…å­˜ä¸å¯å¤ç”¨ã€‚è™½è¯´å†…å­˜æ³„æ¼äº†ï¼Œä½†è¿™åªæ˜¯ä¸ªè°ƒè¯•æ‰‹æ®µï¼Œå‘å¸ƒæ­£å¼åº”ç”¨ç¨‹åºæ—¶ä¸ä¼šæŠŠè¿™é¡¹åŠŸèƒ½æ‰“å¼€ï¼Œæ‰€ä»¥è¿™ç§æ³„æ¼é—®é¢˜æ— å…³ç´§è¦ã€‚ æ€»ç»“ æ‰“å¼€ â€œZombie Objectâ€ è¿™ä¸ªåŠŸèƒ½ï¼Œç³»ç»Ÿåœ¨å›æ”¶å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä¸å°†å…¶çœŸæ­£çš„å›æ”¶ï¼Œè€Œæ˜¯å°†å®ƒè½¬ä¸ºåƒµå°¸å¯¹è±¡ã€‚ ç³»ç»Ÿä¼šä¿®æ”¹å¯¹è±¡çš„isaæŒ‡é’ˆï¼Œä»¤å…¶æŒ‡å‘ç‰¹æ®Šçš„åƒµå°¸ç±»ï¼Œä»è€Œä½¿æ”¹å¯¹è±¡å˜ä¸ºåƒµå°¸å¯¹è±¡ã€‚åƒµå°¸ç±»èƒ½å¤Ÿå“åº”æ‰€æœ‰çš„é€‰æ‹©å­ï¼Œå“åº”æ–¹å¼ä¸ºï¼šæ‰“å°ä¸€æ¡åŒ…å«æ¶ˆæ¯å†…å®¹åŠå…¶æ¥æ”¶è€…çš„æ¶ˆæ¯ï¼Œç„¶åç»ˆæ­¢åº”ç”¨ç¨‹åºã€‚ ç¬¬36æ¡ï¼šä¸è¦ä½¿ç”¨ retainCount MRC ç¯å¢ƒä¸‹ï¼ŒretainCount æ‰€è¿”å›çš„å¼•ç”¨è®¡æ•°åªæ˜¯æŸä¸ªç»™å®šæ—¶é—´ç‚¹ä¸Šçš„å€¼ã€‚è¯¥æ–¹æ³•å¹¶æœªè€ƒè™‘åˆ°ç³»ç»Ÿä¼šç¨åæŠŠè‡ªåŠ¨é‡Šæ”¾æ± æ¸…ç©ºï¼Œå› è€Œä¸ä¼šå°†åç»­çš„é‡Šæ”¾æ“ä½œä»è¿”å›å€¼é‡Œå‡å»ï¼Œè¿™æ ·çš„è¯ï¼Œæ­¤å€¼å°±æœªå¿…èƒ½çœŸå®åæ˜ å®é™…çš„å¼•ç”¨è®¡æ•°äº†ã€‚ARC ç¯å¢ƒä¸‹å·²ç»åºŸå¼ƒæ­¤æ¥å£ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-1.html","title":"Chapter 6-1","keywords":"","body":"ç¬¬å…­ç« ï¼šå—ä¸å¤§ä¸­æ¢æ´¾å‘(1) ç¬¬37æ¡ï¼šç†è§£â€œå—â€è¿™ä¸€æ¦‚å¿µ å—ä¸å‡½æ•°ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯ç›´æ¥å®šä¹‰åœ¨å¦ä¸€ä¸ªå‡½æ•°é‡Œï¼Œå’Œå®šä¹‰ä»–çš„é‚£ä¸ªå‡½æ•°å…±äº«ä¸€ä¸ªèŒƒå›´å†…çš„ä¸œè¥¿ã€‚å—ç±»å‹çš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š return_type (^block_name)(parameters) å˜é‡æ•è· block å¯ä»¥æ•è·å¤–éƒ¨å˜é‡ï¼Œä¾‹å¦‚ï¼š int additional = 5; int (^addBlock)(int a, int b) = ^(int a, int b) { return a + b + additional; }; int add = addBlock(2, 5); block æ•è· additional å˜é‡ï¼Œä»…ä»…æ˜¯æ•è· additional é‚£ä¸€åˆ»çš„å€¼ï¼Œæ•è·äº†ä¹‹åï¼Œå¦‚æœå¤–éƒ¨ additional çš„å€¼æ”¹å˜äº†ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šå½±å“ block å†…éƒ¨ additional çš„å€¼ï¼Œå› ä¸ºè¿™ä¸ªå€¼æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„å†…å­˜ä¸­ï¼Œæ˜¯äº’ä¸å¹²æ‰°çš„ã€‚å¦‚æœå°è¯•å»ä¿®æ”¹æ­¤æ—¶ block å†…éƒ¨çš„additional å˜é‡çš„å€¼ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚äº‹å®ä¸Šï¼Œåœ¨ ARC ç¯å¢ƒä¸‹ï¼Œblock å¤–éƒ¨çš„ additional å˜é‡æ˜¯å­˜æ”¾åœ¨æ ˆä¸­çš„ï¼Œè€Œ block å†…éƒ¨çš„ additional å˜é‡åˆ™æ˜¯å­˜æ”¾åœ¨å †ä¸­çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœéœ€è¦ block å†…å¤–å…±äº«ä¸€ä»½å†…å­˜å‘¢ï¼Ÿè¿™æ—¶å¯ä»¥ç»™å˜é‡åŠ ä¸Š __block å…³é”®å­—ã€‚ __block å…³é”®å­—ä¿®é¥°å˜é‡ ä¸‹é¢ç”¨ __block å…³é”®å­—ä¿®é¥° additional å˜é‡ï¼Œé‚£ä¹ˆå½“å¤–éƒ¨çš„ additional å˜é‡æ”¹å˜æ—¶ï¼Œé‡Œé¢çš„ additional å€¼ä¹Ÿä¼šæ”¹å˜ã€‚å› ä¸ºè¿™ä¸¤ä¸ªæ˜¯åŒä¸€ä¸ªå€¼ã€‚ __block int additional = 5; int (^addBlock)(int a, int b) = ^(int a, int b) { additional = 1; return a + b + additional; }; int add = addBlock(2, 5); ç”¨ __block ä¿®é¥°çš„å˜é‡å­˜æ”¾åœ¨å †ä¸­ï¼Œå’Œ block ä¸­çš„ additional å…±äº«åŒä¸€ä»½å†…å­˜ï¼Œæ˜¯åŒä¸€ä¸ªæ•°æ®ã€‚ å¼•ç”¨å¾ªç¯ å¦‚æœåœ¨ block ä¸­å¼•ç”¨äº†æŸä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚selfï¼Œè€Œè¿™ä¸ªå¯¹è±¡æ­£å¥½ç›´æ¥æˆ–è€…é—´æ¥å¼•ç”¨äº† block ï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆå¼•ç”¨å¾ªç¯ã€‚æ‰€ä»¥ä¸€èˆ¬åœ¨ block ä¸­å¼•ç”¨çš„å˜é‡éƒ½ä¼šä½¿ç”¨å¼±å¼•ç”¨ã€‚ å—çš„å†…éƒ¨ç»“æ„ å—æœ¬èº«ä¹Ÿæ˜¯å¯¹è±¡ï¼Œåœ¨å­˜æ”¾å—å¯¹è±¡çš„å†…å­˜åŒºåŸŸä¸­ï¼Œé¦–ä¸ªå˜é‡æ˜¯æŒ‡å‘Classå¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆå«åšisaã€‚å…¶ä½™å†…å­˜é‡Œå«æœ‰å—å¯¹è±¡æ­£å¸¸è¿è½¬æ‰€éœ€çš„å„ç§ä¿¡æ¯ã€‚ä¸‹å›¾æè¿°äº†å—å¯¹è±¡çš„å†…å­˜å¸ƒå±€ã€‚ åœ¨å†…å­˜å¸ƒå±€ä¸­ï¼Œæœ€é‡è¦çš„å°±æ˜¯invokeå˜é‡ï¼Œè¿™æ˜¯ä¸ªå‡½æ•°æŒ‡é’ˆï¼ŒæŒ‡å‘å—çš„å®ç°ä»£ç ã€‚å‡½æ•°åŸå‹è‡³å°‘è¦æ¥å—ä¸€ä¸ªvoid *å‹çš„å‚æ•°ï¼Œæ­¤å‚æ•°ä»£è¡¨å—ã€‚ descriptor å˜é‡æ˜¯æŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œæ¯ä¸ªå—é‡Œéƒ½åŒ…å«æ­¤ç»“æ„ä½“ï¼Œå…¶ä¸­å£°æ˜äº†å—å¯¹è±¡çš„æ€»ä½“å¤§å°ï¼Œè¿˜å£°æ˜äº† copy ä¸ dispose è¿™ä¸¤ä¸ªè¾…åŠ©å‡½æ•°æ‰€å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆã€‚è¾…åŠ©å‡½æ•°åœ¨æ‹·è´åŠä¸¢å¼ƒå—å¯¹è±¡æ—¶è¿è¡Œï¼Œå…¶ä¸­ä¼šæ‰§è¡Œä¸€äº›æ“ä½œï¼Œæ¯”æ–¹è¯´ï¼Œå‰è€… copy è¦ä¿ç•™æ•è·çš„å¯¹è±¡ï¼Œè€Œåè€… dispose åˆ™å°†ä¹‹é‡Šæ”¾ã€‚ block ä¼šæŠŠå®ƒæ‰€æ•è·çš„æ‰€æœ‰å˜é‡éƒ½æ‹·è´ä¸€ä»½ï¼Œæ‹·è´çš„æ˜¯æŒ‡å‘è¿™äº›å¯¹è±¡çš„æŒ‡é’ˆå˜é‡ã€‚invokeå‡½æ•°ä¸ºä½•éœ€è¦æŠŠå—å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ è¿›æ¥å‘¢ï¼ŸåŸå› å°±åœ¨äºï¼Œæ‰§è¡Œå—æ—¶ï¼Œè¦ä»å†…å­˜ä¸­æŠŠè¿™äº›æ•è·åˆ°çš„å˜é‡è¯»å‡ºæ¥ã€‚ å…¨å±€å—ã€æ ˆå—åŠå †å— å®šä¹‰å—æ—¶ï¼Œå…¶æ‰€å çš„å†…å­˜åŒºåŸŸæ˜¯åˆ†é…åœ¨æ ˆä¸­çš„ã€‚è¿™å°±æ˜¯è¯´ï¼Œå—åªåœ¨å®šä¹‰ä»–çš„é‚£ä¸ªèŒƒå›´å†…æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œä¸‹é¢è¿™æ®µä»£ç ä¼šæœ‰é—®é¢˜ï¼š void (^block)(); if ( /* ... */ ) { block = ^{ NSLog(@\"Block A\"); }; } else { block = ^{ NSLog(@\"Block B\"); }; } block(); ä¸Šé¢ä¸¤ä¸ª block éƒ½æ˜¯åˆ†é…åœ¨æ ˆä¸­çš„ï¼Œå½“ç¦»å¼€äº†ä½œç”¨åŸŸåï¼Œå°±ä¼šå°†å…¶é‡Šæ”¾æ‰ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ª block åªåœ¨ if else å†…æœ‰æ•ˆã€‚æ‰€ä»¥ç¦»å¼€äº† if slse ååœ¨æ‰§è¡Œ blockçš„è¯å°±å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚è‹¥ç¼–è¯‘å™¨æœªè¦†å†™å¾…æ‰§è¡Œçš„ blockï¼Œåˆ™ç¨‹åºç…§å¸¸è¿è¡Œï¼Œè‹¥è¦†å†™ï¼Œåˆ™ç¨‹åºå´©æºƒã€‚ å…¶å®è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ block å±æ€§è¦ä½¿ç”¨ copy ä¿®é¥°çš„åŸå› ã€‚ç»™ block å‘é€ copy æ¶ˆæ¯å°†å…¶æ‹·è´ã€‚è¿™æ ·å°±å¯ä»¥æŠŠ block ä»æ ˆå¤åˆ¶åˆ°å †äº†ã€‚æ‹·è´åçš„ blockï¼Œå¯ä»¥åœ¨å®šä¹‰å®ƒçš„èŒƒå›´ä¹‹å¤–ä½¿ç”¨ã€‚è€Œä¸”ï¼Œä¸€æ—¦å¤åˆ¶åˆ°å †ä¸Šï¼Œå—å°±æˆäº†å¸¦å¼•ç”¨è®¡æ•°çš„å¯¹è±¡äº†ã€‚åç»­çš„å¤åˆ¶æ“ä½œéƒ½ä¸ä¼šçœŸçš„æ‰§è¡Œå¤åˆ¶ï¼Œåªæ˜¯é€’å¢å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ã€‚ ç»™ä¸Šé¢çš„ block å‘é€ copy æ¶ˆæ¯å°±å¯ä»¥ä¿è¯ç¨‹åºå¯ä»¥æ­£ç¡®è¿è¡Œ void (^block)(); if ( /* ... */ ) { block = [^{ NSLog(@\"Block A\"); } copy]; } else { block = [^{ NSLog(@\"Block B\"); } copy]; } block(); æ­¤æ—¶çš„ block æ˜¯åˆ†é…åˆ°å †çš„ï¼Œè¿™æ ·åœ¨ if else å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚ å…¨å±€å— è¿™ç§å—ä¸ä¼šæ•æ‰ä»»ä½•çŠ¶æ€ï¼ˆæ¯”å¦‚å¤–å›´çš„å˜é‡ç­‰ï¼‰ï¼Œè¿è¡Œæ—¶ä¹Ÿæ— é¡»æœ‰çŠ¶æ€æ¥å‚ä¸ã€‚å—æ‰€ä½¿ç”¨çš„æ•´ä¸ªå†…å­˜åŒºåŸŸï¼Œåœ¨ç¼–è¯‘æœŸå·²ç»å®Œå…¨ç¡®å®šäº†ï¼Œå› æ­¤ï¼Œå…¨å±€å—å¯ä»¥å£°æ˜åœ¨å…¨å±€å†…å­˜é‡Œï¼Œè€Œä¸éœ€è¦åœ¨æ¯æ¬¡ç”¨åˆ°çš„æ—¶å€™äºæ ˆä¸­åˆ›å»ºã€‚å¦å¤–ï¼Œå…¨å±€å—çš„æ‹·è´æ“ä½œæ˜¯ä¸ªç©ºæ“ä½œï¼Œå› ä¸ºå…¨å±€å—ç»ä¸å¯èƒ½ä¸ºç³»ç»Ÿæ‰€å›æ”¶ã€‚è¿™ç§å—å®é™…ä¸Šç›¸å½“äºå•ä¾‹ã€‚ void (^block)() = ^{ NSLog(@\"This is a block\"); }; æ­¤ block æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯éƒ½èƒ½åœ¨ç¼–è¯‘æœŸç¡®å®šï¼Œæ‰€ä»¥å¯æŠŠå®ƒåšæˆå…¨å±€å—ã€‚ è¦ç‚¹ å—å¯ä»¥åˆ†é…åœ¨æ ˆã€å †æˆ–è€…å…¨å±€ä¸Šã€‚åˆ†é…åœ¨æ ˆä¸Šçš„å—å¯ä»¥æ‹·è´åˆ°å †é‡Œï¼Œå°±å’Œæ ‡å‡†çš„ Objective-C å¯¹è±¡ä¸€æ ·å…·å¤‡äº†å¼•ç”¨è®¡æ•°ã€‚ ç¬¬38æ¡ï¼šä¸ºå¸¸ç”¨çš„å—ç±»å‹åˆ›å»ºtypedef ä¸€å¼€å§‹æˆ‘ä»¬å®šä¹‰ block æ˜¯è¿™æ ·çš„ int (^variableName)(BOOL flag, int value) = ^(BOOL flag, int value) { return someInt; }; è¿™æ ·åšä¼šæœ‰ä¸¤ä¸ªä¸å‹å¥½çš„é—®é¢˜ ä¸æ˜“è¯» å¦‚æœæˆ‘ä»¬æä¾›çš„æ¥å£ä¸­æœ‰å¥½å‡ ä¸ª block ï¼Œæ¯ä¸ª block ä¸­åˆæœ‰å¥½å‡ ä¸ªå‚æ•°ï¼Œè¿™æ ·ä¼šæ„Ÿè§‰æ¯”è¾ƒéš¾è¯»ã€‚è§£å†³æ–¹æ³•æ˜¯ç»™ block ç±»å‹å®šä¹‰ä¸€ä¸ªåˆ«å typedef int (^EOCSomeBlock)(BOOL flag, int value); EOCSomeBlock block = ^(BOOL flag, int value) { return someInt; }; è¿™æ ·ä½¿ç”¨èµ·æ¥å°±ä¼šç®€ä»‹å¾ˆå¤šã€‚ ä¸æ˜“ä¿®æ”¹ å½“æ‰“ç®—é‡æ„ block çš„ç±»å‹ç­¾åæ—¶ï¼Œæ¯”æ–¹è¯´ï¼Œè¦ç»™åŸæ¥çš„ completion handler block å†åŠ ä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ«åçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†æ‰€æœ‰ä½¿ç”¨äº†è¯¥ block çš„åœ°æ–¹éƒ½ä¿®æ”¹ï¼Œè¿™æ ·æ˜¾å¾—è¿‡äºç¹æ‚ã€‚å¦‚æœä½¿ç”¨äº†åˆ«åçš„è¯ï¼Œé‚£ä¹ˆåªéœ€ä¿®æ”¹ç±»å‹å®šä¹‰è¯­å¥å³å¯ã€‚ æ€»ç»“ å½“è¦åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨åŒç§ç­¾åçš„ block æ—¶ï¼Œåº”è¯¥ç»™è¯¥ block å®šä¹‰ä¸€ä¸ªåˆ«åï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹ä½¿ç”¨è¯¥åˆ«åå®šä¹‰ block ã€‚ ç¬¬39æ¡ï¼šç”¨ handler å—é™ä½ä»£ç åˆ†æ•£ç¨‹åº¦ ç¨‹åºåœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œé€šå¸¸éœ€è¦ â€œå¼‚æ­¥æ‰§è¡Œâ€ ï¼Œè¿™æ ·åšçš„å¥½å¤„åœ¨äºï¼šå¤„ç†ç”¨æˆ·ç•Œé¢çš„æ˜¾ç¤ºåŠè§¦æ‘¸æ“ä½œæ‰€ç”¨çš„çº¿ç¨‹ï¼Œä¸ä¼šå› ä¸ºè¦æ‰§è¡ŒI/Oæˆ–ç½‘ç»œé€šä¿¡è¿™ç±»è€—æ—¶çš„ä»»åŠ¡è€Œé˜»å¡ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœåº”ç”¨ç¨‹åºåœ¨ä¸€å®šæ—¶é—´å†…æ— å“åº”ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨ç»ˆæ­¢ã€‚â€œç³»ç»Ÿç›‘æ§å™¨â€ï¼ˆsystem watchdogï¼‰åœ¨å‘ç°æŸä¸ªåº”ç”¨ç¨‹åºçš„ä¸»çº¿ç¨‹å·²ç»é˜»å¡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå°±ä¼šä»¤å…¶ç»ˆæ­¢ã€‚ é€šå¸¸æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å¤„ç†å¼‚æ­¥ä»£ç  delegate ä½¿ç”¨ delegate ä¼šä½¿ä»£ç å˜å¾—åˆ†æ•£ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åŒæ—¶æ¥æ”¶å¤šä¸ªåŒç§ç±»å‹å¯¹è±¡çš„å§”æ‰˜æ—¶ï¼Œè¿˜éœ€è¦åœ¨å§”æ‰˜æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å“ªä¸ªå¯¹è±¡ä¼ æ¥çš„å§”æ‰˜ã€‚é‚£ä¹ˆä»£ç ä¼šå˜çš„æ›´åŠ å¤æ‚ã€‚delegate ä¸€èˆ¬ç”¨åœ¨ä¸€ä¸ªå§”æ‰˜å¯¹è±¡æœ‰å¤šä¸ªå§”æ‰˜äº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ï¼šUITableViewï¼Œå…¶ä»–æƒ…å†µå¯ä»¥ä½¿ç”¨ block æ¥å®ç°ã€‚ block ç”¨ block å¤„ç†èµ·æ¥ä»£ç ä¼šå˜çš„æ›´åŠ æ¸…æ™°ã€‚block å¯ä»¥ä»¤è¿™ç§APIå˜å¾—æ›´ç´§å‡‘ï¼ŒåŒæ—¶ä¹Ÿä»¤å¼€å‘è€…è°ƒç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€‚ - (void)vch_successWithComplete:(VCHAddNewDeviceComplete)complete failure:(VCHFailure)failure { [self vch_startWithComplete:^(id object) { // do something complete(); } failure:^(NSString *error) { // do something failure(error); }]; } è¿™é‡Œæˆ‘çš„å¤„ç†æ–¹å¼æ˜¯å°†æˆåŠŸå’Œå¤±è´¥åˆ†å¼€å¤„ç†ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ª block æ¥å¤„ç†ä¸¤ä¸ªä¸¤ç§æƒ…å†µï¼Œä¸¤ç§æ–¹æ³•å‡æœ‰ä¼˜åŠ£ã€‚å…·ä½“å¯å¤šçœ‹çœ‹å®˜æ–¹çš„åšæ³•ã€‚ æ€»ç»“ åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å†…è”çš„handlerå—å°†ç›¸å…³ä¸šåŠ¡é€»è¾‘ä¸€å¹¶å£°æ˜ã€‚ä½¿ä»£ç å˜å¾—æ›´åŠ ç´§å‡‘ã€‚ ç¬¬40æ¡ï¼šç”¨ block å¼•ç”¨å…¶æ‰€å±å¯¹è±¡æ—¶ä¸è¦å‡ºç°å¼•ç”¨å¾ªç¯ ä¹¦ä¸­çš„ä¾‹å­æ¯”è¾ƒé•¿ï¼Œæˆ‘ç”¨é¡¹ç›®ä¸­çš„ä¸€éƒ¨åˆ†ä»£ç æ¥æ›¿ä»£ï¼Œæ„æ€æ˜¯ä¸€æ ·çš„ self.tableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{ [self queryFence]; }]; [self.tableView.mj_header beginRefreshing]; ä¸Šé¢çš„ä»£ç ä¼šå‡ºç°å¼•ç”¨å¾ªç¯ï¼Œself -> mj_header -> block -> self ã€‚è¿™ä¸ªæ˜¯åˆå­¦æ—¶å¾ˆå®¹æ˜“çŠ¯çš„é”™è¯¯ã€‚è¿™ç§æƒ…å†µä¸‹æœ‰ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸€ç§å°±æ˜¯ç”¨å®Œ block åï¼Œç«‹å³å°†å…¶é‡Šæ”¾ï¼Œå¦ä¸€ç§å°±æ˜¯ä½¿ç”¨ __weak å…³é”®å­—ä¿®é¥°æŸä¸€ç¯èŠ‚ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ __weak typeof(self) weakSelf = self; self.tableView.mj_header = [MJRefreshNormalHeader headerWithRefreshingBlock:^{ [weakSelf queryFence]; }]; [self.tableView.mj_header beginRefreshing]; æ­¤æ—¶ block å¼±å¼•ç”¨äº† self ï¼Œè¿™ä¸ªå¾ªç¯ä¹Ÿå°±è¢«æ‰“ç ´äº†ã€‚ æ€»ç»“ å¦‚æœ block æ‰€æ•è·çš„å¯¹è±¡ç›´æ¥æˆ–é—´æ¥çš„ä¿ç•™äº† block æœ¬èº«ï¼Œé‚£ä¹ˆå°±éœ€è¦è§£é™¤å¼•ç”¨å¾ªç¯ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-2.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-2.html","title":"Chapter 6-2","keywords":"","body":"ç¬¬å…­ç« ï¼šå—ä¸å¤§ä¸­æ¢æ´¾å‘(2) ç¬¬41æ¡ï¼šå¤šç”¨æ´¾å‘é˜Ÿåˆ—ï¼Œå°‘ç”¨åŒæ­¥é” å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹è¦æ‰§è¡ŒåŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆæœ‰æ—¶å¯èƒ½ä¼šå‡ºé—®é¢˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸è¦ä½¿ç”¨é”æ¥å®ç°åŒæ­¥æœºåˆ¶ã€‚åœ¨GCDå‡ºç°ä¹‹å‰ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°åŒæ­¥ åŸå§‹æ–¹æ³•ï¼šsynchronized & NSLock - (void)synchronizedMethod { @synchronized (self) { // Safe } } _lock = [[NSLock alloc] init]; - (void)synchronizedMethod { [_lock lock]; // Safe [_lock unlock]; } æ»¥ç”¨ @synchronized(self) ä¼šå¾ˆå±é™©ï¼Œå› ä¸ºæ‰€æœ‰åŒæ­¥å—éƒ½ä¼šå½¼æ­¤æŠ¢å¤ºåŒä¸€ä¸ªé”ã€‚è¦æ˜¯æœ‰å¾ˆå¤šä¸ªå±æ€§éƒ½è¿™ä¹ˆå†™çš„è¯ï¼Œé‚£ä¹ˆæ¯ä¸ªå±æ€§çš„åŒæ­¥å—éƒ½è¦ç­‰å…¶ä»–æ‰€æœ‰åŒæ­¥å—æ‰§è¡Œå®Œæ¯•æ‰èƒ½æ‰§è¡Œã€‚ä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨æ•ˆç‡éƒ½ä¸é«˜ï¼Œå¹¶ä¸”å¤„ç†ä¸å½“ä¼šé€ æˆæ­»é”ã€‚ æ”¹è¿›æ–¹æ³•ï¼šä¸²è¡ŒåŒæ­¥é˜Ÿåˆ— _syncQueue = dispatch_queue_create(\"com.vhuichen.syncQueue\", NULL); - (NSString *)someString { __block NSString *localSomeString; dispatch_sync(_syncQueue, ^{ localSomeString = _someString; }); return localSomeString; } - (void)setSomeString:(NSString *)someString { dispatch_sync(_syncQueue, ^{ _someString = someString; }); } è¿™é‡Œæœ‰ä¸€ç§æ–¹æ¡ˆå°±æ˜¯å¯ä»¥æŠŠ setter æ–¹æ³•æ”¹æˆå¼‚æ­¥æ‰§è¡Œï¼Œæå‡ç¨‹åºçš„æ‰§è¡Œé€Ÿåº¦ã€‚ - (void)setSomeString:(NSString *)someString { dispatch_async(_syncQueue, ^{ _someString = someString; }); } è¿™é‡Œéœ€è¦è€ƒè™‘çš„æ˜¯ï¼šæ‰§è¡Œå¼‚æ­¥æ´¾å‘æ—¶ï¼Œéœ€è¦æ‹·è´å—ã€‚è‹¥æ‹·è´å—æ‰€éœ€çš„æ—¶é—´æ˜æ˜¾è¶…è¿‡æ‰§è¡Œå—æ‰€èŠ±çš„æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ç§åšæ³•å°†æ¯”åŸæ¥çš„æ›´æ…¢ã€‚åªæœ‰å½“æ‹·è´å—æ‰€èŠ±çš„æ—¶é—´è¿œä½äºæ‰§è¡Œå—æ‰€èŠ±çš„æ—¶é—´æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¿™ç§å¼‚æ­¥æ–¹æ³•ã€‚ æœ€ä¼˜æ–¹æ¡ˆï¼šdispatch_barrier äº‹å®ä¸Šï¼Œè·å–å€¼æ—¶å¯ä»¥å¤šä¸ªåŒæ—¶è¿›è¡Œï¼Œè®¾ç½®å€¼å’Œè·å–å€¼ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä»£ç å†æ¬¡ä¼˜åŒ–ã€‚ _syncQueue = dispatch_queue_create(DISPATCH_QUEUE_PRIORITY_DEFAULT, NULL); - (NSString *)someString { __block NSString *localSomeString; dispatch_sync(_syncQueue, ^{ localSomeString = _someString; }); return localSomeString; } - (void)setSomeString:(NSString *)someString { // è¿™æ˜¯ä½¿ç”¨ async è¿˜æ˜¯ sync å–å†³äº block çš„ä¸šåŠ¡é€»è¾‘å¤æ‚åº¦ï¼Œä¸Šé¢æœ‰è§£é‡Š dispatch_barrier_async(_syncQueue, ^{ _someString = someString; }); } ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬åˆ›å»ºçš„æ˜¯ä¸€ä¸ªå¹¶è¡Œé˜Ÿåˆ—ã€‚è¯»å–æ“ä½œå¯ä»¥å¹¶è¡Œï¼Œä½†å†™å…¥æ“ä½œæ˜¯å•ç‹¬æ‰§è¡Œçš„ï¼Œå› ä¸ºç»™å®ƒåŠ äº†æ …æ ï¼Œä»£ç çš„æ‰§è¡Œé€»è¾‘å¦‚ä¸‹å›¾ æ€»ç»“ ä½¿ç”¨GCDå®ç°åŒæ­¥æ–¹å¼ï¼Œæ¯”ä½¿ç”¨ synchronized æˆ– NSLock æ›´é«˜æ•ˆã€‚ ç¬¬42æ¡ï¼šå¤šç”¨ GCDï¼Œå°‘ç”¨ performSelector ç³»åˆ—æ–¹æ³• performSelector æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚ å¯èƒ½ä¼šå¼•èµ·å†…å­˜æ³„æ¼ çœ‹ä¸‹é¢ä¸€æ®µä»£ç  SEL selector; if (/* ... */) { selector = @selector(newObject); } else if (/* ... */) { selector = @selector(copy); } else { selector = @selector(someProperty); } id ret = [object performSelector:selector]; ç¼–è¯‘å™¨ä¼šå‘å‡ºå¦‚ä¸‹è­¦ç¤ºä¿¡æ¯ warning:PerformSelector may cause a leak because its selector is unknown åŸå› åœ¨äºï¼Œç¼–è¯‘å™¨å¹¶ä¸çŸ¥é“å°†è¦è°ƒç”¨çš„é€‰æ‹©å­çš„æ–¹æ³•ç­¾ååŠè¿”å›å€¼ã€‚ç”±äºç¼–è¯‘å™¨ä¸çŸ¥é“æ–¹æ³•åï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•è¿ç”¨ ARC çš„å†…å­˜ç®¡ç†è§„åˆ™æ¥åˆ¤å®šè¿”å›å€¼æ˜¯ä¸æ˜¯åº”è¯¥é‡Šæ”¾ã€‚é‰´äºæ­¤ï¼ŒARCé‡‡ç”¨äº†æ¯”è¾ƒè°¨æ…çš„åšæ³•ï¼Œå°±æ˜¯ä¸æ·»åŠ é‡Šæ”¾æ“ä½œã€‚ç„¶è€Œè¿™ä¹ˆåšå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸ºæ–¹æ³•åœ¨è¿”å›å¯¹è±¡æ—¶å¯èƒ½å·²ç»å°†å…¶ä¿ç•™äº†ã€‚ è¿”å›å€¼åªèƒ½æ˜¯ void æˆ–å¯¹è±¡ç±»å‹ å¦‚æœæƒ³è¿”å›æ•´æ•°æˆ–æµ®ç‚¹æ•°ç­‰ç±»å‹çš„å€¼ï¼Œé‚£ä¹ˆå°±éœ€è¦æ‰§è¡Œä¸€äº›å¤æ‚çš„è½¬æ¢æ“ä½œã€‚å¦‚æœè¿”å›çš„æ˜¯ç»“æ„ä½“ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ performSelector ã€‚ ä¼ å…¥å‚æ•°æœ‰é™åˆ¶ ä¼ å…¥å‚æ•°å¿…é¡»ä¸ºå¯¹è±¡ç±»å‹ï¼Œæœ€å¤šåªæœ‰ä¸¤ä¸ªé™åˆ¶ã€‚ æ”¹è¿›ï¼ˆGCDï¼‰ [self performSelectorOnMainThread:@selector(aSelector) withObject:nil waitUntilDone:NO]; ä¸Šé¢çš„åŠŸèƒ½å¯ä»¥é€šè¿‡ GCD æ¥å®ç° dispatch_async(dispatch_get_main_queue(), ^{ [self aSelector]; }); å…¶å®ƒ performSelector çš„æ–¹æ³•ä¹Ÿä¸€æ ·å¯ä»¥ç”¨ GCD çš„æ–¹æ³•ä»£æ›¿ã€‚ ç¬¬43æ¡ï¼šæŒæ¡ GCD åŠ NSOperationQueue çš„ä½¿ç”¨æ—¶æœº ä½¿ç”¨ NSOperationQueue ä¼˜ç‚¹ å–æ¶ˆæŸä¸ªæ“ä½œ ä½¿ç”¨ NSOperationQueue ï¼Œæƒ³è¦å–æ¶ˆæ“ä½œé˜Ÿåˆ—æ˜¯å¾ˆå®¹æ˜“çš„ã€‚è¿è¡Œä»»åŠ¡ä¹‹å‰ï¼Œå¯ä»¥åœ¨ NSOperation å¯¹è±¡ä¸Šè°ƒç”¨ cancel æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè®¾ç½®å¯¹è±¡å†…çš„æ ‡å¿—ä½ï¼Œç”¨ä»¥è¡¨æ˜æ­¤ä»»åŠ¡ä¸éœ€æ‰§è¡Œï¼Œä¸è¿‡ï¼Œå·²ç»å¯åŠ¨çš„ä»»åŠ¡æ— æ³•å–æ¶ˆã€‚GCD åˆ™æ— æ³•ç›´æ¥å–æ¶ˆã€‚ æŒ‡å®šæ“ä½œé—´çš„ä¾èµ–å…³ç³» ä¸€ä¸ªæ“ä½œå¯ä»¥ä¾èµ–å…¶ä»–å¤šä¸ªæ“ä½œã€‚å¼€å‘è€…èƒ½å¤Ÿåˆ¶å®šæ“ä½œä¹‹é—´çš„ä¾èµ–ä½“ç³»ï¼Œä½¿ç‰¹å®šçš„æ“ä½œå¿…é¡»åœ¨å¦å¤–ä¸€ä¸ªæ“ä½œé¡ºåˆ©æ‰§è¡Œå®Œæ¯•åæ–¹å¯æ‰§è¡Œã€‚ é€šè¿‡é”®å€¼è§‚æµ‹æœºåˆ¶ç›‘æ§ NSOperation å¯¹è±¡çš„å±æ€§ NSOperation å¯¹è±¡æœ‰è®¸å¤šå±æ€§éƒ½é€‚åˆé€šè¿‡é”®å€¼è§‚æµ‹æœºåˆ¶ï¼ˆKVOï¼‰æ¥ç›‘å¬ã€‚æ¯”å¦‚å¯ä»¥é€šè¿‡ isCancelled å±æ€§æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å–æ¶ˆï¼Œåˆæ¯”å¦‚å¯ä»¥é€šè¿‡ isFinished å±æ€§æ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å®Œæˆã€‚ æŒ‡å®šæ“ä½œçš„ä¼˜å…ˆçº§ æ“ä½œçš„ä¼˜å…ˆçº§è¡¨ç¤ºæ­¤æ“ä½œä¸é˜Ÿåˆ—ä¸­å…¶ä»–æ“ä½œä¹‹é—´çš„ä¼˜å…ˆçº§å…³ç³»ã€‚ä¼˜å…ˆçº§é«˜çš„æ“ä½œå…ˆæ‰§è¡Œï¼Œä¼˜å…ˆçº§ä½çš„åæ‰§è¡Œã€‚ é‡ç”¨ NSOperation å¯¹è±¡ ç³»ç»Ÿå†…ç½®äº†ä¸€äº› NSOperation çš„å­ç±»ï¼ˆæ¯”å¦‚ NSBlockOperationï¼‰ä»¥ä¾›å¼€å‘è€…è°ƒç”¨ï¼Œè¦æ˜¯ä¸æƒ³ç”¨è¿™äº›å­ç±»ï¼Œå¯ä»¥è‡ªå·±åˆ›å»ºã€‚è¿™äº›ç±»å°±æ˜¯æ™®é€šçš„ Objective-C å¯¹è±¡ï¼Œèƒ½å¤Ÿå­˜æ”¾ä»»ä½•ä¿¡æ¯ã€‚å¯¹è±¡åœ¨æ‰§è¡Œæ—¶å¯ä»¥å……åˆ†åˆ©ç”¨å­˜äºå…¶ä¸­çš„ä¿¡æ¯ï¼Œè€Œä¸”è¿˜å¯ä»¥éšæ„è°ƒç”¨å®šä¹‰åœ¨ç±»ä¸­çš„æ–¹æ³•ã€‚NSOperation ç±»ç¬¦åˆè½¯ä»¶å¼€å‘ä¸­çš„â€œä¸é‡å¤â€ï¼ˆDonâ€™t Repeat Yourselfï¼ŒDRYï¼‰åŸåˆ™ã€‚ æ€»ç»“ GCD æ“ä½œç®€å•ï¼ŒNSOperation åˆ™åŠŸèƒ½æ›´å¤šã€‚ç†Ÿç»ƒæŒæ¡ä¸¤ç§æ–¹å¼ï¼Œåœ¨å„ç§å„æ ·çš„åœºæ™¯ä¸­è¿ç”¨è‡ªå¦‚ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-3.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 6-3.html","title":"Chapter 6-3","keywords":"","body":"ç¬¬å…­ç« ï¼šå—ä¸å¤§ä¸­æ¢æ´¾å‘(3) ç¬¬44æ¡ï¼šé€šè¿‡ Dispatch Groupï¼Œæ ¹æ®ç³»ç»Ÿèµ„æºçŠ¶å†µæ¥æ‰§è¡Œä»»åŠ¡ dispatch group æ˜¯ GCD çš„ä¸€é¡¹ç‰¹æ€§ï¼Œèƒ½å¤ŸæŠŠä»»åŠ¡åˆ†ç»„ã€‚è°ƒç”¨è€…å¯ä»¥ç­‰å¾…è¿™ç»„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œä¹Ÿå¯ä»¥åœ¨æä¾›å›è°ƒå‡½æ•°ä¹‹åç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œè¿™ç»„ä»»åŠ¡å®Œæˆæ—¶ï¼Œè°ƒç”¨è€…ä¼šå¾—åˆ°é€šçŸ¥ã€‚é€šè¿‡è¿™ä¸ªåŠŸèƒ½å¯ä»¥æŠŠå°†è¦å¹¶å‘æ‰§è¡Œçš„å¤šä¸ªä»»åŠ¡åˆä¸ºä¸€ç»„ï¼Œäºæ˜¯è°ƒç”¨è€…å°±å¯ä»¥çŸ¥é“è¿™äº›ä»»åŠ¡ä½•æ—¶æ‰èƒ½å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚ åˆ›å»º dispatch group dispatch_group_t group = dispatch_group_create(); æƒ³æŠŠä»»åŠ¡åˆ†ç»„ï¼Œæœ‰ä¸¤ç§åŠæ³•ã€‚ void dispatch_group_async(dispatch_group_t group, dispatch_queue_t queue, dispatch_block_t block); dispatch_group_enter(dispatch_group_t group); // task dispatch_group_leave(dispatch_group_t group); åˆ¤æ–­ä»»åŠ¡å®Œæˆä¹Ÿæœ‰ä¸¤ç§æ–¹æ³•ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œç­‰åˆ°æ‰€æœ‰ä»»åŠ¡å®Œæˆï¼Œæ‰èƒ½ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ void dispatch_group_wait(dispatch_group_t group, dispatch_time_t timeout); ç¬¬äºŒç§æ–¹æ³•æ˜¯å¼‚æ­¥çš„ï¼Œå½“æ‰€æœ‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªé€šçŸ¥ã€‚ void dispatch_group_notify(dispatch_group_t group, dispatch_queue_t queue, dispatch_block_t block); å¦‚æœæƒ³ä»¤æ•°ç»„ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æ‰§è¡ŒæŸé¡¹ä»»åŠ¡ï¼Œå¹¶ä¸”æƒ³ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªGCDç‰¹æ€§æ¥å®ç°ã€‚åŒæ—¶è¿˜å¯ä»¥ç»™ä»»åŠ¡åŠ ä¸Šä¼˜å…ˆçº§ã€‚ dispatch_queue_t lowPriorityQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_LOW, 0); dispatch_queue_t highPriorityQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0); dispatch_group_t dispatchGroup = dispatch_group_create(); NSArray *lowPriorityObject; NSArray *highPriorityObject; for (id object in lowPriorityObject) { dispatch_group_async(dispatchGroup, lowPriorityQueue, ^{ [object task]; }); } for (id object in highPriorityObject) { dispatch_group_async(dispatchGroup, highPriorityQueue, ^{ [object task]; }); } dispatch_group_notify(dispatchGroup, dispatch_get_main_queue(), ^{ }); é™¤äº†åƒä¸Šé¢è¿™æ ·æŠŠä»»åŠ¡æäº¤åˆ°å¹¶å‘é˜Ÿåˆ—ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥æŠŠä»»åŠ¡æäº¤è‡³å„ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œå¹¶ç”¨ dispatch group è·Ÿè¸ªå…¶æ‰§è¡ŒçŠ¶å†µã€‚å¦‚æœæ‰€æœ‰ä»»åŠ¡éƒ½æ’åœ¨åŒä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—é‡Œé¢ï¼Œé‚£ä¹ˆ dispatch group å°±ç”¨å¤„ä¸å¤§äº†ã€‚å› ä¸ºæ­¤æ—¶ï¼Œä»»åŠ¡æ€»è¦é€ä¸ªæ‰§è¡Œï¼Œæ‰€ä»¥åªéœ€åœ¨æäº¤å®Œå…¨éƒ¨ä»»åŠ¡ä¹‹åå†æäº¤ä¸€ä¸ªå—å³å¯ï¼Œè¿™æ ·åšä¸é€šè¿‡ notify å‡½æ•°ç­‰å¾… dispatch group æ‰§è¡Œå®Œæ¯•åå†å›è°ƒå—æ˜¯ç­‰æ•ˆçš„ã€‚ dispatch_apply dispatch_apply ä¹Ÿæ˜¯å¹¶å‘ï¼Œå¹¶ä¸”æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥æœ‰æ—¶å€™æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨ dispatch_apply æ¥ä»£æ›¿ dispatch group æ¥æ‰§è¡Œä»»åŠ¡ã€‚ dispatch_queue_t queue = dispatch_queue_create(\"com.vhuichen.queue\", NULL); dispatch_apply(count, queue, ^(size_t i) { //Perform task }); æ€»ç»“ å½“æœ‰ä¸€ç»„ä»»åŠ¡éœ€è¦æ‰§è¡Œæ—¶ï¼Œå¯ä»¥å°†è¿™ä¸€ç»„ä»»åŠ¡åŠ åˆ° dispatch group ä¸­ï¼Œå½“æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆåä¼šæ”¶åˆ°ä¸€ä¸ªé€šçŸ¥ã€‚ ç¬¬45æ¡ï¼šä½¿ç”¨ dispath_once æ¥æ‰§è¡Œåªéœ€è¿è¡Œä¸€æ¬¡çš„çº¿ç¨‹å®‰å…¨ä»£ç  å•ä¾‹æ¨¡å¼ï¼ˆsingletonï¼‰æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä¸€ç§å¼€å‘æ¨¡å¼ï¼Œå¸¸è§çš„ä¸€ç§å†™æ³•å¦‚ä¸‹ï¼š + (instancetype)sharedInstance { static id sharedInstance = nil; @synchronized (self) { if (!sharedInstance) { sharedInstance = [[self alloc] init]; } } return sharedInstance; } ä¹Ÿå¯ä»¥é€šè¿‡ GCD çš„ dispath_once æ¥å®ç°ï¼Œdispath_once æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ + (instancetype)sharedInstance { static id sharedInstance = nil; static dispatch_once_t onceToken; dispatch_once(&onceToken, ^{ sharedInstance = [[self alloc] init]; }); return sharedInstance; } ä½¿ç”¨ dispath_once æ–¹å¼æ¯” @synchronized æ–¹å¼è¦å¿«å¾ˆå¤š ç¬¬46æ¡ï¼šä¸è¦ä½¿ç”¨ dispatch_get_current_queue ä½¿ç”¨ GCD æ—¶ï¼Œç»å¸¸éœ€è¦åˆ¤æ–­å½“å‰ä»£ç æ­£åœ¨å“ªä¸ªé˜Ÿåˆ—ä¸Šæ‰§è¡Œï¼Œæ–‡æ¡£æä¾›äº†è¿™ä¸ªå‡½æ•°ï¼š dispatch_queue_t dispatch_get_current_queue(); iOS6.0 å¼€å§‹å·²ç»æ­£å¼å¼ƒç”¨æ­¤å‡½æ•°äº†ã€‚è¿™ä¸ªå‡½æ•°æœ‰ä¸ªå…¸å‹çš„é”™è¯¯ç”¨æ³•ï¼Œå°±æ˜¯ç”¨å®ƒæ¥æ£€æµ‹å½“å‰é˜Ÿåˆ—æ˜¯ä¸æ˜¯æŸä¸ªç‰¹å®šçš„é˜Ÿåˆ—ï¼Œè¯•å›¾ä»¥æ­¤æ¥é¿å…æ‰§è¡ŒåŒæ­¥æ´¾å‘æ—¶å¯èƒ½é‡åˆ°çš„æ­»é”é—®é¢˜ã€‚ä¸‹é¢ä¸¤ä¸ªå­˜å–æ–¹æ³•ï¼Œç”¨ä¸²è¡Œé˜Ÿåˆ—ä¿è¯å®ä¾‹å˜é‡çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ - (NSString *)someString { __block NSString *localSomeString; dispatch_sync(_syncQueue, ^{ localSomeString = _someString; }); return localSomeString; } - (void)setSomeString:(NSString *)someString { dispatch_async(_syncQueue, ^{ _someString = someString; }); } è¿™ç§å†™æ³•çš„é—®é¢˜åœ¨äºï¼Œgetter æ–¹æ³•å¯èƒ½ä¼šæ­»é”ï¼ˆå½“ getter æ–¹æ³•æ°å¥½å°±æ˜¯ _syncQueue æ—¶ï¼‰ã€‚å¯ä»¥å°†ä¸Šé¢çš„ä»£ç ç¨ä½œä¿®æ”¹ï¼Œåªéœ€å…ˆåˆ¤æ–­å½“å‰é˜Ÿåˆ—æ˜¯å¦ä¸º _syncQueue é˜Ÿåˆ—ï¼Œå¦‚æœæ˜¯å°±ä¸æ´¾å‘ï¼Œç›´æ¥æ‰§è¡Œã€‚è¿™æ ·åšå°±å¯ä»¥å¦å…¶å˜å¾—â€œå¯é‡å…¥â€ - (NSString *)someString { __block NSString *localSomeString; dispatch_block_t accessorBlock = ^{ localSomeString = _someString; }; if (dispatch_get_current_queue() == _syncQueue) { accessorBlock(); } else { dispatch_sync(_syncQueue, accessorBlock); } return localSomeString; } è¿™æ ·åšå¥½åƒæ˜¯å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æœ‰äº›æƒ…å†µä¸‹è¿˜æ˜¯ä¼šå‡ºç°æ­»é”é—®é¢˜ï¼Œä¾‹å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š dispatch_queue_t queueA = dispatch_queue_create(\"com.vhuichen.queueA\", NULL); dispatch_queue_t queueB = dispatch_queue_create(\"com.vhuichen.queueB\", NULL); dispatch_sync(queueA, ^{ dispatch_sync(queueB, ^{ dispatch_block_t block = ^{ /* ... */ }; if (dispatch_get_current_queue() == queueA) { block(); } else { dispatch_sync(queueA, block); } }); }); ä¸Šé¢çš„ä»£ç ä¾ç„¶ä¼šå‡ºç°æ­»é”ã€‚ä¹Ÿå°±æ˜¯è¯´æƒ³é€šè¿‡ dispatch_get_current_queue æ¥é¿å…æ­»é”é—®é¢˜æ˜¯ä¸å¯èƒ½çš„ã€‚ æœ‰çš„ API å¯ä»¤å¼€å‘è€…æŒ‡å®šè¿è¡Œå›è°ƒæ—¶æ‰€ç”¨çš„é˜Ÿåˆ—ï¼Œä½†å®é™…ä¸Šå´ä¼šæŠŠå›è°ƒå—å®‰æ’åœ¨å†…éƒ¨çš„ä¸²è¡ŒåŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œè€Œå†…éƒ¨é˜Ÿåˆ—çš„ç›®æ ‡é˜Ÿåˆ—åˆæ˜¯å¼€å‘è€…æ‰€æä¾›çš„é‚£ä¸ªé˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°æ­»é”ã€‚ä½¿ç”¨ API çš„å¼€å‘è€…è®¤ä¸ºåœ¨å›è°ƒå—é‡Œè°ƒç”¨ dispatch_get_current_queue è¿”å›çš„â€œå½“å‰é˜Ÿåˆ—â€ï¼Œæ€»æ˜¯è°ƒç”¨ API æ—¶æŒ‡å®šçš„é‚£ä¸ªï¼Œä½†å®é™…è¿”å›çš„å´æ˜¯ API å†…éƒ¨çš„é‚£ä¸ªé˜Ÿåˆ—ã€‚ è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯é€šè¿‡ GCD æ‰€æä¾›çš„åŠŸèƒ½æ¥è®¾å®šâ€œé˜Ÿåˆ—ç‰¹æœ‰æ•°æ®â€ï¼ˆ queue_specific data ï¼‰ï¼Œæ­¤åŠŸèƒ½å¯ä»¥æŠŠä»»æ„æ•°æ®ä»¥é”®å€¼å¯¹çš„å½¢å¼å…³è”åˆ°é˜Ÿåˆ—é‡Œã€‚å‡å¦‚æ ¹æ®æŒ‡å®šçš„é”®å€¼å¯¹è·å–ä¸åˆ°å…³è”æ•°æ®ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šæ²¿ç€å±‚çº§ä½“ç³»ä¸€ç›´å‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°æ•°æ®æˆ–è€…åˆ°è¾¾æ ¹é˜Ÿåˆ—ä¸ºæ­¢ã€‚çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ï¼š dispatch_queue_t queueA = dispatch_queue_create(\"com.vhuichen.queueA\", NULL); dispatch_queue_t queueB = dispatch_queue_create(\"com.vhuichen.queueB\", NULL); static int kQueueSpecific; CFStringRef queueSpecificValue = CFSTR(\"queueA\"); dispatch_queue_set_specific(queueA, &kQueueSpecific, (void *)queueSpecificValue, (dispatch_function_t)CFRelease); dispatch_sync(queueB, ^{ dispatch_block_t block = ^{ NSLog(@\"no deadlock\"); }; CFStringRef retrievedValue = dispatch_get_specific(&kQueueSpecific); if (retrievedValue) { block(); } else { dispatch_sync(queueA, block); } }); ä½¿ç”¨ â€œé˜Ÿåˆ—ç‰¹æœ‰æ•°æ®â€ï¼ˆ queue_specific data ï¼‰åˆ™å¯ä»¥é¿å…ç”±ä¸å¯é‡å…¥å¼•å‘çš„æ­»é”ã€‚ æ€»ç»“ dispatch_get_current_queue å‡½æ•°æ— æ³•è§£å†³ç”±ä¸å¯é‡å…¥å¼•å‘çš„æ­»é”é—®é¢˜ï¼Œä½†â€œé˜Ÿåˆ—ç‰¹æœ‰æ•°æ®â€ï¼ˆ queue_specific data ï¼‰å¯ä»¥è§£å†³æ­¤é—®é¢˜ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 7-1.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 7-1.html","title":"Chapter 7-1","keywords":"","body":"ç¬¬ä¸ƒç« ï¼šç³»ç»Ÿæ¡†æ¶(1) ç¬¬47æ¡ï¼šç†Ÿæ‚‰ç³»ç»Ÿæ¡†æ¶ Foundation Foundation æ¡†æ¶ä¸­çš„ç±»ï¼Œä½¿ç”¨ NS è¿™ä¸ªå‰ç¼€ï¼Œæ­¤å‰ç¼€æ˜¯åœ¨ Objective-C è¯­è¨€ç”¨ä½œ NeXTSTEP æ“ä½œç³»ç»Ÿçš„ç¼–ç¨‹è¯­è¨€æ—¶é¦–åº¦ç¡®å®šçš„ã€‚Foundation æ¡†æ¶æ˜¯ Objective-C åº”ç”¨ç¨‹åºçš„åŸºç¡€ã€‚Foundation æ¡†æ¶ä¸ä»…æä¾›äº† collection ç­‰åŸºç¡€æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œä¸”è¿˜æä¾›äº†å­—ç¬¦ä¸²å¤„ç†è¿™æ ·çš„å¤æ‚åŠŸèƒ½ã€‚ CoreFoundation CoreFoundation æ¡†æ¶ä¸æ˜¯ Objective-C æ¡†æ¶ï¼Œä½†å®ƒå´æ˜¯ Objective-C åº”ç”¨ç¨‹åºæ—¶æ‰€åº”ç†Ÿæ‚‰çš„é‡è¦æ¡†æ¶ï¼ŒFoundation æ¡†æ¶ä¸­çš„è®¸å¤šåŠŸèƒ½ï¼Œéƒ½å¯ä»¥åœ¨æ­¤æ¡†æ¶ä¸­æ‰¾åˆ°å¯¹åº”çš„ C è¯­è¨€ APIã€‚CoreFoundation ä¸ Foundation åå­—ç›¸ä¼¼ã€è”ç³»ç´§å¯†ã€‚èƒ½åšåˆ°â€œæ— ç¼æ¡¥æ¥â€ï¼Œå¯ä»¥æŠŠ CoreFoundation æ¡†æ¶ä¸­çš„ C è¯­è¨€æ•°æ®ç»“æ„å¹³æ»‘è½¬æ¢ä¸º Foundation ä¸­çš„ Objective-C å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥åå‘è½¬æ¢ã€‚æ¯”å¦‚ï¼šNSString ä¸ CFString å¯ä»¥äº’è½¬ã€‚ CFNetWork æ­¤æ¡†æ¶æä¾›äº† C è¯­è¨€çº§åˆ«çš„ç½‘ç»œé€šä¿¡èƒ½åŠ›ï¼Œå®ƒå°†\"BSDå¥—æ¥å­—\"ï¼ˆBSD socketï¼‰æŠ½è±¡æˆæ˜“äºä½¿ç”¨çš„ç½‘ç»œæ¥å£ã€‚è€Œ Foundation åˆ™å°†è¯¥æ¡†æ¶é‡Œçš„éƒ¨åˆ†å†…å®¹å°è£…ä¸º Objective-C è¯­è¨€çš„æ¥å£ï¼Œä»¥ä¾¿äºè¿›è¡Œç½‘ç»œé€šä¿¡ï¼Œä¾‹å¦‚å¯ä»¥ç”¨ NSURLConnection ä» URL ä¸­ä¸‹è½½æ•°æ®ã€‚ CoreAudio è¯¥æ¡†æ¶æ‰€æä¾›çš„ C è¯­è¨€ API å¯ç”¨æ¥æ“ä½œè®¾å¤‡ä¸Šçš„éŸ³é¢‘ç¡¬ä»¶ã€‚è¿™ä¸ªæ¡†æ¶å±äºæ¯”è¾ƒéš¾ç”¨çš„é‚£ç§ï¼Œå› ä¸ºéŸ³é¢‘å¤„ç†æœ¬èº«å°±å¾ˆå¤æ‚ã€‚æ‰€å¹¸ç”±è¿™å¥— API å¯ä»¥æŠ½è±¡å‡ºå¦å¤–ä¸€å¥— Objective-C å¼çš„ APIï¼Œç”¨åè€…æ¥å¤„ç†éŸ³é¢‘é—®é¢˜ä¼šæ›´ç®€å•äº›ã€‚ AVFoundation æ­¤æ¡†æ¶æ‰€æä¾›çš„ Objective-C å¯¹è±¡å¯ç”¨æ¥å›æ”¾å¹¶å½•åˆ¶éŸ³é¢‘åŠè§†é¢‘ï¼Œæ¯”å¦‚èƒ½å¤Ÿåœ¨ UI è§†å›¾ç±»é‡Œæ’­æ”¾è§†é¢‘ã€‚ CoreData æ­¤æ¡†æ¶æä¾›çš„ Objective-C æ¥å£å¯ä»¥å°†å¯¹è±¡æ”¾å…¥æ•°æ®åº“ï¼Œä¾¿äºæŒä¹…ä¿å­˜ã€‚CoreData ä¼šå¤„ç†æ•°æ®çš„è·å–åŠå­˜å‚¨äº‹å®œï¼Œè€Œä¸”å¯ä»¥è·¨è¶Š Mac OS X åŠ iOS å¹³å°ã€‚ CoreText æ­¤æ¡†æ¶æä¾›çš„ C è¯­è¨€æ¥å£å¯ä»¥é«˜æ•ˆæ‰§è¡Œæ–‡å­—æ’ç‰ˆåŠæ¸²æŸ“æ“ä½œã€‚ UIKit æˆ‘ä»¬å¯èƒ½ä¼šç¼–å†™ä½¿ç”¨ UI æ¡†æ¶çš„ Mac OS X æˆ– iOS åº”ç”¨ç¨‹åºã€‚è¿™ä¸¤ä¸ªå¹³å°çš„æ ¸å¿ƒ UI æ¡†æ¶åˆ†åˆ«å«åš Appkit åŠ UIKitï¼Œå®ƒä»¬éƒ½æä¾›äº†æ„å»ºåœ¨Foundation ä¸ CoreFoundation ä¹‹ä¸Šçš„ Objective-C ç±»ã€‚æ¡†æ¶é‡Œå«æœ‰ UI å…ƒç´ ï¼Œä¹Ÿå«æœ‰ç²˜åˆæœºåˆ¶ï¼Œä»¤å¼€å‘è€…å¯å°†æ‰€æœ‰ç›¸å…³å†…å®¹ç»„è£…ä¸ºåº”ç”¨ç¨‹åºã€‚ CoreAnimation CoreAnimation æ˜¯ç”¨ Objective-C è¯­è¨€å†™æˆçš„ï¼Œå®ƒæä¾›äº†ä¸€äº›å·¥å…·ï¼Œè€Œ UI æ¡†æ¶åˆ™ç”¨è¿™äº›å·¥å…·æ¥æ¸²æŸ“å›¾å½¢å¹¶æ’­æ”¾åŠ¨ç”»ã€‚å¼€å‘è€…ç¼–ç¨‹æ—¶å¯èƒ½ä»æ¥ä¸ä¼šæ·±å…¥åˆ°è¿™ç§çº§åˆ«ï¼Œä¸è¿‡çŸ¥é“è¯¥è¯¥æ¡†æ¶æ€»æ˜¯å¥½çš„ã€‚CoreAnimation æœ¬èº«å¹¶ä¸æ˜¯æ¡†æ¶ï¼Œå®ƒæ˜¯ QuartzCore æ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œåœ¨æ¡†æ¶çš„å›½åº¦é‡Œï¼ŒCoreAnimation ä»åº”ç®—ä½œâ€œä¸€ç­‰å…¬æ°‘â€(first-class citizen)ã€‚ CoreGraphics CoreGraphics æ¡†æ¶ä»¥ C è¯­è¨€å†™æˆï¼Œå…¶ä¸­æä¾›äº† 2D æ¸²æŸ“æ‰€å¿…å¤‡çš„æ•°æ®ç»“æ„ä¸å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå…¶ä¸­å®šä¹‰äº† CGPointã€CGSizeã€CGRect ç­‰æ•°æ®ç»“æ„ï¼Œè€Œ UIKit æ¡†æ¶ä¸­ UIView ç±»åœ¨ç¡®å®šè§†å›¾æ§ä»¶ä¹‹é—´çš„ç›¸å¯¹ä½ç½®æ—¶ï¼Œè¿™äº›æ•°æ®ç»“æ„éƒ½è¦ç”¨åˆ°ã€‚ æ€»ç»“ ç³»ç»Ÿæ¡†æ¶ç»™æˆ‘ä»¬æä¾›äº†æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ ¸å¿ƒåŠŸèƒ½ã€‚Objective-C ç¼–ç¨‹ç»å¸¸éœ€è¦ä½¿ç”¨åº•å±‚çš„ C è¯­è¨€çº§ APIã€‚å¥½å¤„æ˜¯å¯ä»¥ç»•è¿‡ Objective-C è¿è¡ŒæœŸç³»ç»Ÿï¼Œä»è€Œæä¾›æ‰§è¡Œé€Ÿåº¦ã€‚ç”±äº ARC åªè´Ÿè´£ Objective-C å¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨ C è¯­è¨€çº§åˆ«çš„ API æ—¶å°¤å…¶è¦æ³¨æ„å†…å­˜ç®¡ç†é—®é¢˜ã€‚ ç¬¬48æ¡ï¼šå¤šç”¨å—æšä¸¾ï¼Œå°‘ç”¨ for å¾ªç¯ åœ¨ç¼–ç¨‹ä¸­ç»å¸¸éœ€è¦åˆ—ä¸¾ collection ä¸­çš„å…ƒç´ ï¼Œå½“å‰çš„ Objective-C è¯­è¨€æœ‰å¾ˆå¤šç§åŠæ³•å®ç°æ­¤åŠŸèƒ½ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼Œæ ‡å‡† C è¯­è¨€å¾ªç¯ï¼Œ Objective-C 2.0 çš„å¿«é€Ÿéå†ï¼Œä»¥åŠâ€œå—â€å¾ªç¯ã€‚ for å¾ªç¯ // Dictionary NSArray *anArray = /*...*/; for (int i = 0; i for å¾ªç¯çš„ç¼ºç‚¹å°±æ˜¯æœ‰æ—¶éœ€è¦åˆ›å»ºé¢å¤–çš„å¯¹è±¡æ‰èƒ½å®Œæˆéå†ã€‚ åœ¨è¿™é‡Œï¼Œå­—å…¸ä¸ set éƒ½æ˜¯\"æ— åºçš„\"ï¼ˆ unordered ï¼‰ï¼Œæ‰€ä»¥æ— æ³•æ ¹æ®ç‰¹å®šçš„æ•´æ•°ä¸‹æ ‡æ¥ç›´æ¥è®¿é—®å…¶ä¸­çš„å€¼ã€‚äºæ˜¯ï¼Œå°±éœ€è¦å…ˆè·å–å­—å…¸é‡Œçš„æ‰€æœ‰é”®æˆ–æ˜¯ set é‡Œçš„æ‰€æœ‰å¯¹è±¡ï¼Œè¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥åœ¨è·å–åˆ°çš„æœ‰åºæ•°ç»„ä¸Šéå†ï¼Œä»¥ä¾¿å€Ÿæ­¤è®¿é—®åŸå­—å…¸åŠåŸ set ä¸­å¾—å€¼ã€‚åˆ›å»ºè¿™ä¸ªé™„åŠ æ•°ç»„ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œè€Œä¸”è¿˜ä¼šå¤šåˆ›å»ºä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œå®ƒä¼šä¿ç•™ collection ä¸­å¾—æ‰€æœ‰å…ƒç´ å¯¹è±¡ã€‚ å¿«é€Ÿéå† Objective-C 2.0 å¼•å…¥äº†å¿«é€Ÿéå†è¿™ä¸€åŠŸèƒ½ã€‚å¿«é€Ÿéå†è¯­æ³•æ›´ç®€æ´ï¼Œå®ƒä¸º for å¾ªç¯å¼€è®¾äº† in å…³é”®å­—ã€‚è¿™ä¸ªå…³é”®å­—å¤§å¹…ç®€åŒ–äº†éå† collection æ‰€éœ€çš„è¯­æ³•ã€‚ // NSArray NSArray *anArray = /* ... */; for (id object in anArray) { // Do something with 'object' } // NSDictionary NSDictionary *aDictionary = /* ... */; for (id key in aDictionary) { id value = aDictionary[key]; // Do something with 'key' and 'value' } // NSSet NSSet *aSet = /* ... */; for (id object in aSet) { // Do something with 'object' } è¿™ç§éå†æ–¹å¼ç®€å•ä¸”æ•ˆç‡é«˜ï¼Œç„¶è€Œå¦‚æœåœ¨éå†å­—å…¸æ—¶éœ€è¦åŒæ—¶è·å–é”®ä¸å€¼ï¼Œé‚£ä¹ˆä¼šå¤šå‡ºæ¥ä¸€æ­¥ã€‚è€Œä¸”ï¼Œä¸ä¼ ç»Ÿ for å¾ªç¯ä¸åŒï¼Œè¿™ç§éå†æ–¹å¼æ— æ³•è½»æ¾è·å–å½“å‰éå†æ“ä½œæ‰€é’ˆå¯¹çš„ä¸‹æ ‡ã€‚ åŸºäºå—çš„éå†æ–¹å¼ åœ¨å½“å‰çš„ Objective-C è¯­è¨€ä¸­ï¼Œæœ€æ–°å¼•å…¥çš„ä¸€ç§åšæ³•å°±æ˜¯åŸºäºå—æ¥éå†ã€‚NSArrayã€NSDictionaryã€NSSet ä¸­å®šä¹‰äº†ä¸‹é¢è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å®ç°æœ€åŸºæœ¬çš„éå†åŠŸèƒ½ï¼š // NSArray - (void)enumerateObjectsUsingBlock:(void(^)(id object, NSUInteger idx, BOOL *stop))block; // NSDictionary - (void)enumerateKeysAndObjectsUsingBlock:(void(^)(id key, id object, BOOL *stop))block; // NSSet - (void)enumerateObjectsUsingBlock:(void(^)(id object, BOOL *stop))block; NSArray å¯¹åº”çš„å—æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯å½“å‰è¿­ä»£æ‰€é’ˆå¯¹çš„å¯¹è±¡ã€æ‰€é’ˆå¯¹çš„ä¸‹æ ‡ï¼Œä»¥åŠæŒ‡å‘å¸ƒå°”å€¼çš„æŒ‡é’ˆã€‚å‰ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰ä¸è¨€è€Œå–»ã€‚è€Œé€šè¿‡ç¬¬ä¸‰ä¸ªå‚æ•°æ‰€æä¾›çš„æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥ç»ˆæ­¢éå†æ“ä½œã€‚å…¶ä»–ä¸¤ä¸ªç±»ä¼¼ã€‚ä½¿ç”¨ä¸‹é¢ä»£ç å¯ä»¥éå†æ•°ç»„ // NSArray NSArray *anArray = /* ... */; [anArray enumerateObjectsUsingBlock:^(id object, NSUInteger idx, BOOL *stop) { // Do something with 'object' if (shouldStop) { *stop = YES; } }]; // NSDictionary NSDictionary *aDictionary = /* ... */; [aDictionary enumerateKeysAndObjectsUsingBlock:^(id key, id object, BOOL *stop) { // Do something with 'key' and 'object' if (shouldStop) { *stop = YES; } }]; // NSSet NSSet *aSet = /* ... */; [aSet enumerateObjectsUsingBlock:^(id object, BOOL *stop) { // Do something with 'object' if (shouldStop) { *stop = YES; } }]; éå†æ—¶å¯ä»¥ç›´æ¥ä» block é‡Œè·å–æ›´å¤šä¿¡æ¯ã€‚åœ¨éå†æ•°ç»„æ—¶ï¼Œå¯ä»¥çŸ¥é“å½“å‰æ‰€é’ˆå¯¹çš„ä¸‹æ ‡ã€‚éå†æœ‰åº NSSetï¼ˆNSOrderedSetï¼‰æ—¶ä¹Ÿä¸€æ ·ã€‚è€Œåœ¨éå†å­—å…¸æ—¶ï¼Œæ— é¡»é¢å¤–ç¼–ç ï¼Œå³å¯åŒæ—¶è·å–é”®ä¸å€¼ï¼Œå› è€Œçœå»äº†æ ¹æ®ç»™å®šé”®æ¥è·å–å¯¹åº”å€¼è¿™ä¸€æ­¥ã€‚ç”¨è¿™ç§æ–¹å¼éå†å­—å…¸ï¼Œå¯ä»¥åŒæ—¶å¾—çŸ¥é”®ä¸å€¼ï¼Œè¿™å¾ˆå¯èƒ½æ¯”å…¶ä»–æ–¹å¼å¿«å¾ˆå¤šï¼Œå› ä¸ºåœ¨å­—å…¸å†…éƒ¨çš„æ•°æ®ç»“æ„ä¸­ï¼Œé”®ä¸å€¼æœ¬æ¥å°±æ˜¯å­˜å‚¨åœ¨ä¸€èµ·çš„ã€‚åŒæ—¶ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•èƒ½å¤Ÿä¿®æ”¹ block çš„æ–¹æ³•åï¼Œä»¥å…è¿›è¡Œç±»å‹è½¬æ¢çš„æ“ä½œï¼Œä»æ•ˆæœä¸Šè®²ï¼Œç›¸å½“äºæŠŠæœ¬æ¥éœ€è¦æ‰§è¡Œçš„ç±»å‹è½¬æ¢æ“ä½œäº¤ç»™blockæ–¹æ³•ç­¾åæ¥åšã€‚ ç”¨æ­¤æ–¹å¼ä¹Ÿå¯ä»¥æ‰§è¡Œåå‘éå†ã€‚æ•°ç»„ã€å­—å…¸ã€setéƒ½å®ç°äº†å‰è¿°æ–¹æ³•çš„å¦ä¸€ä¸ªç‰ˆæœ¬ï¼Œä½¿å¼€å‘è€…å¯å‘å…¶ä¼ å…¥â€œé€‰é¡¹æ©ç â€ï¼ˆoption maskï¼‰ï¼š - (void)enumerateObjectsWithOptions:(NSEnumerationOptions)options usingBlock:(void(^)(id obj, NSUInteger idx, BOOL *stop))block; - (void)enumerateKeysAndObjectsWithOptions:(NSEnumerationOptions)options usingBlock: (void(^)(id key, id obj, BOOL *stop))block; NSEnumerationOptions ç±»å‹æ˜¯ä¸ª enumï¼Œå…¶å„ç§å–å€¼å¯ç”¨â€œæŒ‰ä½æˆ–â€ï¼ˆbitwise ORï¼‰è¿æ¥ï¼Œç”¨ä»¥è¡¨æ˜éå†æ–¹å¼ã€‚ æ€»ä½“æ¥çœ‹ï¼Œblock æšä¸¾æ³•æ‹¥æœ‰å…¶ä»–éå†æ–¹å¼éƒ½å…·å¤‡çš„ä¼˜åŠ¿ï¼Œè€Œä¸”è¿˜èƒ½å¸¦æ¥æ›´å¤šå¥½å¤„ã€‚ä¸å¿«é€Ÿéå†æ³•ç›¸æ¯”ï¼Œå®ƒè¦å¤šç”¨ä¸€äº›ä»£ç ï¼Œå¯æ˜¯å´èƒ½æä¾›éå†æ—¶æ‰€é’ˆå¯¹çš„ä¸‹æ ‡ï¼Œåœ¨éå†å­—å…¸æ—¶ä¹Ÿèƒ½åŒæ—¶æä¾›é”®ä¸å€¼ï¼Œè€Œä¸”è¿˜æœ‰é€‰é¡¹å¯ä»¥å¼€å¯å¹¶å‘è¿­ä»£åŠŸèƒ½ã€‚ ç¬¬49æ¡ï¼šå¯¹è‡ªå®šä¹‰å…¶å†…å­˜ç®¡ç†è¯­ä¹‰çš„ collection ä½¿ç”¨æ— ç¼æ¡¥æ¥ ä½¿ç”¨ â€œæ— ç¼æ¡¥æ¥â€ æŠ€æœ¯ï¼Œå¯ä»¥åœ¨å®šä¹‰äº Foundation æ¡†æ¶ä¸­çš„ Objective-C ç±»å’Œå®šä¹‰äº CoreFoundation æ¡†æ¶ä¸­ C æ•°æ®ç»“æ„ä¹‹é—´ç›¸äº’è½¬æ¢ã€‚ ä¸‹é¢ä»£ç æ¼”ç¤ºäº†ç®€å•çš„æ— ç¼æ¡¥æ¥ï¼š NSArray *anNSArray = @[@1,@2,@3,@4,@5]; CFArrayRef aCFArray = (__bridge CFArrayRef)anNSArray; NSLog(@\"size of array = %li\",CFArrayGetCount(aCFArray)); // Outputï¼šsize of array = 5 è½¬æ¢æ“ä½œä¸­çš„ __bridge å‘Šè¯‰ ARC å¦‚ä½•å¤„ç†æ‰€æ¶‰åŠçš„ Objective-C å¯¹è±¡ã€‚__bridge æœ¬èº«çš„æ„æ€æ˜¯ï¼šARC ä»ç„¶å…·å¤‡è¿™ä¸ª Objective-C å¯¹è±¡çš„æ‰€æœ‰æƒã€‚è€Œ __bridge_retained åˆ™ä¸ä¹‹ç›¸åï¼Œæ„å‘³ç€ ARC å°†äº¤å‡ºå¯¹è±¡çš„æ‰€æœ‰æƒã€‚è‹¥æ˜¯å‰é¢é‚£æ®µä»£ç æ”¹ç”¨å®ƒæ¥å®ç°ï¼Œé‚£ä¹ˆç”¨å®Œæ•°ç»„ä¹‹åå°±è¦åŠ ä¸ŠCFRelease(aCFArray)ä»¥é‡Šæ”¾å…¶å†…å­˜ã€‚ä¸ä¹‹ç›¸ä¼¼ï¼Œåå‘è½¬æ¢å¯é€šè¿‡ __bridge_transfer æ¥å®ç°ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æ¡¥æ¥å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºFoundation æ¡†æ¶ä¸­ Objective-C ç±»æ‰€å…·å¤‡çš„æŸäº›åŠŸèƒ½ï¼Œæ˜¯ CoreFoundation æ¡†æ¶ä¸­ C æ•°æ®ç»“æ„æ‰€ä¸å…·å¤‡çš„ï¼Œåä¹‹äº¦ç„¶ã€‚ "},"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 7-2.html":{"url":"iOS/ä¹¦ç±/Effective Objective-C 2.0/Chapter 7-2.html","title":"Chapter 7-2","keywords":"","body":"ç¬¬ä¸ƒç« ï¼šç³»ç»Ÿæ¡†æ¶(2) ç¬¬50æ¡ï¼šæ„å»ºç¼“å­˜æ—¶é€‰ç”¨ NSCache è€Œé NSDictionary ä¼˜ç‚¹ 1ã€å½“ç³»ç»Ÿèµ„æºè€—å°½æ—¶ï¼ŒNSCache å¯ä»¥è‡ªåŠ¨åˆ å‡ç¼“å­˜ï¼Œè€Œä¸”è¿˜ä¼šä¼˜å…ˆåˆ é™¤æœ€ä¹…æ²¡æœ‰ä½¿ç”¨çš„ç¼“å­˜ã€‚2ã€NSCache å¹¶ä¸ä¼šâ€œæ‹·è´â€é”®ï¼Œè€Œæ˜¯â€œä¿ç•™â€å®ƒã€‚ä¸æ‹·è´é”®çš„åŸå› æ˜¯ï¼šå¾ˆå¤šæ—¶å€™ï¼Œé”®éƒ½æ˜¯ç”±ä¸æ”¯æŒæ‹·è´æ“ä½œçš„å¯¹è±¡å……å½“çš„ã€‚3ã€NSCache æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚4ã€å¯ä»¥æ“æ§ç¼“å­˜åˆ å‡å…¶å†…å®¹çš„æ—¶æœºï¼Œæœ‰ä¸¤ä¸ªä¸ç³»ç»Ÿèµ„æºç›¸å…³çš„å°ºåº¦å¯ä¾›è°ƒæ•´ï¼Œå…¶ä¸€æ˜¯ç¼“å­˜ä¸­çš„å¯¹è±¡æ€»æ•°ï¼Œå…¶äºŒæ˜¯æ‰€æœ‰å¯¹è±¡çš„â€œæ€»å¼€é”€â€ï¼ˆoverroll costï¼‰ã€‚ ä¸‹é¢ä»£ç æ¼”ç¤ºç¼“å­˜çš„ç”¨æ³•ï¼š #import // Network fetcher class typedef void(^EOCNetworkFercherCompletionHandler)(NSData *data); @interface EOCNetworkFetcher : NSObject - (id)initWithURL:(NSURL *)url; - (void)startWithCompletionHandler:(EOCNetworkFercherCompletionHandler)handler; @end @implementation EOCClass { NSCache *_cache; } - (id)init { self = [super init]; if (self) { _cache = [NSCache new]; // æœ€å¤šç¼“å­˜ 100 æ¡æ•°æ® _cache.countLimit = 100; // æœ€å¤§ç¼“å­˜ç©ºé—´ 5MB _cache.totalCostLimit = 5 * 1024 * 1024; }; return self; } - (void)downloadDataForURL:(NSURL *)url { NSData *cachedData = [_cache objectForKey:url]; if (cachedData) { // Cache hit [self useData:cachedData]; } else { // Cache miss EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url]; [fetcher startWithCompletionHandler:^(NSData *data) { [_cache setObject:data forKey:url cost:data.length]; [self useData:cachedData]; }]; } } @end NSPurgeableData NSPurgeableData å’Œ NSCache æ­é…èµ·æ¥ç”¨ï¼Œæ•ˆæœå¾ˆå¥½ã€‚æ­¤ç±»æ˜¯ NSMutableData çš„å­ç±»ï¼Œè€Œä¸”å®ç°äº† NSDiscardableContent åè®®ã€‚å¦‚æœæŸä¸ªå¯¹è±¡æ‰€å æœ‰çš„å†…å­˜èƒ½å¤Ÿæ ¹æ®éœ€è¦éšæ—¶ä¸¢å¼ƒï¼Œé‚£ä¹ˆå°±å¯ä»¥å®ç°è¯¥åè®®æ‰€å®šä¹‰çš„æ¥å£ã€‚å½“ç³»ç»Ÿèµ„æºç´§å¼ æ—¶å¯ä»¥æŠŠä¿å­˜ NSPurgeableData å¯¹è±¡çš„é‚£å—å†…å­˜é‡Šæ”¾æ‰ã€‚NSDiscardableContent åè®®å®šä¹‰äº†åä¸º isContentDiscarded çš„æ–¹æ³•ï¼Œç”¨æ¥æŸ¥è¯¢ç›¸å…³å†…å­˜æ˜¯å¦å·²é‡Šæ”¾ã€‚å¦‚æœéœ€è¦è®¿é—®æŸä¸ª NSPurgeableData å¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨ beginContentAccess æ–¹æ³•ï¼Œå‘Šè¯‰å®ƒç°åœ¨è¿˜ä¸åº”è¯¥ä¸¢å¼ƒè‡ªå·±æ‰€å æ®çš„å†…å­˜ã€‚ç”¨å®Œä¹‹åï¼Œè°ƒç”¨ endContentAccess æ–¹æ³•ï¼Œå‘Šè¯‰å®ƒåœ¨å¿…è¦æ—¶å¯ä»¥ä¸¢å¼ƒè‡ªå·±æ‰€å æ®çš„å†…å­˜äº†ã€‚ - (void)downloadDataForURLTwo:(NSURL *)url { NSPurgeableData *cachedData = [_cache objectForKey:url]; if (cachedData) { [cachedData beginContentAccess]; [self useData:cacheData]; [cachedData endContentAccess]; } else { EOCNetworkFetcher *fetcher = [[EOCNetworkFetcher alloc] initWithURL:url]; [fetcher startWithCompletionHandler:^(NSData *data) { NSPurgeableData *purgeableData = [NSPurgeableData dataWithData:data]; [_cache setObject:purgeableData forKey:url cost:purgeableData.length]; [self useData:purgeableData]; [purgeableData endContentAccess]; }]; } } åˆ›å»ºå¥½ NSPurgeableData åï¼Œå…¶ â€œpurge å¼•ç”¨è®¡æ•°â€ä¼šå¤š1ï¼Œæ‰€ä»¥æ— éœ€å†è°ƒç”¨ beginContentAccess äº†ï¼Œä½†ä½¿ç”¨å®Œåå¿…é¡»è°ƒç”¨ endContentAccess æ–¹æ³•ï¼Œå°†å¤šå‡ºæ¥çš„ â€œ1â€ æŠµæ¶ˆæ‰ã€‚ æ€»ç»“ åˆç†çš„ä½¿ç”¨ NSCache å¯ä»¥æé«˜ç¨‹åºçš„å“åº”é€Ÿåº¦ã€‚ ç¬¬51æ¡ï¼šç²¾ç®€ initialize å’Œ load çš„å®ç°ä»£ç  æœ‰æ—¶å€™ï¼Œç±»å¿…é¡»å…ˆæ‰§è¡ŒæŸäº›åˆå§‹åŒ–æ“ä½œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚åœ¨ Objective-C ä¸­ï¼Œç»å¤§å¤šæ•°çš„ç±»éƒ½ç»§æ‰¿è‡ª NSObject è¿™ä¸ªæ ¹ç±»ï¼Œè¯¥ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ç”¨æ¥å®ç°è¿™ç§åˆå§‹åŒ–æ“ä½œã€‚ load å¯¹äºåŠ å…¥è¿è¡ŒæœŸç³»ç»Ÿä¸­çš„æ¯ä¸ªç±»ï¼ˆclassï¼‰åŠåˆ†ç±»ï¼ˆcategoryï¼‰æ¥è¯´ï¼Œå¿…å®šä¼šè°ƒç”¨æ­¤æ–¹æ³•ï¼Œè€Œä¸”ä»…è°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœåˆ†ç±»å’Œå…¶æ‰€å±çš„ç±»éƒ½å®šä¹‰äº† load æ–¹æ³•ï¼Œåˆ™å…ˆè°ƒç”¨ç±»é‡Œçš„ï¼Œå†è°ƒç”¨åˆ†ç±»çš„ã€‚ æ‰§è¡Œ load æ–¹æ³•æ—¶ï¼Œè¿è¡ŒæœŸç³»ç»Ÿå¤„äºâ€œè„†å¼±çŠ¶æ€â€ï¼ˆfragile stateï¼‰ã€‚åœ¨æ‰§è¡Œå­ç±»çš„ load æ–¹æ³•ä¹‹å‰ï¼Œå¿…å®šä¼šå…ˆæ‰§è¡Œæ‰€æœ‰çˆ¶ç±»çš„ load æ–¹æ³•ï¼Œè€Œå¦‚æœä»£ç è¿˜ä¾èµ–å…¶ä»–ç¨‹åºï¼Œé‚£ä¹ˆç¨‹åºåº“é‡Œç›¸å…³ç±»çš„ load æ–¹æ³•ä¹Ÿå¿…å®šä¼šå…ˆæ‰§è¡Œã€‚ç„¶è€Œï¼Œæ ¹æ®æŸä¸ªç»™å®šçš„ç¨‹åºåº“ï¼Œå´æ— æ³•åˆ¤æ–­å‡ºå…¶ä¸­å„ä¸ªç±»çš„è½½å…¥é¡ºåºã€‚å› æ­¤ï¼Œåœ¨ load æ–¹æ³•ä¸­ä½¿ç”¨å…¶ä»–ç±»æ˜¯ä¸å®‰å…¨çš„ã€‚ load æ–¹æ³•ä¸åƒæ™®é€šæ–¹æ³•é‚£æ ·ï¼Œå®ƒä¸éµä»é‚£å¥—ç»§æ‰¿è§„åˆ™ã€‚å¦‚æœæŸä¸ªç±»æœ¬èº«æ²¡å®ç° load æ–¹æ³•ï¼Œé‚£ä¹ˆä¸ç®¡å…¶å„çº§çˆ¶ç±»æ˜¯å¦å®ç°æ­¤æ–¹æ³•ï¼Œç³»ç»Ÿéƒ½ä¸ä¼šè°ƒç”¨ã€‚æ­¤å¤–ï¼Œåˆ†ç±»çš„å…¶æ‰€å±çš„ç±»é‡Œï¼Œéƒ½å¯èƒ½å‡ºç° load æ–¹æ³•ã€‚æ­¤æ—¶ä¸¤ç§å®ç°ä»£ç éƒ½ä¼šè°ƒç”¨ï¼Œç±»çš„å®ç°è¦æ¯”åˆ†ç±»çš„å®ç°å…ˆæ‰§è¡Œã€‚ load æ–¹æ³•åŠ¡å¿…å®ç°å¾—ç²¾ç®€ä¸€äº›ï¼Œä¹Ÿå°±æ˜¯è¦å°½é‡å‡å°‘å…¶æ‰€æ‰§è¡Œæ“ä½œï¼Œå› ä¸ºæ•´ä¸ªç¨‹åºåœ¨æ‰§è¡Œ load æ–¹æ³•çš„æ—¶å€™éƒ½ä¼šé˜»å¡ã€‚å¦‚æœ load æ–¹æ³•ä¸­åŒ…å«ç¹æ‚çš„ä»£ç ï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºåœ¨æ‰§è¡ŒæœŸè¡Œå°±ä¼šå˜å¾—æ— å“åº”ã€‚ä¹Ÿä¸è¦å†™ç­‰å¾…é”ï¼Œä¹Ÿä¸è¦è°ƒç”¨å¯èƒ½ä¼šåŠ é”çš„æ–¹æ³•ã€‚ initialize åªæœ‰åœ¨ç¬¬ä¸€æ¬¡ç»™è¯¥ç±»å‘é€æ¶ˆæ¯ä¹‹å‰ä¼šè°ƒç”¨ initialize æ–¹æ³•ã€‚ ä¸ load æ–¹æ³•ä¸åŒï¼Œè¿è¡Œç³»ç»Ÿåœ¨æ‰§è¡Œ initialize æ–¹æ³•æ—¶ï¼Œæ˜¯å¤„äºæ­£å¸¸çŠ¶æ€çš„ã€‚å› æ­¤ï¼Œä»è¿è¡ŒæœŸç³»ç»Ÿå®Œæ•´è§’åº¦ä¸Šæ¥è®²ï¼Œæ­¤æ—¶ä¹Ÿå¯ä»¥å®‰å…¨ä½¿ç”¨å¹¶è°ƒç”¨ä»»æ„ç±»ä¸­çš„ä»»æ„æ–¹æ³•ã€‚è€Œä¸”ï¼Œè¿è¡ŒæœŸç³»ç»Ÿä¹Ÿèƒ½ç¡®ä¿ initialize æ–¹æ³•åœ¨â€œçº¿ç¨‹å®‰å…¨çš„ç¯å¢ƒâ€ä¸­æ‰§è¡Œã€‚è¿™å°±æ˜¯è¯´ï¼Œåªæœ‰æ‰§è¡Œ initialize çš„é‚£ä¸ªçº¿ç¨‹å¯ä»¥æ“ä½œç±»æˆ–ç±»å®ä¾‹ã€‚å…¶ä»–çº¿ç¨‹éƒ½è¦å…ˆé˜»å¡ï¼Œç­‰ç€ initialize æ‰§è¡Œå®Œã€‚ è·Ÿå…¶ä»–æ–¹æ³•ä¸€æ ·ï¼Œå¦‚æœæŸä¸ªç±»æœªå®ç° initialize æ–¹æ³•ï¼Œè€Œçˆ¶ç±»å®ç°äº†ï¼Œé‚£ä¹ˆå°±ä¼šè¿è¡Œçˆ¶ç±»çš„ä»£ç ã€‚initialize éµå¾ªé€šå¸¸çš„ç»§æ‰¿è§„åˆ™ã€‚æ‰€ä»¥åº”è¯¥åœ¨ initialize æ–¹æ³•ä¸­åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š + (void)initialize { if(self == [EOCBaseClass class]) { // doSomething } } æœ€åï¼Œinitialize å’Œ load ä¸€æ ·ï¼Œéƒ½åº”è¯¥å®ç°çš„ç²¾ç®€ä¸€äº›ã€‚å¯ä»¥ç”¨æ¥åˆå§‹åŒ–ä¸€äº›å…¨å±€å˜é‡ï¼Œ å‚è€ƒ ä¹‹å‰å†™çš„æ–‡ç«  iOSå¼€å‘ä¹‹ç†è§£loadå’Œinitialize ç¬¬52æ¡ï¼šåˆ«å¿˜äº† NSTimer ä¼šä¿ç•™å…¶ç›®æ ‡å¯¹è±¡ è®¡æ—¶å™¨è¦å’Œâ€œè¿è¡Œå¾ªç¯â€ï¼ˆrunloopï¼‰ç›¸å…³è”ï¼Œè¿è¡Œå¾ªç¯åˆ°æ—¶å€™ä¼šè§¦å‘ä»»åŠ¡ã€‚åˆ›å»º NSTimer æ—¶ï¼Œå¯ä»¥å°†å…¶â€œé¢„å…ˆå®‰æ’â€åœ¨å½“å‰çš„è¿è¡Œå¾ªç¯ä¸­ï¼Œä¹Ÿå¯ä»¥å…ˆåˆ›å»ºå¥½ï¼Œç„¶åç”±å¼€å‘è€…æ¥è°ƒåº¦ã€‚æ— è®ºé‡‡ç”¨å“ªç§æ–¹å¼ï¼Œåªæœ‰æŠŠè®¡æ—¶å™¨æ”¾åœ¨è¿è¡Œå¾ªç¯é‡Œï¼Œå®ƒæ‰èƒ½æ­£å¸¸è§¦å‘ä»»åŠ¡ã€‚ ä½¿ç”¨ NSTimer å¾ˆå®¹æ˜“ä¼šé€ æˆå¼•ç”¨å¾ªç¯ã€‚çœ‹çœ‹ä¸‹é¢çš„ä¾‹å­ #import @interface EOCClass : NSObject - (void)startPolling; - (void)stopPolling; @end // -- #import \"EOCClass.h\" @implementation EOCClass { NSTimer *_pollTimer; } - (id)init { return [super init]; } - (void)dealloc { [_pollTimer invalidate]; } - (void)stopPolling { [_pollTimer invalidate]; _pollTimer = nil; } - (void)startPolling { _pollTimer = [NSTimer scheduledTimerWithTimeInterval:5.0 target:self selector:@selector(p_doPoll) userInfo:nil repeats:YES]; } - (void)p_doPoll { // Poll the resource } @end ä¸Šé¢ä»£ç ä¸­ self å¼ºå¼•ç”¨äº† _pollTimer ï¼Œè€Œ _pollTimer ä¹Ÿå¼ºå¼•ç”¨äº† self ã€‚æ‰€ä»¥å°±é€ æˆäº†å¼•ç”¨å¾ªç¯ã€‚é™¤éæ‰‹åŠ¨è°ƒç”¨ stopPolling è¿™ä¸ªæ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ä½†æˆ‘ä»¬æ— æ³•ä¿è¯å¼€å‘è€…ä¸€å®šä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ è§£å†³æ–¹æ³•ï¼š #import @interface NSTimer (EOCBlocksSupport) + (NSTimer *)eoc_timerScheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(void(^)())block repeats:(BOOL)repeats; @end // -- #import \"NSTimer+EOCBlocksSupport.h\" @implementation NSTimer (EOCBlocksSupport) + (NSTimer *)eoc_timerScheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(void(^)())block repeats:(BOOL)repeats { return [self scheduledTimerWithTimeInterval:interval target:self selector:@selector(eoc_blockInvoke:) userInfo:[block copy] repeats:repeats]; } + (void)eoc_blockInvoke:(NSTimer *)timer { void (^block) () = timer.userInfo; block ? block() : nil; } - (void)startPolling { __weak EOCClass *weakSelf = self; _pollTimer = [NSTimer eoc_timerScheduledTimerWithTimeInterval:5.0 block:^{ EOCClass *strongSelf = weakSelf; [strongSelf p_doPoll]; } repeats:YES]; } - (void)p_doPoll { // Poll the resource } @end ä½¿ç”¨è¿™ç§æ–¹æ³•æ•è·åˆ° weakSelf ï¼Œè¿™æ · self å°±å¯ä»¥æ­£å¸¸é‡Šæ”¾äº†ï¼Œself é‡Šæ”¾åï¼Œ weakSelf ä¹Ÿå°±å˜ä¸º nil ã€‚ä»è€Œæ‰“ç ´äº†å¼•ç”¨å¾ªç¯ã€‚ è¡¥å…… åœ¨é¡¹ç›®ä¸­æˆ‘ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼š #import typedef void (^VCHTimerHandler)(id userInfo); @interface VCHWeakTimer : NSObject + (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval target:(id)aTarget selector:(SEL)aSelector userInfo:(id)userInfo repeats:(BOOL)repeats; + (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(VCHTimerHandler)block userInfo:(id)userInfo repeats:(BOOL)repeats; @end #import \"VCHWeakTimer.h\" @interface VCHWeakTimer() @property(nonatomic,weak) id target; @property(nonatomic,assign) SEL selector; @end @implementation VCHWeakTimer - (void)fire:(id)obj { #pragma clang diagnostic push #pragma clang diagnostic ignored \"-Warc-performSelector-leaks\" [self.target performSelector:self.selector withObject:obj]; #pragma clang diagnostic pop } + (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval target:(id)aTarget selector:(SEL)aSelector userInfo:(id)userInfo repeats:(BOOL)repeats { VCHWeakTimer *weakTimer = [[VCHWeakTimer alloc] init]; weakTimer.target = aTarget; weakTimer.selector = aSelector; return [NSTimer scheduledTimerWithTimeInterval:interval target:weakTimer selector:@selector(fire:) userInfo:userInfo repeats:repeats]; } + (NSTimer *)scheduledTimerWithTimeInterval:(NSTimeInterval)interval block:(VCHTimerHandler)block userInfo:(id)userInfo repeats:(BOOL)repeats { NSMutableArray *userInfoArray = [NSMutableArray arrayWithObject:[block copy]]; if (userInfo != nil) { [userInfoArray addObject:userInfo]; } return [self scheduledTimerWithTimeInterval:interval target:self selector:@selector(_timerBlockInvoke:) userInfo:userInfoArray repeats:repeats]; } - (void)_timerBlockInvoke:(NSArray *)userInfo { VCHTimerHandler block = userInfo[0]; id info = nil; if (userInfo.count == 2) { info = userInfo[1]; } block ? block(info) : nil; } @end æ€»ç»“ ç›´æ¥ä½¿ç”¨ NSTimer å¯èƒ½ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼ï¼Œä¸€å®šè¦æƒ³åŠæ³•å¤„ç†æ‰è¿™ä¸ªé—®é¢˜ã€‚ å…¨ä¹¦ Â· å®Œ "},"iOS/CocoaPodsä¹‹Profile.html":{"url":"iOS/CocoaPodsä¹‹Profile.html","title":"CocoaPodsä¹‹Profile","keywords":"","body":"CocoaPodsä¹‹Profile 0x00 //é™åˆ¶æœ€ä½ç‰ˆæœ¬ï¼Œä¸é™åˆ¶çš„è¯å¯èƒ½ä¼šæŠ¥é”™ platform :ios, '9.0' //ä¸æç¤ºç¬¬ä¸‰æ–¹åº“çš„è­¦å‘Šï¼Œå¦‚æœæœ‰ç»„ä»¶çš„ inhibit_all_warnings! //ä½¿ç”¨é™æ€åº“ use_modular_headers! //åŠ¨æ€åº“ use_frameworks! //æ”¯æŒçš„swiftç‰ˆæœ¬ supports_swift_versions '>= 5.0' //å£°æ˜ä½¿ç”¨çš„å®‰è£…æ–¹æ³•å’Œé€‰é¡¹ï¼Œinstall! å‡½æ•°åªèƒ½è°ƒç”¨ä¸€æ¬¡ install! //ç›®å‰åªå…è®¸é€šè¿‡ cocoapods å®‰è£… install! 'cocoapods', æ”¯æŒçš„key ,æ˜¾ç¤ºçš„æ˜¯é»˜è®¤å€¼ //æ¸…ç†podæ²¡æœ‰ä½¿ç”¨çš„æ‰€æœ‰æ–‡ä»¶ :clean => true //æ˜¯å¦å¤åˆ¶podçš„target :deduplicate_targets => true //æ˜¯å¦ç”Ÿæˆuuid :deterministic_uuids => true //æ˜¯å¦å°†å®‰è£…çš„podsé›†æˆåˆ°é¡¹ç›®ä¸­ //å¦‚æœè®¾ç½®ä¸ºfalse, Podså°†è¢«ä¸‹è½½å¹¶å®‰è£…åˆ°Pods/ç›®å½•ä¸­ï¼Œä½†ä¸ä¼šé›†æˆåˆ°é¡¹ç›®ä¸­ :integrate_targets => true //é”å®špodsçš„æºæ–‡ä»¶ :lock_pod_sources => true //å¤šä¸ªæºåŒ…å«ç›¸åŒåç§°å’Œç‰ˆæœ¬çš„Podæ—¶å‘å‡ºè­¦å‘Š :warn_for_multiple_pod_sources => true // :share_schemes_for_development_pods => false //ç¦ç”¨CocoaPodsè„šæœ¬é˜¶æ®µçš„è¾“å…¥å’Œè¾“å‡ºè·¯å¾„(å¤åˆ¶æ¡†æ¶å’Œå¤åˆ¶èµ„æº) //å¯ä»¥è§£å†³ä¿®æ”¹äº†ç§æœ‰åº“ä»£ç åï¼Œæ— æ³•ç«‹å³ç”Ÿæ•ˆçš„é—®é¢˜ :disable_input_output_paths => false //æ˜¯å¦ä¿ç•™æ‰€æœ‰podçš„æ–‡ä»¶ç»“æ„ï¼ŒåŒ…æ‹¬å¤–éƒ¨podæºã€‚ //é»˜è®¤æƒ…å†µä¸‹ï¼ŒPodæºçš„æ–‡ä»¶ç»“æ„ä»…ä¸ºå¼€å‘Podä¿ç•™ã€‚ //è®¾ç½®:preserve_pod_file_structureä¸ºtrueå°†å§‹ç»ˆä¿å­˜æ–‡ä»¶ç»“æ„ã€‚ :preserve_pod_file_structure => false //æ˜¯å¦ä¸ºæ¯ä¸ªpodç›®æ ‡ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªPods.xcodeprojï¼Œæ­¤é€‰é¡¹å°†ä¸ºåµŒå¥—åœ¨Pods.xcodeprojä¸‹çš„æ¯ä¸ªpodç›®æ ‡ç”Ÿæˆä¸€ä¸ªé¡¹ç›®ã€‚ //ä½¿ç”¨æ­¤é€‰é¡¹å¯ä»¥åŠ å¿«ç¼–è¯‘é€Ÿåº¦ :generate_multiple_pod_projects => false //æ˜¯å¦ä»…å¯ç”¨è‡ªä¸Šæ¬¡å®‰è£…ä»¥æ¥å·²æ›´æ”¹çš„é‡æ–°ç”Ÿæˆç›®æ ‡åŠå…¶å…³è”é¡¹ç›®ã€‚ :incremental_installation => false //æ˜¯å¦è·³è¿‡ç”ŸæˆPods.xcodeprojï¼Œåªæ‰§è¡Œä¾èµ–é¡¹è§£æå’Œä¸‹è½½ã€‚ :skip_pods_project_generation 0x01 å…³é”®å­— pod æŒ‡å®šé¡¹ç›®çš„ä¾èµ–é¡¹ã€‚ä¾èµ–é¡¹éœ€æ±‚ç”±Podçš„åç§°å’Œç‰ˆæœ¬éœ€æ±‚åˆ—è¡¨(å¯é€‰)å®šä¹‰ã€‚ pod 'Objection', '0.9' // = 0.1ï¼Œç‰ˆæœ¬0.1ã€‚ > 0.1ï¼Œä»»ä½•é«˜äº0.1çš„ç‰ˆæœ¬ã€‚ >= 0.1ï¼Œç‰ˆæœ¬0.1å’Œä»»ä½•æ›´é«˜ç‰ˆæœ¬ã€‚ 0.1.2ï¼Œç‰ˆæœ¬0.1.2åŠä»¥ä¸Šåˆ°ç‰ˆæœ¬0.2ï¼Œä¸å«0.2ã€‚è¯¥æ“ä½œç¬¦åŸºäºä½ åœ¨ç‰ˆæœ¬éœ€æ±‚ä¸­æŒ‡å®šçš„æœ€åä¸€ä¸ªç»„ä»¶å·¥ä½œã€‚è¿™ä¸ªä¾‹å­ç­‰äº>= 0.1.2ä¸ 0.1.3-beta.0ï¼ŒBetaç‰ˆå’Œreleaseå‘è¡Œç‰ˆæœ¬ä¸º0.1.3ï¼Œå‘è¡Œç‰ˆæœ¬ä¸º0.2(ä¸åŒ…æ‹¬0.2)ã€‚ç”¨ç ´æŠ˜å·(-)åˆ†éš”çš„ç»„ä»¶å°†ä¸è€ƒè™‘ç‰ˆæœ¬è¦æ±‚ã€‚ configurations pod 'PonyDebugger', :configurations => ['Debug', 'Beta'] pod 'PonyDebugger', :configuration => 'Debug' modular_headers æ¨¡å—åŒ–ï¼Œå½“ä½ ä½¿ç”¨ use_modular_headers! å±æ€§æ—¶ï¼Œå¯ä»¥ä»æ¨¡å—å¤´ä¸­æ’é™¤ç‰¹å®šçš„Pod pod 'SSZipArchive', :modular_headers => false source path æºï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å…¨å±€çº§åˆ«æŒ‡å®šçš„æºæŒ‰ç…§æŒ‡å®šä¾èµ–é¡¹åŒ¹é…çš„é¡ºåºè¿›è¡Œæœç´¢ã€‚è¿™ç§è¡Œä¸ºå¯ä»¥é€šè¿‡æŒ‡å®šä¾èµ–é¡¹çš„æ¥æºæ¥æ”¹å˜ç‰¹å®šçš„ä¾èµ–é¡¹ pod 'PonyDebugger', :source => 'https://github.com/CocoaPods/Specs.git' pod 'AFNetworking', :path => '~/Documents/AFNetworking' pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :branch => 'dev' pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :tag => '0.7.0' pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :commit => '082f8319af' pod 'JSONKit', :podspec => 'https://example.com/JSONKit.podspec' Subspecs å½“é€šè¿‡å®ƒçš„åå­—å®‰è£…Podæ—¶ï¼Œå®ƒå°†å®‰è£…podspecä¸­å®šä¹‰çš„æ‰€æœ‰é»˜è®¤çš„å­è§„èŒƒã€‚ pod 'QueryKit/Attribute' pod 'QueryKit', :subspecs => ['Attribute', 'QuerySet'] testspecs pod 'AFNetworking', :testspecs => ['UnitTests', 'SomeOtherTests'] abstract_target å®šä¹‰ä¸€ä¸ªæ–°çš„æŠ½è±¡ç›®æ ‡ï¼Œå¯ç”¨äºæ–¹ä¾¿çš„ç›®æ ‡ä¾èµ–é¡¹ç»§æ‰¿ã€‚ abstract_target 'Networking' do pod 'AlamoFire' target 'ShowsiOS' do pod 'ShowWebAuth' end target 'ShowsTV' do pod 'ShowTVAuth' end end def é¢„å®šä¹‰æ¨¡å— def debug_pods pod 'LookinServer', :configurations => ['Debug'] pod 'MLeaksFinder', :configurations => ['Debug'] end "},"iOS/CocoaPodsä¹‹podspec.html":{"url":"iOS/CocoaPodsä¹‹podspec.html","title":"CocoaPodsä¹‹podspec","keywords":"","body":"PodSpec å­¦ä¹ ä¸‹æ€æ ·å°†è‡ªå·±çš„ä»£ç ä¸Šä¼ åˆ°CocoaPods 1.åœ¨GitHubä¸Šåˆ›å»ºæ–°çš„ä»“åº“ï¼Œå¹¶cloneåˆ°æœ¬åœ° æ­¤æ—¶å°†åº“æ–‡ä»¶ä½†æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¤¹å†…ï¼Œå¹¶å°†ç›¸å…³çš„æ¼”ç¤ºDemoå†™å¥½ã€‚ 2.åˆ›å»ºpodspecæ–‡ä»¶ cd path**** pod spec create VCHKit 3.ä¿®æ”¹podspecæ–‡ä»¶ s.name = \"VCHKit\" s.version = \"0.0.1\" s.summary = \"this is summary\" s.description = \"vhuichen@163.com\" } s.platform = :ios, \"8.0\" s.source = { :git => \"https://github.com/vhuichen/VCHKit.git\", :tag => \"#{s.version}\" } s.source_files = \"VCHMapKit/*.{h,m}\", \"VCHMapKit/XXXX/*.{h,m}\" s.frameworks = \"UIKit\" s.requires_arc = true *æ³¨æ„ï¼šæè¿°descriptionå¿…é¡»å¡«å†™ï¼Œå¹¶ä¸”ä¸èƒ½å’Œsummaryç›¸åŒ éªŒè¯pod pod lib lint å¦‚æœéªŒè¯æˆåŠŸåˆ™ä¼šæ˜¾ç¤ºæˆåŠŸä¿¡æ¯--VCHMapKit passed validation. 4.æäº¤åº“åˆ°CocoaPods trunk å¦‚æœæ²¡æœ‰æ³¨å†Œï¼Œåˆ™å…ˆæ³¨å†Œtrunk pod trunk register vhuichen@163.com 'vhuichen' --verbose å‘trunkæœåŠ¡å™¨æŸ¥è¯¢è‡ªå·±çš„æ³¨å†Œä¿¡æ¯ pod trunk me æ‰“ä¸Šå’ŒGitHubä¸Šç›¸åŒçš„tag set the new version to 0.0.1 set the new tag to 0.0.1 5.æäº¤ä»£ç åˆ°GitHub å°†ä»£ç æäº¤åˆ°GitHubåï¼Œå†æ‰“ä¸Štag git tag 0.0.1 git push --tags 6.ä¸Šä¼ æˆ–æ›´æ–°trunk pod trunk push 7.å‡ºç°çš„é—®é¢˜ 1ã€Unable to find a pod with name, author, summary, or description matching VCHMapKitè§£å†³æ–¹æ³•ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶ååœ¨é‡æ–°æœç´¢ rm ~/Library/Caches/CocoaPods/search_index.json pod search VCHMapKit "},"iOS/å¯¹è±¡ä»€ä¹ˆæ—¶å€™åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± .html":{"url":"iOS/å¯¹è±¡ä»€ä¹ˆæ—¶å€™åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± .html","title":"å¯¹è±¡ä»€ä¹ˆæ—¶å€™åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ","keywords":"","body":"ARCä¸‹ï¼Œå¯¹è±¡ä»€ä¹ˆæ—¶å€™åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ±  ARC ARC (Automatic Reference Counting) æ˜¯ç”±ç¼–è¯‘å™¨è·Ÿè¿è¡Œæ—¶å…±åŒå®Œæˆçš„ï¼ˆè¿è¡Œæ—¶æ ‡è®°ï¼‰ï¼›ç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨åŠ ä¸Š retainã€releaseã€autoreleaseã€dealloc æ“ä½œã€‚ __autoreleasing å¦‚æœä¸€ä¸ªå˜é‡è¢«ç”¨å…³é”®å­—ä¿®é¥° __autoreleasing ä¿®é¥°ï¼Œé‚£ä¹ˆå˜é‡ä¼šç«‹å³åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ ARCè§„åˆ™ è‹¥æ–¹æ³•åä»¥ä¸‹åˆ—è¯è¯­å¼€å¤´ï¼Œåˆ™å…¶è¿”å›çš„å¯¹è±¡å½’è°ƒç”¨è€…æ‰€æœ‰ï¼š alloc new copy mutableCopyã€‚å½’è°ƒç”¨è€…æ‰€æœ‰çš„æ„æ€æ˜¯ï¼šè°ƒç”¨ä¸Šè¿°å››ç§æ–¹æ³•çš„é‚£æ®µä»£ç è¦è´Ÿè´£é‡Šæ”¾æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ã€‚ é™¤äº†ä¼šè‡ªåŠ¨è°ƒç”¨â€œä¿ç•™â€ä¸â€œé‡Šæ”¾â€æ–¹æ³•å¤–ï¼ŒARC è¿˜å¯ä»¥æ‰§è¡Œä¸€äº›æ‰‹å·¥æ“ä½œå¾ˆéš¾ç”šè‡³æ— æ³•å®Œæˆçš„ä¼˜åŒ–ã€‚å¦‚æœå‘ç°åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šæ‰§è¡Œå¤šæ¬¡â€œä¿ç•™â€ä¸â€œé‡Šæ”¾â€æ“ä½œï¼Œé‚£ä¹ˆARCæœ‰æ—¶å¯ä»¥æˆå¯¹åœ°ç§»é™¤è¿™ä¸¤ä¸ªæ“ä½œã€‚ä¸€èˆ¬ï¼Œåœ¨æ–¹æ³•ä¸­è¿”å›è‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡æ—¶ï¼Œè¦æ‰§è¡Œä¸€ä¸ªç‰¹æ®Šå‡½æ•°ã€‚æ­¤æ—¶ä¸ç›´æ¥è°ƒç”¨å¯¹è±¡çš„ autorelease æ–¹æ³•ï¼Œè€Œæ˜¯æ”¹ä¸ºè°ƒç”¨ objc_autoreleaseReturnValue ã€‚æ­¤å‡½æ•°ä¼šæ£€è§†å½“å‰æ–¹æ³•è¿”å›ä¹‹åå³å°†è¦æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚è‹¥å‘ç°é‚£æ®µä»£ç åœ¨è¿”å›çš„å¯¹è±¡ä¸Šæ‰§è¡Œ retain æ“ä½œï¼Œåˆ™è®¾ç½®å…¨å±€æ•°æ®ç»“æ„ï¼ˆæ­¤æ•°æ®ç»“æ„çš„å…·ä½“å†…å®¹å› å¤„ç†å™¨è€Œå¼‚ï¼‰ä¸­çš„ä¸€ä¸ªæ ‡å¿—ä½è€Œä¸æ‰§è¡Œ autorelease æ“ä½œã€‚ä¸ä¹‹ç›¸ä¼¼ï¼Œå¦‚æœæ–¹æ³•è¿”å›äº†ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾çš„å¯¹è±¡ï¼Œè€Œè°ƒç”¨æ–¹æ³•çš„ä»£ç è¦ä¿ç•™æ­¤å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶ä¸ç›´æ¥æ‰§è¡Œ retainï¼Œè€Œæ˜¯æ”¹ä¸ºæ‰§è¡Œ objc_retainAutoreleaseReturnValue å‡½æ•°ã€‚æ­¤å‡½æ•°è¦æ£€æµ‹åˆšæ‰æåˆ°çš„é‚£ä¸ªæ ‡å¿—ä½ï¼Œè‹¥å·²ç»ç½®ä½ï¼Œåˆ™ä¸æ‰§è¡Œ retain æ“ä½œã€‚è®¾ç½®å¹¶æ£€æµ‹æ ‡å¿—ä½ï¼Œè¦æ¯”è°ƒç”¨ autorelease å’Œ retain æ›´å¿«ã€‚å¤‡æ³¨ï¼šobjc_autoreleaseReturnValue ä¼˜åŒ–ä¸ä¸€å®šå¼€å¯ï¼Œä¼šæ ¹æ®ä¸åŒCPUç±»å‹å†³å®šå¦å¤–ï¼Œè¿™ä¸ªæ ‡è®°ä½å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿå…³é”®å­—ï¼šçº¿ç¨‹å±€éƒ¨å­˜å‚¨ï¼ˆTLSï¼‰ objc_autoreleaseReturnValue ç›¸å…³ä»£ç é€»è¾‘ // Prepare a value at +1 for return through a +0 autoreleasing convention. id objc_autoreleaseReturnValue(id obj) { if (prepareOptimizedReturn(ReturnAtPlus1)) return obj; return objc_autorelease(obj); } static ALWAYS_INLINE bool prepareOptimizedReturn(ReturnDisposition disposition) { ASSERT(getReturnDisposition() == ReturnAtPlus0); //callerAcceptsOptimizedReturn æ˜¯ä¸ªæ¡ä»¶ç¼–è¯‘é€‰é¡¹ï¼Œä¸åŒCPUç±»å‹ä»£ç å®Œå…¨ä¸ä¸€æ · if (callerAcceptsOptimizedReturn(__builtin_return_address(0))) { if (disposition) setReturnDisposition(disposition); return true; } return false; } ä¾‹å­ // æ–¹æ³•åä»¥å…³é”®å­— new å¼€å¤´ï¼ŒARC ä¸ä¼šåŠ å…¥ retainã€release æˆ– autorelease è¯­å¥ã€‚ + (VCHPerson *)newPerson { VCHPerson *person = [[VCHPerson alloc] init]; return person; } // æ–¹æ³•åä¸ä»¥å…³é”®å­—å¼€å¤´ï¼ŒARC ä¼šè‡ªåŠ¨åŠ ä¸Š autorelease è¯­å¥ã€‚ + (VCHPerson *)somePerson { VCHPerson *person = [[VCHPerson alloc] init]; return person; } // ARC ä¼šåœ¨å‡½æ•°æœ«å°¾ç»™ personOne åŠ ä¸Š release è¯­å¥ã€‚ // è€Œ somePerson å·²ç»åœ¨æ–¹æ³•å†…éƒ¨åŠ å…¥åˆ°é‡Šæ”¾æ± ä¸­äº† - (void)doSomething { VCHPerson *personOne = [VCHPerson newPerson]; VCHPerson *personTwo = [VCHPerson somePerson]; } å†…éƒ¨çš„å®ç°é€»è¾‘å¯ä»¥ç”¨ä»¥ä¸‹ä»£ç ä»£æ›¿ //éå…³é”®å­—å¼€å¤´ + (instancetype)object { return [[NSObject alloc] init]; // å®é™…ä¼šå˜æˆ return objc_autoreleaseReturnValue([[NSObject alloc] init]); } NSObject *object = [NSObject object]; // å®é™…ä¼šå˜æˆ NSObject *object = objc_retainAutoreleasedReturnValue([NSObject object]); å†æ¥çœ‹çœ‹æ±‡ç¼– ä¸€ã€å¤–éƒ¨æ–¹æ³•éå…³é”®å­—å¼€å¤´ï¼Œå†…éƒ¨æ–¹æ³•å…³é”®å­—å¼€å¤´ NSMutableArray ä»¥ alloc æ–¹å¼ç”Ÿæˆå¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸º1ï¼Œæ­¤æ—¶æ²¡æœ‰åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ initæ–¹æ³•ä¸åšä»»ä½•å¤„ç†ï¼ŒçŒœæµ‹æ˜¯ç¼–è¯‘å™¨è¡Œä¸º å½“å‰æ–¹æ³•åä¸ä»¥å…³é”®å­—å¼€å¤´ï¼Œreturnæ—¶éœ€è¦åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè¡¨ç¤ºå½“å‰æ–¹æ³•å†…æŒæœ‰å¯¹è±¡ï¼Œå¹¶è´Ÿè´£é‡Šæ”¾å¯¹è±¡ã€‚ ä½†æ˜¯ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ï¼Œä¸ä¼šç«‹å³åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè€Œæ˜¯è°ƒç”¨ objc_autoreleaseReturnValue æ–¹æ³•æ ‡è®°å¯¹è±¡ï¼ˆä»ä¸‹é¢çš„æ±‡ç¼–ä»£ç å¯ä»¥çœ‹å‡ºç¡®å®è°ƒç”¨äº† objc_autoreleaseReturnValue æ–¹æ³•ï¼‰ã€‚ å¦‚æœå¯¹è±¡è¿”å›åï¼Œåˆæœ‰åˆ«çš„å˜é‡éœ€è¦ retain è¿™ä¸ªå¯¹è±¡ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• objc_retainAutoreleasedReturnValueï¼Œæ­¤æ—¶ä¼šæ£€æŸ¥å¯¹è±¡çš„æ˜¯å¦å·²ç»è¢«æ ‡è®°ï¼Œå¦‚æœå·²ç»è¢«æ ‡è®°ï¼Œåˆ™ç›¸äº’æŠµæ¶ˆï¼Œå¹¶å°†æ ‡è®°ä½æ¸…é™¤ï¼Œå¦‚æœæ²¡æœ‰è¢«æ ‡è®°åˆ™æœ€ç»ˆè°ƒç”¨ retain æ–¹æ³•ã€‚ - (id)getObjectWithAlloc { id obj = [[NSMutableArray alloc] init]; return obj;//æ–­ç‚¹ /* VCHTest`-[AppDelegate getObjectWithAlloc]: 0x10027e210 : pushq %rbp 0x10027e211 : movq %rsp, %rbp 0x10027e214 : subq $0x20, %rsp 0x10027e218 : movq %rdi, -0x8(%rbp) 0x10027e21c : movq %rsi, -0x10(%rbp) 0x10027e220 : movq 0x9c41(%rip), %rdi ; (void *)0x00007fff801e6298: NSMutableArray 0x10027e227 : callq 0x10027f814 ; symbol stub for: objc_alloc_init 0x10027e22c : movq %rax, -0x18(%rbp) -> 0x10027e230 : movq -0x18(%rbp), %rdi 0x10027e234 : movq 0x3df5(%rip), %rax ; (void *)0x00007fff20191840: objc_retain 0x10027e23b : callq *%rax 0x10027e23d : xorl %ecx, %ecx 0x10027e23f : movl %ecx, %esi 0x10027e241 : leaq -0x18(%rbp), %rdi 0x10027e245 : movq %rax, -0x20(%rbp) 0x10027e249 : callq 0x10027f86e ; symbol stub for: objc_storeStrong 0x10027e24e : movq -0x20(%rbp), %rdi 0x10027e252 : addq $0x20, %rsp 0x10027e256 : popq %rbp 0x10027e257 : jmp 0x10027f826 ; symbol stub for: objc_autoreleaseReturnValue */ } äºŒã€å¤–éƒ¨æ–¹æ³•éå…³é”®å­—å¼€å¤´ï¼Œå†…éƒ¨æ–¹æ³•éå…³é”®å­—å¼€å¤´ NSMutableArray ä»¥ array æ–¹å¼ç”Ÿæˆå¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸º1ï¼Œå¹¶åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼ˆæ ‡è®°ï¼‰ è°ƒç”¨ objc_retainAutoreleasedReturnValueï¼Œå› ä¸ºä¸´æ—¶å˜é‡éœ€è¦æŒæœ‰å¯¹è±¡ï¼Œæ­¤æ—¶æ ‡è®°ä½æ¸…é™¤ ç”±äºæ–¹æ³•åä¸ä»¥å…³é”®å­—å¼€å¤´ï¼Œreturn æ—¶è°ƒç”¨ objc_autoreleaseReturnValue åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼ˆåŒæ ·ä¹Ÿæ˜¯å…ˆæ ‡è®°ï¼‰ - (id)getObjectWithArray { id obj = [NSMutableArray array]; return obj;//æ–­ç‚¹ /* VCHTest`-[AppDelegate getObjectWithArray]: 0x10027e260 : pushq %rbp 0x10027e261 : movq %rsp, %rbp 0x10027e264 : subq $0x20, %rsp 0x10027e268 : movq %rdi, -0x8(%rbp) 0x10027e26c : movq %rsi, -0x10(%rbp) 0x10027e270 : movq 0x9bf1(%rip), %rdi ; (void *)0x00007fff801e6298: NSMutableArray 0x10027e277 : movq 0x9aba(%rip), %rsi ; \"array\" 0x10027e27e : movq 0x3d9b(%rip), %rax ; (void *)0x00007fff20175280: objc_msgSend 0x10027e285 : callq *%rax 0x10027e287 : movq %rax, %rdi 0x10027e28a : callq 0x10027f85c ; symbol stub for: objc_retainAutoreleasedReturnValue 0x10027e28f : movq %rax, -0x18(%rbp) -> 0x10027e293 : movq -0x18(%rbp), %rdi 0x10027e297 : movq 0x3d92(%rip), %rax ; (void *)0x00007fff20191840: objc_retain 0x10027e29e : callq *%rax 0x10027e2a0 : xorl %ecx, %ecx 0x10027e2a2 : movl %ecx, %esi 0x10027e2a4 : leaq -0x18(%rbp), %rdi 0x10027e2a8 : movq %rax, -0x20(%rbp) 0x10027e2ac : callq 0x10027f86e ; symbol stub for: objc_storeStrong 0x10027e2b1 : movq -0x20(%rbp), %rdi 0x10027e2b5 : addq $0x20, %rsp 0x10027e2b9 : popq %rbp 0x10027e2ba : jmp 0x10027f826 ; symbol stub for: objc_autoreleaseReturnValue */ } ä¸‰ã€å¤–éƒ¨æ–¹æ³•å…³é”®å­—å¼€å¤´ï¼Œå†…éƒ¨æ–¹æ³•å…³é”®å­—å¼€å¤´ NSMutableArray ä½¿ç”¨ alloc ç”Ÿæˆå¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸º1ï¼Œå†…éƒ¨æ²¡æœ‰åŠ å…¥ AutoreleasePool ä¸­ï¼› éšåè°ƒç”¨ init æ–¹æ³•ï¼Œè¿™é‡Œ init æ–¹æ³•è¿”å›å¯¹è±¡æ—¶æ²¡æœ‰åŠ å…¥åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼ŒçŒœæµ‹æ˜¯ç¼–è¯‘å™¨è¡Œä¸ºï¼› ç”±äºå½“å‰æ–¹æ³•ä»¥ copy å¼€å¤´ï¼Œreturn æ—¶æ—¢ä¸è°ƒç”¨ releaseï¼Œä¹Ÿä¸è°ƒç”¨ autoreleaseï¼› - (id)copyObjectWithAlloc { id obj = [[NSMutableArray alloc] init]; return obj;//æ–­ç‚¹ /* VCHTest`-[AppDelegate copyObjectWithAlloc]: 0x10027e160 : pushq %rbp 0x10027e161 : movq %rsp, %rbp 0x10027e164 : subq $0x20, %rsp 0x10027e168 : movq %rdi, -0x8(%rbp) 0x10027e16c : movq %rsi, -0x10(%rbp) 0x10027e170 : movq 0x9cf1(%rip), %rax ; (void *)0x00007fff801e6298: NSMutableArray 0x10027e177 : movq %rax, %rdi 0x10027e17a : callq 0x10027f814 ; symbol stub for: objc_alloc_init 0x10027e17f : movq %rax, -0x18(%rbp) -> 0x10027e183 : movq -0x18(%rbp), %rdi 0x10027e187 : callq *0x3ea3(%rip) ; (void *)0x00007fff20191840: objc_retain 0x10027e18d : xorl %ecx, %ecx 0x10027e18f : movl %ecx, %esi 0x10027e191 : leaq -0x18(%rbp), %rdi 0x10027e195 : movq %rax, -0x20(%rbp) 0x10027e199 : callq 0x10027f86e ; symbol stub for: objc_storeStrong 0x10027e19e : movq -0x20(%rbp), %rax 0x10027e1a2 : addq $0x20, %rsp 0x10027e1a6 : popq %rbp 0x10027e1a7 : retq */ } å››ã€å¤–éƒ¨æ–¹æ³•å…³é”®å­—å¼€å¤´ï¼Œå†…éƒ¨æ–¹æ³•éå…³é”®å­—å¼€å¤´ NSMutableArray ä½¿ç”¨ array ç”Ÿæˆå¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸º1ï¼Œå†…éƒ¨å·²ç»åŠ å…¥ AutoreleasePool ä¸­ï¼ˆå…¶å®è¿˜æ²¡æœ‰åŠ å…¥ï¼Œåªæ˜¯è¢«æ ‡è®°äº†è€Œå·²ï¼‰ï¼› é€šè¿‡ä¸‹é¢çš„æ±‡ç¼–ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ–¹æ³•å†…è°ƒç”¨äº† objc_retainAutoreleasedReturnValue ï¼ˆå› ä¸ºæœ‰ä¸ªä¸´æ—¶å˜é‡éœ€è¦æŒæœ‰å½“å‰å¯¹è±¡ï¼‰ï¼Œæ­¤æ—¶å‘ç°è¯¥å¯¹è±¡å·²ç»è¢«æ ‡è®°ï¼Œåˆ™ç›¸äº’æŠµæ¶ˆï¼Œæ¸…é™¤æ ‡å¿—ä½ï¼Œä¸åŠ å…¥è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼› ç”±äºå½“å‰æ–¹æ³•ä»¥ copy å¼€å¤´ï¼Œreturn æ—¶æ—¢ä¸è°ƒç”¨ releaseï¼Œä¹Ÿä¸è°ƒç”¨ autoreleaseï¼› - (id)copyObjectWithArray { id obj = [NSMutableArray array]; return obj;//æ–­ç‚¹ /* VCHTest`-[AppDelegate copyObjectWithArray]: 0x10027e1b0 : pushq %rbp 0x10027e1b1 : movq %rsp, %rbp 0x10027e1b4 : subq $0x20, %rsp 0x10027e1b8 : movq %rdi, -0x8(%rbp) 0x10027e1bc : movq %rsi, -0x10(%rbp) 0x10027e1c0 : movq 0x9ca1(%rip), %rax ; (void *)0x00007fff801e6298: NSMutableArray 0x10027e1c7 : movq 0x9b6a(%rip), %rsi ; \"array\" 0x10027e1ce : movq %rax, %rdi 0x10027e1d1 : callq *0x3e49(%rip) ; (void *)0x00007fff20175280: objc_msgSend 0x10027e1d7 : movq %rax, %rdi 0x10027e1da : callq 0x10027f85c ; symbol stub for: objc_retainAutoreleasedReturnValue 0x10027e1df : movq %rax, -0x18(%rbp) -> 0x10027e1e3 : movq -0x18(%rbp), %rdi 0x10027e1e7 : callq *0x3e43(%rip) ; (void *)0x00007fff20191840: objc_retain 0x10027e1ed : xorl %ecx, %ecx 0x10027e1ef : movl %ecx, %esi 0x10027e1f1 : leaq -0x18(%rbp), %rdi 0x10027e1f5 : movq %rax, -0x20(%rbp) 0x10027e1f9 : callq 0x10027f86e ; symbol stub for: objc_storeStrong 0x10027e1fe : movq -0x20(%rbp), %rax 0x10027e202 : addq $0x20, %rsp 0x10027e206 : popq %rbp 0x10027e207 : retq */ } æµ‹è¯• ä¸‹é¢ä»£ç æ‰§è¡Œä¼šæ€æ · id __unsafe_unretained obj0 = nil; id __unsafe_unretained obj1 = nil; { NSArray *array0 = [self getObjectWithAlloc]; obj0 = array0; // NSArray *array1 = [self copyObjectWithAlloc]; obj1 = array1; } NSLog(@\"vhuichen obj0 = %@\", obj0); NSLog(@\"vhuichen obj1 = %@\", obj1); "},"iOS/å†…å­˜ç®¡ç†æœºåˆ¶.html":{"url":"iOS/å†…å­˜ç®¡ç†æœºåˆ¶.html","title":"å†…å­˜ç®¡ç†æœºåˆ¶","keywords":"","body":"iOSå†…å­˜ç®¡ç†æœºåˆ¶ 0x00 å†…å­˜åˆ†ç±» æ ¹æ®ä¸åŒ Section å¯ä»¥å°†å†…å­˜åˆ†ä¸º ä»£ç æ®µ .text å·²åˆå§‹åŒ–æ•°æ®æ®µ .data æœªåˆå§‹åŒ–æ•°æ®æ®µ .bss å † heap æ ˆ stack æ ¹æ®å†…å­˜èƒ½å¦è¢«ç³»ç»Ÿå›æ”¶ï¼Œå¯ä»¥åˆ†ä¸º Clean Memory Dirty Memory Clean Memory å†…å­˜ç´§å¼ æ—¶å¯ä»¥è¢«è¦†ç›–ï¼Œä¸‹æ¬¡éœ€è¦ä½¿ç”¨æ—¶ï¼Œè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œç„¶åä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ ï¼ˆPage Inï¼‰ system framework binary executable of your app memory mapped files ç–‘é—®ï¼šé“¾æ¥çš„ framework ä¸­ _DATA_CONST å¹¶ä¸ç»å¯¹å±äº clean memoryï¼Œå½“ app ä½¿ç”¨åˆ° framework æ—¶ï¼Œå°±ä¼šå˜æˆ dirty memoryã€‚ è¿™é‡Œï¼Œå—¯ï¼Œæ²¡ç†è§£ä»€ä¹ˆæ„æ€ Dirty Memory æ— æ³•è¢«ç³»ç»Ÿå›æ”¶çš„å†…å­˜ï¼Œå†…å­˜ç´§å¼ æ—¶ä¼šç»™è¿›ç¨‹å‘é€é€šçŸ¥ï¼Œéœ€è¦ç¨‹åºæ‰‹åŠ¨é‡Šæ”¾è¿™éƒ¨åˆ†å†…å­˜ã€‚åŒæ—¶ç³»ç»Ÿä¼šå‹ç¼©è¿™éƒ¨åˆ†çš„å†…å­˜ï¼Œç­‰ä¸‹æ¬¡ä½¿ç”¨æ—¶å†è§£å‹ã€‚ heap allocation caches decompressed images compressed memory è™šæ‹Ÿå†…å­˜ Virtual Memory = Clean Memory + Dirty Memory ç‰©ç†å†…å­˜ Resident Memory = Clean Memory(Loaded in Physical Memory) + Dirty Memory å®é™…å†…å­˜å ç”¨ memory footprint = dirty size + compressed size 0x01 å†…å­˜ç®¡ç† å†…å­˜ç®¡ç†å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ† APPå†…å­˜ç®¡ç†ï¼Œç”±APPå†…éƒ¨æ§åˆ¶ ç³»ç»Ÿå†…å­˜ç®¡ç†ï¼Œç”±ç³»ç»Ÿæ§åˆ¶ APPå†…å­˜ç®¡ç† APPç®¡ç†æ–¹æ¡ˆæœ‰3ä¸­ Tagged Pointer åœ¨64ä½çš„æœºå™¨ä¸Šï¼Œæœªå¼•å…¥ Tagged Pointer ä¹‹å‰å†…å­˜ç»“æ„å¦‚ä¸‹å›¾ï¼Œå¯¹äºä¸€äº›å¾ˆå°çš„æ•°æ®ï¼Œåœ¨64ä½çš„æœºå™¨ä¸‹å ç”¨çš„å†…å­˜ç¿»äº†ä¸€å€ï¼Œå•å•æ˜¯æŒ‡é’ˆå°±å ç”¨äº†2/3çš„å­—èŠ‚ï¼ŒåŒæ—¶è¿˜è¦åœ¨å †åˆ†é…å†…å­˜ï¼Œç»´æŠ¤å¼•ç”¨è®¡æ•°ç­‰ åŸºäºä»¥ä¸Šé—®é¢˜ï¼Œè‹¹æœå¼•å…¥äº† Tagged Pointer å¯¹è±¡ï¼ŒæŠŠä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆåˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œä¸€éƒ¨åˆ†ä½œä¸ºæ•°æ®æ ‡è¯†ï¼Œä¸€éƒ¨åˆ†å­˜å‚¨æ•°æ®ã€‚æ­¤æ—¶å¯¹è±¡çš„æŒ‡é’ˆä¸å†æ˜¯æŒ‡é’ˆï¼Œæ›´åƒæ˜¯ä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”ä¸éœ€è¦åœ¨å †ä¸­åˆ†é…å†…å­˜ï¼Œè¿™æ ·ä¸ä»…å‡å°‘äº†å ç”¨å†…å­˜ï¼Œè¿˜æé«˜äº†ä½¿ç”¨æ•ˆç‡ã€‚ Tagged Pointer å¯¹è±¡ä¼šåœ¨ä½¿ç”¨æ—¶åˆ›å»ºï¼Œå­˜æ”¾åœ¨æ ˆåŒºï¼ŒåŒä¸€ä¸ªå€¼æ¯æ¬¡åˆ›å»ºéƒ½æ˜¯åŒä¸€ä¸ªåœ°å€ã€‚iOSé»˜è®¤å¼€å¯äº† Tagged Pointer æ··æ·†ï¼Œè°ƒè¯•æ—¶è®¾ç½® OBJC_DISABLE_TAG_OBFUSCATION = YES åï¼Œæ•°æ®æ­£å¸¸äº†ï¼Œæ¯æ¬¡APPå¯åŠ¨åï¼Œéƒ½æ˜¯åŒä¸€ä¸ªå€¼ æµ‹è¯• NSNumber *num1 = @(7); //0x8000000000000393 NSNumber *num2 = @(3); //0x8000000000000193 ä½3ä½è¡¨ç¤ºç±»æ ‡è¯†ä½4~7ä½è¡¨ç¤ºæ•°æ®ç±»å‹æœ€é«˜ä½è¡¨ç¤ºæ˜¯å¦æ˜¯Tagged Pointer Non-pointer iSA åœ¨64ä½çš„æ¶æ„ä¸‹ï¼ŒæŒ‡é’ˆæŸ¥æ‰¾æ•°æ®å¹¶ä¸éœ€è¦64ä½ï¼Œè€Œè‹¹æœå®é™…ä¸Šåªç”¨33ä½æ¥å­˜å‚¨åœ°å€ï¼Œå‰©ä¸‹çš„ç”¨æ¥å­˜å‚¨ä¸€äº›å…¶ä»–çš„æ•°æ®ï¼ŒiSAæŒ‡é’ˆçš„ç»“æ„å¦‚ä¸‹ // æ³¨æ„çœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„ç»“æ„æ˜¯ä¸ä¸€æ ·çš„ union isa_t { Class cls; uintptr_t bits; # define ISA_MASK 0x0000000ffffffff8ULL # define ISA_MAGIC_MASK 0x000003f000000001ULL # define ISA_MAGIC_VALUE 0x000001a000000001ULL struct { uintptr_t nonpointer : 1; //æ˜¯å¦å¼€å¯ nonpointer uintptr_t has_assoc : 1; //å…³è”å¯¹è±¡ uintptr_t has_cxx_dtor : 1; //è¡¨æ˜å¯¹è±¡æ˜¯å¦æœ‰C++æˆ–ARCææ„å‡½æ•° uintptr_t shiftcls : 33; // MACH_VM_MAX_ADDRESS 0x1000000000 uintptr_t magic : 6; uintptr_t weakly_referenced : 1; //å¼±å¼•ç”¨ uintptr_t deallocating : 1; uintptr_t has_sidetable_rc : 1; //æ˜¯å¦å½“å‰çš„å¼•ç”¨è®¡æ•°è¿‡å¤§ uintptr_t extra_rc : 19; // å¼•ç”¨è®¡æ•° = extra_rc + 1ï¼Œè¶…è¿‡å°±é€šè¿‡ SideTable å­˜å‚¨ }; }; æ˜¯å¦ä½¿ç”¨ Non-pointer iSA ç”±è‹¹æœå†³å®š 1ï¼šåŒ…å«swiftä»£ç  2ï¼šsdkç‰ˆæœ¬ä½äº10.11 3ï¼šruntimeè¯»å–imageæ—¶å‘ç°è¿™ä¸ªimageåŒ…å«__objc_rawisaæ®µ 4ï¼šå¼€å‘è€…è‡ªå·±æ·»åŠ äº†OBJC_DISABLE_NONPOINTER_ISA=YESåˆ°ç¯å¢ƒå˜é‡ä¸­ 5ï¼šæŸäº›ä¸èƒ½ä½¿ç”¨Non-pointerçš„ç±»ï¼ŒGCDç­‰ 6ï¼šçˆ¶ç±»å…³é—­ SideTables SideTables æ˜¯ä¸€ä¸ªæ•£åˆ—è¡¨ï¼Œ ç”¨æ¥ç®¡ç†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å’Œå¼±å¼•ç”¨ã€‚ç”±äºå¯¹è±¡å¼•ç”¨è®¡æ•°çš„æ“ä½œæ˜¯åŸå­æ€§æ“ä½œæ‰€ä»¥ SideTable ä¸­ä½¿ç”¨äº†è‡ªæ—‹é”ï¼ŒSideTables åˆ†æˆäº†8ä¸ª SideTableï¼Œå®ç°äº†åˆ†ç¦»é”æŠ€æœ¯ï¼Œæé«˜äº†æ•ˆç‡ã€‚ struct SideTable { //éå…¬å¹³çš„è‡ªæ—‹é” spinlock_t slock; //å¼ºå¼•ç”¨ç›¸å…³ï¼Œå†…éƒ¨æ˜¯ä¸€ä¸ªhashè¡¨ã€‚ RefcountMap refcnts; //å¼±å¼•ç”¨ç›¸å…³ï¼Œå†…éƒ¨ä¹Ÿæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æŒ‡å‘ä¸€ä¸ªå¯å˜æ•°ç»„ weak_table_t weak_table; } RefcountMap ä»…åœ¨æœªå¼€å¯ isa ä¼˜åŒ–æˆ– isa ä¼˜åŒ–æƒ…å†µä¸‹çš„å¼•ç”¨è®¡æ•°æº¢å‡ºæ—¶æ‰ä¼šç”¨åˆ° 8ä¸ª SideTable å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šè§£å†³æ•ˆç‡é—®é¢˜ ç³»ç»Ÿå†…å­˜ç®¡ç† å½“ç³»ç»Ÿå‘ç°æ²¡æœ‰å¯ç”¨çš„å†…å­˜é¡µæ—¶ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹æ­¥éª¤ è¦†ç›–æ‰ä¼˜å…ˆçº§è¾ƒä½çš„ Clean Memory ï¼Œä»¥é¡µä¸ºå•ä½ ç»™æ‰€æœ‰çš„å‰åå°APPè¿›ç¨‹å‘é€å†…å­˜è­¦å‘Šé€šçŸ¥ï¼ˆä¸€èˆ¬APPä¼šé‡Šæ”¾æ‰ä¸€äº›å¯ä»¥å†æ¬¡åŠ è½½çš„å†…å­˜ï¼‰ é€šè¿‡ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤åï¼Œå†…å­˜ä¾ç„¶ä¸å¤Ÿç”¨ï¼Œä½å†…å­˜ç®¡ç†æœºåˆ¶ Jetsam ä¼šæ ¹æ®ä¼˜å…ˆçº§ kill å¯¹åº”çš„è¿›ç¨‹ ä¸ºä»€ä¹ˆæ‰‹æœºAPPå®¹æ˜“è¢«ç³»ç»Ÿæ€æ­»ï¼Œç”µè„‘APPä¸ä¼šè¢«æ€æ­»ï¼Œä½†å´å®¹æ˜“å¡æ­» ç”µè„‘çš„ Swap åŒºåœ¨ç¡¬ç›˜ä¸­ï¼Œç¡¬ç›˜æœ¬èº«å¾ˆå¤§ï¼Œå¾ˆè½»æ¾çš„å°±è™šæ‹Ÿå‡ºä¸€ä¸ªå†…å­˜ï¼ˆè™šæ‹Ÿå†…å­˜ï¼‰ã€‚æœºæ¢°ç¡¬ç›˜ä¸é™è¯»å†™æ¬¡æ•°ï¼Œæ‰€ä»¥å†…å­˜å’Œç¡¬ç›˜ä¹‹é—´å¯ä»¥æ— é™è¯»å†™ã€‚ æ‰‹æœºä¸€èˆ¬æ˜¯ç”¨ flash åšå­˜å‚¨å™¨çš„ï¼Œè¯»å†™æ¬¡æ•°æœ‰é™ï¼Œå¦‚æœç”¨ flash åš Swap åŒºï¼Œé‚£ä¹ˆ flash å¾ˆå¯èƒ½åœ¨çŸ­æ—¶é—´å†…æŠ¥åºŸã€‚æ‰€æœ‰æ‰‹æœºä¸€èˆ¬éƒ½æ—  Swap åŒºã€‚åŸå› ï¼š1. flash å¤§å°æœ‰é™ã€‚2. flash è¯»å†™æ¬¡æ•°æœ‰é™åˆ¶ "},"iOS/Allocations.html":{"url":"iOS/Allocations.html","title":"Allocations","keywords":"","body":"Instruments ä¹‹ Allocations Allocations Allocations ä¸€èˆ¬åŒ…å«ä¸€ä¸ª VM Tracker Statistics ç›´è¯‘ï¼šç»Ÿè®¡ çš„æ„æ€ è¡¨ç¤ºå½“å‰ç³»ç»Ÿçš„å†…å­˜å ç”¨åˆ—è¡¨ All Heap Allocation å¼€å‘è€…æ‰‹åŠ¨ç”³è¯·çš„å†…å­˜ï¼ˆå †ï¼‰ï¼Œè™šæ‹Ÿå†…å­˜ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯ç”±å¼€å‘è€…æ§åˆ¶çš„ã€‚æœªä½¿ç”¨çš„å†…å­˜ä¸ä¼šç›´æ¥åˆ†é…ç‰©ç†å†…å­˜ï¼Œåªæœ‰ä½¿ç”¨äº†çš„å†…å­˜æ‰ä¼šåœ¨ç‰©ç†å†…å­˜ä¸Šåˆ†é…ç©ºé—´ã€‚ All Anonymous VM ç›¸å¯¹äºAll Heap Allocationï¼Œè¿™é‡Œçš„æ˜¯åŒ¿åçš„è™šæ‹Ÿå†…å­˜ï¼Œå¼€å‘è€…æ— æ³•æ§åˆ¶çš„å†…å­˜ã€‚memory mapped file ã€CALayer back store å¥½åƒéƒ½æ˜¯åœ¨è¿™é‡Œçš„ All Heap & Anonymous VM æŒ‡çš„å°±æ˜¯ All Heap Allocation + All Anonymous VM VM:ImageIO_PNG_Data ä½¿ç”¨ [UIImage imageNamed:@\"*.png\"] ç¼“å­˜çš„è§£å‹åçš„å›¾ç‰‡ VM:CG raster data é€šè¿‡CGè§£å‹çš„å›¾ç‰‡.å…‰æ …åŒ–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åƒç´ æ•°æ® Call Tree æ˜¾ç¤ºè°ƒç”¨å‡½æ•°ï¼Œç‚¹å‡»å…·ä½“çš„å‡½æ•°èƒ½è·³è½¬åˆ°å¯¹åº”çš„ä»£ç  Invert Call Tree å€’ç½®å‡½æ•°æ ˆ Hide System Libraries éšè—ç³»ç»Ÿåº“ Allocations list å¯ä»¥æŒ‰ç…§å•æ¬¡åˆ†é…çš„å†…å­˜å¤§å°æ’åºï¼Œå¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°å¯¹åº”çš„è°ƒç”¨æ ˆ Generations æŸ¥çœ‹ä¸¤ä¸ªæ—¶é—´ç‚¹ä¹‹é—´çš„å†…å­˜å˜åŒ– VM Tracker æ‰“å¼€ç•Œé¢åï¼Œéœ€è¦å…ˆå¯åŠ¨ VM Tracker Resident æŒ‡çš„æ˜¯å½“å‰ç‰©ç†å†…å­˜ï¼ˆå·²åŠ è½½çš„ä»£ç æ®µ+è„å†…å­˜ï¼‰VM Region ä¸€ä¸ª VM Region æ˜¯æŒ‡ä¸€æ®µè¿ç»­çš„å†…å­˜é¡µï¼ˆåœ¨è™šæ‹Ÿåœ°å€ç©ºé—´é‡Œï¼‰ï¼Œè¿™äº›é¡µæ‹¥æœ‰ç›¸åŒçš„å±æ€§ï¼ˆå¦‚è¯»å†™æƒé™ã€æ˜¯å¦æ˜¯ wiredï¼Œä¹Ÿå°±æ˜¯æ˜¯å¦èƒ½è¢« page outï¼‰VMObject æ¯ä¸ª VM Region å¯¹åº”ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œåä¸º VM Objectã€‚ % of Res. å½“å‰ Type çš„ Resident å  æ€» Resident çš„æ¯”ä¾‹Type è™šæ‹Ÿå†…å­˜çš„ç±»å‹# Regs VM Region çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯ VMObject çš„ä¸ªæ•°ï¼ŸPath VM Region ä»å“ªä¸ªæ–‡ä»¶æ˜ å°„è¿‡æ¥çš„Dirty Size è„å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿæ— æ³•å›æ”¶çš„å†…å­˜Swapped Size OSX ä¸­è¢«äº¤æ¢çš„å†…å­˜ã€‚iOS æ²¡æœ‰äº¤æ¢åŒºï¼Œæ­¤æ—¶çš„Swapped Sizeå°±æ˜¯å‹ç¼©å†…å­˜Virtual Size è™šæ‹Ÿå†…å­˜æ€»å¤§å°Res. % å½“å‰ç‰©ç†å†…å­˜å è™šæ‹Ÿå†…å­˜çš„æ€»å¤§å° "},"iOS/libffiæ¢ç©¶.html":{"url":"iOS/libffiæ¢ç©¶.html","title":"libffiæ¢ç©¶","keywords":"","body":"libffi æ¢ç©¶ å‰è¨€ è‡ªè‹¹æœç¦ç”¨çƒ­æ›´æ–°ä»¥æ¥ï¼ˆå®é™…ä¸Šå°±æ˜¯ç¦ç”¨äº† dlsym ç­‰å‡ ä¸ªæ¥å£ï¼‰ï¼Œä½¿ç”¨äº† JSpatch ç­‰çƒ­æ›´æ–°åº“çš„åº”ç”¨ä¹Ÿå°±æ— æ³•æ›´æ–°äº†ï¼›é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥ä»£æ›¿é€šè¿‡ dlsym å®ç°çš„çƒ­æ›´æ–°å‘¢ï¼Ÿ OCRunner & MangoFix è¿™ä¸¤ä¸ªåº“éƒ½å¯ä»¥å®ç° iOS çš„çƒ­æ›´æ–°ï¼Œä½¿ç”¨çš„åŸç†æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯é€šè¿‡è¯­æ³•åˆ†æã€è¯æ³•åˆ†ææœ€ç»ˆç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œå†é€šè¿‡è§£æå™¨è§£æï¼Œè¿™é‡Œç›¸å½“äºè‡ªå·±å†™äº†ä¸€ä¸ªç¼–è¯‘å™¨ï¼›è€Œåº•å±‚æ–¹æ³•äº¤æ¢æ˜¯é€šè¿‡ libffi + runtime å®ç°çš„ï¼Œè¿™ç¯‡æ–‡ç« å°±æ¥ç®€å•äº†è§£ä¸‹ libffi è¿™ä¸ªåº“çš„ä½¿ç”¨ã€‚ libffi FFI çš„å…¨åæ˜¯ Foreign Function Interface (å¤–éƒ¨å‡½æ•°æ¥å£)libffi æä¾›äº†ä¸€å¥—åº•å±‚æ¥å£ï¼Œåœ¨çŸ¥é“å‡½æ•°ç­¾åçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ ¹æ®ç›¸å…³æ¥å£å®Œæˆå‡½æ•°è°ƒç”¨ï¼› è°ƒç”¨æƒ¯ä¾‹(Calling Convention) å‡½æ•°è°ƒç”¨æ˜¯é€šè¿‡å †æ ˆä½“ç°å‡ºæ¥çš„ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œéœ€è¦æŒ‰ç…§çº¦å®šå°†ç›¸å…³çš„å‚æ•°å…¥æ ˆï¼Œ è€Œè¿™ç§çº¦å®šå°±å«åšï¼šè°ƒç”¨æƒ¯ä¾‹(Calling Convention)ä¹Ÿå°±æ˜¯è¯´åªè¦æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªçº¦å®šå­˜æ”¾å‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨çš„å‚æ•°ï¼Œå°±å¯å®ç°å‡½æ•°è°ƒç”¨çš„æ•ˆæœï¼›libffi ä¹Ÿå°±æ˜¯å®ç°äº†è¿™æ ·çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ libffi è°ƒç”¨ä»»æ„ OC æ–¹æ³• å®ç°æ­¥éª¤ï¼š é€šè¿‡ libffi åˆ›å»º closure é—­åŒ… äº¤æ¢å‡½æ•°æŒ‡é’ˆï¼›ä¹‹åè°ƒç”¨åŸå§‹æ–¹æ³•ï¼Œå› ä¸º imp å·²ç»ä¿®æ”¹ï¼Œæœ€ç»ˆä¼šè°ƒç”¨åˆ°é—­åŒ…ä¸­ åœ¨é—­åŒ…å›è°ƒå‡½æ•°é‡Œé¢ï¼Œå°† imp æ›¿æ¢æˆæ–°çš„ï¼Œå°†æ¶ˆæ¯é€šè¿‡ ffi_call å‘é€å‡ºå» æ¢å¥è¯è¯´é€šè¿‡ libffi çš„é—­åŒ…åŠŸèƒ½ï¼Œå†åŠ ä¸Š OC æä¾›ç»™æˆ‘ä»¬çš„ runtime ï¼Œä¸€æ ·ä¹Ÿå¯ä»¥å®ç°ä»»æ„æ–¹æ³•çš„ hook åŠŸèƒ½ï¼›åŒæ—¶ä¹Ÿä¸ºçƒ­ä¿®å¤æä¾›äº†åŸºç¡€èƒ½åŠ›ã€‚ åˆ›å»ºé—­åŒ…å¹¶äº¤æ¢ IMP - (void)closureInit { Method method = class_getInstanceMethod(sourceClass, sourceSelector); const char *types = method_getTypeEncoding(method); NSMethodSignature *sign = [NSMethodSignature signatureWithObjCTypes:types]; unsigned int nargs = (unsigned int)sign.numberOfArguments; argumentTypes = malloc(sizeof(ffi_type *) * nargs); argumentTypes[0] = &ffi_type_pointer; argumentTypes[1] = &ffi_type_pointer; for (int i = 2; i ffi_type è¡¨ç¤ºå‚æ•°ç±»å‹ ffi_prep_cif è´Ÿè´£åˆå§‹åŒ–å‡½æ•°æ¨¡æ¿ï¼ˆç›¸å½“äºå‡½æ•°ç­¾åï¼‰ ffi_closure_alloc åˆ†é…ç©ºé—´ ffi_prep_closure_loc ç»‘å®šé—­åŒ…æ•°æ® å°†é—­åŒ…å›è°ƒè½¬å‘åˆ°æ–°çš„IMPä¸Š void ffiClosureCalled(ffi_cif *cif, void *ret, void **args, void *userdata) { VCHFFIClosure *closure = (__bridge VCHFFIClosure *)userdata; //æ›´æ¢æ–°çš„imp IMP imp = class_getMethodImplementation(closure->targetClass, closure->targetSelector); ffi_call(cif, imp, ret, args); } ç¼“å­˜ ffi ç”Ÿæˆçš„é—­åŒ…æ•°æ®å¿…é¡»ç¼“å­˜èµ·æ¥ï¼Œè¿™é‡Œå†™äº†ä¸ªç±»å•ç‹¬å¤„ç†é—­åŒ…ç›¸å…³é€»è¾‘ã€‚è€ƒè™‘åˆ°æ¯ä¸ªç±»å¯ä»¥ hook å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•åˆå¿…é¡»å¯¹åº”ä¸€ä¸ªé—­åŒ…ï¼Œæ‰€ä»¥ç¼“å­˜ç»“æ„å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œkey è¡¨ç¤º classï¼Œvalue è¡¨ç¤ºå¤šä¸ªæ–¹æ³•çš„é›†åˆï¼Œé›†åˆä¹Ÿæ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œkeyè¡¨ç¤ºæ–¹æ³•åï¼Œvalueè¡¨ç¤ºå¯¹åº”çš„é—­åŒ…ï¼› é—ç•™é—®é¢˜ é—­åŒ…é‡Šæ”¾æ—¶è¦æ€ä¹ˆé”€æ¯å†…å­˜ Demo Demo "},"iOS/MVCã€MVPã€MVVM.html":{"url":"iOS/MVCã€MVPã€MVVM.html","title":"MVCã€MVPã€MVVM","keywords":"","body":"MVCã€MVPã€MVVMæ¡†æ¶ MVC è‹¹æœçš„ UIVieController å°±æ˜¯æ ¹æ® MVC æ¡†æ¶æ¥è®¾è®¡çš„ï¼ŒUIVieController æŒæœ‰ View è·Ÿ Modelï¼ˆè‡ªå·±å®ç°ï¼‰ï¼Œå¯¹äºä¸€ä¸ªç®€å•çš„é¡µé¢è€Œè¨€åœ¨ UIVieController è´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼ŒView è´Ÿè´£æ˜¾ç¤º UI ä»¥åŠæ¥å—ç”¨æˆ·äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶ä¼ é€’ç»™ UIVieControllerï¼Œè€Œ Model è´Ÿè´£å­˜å‚¨æ•°æ®ã€‚ åºå¤§çš„ C è‹¹æœçš„ MVC ä¸­ï¼Œ C åŒ…å«äº†å¤§é‡çš„ä»£ç ï¼ŒåŒ…æ‹¬ï¼šè®¾ç½® View çš„ä»£ç ï¼Œç›‘å¬ Model çš„ä»£ç ï¼Œç½‘ç»œç›¸å…³ä¸šåŠ¡é€»è¾‘ï¼Œé¡µé¢è·³è½¬é€»è¾‘ï¼Œè¿™äº›éƒ½æ˜¯åœ¨ C ä¸­å®ç°çš„ã€‚Model ä¸­ä»…ä»…åŒ…å«ä¸€äº›æ•°æ®ï¼Œç®€ç®€å•å•çš„ä¸€ä¸ªç˜¦Modelï¼Œæˆ–è€…å¯ä»¥å°†éƒ¨åˆ†æ•°æ®ç»„è£…ã€æ ¼å¼åŒ–çš„é€»è¾‘æ”¾åœ¨ Model ä¸­ï¼Œè®©è¿™ä¸ª Model æ…¢æ…¢å˜æˆèƒ–Modelã€‚è€Œåœ¨ä¼ ç»Ÿçš„ MVC ä¸­ï¼ŒModel æ˜¯è´Ÿè´£ç½‘ç»œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘çš„ï¼Œæ•°æ®é€šè¿‡ Model æä¾›çš„æ¥å£å¼‚æ­¥è·å–ï¼Œæ‰€æœ‰è·Ÿæ•°æ®ç›¸å…³çš„é€»è¾‘éƒ½åº”è¯¥æ”¾åœ¨ Model ä¸­ã€‚è¿™æ ·åšä¼¼ä¹æ›´åŠ åˆç†ï¼Œä½†æ˜¯æˆ‘åœ¨ iOS å¼€å‘ä¸­å´å¾ˆå°‘è§åˆ°è¿™æ ·çš„ä»£ç  åˆ†ç¦» C ä¸­çš„ä»£ç  è®¾ç½® View çš„ä»£ç  å¯ä»¥æ”¾åœ¨ View é‡Œé¢ï¼ˆæˆ–è€… View åˆ†ç±»ï¼‰ï¼Œäº‹å®ä¸Šæˆ‘è§åˆ°çš„ä»£ç å¾ˆå¤šéƒ½æ˜¯è¿™æ ·åšçš„ï¼Œç”šè‡³ä¸å¯é¿å…çš„åœ¨ View ä¸­ è¿˜ä¼šåŒ…å«ä¸€äº›ç®€å•çš„å±•ç¤ºé€»è¾‘ã€‚æ­¤æ—¶ä¹Ÿå¯ä»¥å°†ç›‘å¬çš„ä»£ç æ”¾åœ¨ View ä¸­å®ç°ã€‚è€ƒè™‘åˆ°è‹¹æœåŸç”Ÿçš„ KVO å¥½å¤šå‘ï¼Œè¿™é‡Œå¯ä»¥ç”¨ Facebook çš„ KVOController è¿™ä¸ªåº“ã€‚ ç½‘ç»œé€»è¾‘æœ¬åº”è¯¥æ”¾åœ¨ Model ä¸­çš„ï¼Œä½†æ˜¯æ²¡æ”¾ï¼Œæ‰€ä»¥å¯ä»¥å°†ç½‘ç»œé€»è¾‘æŠ½å‡ºæ¥æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­ï¼Œå°†è¿”å›çš„æ•°æ®å¤„ç†å¥½åå†äº¤ç»™ Model åˆ†æ¨¡å—ï¼Œå¾ˆå¤š MVC ä¹‹æ‰€ä»¥ä¼šâ€œè‚¿â€ï¼Œæ˜¯å› ä¸ºå°† UIVieController å®Œå…¨å½“æˆ C äº†ï¼Œå¯¹äºä¸€äº›ä¸šåŠ¡åˆ†å¼€çš„ç•Œé¢ï¼Œå®Œå…¨å¯ä»¥å•ç‹¬å†™æˆä¸€ä¸ª MVC ã€‚è¿™æ ·æ›´åŠ åˆç†ï¼Œä¹Ÿæ–¹ä¾¿ä¿®æ”¹ã€‚å¯¹äºå¾ˆå¤æ‚çš„é¡µé¢ï¼Œä¾‹å¦‚åŒ…å« UITableView çš„é¡µé¢ï¼Œå°±åº”è¯¥å°† UITableView ç›¸å…³çš„é€»è¾‘å†™æˆä¸€ä¸ª MVC ï¼Œæ¯ç§ä¸åŒçš„ç±»å‹çš„ UITableViewCell å†™æˆä¸€ä¸ª MVC ï¼Œæœ€ç»ˆå˜æˆ UITableViewï¼ˆMVCï¼‰+ Nç§ç±»å‹çš„ UITableViewCellï¼ˆMVCï¼‰ã€‚ï¼ˆPSï¼šå®é™…ä¸Šé¡¹ç›®ä¸­è¿™é‡Œæˆ‘éƒ½å†™æˆ MVC + MVVM äº†ï¼Œä¸è¿‡æ€æƒ³æ˜¯ä¸€æ ·çš„ï¼‰ ä¼˜ç‚¹ ç®€å•ï¼Œå¾ˆå®¹æ˜“ä¸Šæ‰‹ ç›¸æ¯”äºå…¶ä»–æ¡†æ¶ï¼ŒMVCä»£ç é‡æœ€å°‘ï¼Œéå¸¸é€‚ç”¨äºä¸€äº›ä¸šåŠ¡ç®€å•çš„é¡µé¢ ç¼ºç‚¹ ä¸å¤ªé€‚ç”¨äºè¾ƒå¤æ‚çš„é¡µé¢ ä¸šåŠ¡é€»è¾‘éƒ½å†™åœ¨ C ä¸­ï¼Œä½† C å’Œ V ç´§å¯†è”ç³»åœ¨ä¸€èµ·ï¼Œè¾¹ç•Œç¼ºå¤±ï¼Œå¾ˆéš¾å¯¹ C è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå‡å¦‚ç°åœ¨éœ€è¦æµ‹è¯• C ï¼Œé‚£ä¹ˆ C çš„æ¥å£åœ¨å“ªé‡Œï¼Ÿ MVP MVP æ”¹è¿›äº† MVCï¼Œå°†åŸæ¥ C ä¸­çš„ä¸šåŠ¡ç§»åˆ° P ä¸­ï¼ŒV å’Œ P é€šè¿‡æ¥å£é€šä¿¡ ï¼Œæ„Ÿè§‰å¥½åƒè·Ÿ MVC æ²¡ä»€ä¹ˆåŒºåˆ«å•Šï¼ï¼Ÿï¼Ÿå…¶å®æ˜¯æœ‰çš„æœ€æ˜æ˜¾çš„åŒºåˆ«å°±æ˜¯ MVP ä¸­å¯ä»¥å¯¹ P è·Ÿ M è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ŒV æŒæœ‰ P ï¼ŒP æŒæœ‰ Mï¼Œè¿™æ ·æˆ‘ä»¬å¾ˆå®¹æ˜“æ¨¡æ‹Ÿ V ï¼Œ ä»è€Œå¯¹ P è·Ÿ M è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚ ä¼˜ç‚¹ æ˜“æµ‹è¯•ï¼Œå¯ä»¥å¯¹ P è·Ÿ M è¿›è¡Œå•å…ƒæµ‹è¯• ç¼ºç‚¹ V å’Œ P ä¹‹é—´å¼•å…¥äº†å¤§é‡çš„æ¥å£ MVVM MVVM æ”¹è¿›äº† MVPï¼Œé€šè¿‡åŒå‘ç»‘å®šæœºåˆ¶è§£å†³äº† MVP æ¥å£å¾ˆå¤šçš„é—®é¢˜ï¼ŒMVVM ä¸­çš„ VM å¯¹åº” MVP çš„ Pï¼Œè´Ÿè´£å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚é€šè¿‡ç»‘å®šæœºåˆ¶ï¼Œå½“ M å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–° VM ï¼ŒVM å‘ç”Ÿæ”¹å˜æ—¶æ›´æ–° V ï¼Œè¿™äº›æ•°æ®æ›´æ–°éƒ½ä¸éœ€è¦é€šè¿‡æ¥å£å®ç°ã€‚åœ¨ iOS ä¸­ï¼Œè¿™ç§ç»‘å®šæœºåˆ¶å¯ä»¥ç”¨ ReactiveCocoa æˆ–è€…ç”¨ Facebook çš„ KVOController + KVC å®ç°ã€‚ PSï¼šä½¿ç”¨ Swift è‡ªèº«çš„ç‰¹æ€§åº”è¯¥å¯ä»¥æ›´å¥½åœ°å®ç° MVVMï¼Œä½†ç”±äºæœ¬äººç›®å‰ä¸å¤ªç†Ÿæ‚‰ Swift ï¼ŒDemo ä¸­å¹¶æ²¡æœ‰ä½¿ç”¨ Swift è‡ªèº«çš„ç‰¹æ€§ ä¼˜ç‚¹ æ˜“æµ‹è¯•ï¼Œå¯ä»¥å¯¹ VM è¿›è¡Œå•å…ƒæµ‹è¯• åŒå‘ç»‘å®šç®€åŒ–ä»£ç  ç¼ºç‚¹ åŒå‘ç»‘å®šä½¿å¾—æŸ¥æ‰¾ bug å˜éš¾ MVVM vs MVC-VM åœ¨å®é™…å¼€å‘ä¸­ä¸ä½¿ç”¨ç»‘å®šæœºåˆ¶ä¹Ÿå¯ä»¥å°†æ•°æ®ç›¸å…³çš„ä¸šåŠ¡æ”¾åœ¨ VM ä¸­ï¼Œè¿™æ ·æ•´ä¸ªæ¡†æ¶çœ‹èµ·æ¥å°±åƒæ˜¯ MVC-VMï¼ŒåŒæ ·ä¹Ÿå¯ä»¥å¯¹ VM è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚åœ¨ä¸ä½¿ç”¨ ReactiveCocoa çš„æƒ…å†µä¸‹ï¼Œè¿™ç§ä»£ç æ¡†æ¶åœ¨æˆ‘æ¥è§¦çš„é¡¹ç›®ä¸­å æ¯”å¾ˆå¤§ï¼Œå…¶å®å¾ˆå¤šæ–‡ç« æŠŠè¿™ç§ä»£ç æ¡†æ¶ä¹Ÿå«åš MVVM æ€»ç»“ MVC ç®€å•æ˜“ä¸Šæ‰‹ï¼Œä½†å¾ˆéš¾è¿›è¡Œå•å…ƒæµ‹è¯•ï¼ˆå…¶å®ï¼Œé¡¹ç›®å¼€å‘æœ¬æ¥å°±å¾ˆå°‘å•å…ƒæµ‹è¯•ï¼Œç”šè‡³æ²¡æœ‰ï¼‰ MVP æ”¹è¿›äº† MVC ï¼Œä½¿å¾— MVP å¾ˆå®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä½†åŒæ—¶ä¹Ÿä½¿å¾— V å’Œ P ä¹‹é—´å‡ºç°ä¸€å †äº¤äº’æ¥å£ MVVM æ”¹è¿›äº† MVPï¼Œä½¿ç”¨åŒå‘ç»‘å®šç®€åŒ–äº† V å’Œ P ä¹‹é—´çš„äº¤äº’æ¥å£ åœ¨æ²¡æœ‰ä½¿ç”¨ ReactiveCocoa ç­‰æ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨æ²¡æœ‰ç»‘å®šæœºåˆ¶çš„ MVVMï¼ˆMVC-VMï¼‰ ä¹Ÿæ˜¯ä¸ªä¸é”™çš„é€‰æ‹© Demo Demo "},"iOS/Modules.html":{"url":"iOS/Modules.html","title":"Modules","keywords":"","body":"ç†è§£ iOS ä¸­çš„ Modules ä»€ä¹ˆæ˜¯ Module module è¡¨ç¤ºä»£ç ç¼–è¯‘çš„æœ€å°æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ª.mæ–‡ä»¶ç¼–è¯‘æˆ.oç›®æ ‡æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ª.oå°±æ˜¯ä¸€ä¸ª moduleã€‚è€Œ modulemap å¯ä»¥å°†å¤šä¸ª module åˆå¹¶æˆä¸€ä¸ª moduleã€‚module è¿˜æœ‰å¦ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯å……å½“ Framework ä¸­ OC è·Ÿ Swift çš„æ¡¥æ¥æ–‡ä»¶ã€‚module å¯ä»¥ç”¨æ¥å–ä»£C/C++é¢„è¨€ä¼ ç»Ÿçš„å¤´æ–‡ä»¶å¼•å…¥æ–¹å¼ï¼ŒC/C++ ä¸­å•ä¸ªæ–‡ä»¶è¢«å¼•å…¥äº†Næ¬¡å°±éœ€è¦ç¼–è¯‘Næ¬¡ï¼Œè€Œä½¿ç”¨ module åªéœ€è¦1æ¬¡ã€‚è€Œ moduleå’Œå¤´æ–‡ä»¶ä¹‹é—´åˆ™æ˜¯é€šè¿‡ modulemap å…³è”çš„ #include include ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´å¤´æ–‡ä»¶é‡å¤å¯¼å…¥ã€‚é¢„ç¼–è¯‘æ—¶ä¼šå°† include æ–‡ä»¶é€’å½’å¯¼å…¥è¿›.mæ–‡ä»¶ï¼Œ å‡å¦‚æœ‰Mä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½å¼•å…¥Nä¸ªå¤´æ–‡ä»¶ï¼Œé‚£ä¹ˆç¼–è¯‘æ—¶é—´å˜ä¸º M * N #import æ”¹è¿›äº† include ï¼Œå¯ä»¥é˜²æ­¢é‡å¤æ·»åŠ å¤´æ–‡ä»¶ @import @import å¯¼å…¥çš„å°±æ˜¯ä¸€ä¸ª module çš„å¤´æ–‡ä»¶ã€‚åœ¨ä½¿ç”¨ module ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆæ‰“å¼€è¿™ä¸ªåŠŸèƒ½ Defines Module = YES Module Map File = \"æ‰‹åŠ¨åˆ›å»ºçš„æ–‡ä»¶è·¯å¾„\" //å¯é€‰ moduleåˆ°åº•æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿmodule ä¼šå…ˆæŠŠå¤´æ–‡ä»¶ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå“ªé‡Œéœ€è¦ä½¿ç”¨è¿™ä¸ªå¤´æ–‡ä»¶éƒ½ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å¤´æ–‡ä»¶ï¼Œé™¤éè¿™ä¸ªå¤´æ–‡ä»¶è‡ªèº«å‘ç”Ÿæ”¹åŠ¨ã€‚åŒä¸€ä¸ªå¤´æ–‡ä»¶åªéœ€è¦ç¼–è¯‘ä¸€æ¬¡å°±è¡Œäº† å¼€å¯äº† Defines Module åï¼Œ#include è·Ÿ #import éƒ½ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ›¿æ¢æˆ @importã€‚ Module maps å¦‚æœæ˜¯åŠ¨æ€åº“ Xcode ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªmodulemap, é™æ€åº“åˆ™éœ€è¦æ‰‹åŠ¨ç”Ÿæˆã€‚ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª umbrella header \"ModuleFrameworkA.h\"umbrella å¯ä»¥ç¿»è¯‘æˆ é›†åˆä½“ï¼Œç†è§£æˆå¤´æ–‡ä»¶çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯å°†è¿™ä¸ªå¤´æ–‡ä»¶ä¸‹çš„æ‰€æœ‰å¤´æ–‡ä»¶å¯¼å…¥ã€‚å£°æ˜æŒ‡å®šæŒ‡å®šç›®å½•ä¸­çš„æ‰€æœ‰å¤´æ–‡ä»¶éƒ½åº”åŒ…å«åœ¨æ¨¡å—ä¸­ export **å·åŒ¹é…æ‰€æœ‰çš„æ–‡ä»¶ã€‚è¡¨ç¤ºå¯¼å‡ºæ‰€æœ‰çš„å¤´æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯ umbrella headerä¸­çš„å¤´æ–‡ä»¶ module { export }å°†æ¯ä¸€ä¸ªå¯¼å…¥çš„å¤´æ–‡ä»¶ï¼Œå†æ¬¡å¯¼å‡ºä¸ºå­moduleï¼Œå¯¼å‡ºåå°±å¯ä»¥å¼•å…¥æŸä¸ªå¤´æ–‡ä»¶ explicit module XXXXç†è§£ä¸ºæ˜¾å¼å¯¼å…¥ä¸€ä¸ªå­æ¨¡å—ï¼Œå¹¶å¯ä»¥è‡ªå®šä¹‰å­æ¨¡å—çš„åç§° è¿™é‡Œæµ‹è¯•å‘ç°æ— æ³•ç”¨#import æ–¹å¼å¯¼å…¥æ˜¾å¼å­æ¨¡å—ï¼Œä½†æ˜¯ @import A.a æ˜¯å¯ä»¥çš„ã€‚ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ modulemap æ–‡ä»¶ï¼Œå¹¶å°†OCçš„å¤´æ–‡ä»¶å¼•å…¥ï¼Œç„¶åå°†è·¯å¾„å¼•å…¥åˆ° import paths ä¸­ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥åœ¨ Swift ä¸­å¼•ç”¨ //è¿˜å¯ä»¥å£°æ˜ç§æœ‰æ–‡ä»¶å¤´æ–‡ä»¶ï¼Œä½†åªèƒ½åšåˆ°æç¤ºå¼€å‘è€…æ­¤æ–‡ä»¶ä¸ºç§æœ‰æ–‡ä»¶ï¼Œå¹¶ä¸èƒ½å®Œå…¨éš”ç» framework module ModuleAFramework_Private { header \"Student.h\" export * } Swift Module è€Œä» Swift 5.1 ç‰ˆæœ¬å¼€å§‹ï¼Œ Module Stability å…è®¸ 5.1 ç‰ˆæœ¬æ‰“çš„ Module åœ¨ 5.1 ä¹‹åçš„ä»»æ„ç‰ˆæœ¬è¿è¡Œã€‚å¼€å¯ Module Stability åï¼ŒFramework å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„æ–‡ä»¶å¤¹ .swiftmoduleï¼ŒåŒ…å« .swiftinterface å’Œ .swiftmodule æ–‡ä»¶ï¼Œä½œä¸ºå…¬å…±æ¥å£çš„å®šä¹‰æ–‡ä»¶ã€‚åŸºäº swiftmodule è¿™ä¸ªæ–‡ä»¶ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæ„é€ å‡ºå¯ä»¥ç»™OCä½¿ç”¨çš„å¤´æ–‡ä»¶ å½“å¼€å¯ Build Libraries for Distribution ç¼–è¯‘åç”Ÿæˆçš„æ–‡ä»¶å°±å¤Ÿå¦‚ä¸‹ å¯ä»¥çœ‹åˆ°ç”Ÿæˆäº† module.modulemap æ–‡ä»¶ è·Ÿ swiftmodule æ–‡ä»¶å¤¹ã€‚module.modulemap æ–‡ä»¶æ˜¯ OC ç”Ÿæˆç»™ Swift çš„æ¥å£æè¿°swiftmodule æ–‡ä»¶å¤¹åˆ™æ˜¯ Swift ç”Ÿæˆç»™ OC çš„æ¥å£æè¿°ï¼Œswiftinterface æ–‡ä»¶ä½œä¸º swiftmodule æ–‡ä»¶çš„ä¸€ä¸ªè¡¥å……ï¼Œä¸å—ä»»ä½•ç¼–è¯‘å™¨ç‰ˆæœ¬é™åˆ¶ã€‚ Swift OC é€šä¿¡æ–¹å¼ åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­OC è°ƒç”¨ Swift ï¼Œéœ€è¦æ˜¾å¼å¯¼å…¥ XXX-Swift.h æ–‡ä»¶ã€‚Swift è°ƒç”¨ OC ï¼Œé€šè¿‡æ¡¥æ¥æ–‡ä»¶ï¼Œä¸éœ€è¦æ˜¾å¼å¯¼å…¥ã€‚ åŒä¸€ä¸ª Framework ä¸­OC è°ƒç”¨ Swift ï¼Œéœ€è¦æ˜¾å¼å¯¼å…¥ XXX-Swift.h æ–‡ä»¶ã€‚Swift è°ƒç”¨ OC ï¼Œé€šè¿‡modulemapï¼Œä¸éœ€è¦æ˜¾å¼å¯¼å…¥ã€‚ ä¸åœ¨åŒä¸€ä¸ª Framework ä¸­OC è°ƒç”¨ Swift ï¼Œéœ€è¦æ˜¾å¼å¯¼å…¥ XXX-Swift.h æ–‡ä»¶ã€‚Swift è°ƒç”¨ OC ï¼Œé€šè¿‡modulemapï¼Œä¸éœ€è¦æ˜¾å¼å¯¼å…¥ã€‚ å‚è€ƒæ–‡ç«  æ–‡æ¡£ "},"iOS/æ£€æµ‹æœªä½¿ç”¨çš„ç±».html":{"url":"iOS/æ£€æµ‹æœªä½¿ç”¨çš„ç±».html","title":"æ£€æµ‹æœªä½¿ç”¨çš„ç±»","keywords":"","body":"iOSæ£€æµ‹æœªä½¿ç”¨çš„ç±» ä¸¤ç§æ–¹æ³•1ã€machOæ–‡ä»¶ä¸­ é€šè¿‡ __objc_classlist __objc_classrefs å¯¹æ¯”2ã€è¿è¡Œæ—¶è·å–åˆ°æœªä½¿ç”¨çš„ç±»ï¼ˆéœ€è¦å¤§é‡æµ‹è¯•ï¼Œæˆ–è€…çº¿ä¸Šæµ‹è¯•ï¼‰ä¸¤ç§æ–¹æ³•éƒ½ä¸èƒ½ç»å¯¹è¯†åˆ«å‡†ç¡®ï¼Œä½†åˆå¹¶èµ·æ¥å‡†ç¡®ç‡å¾ˆé«˜äº†ï¼Œæœ€ç»ˆå†æ‰‹åŠ¨ç¡®å®š #include #include #include /* è·å– runtime æœªä½¿ç”¨çš„ç±» */ NSMutableSet *runtimeUnusedClass() { Dl_info info; dladdr((const void *)&runtimeUnusedClass, &info); const uint64_t mach_header = (uint64_t)info.dli_fbase; const struct section_64 *classlist = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, \"__DATA\", \"__objc_classlist\"); if (classlist) { NSMutableSet *classlistUnused = [[NSMutableSet alloc] init]; // éå†æ‹¿åˆ°æ‰€æœ‰çš„ç±» for (UInt64 addr = classlist->offset; addr offset + classlist->size; addr += sizeof(const char **)) { uint64_t baseArrr = mach_header + addr; //è·å–ç±»å¯¹è±¡æŒ‡é’ˆ uint64_t object_class_addr = *(uint64_t *)(baseArrr); // uint64_t object_class_isa = *(uint64_t *)(object_class_addr); //è·å–å…ƒç±»å¯¹è±¡ uint64_t object_meta_class_addr; if (object_class_isa & (1 *machOUnusedClass() { Dl_info info; dladdr((const void *)&machOUnusedClass, &info); const uint64_t mach_header = (uint64_t)info.dli_fbase; const struct section_64 *classlist = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, \"__DATA\", \"__objc_classlist\"); const struct section_64 *selfrefs = getsectbynamefromheader_64((const struct mach_header_64 *)mach_header, \"__DATA\", \"__objc_classrefs\"); if (classlist && selfrefs) { NSMutableSet *classlistSet = [[NSMutableSet alloc] init]; for (UInt64 addr = classlist->offset; addr offset + classlist->size; addr += sizeof(const char **)) { uint64_t baseArrr = mach_header + addr; Class cls = (__bridge Class)(*(void **)(baseArrr)); NSString *clsString = [NSString stringWithFormat:@\"%@\",cls]; [classlistSet addObject:clsString]; } NSMutableSet *selfrefsSet = [[NSMutableSet alloc] init]; for (UInt64 addr = selfrefs->offset; addr offset + selfrefs->size; addr += sizeof(const char **)) { uint64_t baseArrr = mach_header + addr; Class cls = (__bridge Class)(*(void **)(baseArrr)); while (cls) { [selfrefsSet addObject:[NSString stringWithFormat:@\"%@\",cls]]; cls = [cls superclass]; } } [classlistSet minusSet:selfrefsSet]; return classlistSet; } return nil; } ç¼ºç‚¹ 1ã€runtimeUnusedClass æ–¹æ³•åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æœ‰æ•ˆï¼Œè€Œä¸”å¿…é¡»æ‰‹åŠ¨æµè§ˆæ‰€æœ‰çš„é¡µé¢ï¼ˆå¯ä»¥è€ƒè™‘æ”¾åˆ°çº¿ä¸Šæ”¶é›†ï¼‰2ã€ä¸¤ç§æ–¹æ³•éƒ½æ˜¯ä¸å‡†ç¡®çš„ï¼Œä½†æœªä½¿ç”¨çš„ç±»ä¸€å®šåœ¨å…¶ä¸­ï¼Œæœ€ç»ˆéœ€è¦æ‰‹åŠ¨å†æ¬¡ç¡®è®¤ã€‚ "},"iOS/è‡ªå®šä¹‰å¯¹è±¡å»é‡.html":{"url":"iOS/è‡ªå®šä¹‰å¯¹è±¡å»é‡.html","title":"è‡ªå®šä¹‰å¯¹è±¡å»é‡","keywords":"","body":"è‡ªå®šä¹‰å¯¹è±¡å»é‡ åŸºæœ¬ç±»å‹æ•°æ®å»é‡ï¼ˆ4ç§æ–¹æ³•ï¼‰ 1ã€åˆ©ç”¨ NSDictionary key çš„å”¯ä¸€æ€§2ã€åˆ©ç”¨ NSSet çš„ç‰¹æ€§ï¼Œæ•°æ®ä¸èƒ½é‡å¤3ã€åˆ©ç”¨ NSArray çš„ containsObject æ–¹æ³•4ã€åˆ©ç”¨ NSArray çš„ valueForKeyPath æ–¹æ³•ï¼Œä¼ å…¥çš„ keyPath ä¸º @distinctUnionOfObjects.self ç¤ºä¾‹ NSArray *dataArray = @[@\"a\",@\"b\",@\"c\",@\"d\",@\"e\",@\"f\",@\"g\", @\"b\",@\"d\",@\"a\"]; NSMutableDictionary *dict = [NSMutableDictionary dictionary]; for(NSString *str in dataArray) { [dict setValue:str forKey:str]; } NSLog(@\"dict = %@\",[dict allKeys]); NSSet *set = [NSSet setWithArray:dataArray]; NSLog(@\"set = %@\",[set allObjects]); NSMutableArray *array = [NSMutableArray array]; for (NSString *str in dataArray) { if (![array containsObject:str]) { [array addObject:str]; } } NSLog(@\"array = %@\",array); NSArray *keyPathArray = [dataArray valueForKeyPath:@\"@distinctUnionOfObjects.self\"]; NSLog(@\"keyPathArray = %@\",keyPathArray); é€šè¿‡ä¸Šé¢4ä¸­æ–¹æ³•å‡å¯è¿‡æ»¤æ‰é‡å¤æ•°æ®ã€‚ è‡ªå®šä¹‰ç±»å‹æ•°æ®å»é‡ å¯ä»¥é€šè¿‡é‡å†™ hash isEqual ä¸¤ä¸ªæ–¹æ³•å®ç° //.h #import @interface VCHAnimal : NSObject @property (assign, nonatomic) int ID; @property (assign, nonatomic) int age; @end //.m #import \"VCHAnimal.h\" @implementation VCHAnimal - (NSUInteger)hash { return [[NSString stringWithFormat:@\"%zd\",self.ID] hash]; } - (BOOL)isEqual:(id)object { if ([object isKindOfClass:[self class]]) { return ((VCHAnimal *)object).ID == self.ID; } return NO; } @end ç¤ºä¾‹ NSMutableArray *array = [NSMutableArray array]; for (int i = 0; i ID = 0 // obj = ID = 1 // obj = ID = 2 // obj = ID = 0 // obj = ID = 1 // obj = ID = 2 // obj = ID = 3 // obj = ID = 4 // --------- // obj = ID = 3 // obj = ID = 4 // obj = ID = 0 // obj = ID = 1 // obj = ID = 2 ç”¨containsObjectæ–¹æ³•å¯ä»¥å¾—åˆ°ç›¸åŒçš„æ•ˆæœã€‚ NSMutableArray *arraySort = [NSMutableArray array]; for (VCHAnimal *animal in array) { if (![arraySort containsObject:animal]) { [arraySort addObject:animal]; } } æ³¨æ„ è€ƒè™‘åˆ°æ€§èƒ½é—®é¢˜ï¼Œhash æ–¹æ³•åº”è¯¥å°½é‡ç®€æ´ï¼Œé¿å…åšè¿‡å¤šçš„è¿ç®—ã€‚ "},"iOS/ä¸€ä¸ªWorkspaceå¤šä¸ªProject.html":{"url":"iOS/ä¸€ä¸ªWorkspaceå¤šä¸ªProject.html","title":"ä¸€ä¸ªWorkspaceå¤šä¸ªProject","keywords":"","body":"ä¸€ä¸ªWorkspaceä¸‹æœ‰å¤šä¸ªProject æ–°å»ºä¸€ä¸ª Workspace å…ˆåˆ›å»ºä¸€ä¸ªåä¸º MultiProject çš„ .xcworkspace æ–‡ä»¶ ï¼Œæ”¾åˆ° MultiProject è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹ã€‚ å°† Project æ·»åŠ åˆ° Workspace ä¸­ æ–¹æ³•ä¸€ï¼šæ·»åŠ å·²åˆ›å»ºå¥½çš„ Project å…ˆåˆ›å»ºä¸€ä¸ªåä¸º ProjectA çš„ Projectã€‚åˆ›å»ºå¥½ Project åã€‚æ‰“å¼€ MultiProject.xcworkspace æ–‡ä»¶ã€‚ ç‚¹å‡» File -> Add Files to \"Workspace Name\"ï¼Œæ‰¾åˆ°åˆšåˆ›å»ºé¡¹ç›®çš„ ProjectA.xcodeproj æ–‡ä»¶ï¼Œæ·»åŠ ã€‚æ­¤æ—¶ ProjectA å·²ç»åŠ åˆ° MultiProject è¿™ä¸ªå·¥ä½œç©ºé—´ä¸‹äº†ã€‚ æ–¹æ³•äºŒï¼šåˆ›å»º Project æ—¶å°±æ·»åŠ åˆ° Workspace ä¸­ åœ¨åˆ›å»º Project æ•´ä¸ªè¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œä¼šæ˜¯è¿™æ ·çš„ç•Œé¢åœ¨çº¢è‰²æ¡†ä¸­é€‰æ‹©å¯¹åº”çš„ Workspaceï¼Œç‚¹å‡» Create åï¼Œåˆšåˆ›å»ºçš„ Project å°±æ·»åŠ åˆ° Workspace ä¸­äº†ã€‚ æ³¨æ„ï¼šä¸€èˆ¬ä¼šå°†åˆ›å»ºå¥½çš„ Project æ”¾åˆ° Workspace ç›®å½•ä¸‹ã€‚ CocoaPods å®‰è£… åœ¨ MultiProject.xcworkspace æ–‡ä»¶çš„ç›®å½•ä¸‹åˆ›å»º Podfile æ–‡ä»¶ã€‚å†…å®¹å¦‚ä¸‹ platform :ios, '8.0' workspace 'MultiProject.xcworkspace' target 'ProjectA' do project 'ProjectA/ProjectA.xcodeproj' pod 'SDWebImage' pod 'iVersion' end target 'ProjectB' do project 'ProjectB/ProjectB.xcodeproj' pod 'SDWebImage' pod 'AFNetworking' pod 'iVersion' end æœ€ååœ¨å‘½ä»¤è¡Œä¸­è¿›å…¥è¯¥ç›®å½•ï¼Œæ‰§è¡Œ pod install å‘½ä»¤ï¼ŒOK æå®šã€‚ æœ€ç»ˆçš„ç›®å½•æ–‡ä»¶å¦‚ä¸‹ï¼š é¡¹ç›®å†…ç»“æ„å¦‚ä¸‹ï¼š "},"iOS/å•ä¾‹å®Œæ•´å†™æ³•.html":{"url":"iOS/å•ä¾‹å®Œæ•´å†™æ³•.html","title":"å•ä¾‹å®Œæ•´å†™æ³•","keywords":"","body":"å•ä¾‹å®Œæ•´å†™æ³• æ³¨æ„ç‚¹ 1ã€ç¬¬ä¸€æ¬¡ç”Ÿæˆå¯¹è±¡æ—¶ä¸èƒ½è°ƒç”¨[self alloc]ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„allocWithZoneæ–¹æ³•ä¼šè¢«é‡å†™ã€‚å¯ä»¥è°ƒç”¨[super allocWithZone:nil]æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚2ã€å¿…é¡»è¦éµå®ˆNSCopying NSMutableCopying è€…ä¸¤ä¸ªåè®®ï¼Œé‡å†™copyWithZone mutableCopyWithZoneè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸ç„¶å¤–éƒ¨è°ƒç”¨ copy mutableCopyæ–¹æ³•ä¼šå´©æºƒã€‚ æ–¹æ³•è¿”å›selfã€‚3ã€é‡å†™allocWithZoneè¿™ä¸ªæ–¹æ³•ã€‚è¿”å›ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„å¯¹è±¡ã€‚ ä»£ç  //.h #import @interface VCHSingleton : NSObject + (instancetype)sharedInstance; @end //.m #import \"VCHSingleton.h\" @interface VCHSingleton() @end @implementation VCHSingleton + (instancetype)sharedInstance { static id instane = nil; static dispatch_once_t onceToken; dispatch_once(&onceToken, ^{ instane = [[super allocWithZone:nil] init]; }); return instane; } + (instancetype)allocWithZone:(struct _NSZone *)zone { return [self sharedInstance]; } - (id)copyWithZone:(NSZone *)zone { return self; } - (id)mutableCopyWithZone:(NSZone *)zone { return self; } @end è°ƒç”¨ VCHSingleton *singleton0 = [VCHSingleton sharedInstance]; NSLog(@\"singleton0 = %@\",singleton0); VCHSingleton *singleton1 = [VCHSingleton new]; NSLog(@\"singleton1 = %@\",singleton1); VCHSingleton *singleton2 = [VCHSingleton alloc]; NSLog(@\"singleton2 = %@\",singleton2); VCHSingleton *singleton3 = [[VCHSingleton alloc] init]; NSLog(@\"singleton3 = %@\",singleton3); VCHSingleton *singleton4 = [singleton0 copy]; NSLog(@\"singleton4 = %@\",singleton4); VCHSingleton *singleton5 = [singleton0 mutableCopy]; NSLog(@\"singleton5 = %@\",singleton5); // è¾“å‡º // singleton0 = // singleton1 = // singleton2 = // singleton3 = // singleton4 = // singleton5 = "},"iOS/åœ°å›¾åæ ‡ç³».html":{"url":"iOS/åœ°å›¾åæ ‡ç³».html","title":"åœ°å›¾åæ ‡ç³»","keywords":"","body":"åœ°å›¾å®šä½åæ ‡åå·®è§£å†³æ–¹æ¡ˆ å‰è¨€ ç”±äºæŸäº›åŸå› ï¼Œå›½å†…çš„ç»çº¬åº¦åæ ‡ç³»å¹¶ä¸æ˜¯ä½¿ç”¨é€šç”¨çš„ç»çº¬åº¦åæ ‡ç³»ã€‚å½“åæ ‡å®šä½åˆ°å›½å†…æ—¶å°±ä¼šå‡ºç°åå·®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆåˆ¤æ–­ç»çº¬åº¦åæ ‡æ˜¯å¦åœ¨å›½å†…ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™éœ€è¦å…ˆè½¬æˆå›½å†…åæ ‡ã€‚ å¸¸ç”¨åæ ‡ç³» WGS84åæ ‡ç³» å›½é™…åæ ‡ï¼ŒGoogleåœ°å›¾ã€è‹¹æœåœ°å›¾ä½¿ç”¨çš„åæ ‡ç³»ã€‚GPSä¿¡å·ç›´æ¥è§£æçš„ç»çº¬åº¦ä¿¡æ¯ä¹Ÿæ˜¯è¿™ä¸ªåæ ‡ç³»çš„ã€‚ GCJ02åæ ‡ç³» ä¸­å›½åæ ‡ï¼Œé«˜å¾·åœ°å›¾ã€è…¾è®¯åœ°å›¾ä½¿ç”¨è¿™ä¸ªåæ ‡ç³»ã€‚å›½å†…åŸºç«™å®šä½ã€WIFIå®šä½è·å–åˆ°çš„ä¹Ÿæ˜¯ GCJ02 çš„åæ ‡ã€‚ å›½å†…çš„å…¶ä»–åæ ‡ç³» è¿˜æœ‰ä¸€äº›å›½å†…çš„åœ°å›¾ï¼Œåœ¨ GCJ02 åæ ‡çš„åŸºç¡€ä¸Šå†è¿›è¡Œä¸€æ¬¡åŠ å¯†ã€‚ä¾‹å¦‚ï¼šç™¾åº¦åæ ‡ï¼ˆBD09ï¼‰ã€‚ iOS è‹¹æœåœ°å›¾å¼€å‘ è‹¹æœåœ°å›¾åœ¨å›½å†…ä½¿ç”¨çš„æ˜¯é«˜å¾·åœ°å›¾çš„æ•°æ®ï¼ˆGCJ02åæ ‡ç³»ï¼‰ï¼Œåœ¨å›½å¤–åˆ™ä½¿ç”¨è‡ªå·±çš„æ•°æ®ï¼ˆWGS84åæ ‡ç³»ï¼‰ã€‚é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŒºåˆ†å›½å†…å¤–å‘¢ï¼Ÿè¿™é‡Œæœ‰å‡ ç§æ–¹æ³• 1ã€å›½å®¶åŒºåŸŸåˆ¤æ–­ ç”¨å¤§é‡çš„ç‚¹å°†å°†ä¸­å›½åœˆå‡ºæ¥ï¼ˆæ¸¯æ¾³å°åœ°åŒºè¦å•ç‹¬å‡ºæ¥ï¼‰ï¼Œç„¶ååˆ¤æ–­ç»çº¬åº¦æ˜¯å¦åœ¨è¿™ä¸ªåŒºåŸŸå†…ã€‚è¾¹ç•Œç‚¹è¶Šå¤šè¶Šç²¾ç¡®ã€‚ç¼ºç‚¹ï¼šæ•°æ®è¶Šå¤šè¿ç®—é‡è¶Šå¤§ï¼Œæ•°æ®å°‘ç²¾ç¡®åº¦å°±ä½ã€‚ 2ã€è°ƒç”¨é€†åœ°ç†ç¼–ç æ¥å£ï¼Œè¿”å›å›½å®¶ç  [[[CLGeocoder alloc] init] reverseGeocodeLocation:location completionHandler:^(NSArray *placemarks, NSError *error) { if(placemarks.count) { CLPlacemark *placemark = [placemarks firstObject]; NSLog(@\"placemark = %@ %@\",placemark.country, placemark.ISOcountryCode); } }]; é€šè¿‡ä¸Šé¢çš„æ¥å£å°±å¯ä»¥è¿”å›å›½å®¶ç ï¼Œå½“å›½å®¶ç ä¸ºCNæ—¶å°±åˆ¤å®šä¸ºå›½å†…ã€‚è¿™é‡Œç”±äº GCJ02 å’Œ WGS84 åæ ‡çš„åå·®åœ¨ä¸€åƒç±³å†…ï¼Œæ‰€ä»¥åœ¨åˆ¤æ–­å›½å®¶ç æ—¶å¯ä»¥å¿½ç•¥ã€‚ç¼ºç‚¹ï¼šè¯·æ±‚æ¥å£ä¼šæœ‰ç½‘ç»œå»¶æ—¶ï¼Œä¾èµ–ç½‘ç»œã€‚ 3ã€åˆ¤æ–­æ˜¯å¦æœ‰â€œé«˜å¾·åœ°å›¾â€çš„å›¾ç‰‡ å½“è‹¹æœåœ°å›¾ä½¿ç”¨é«˜å¾·åœ°å›¾çš„æ•°æ®æ—¶ï¼Œåœ°å›¾ä¸Šä¼šå‡ºç° â€œé«˜å¾·åœ°å›¾â€çš„å­—çœ¼ï¼ˆå…¶å®æ˜¯ä¸€å¼ å›¾ç‰‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥åˆ¤æ–­åº”è¯¥ä½¿ç”¨ä»€ä¹ˆåæ ‡ç³»æ¥æ˜¾ç¤ºã€‚åˆ¤æ–­ä»£ç å¦‚ä¸‹ï¼š [self.mapView.subviews enumerateObjectsUsingBlock:^(__kindof UIView * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) { if ([obj isKindOfClass:[UIImageView class]] && (obj.size.width == 45.5) && (obj.size.height == 10.5)) { isAutoNavi = YES; } }]; ç¼ºç‚¹ï¼šç›®å‰æ˜¯é€šè¿‡åˆ¤æ–­å›¾ç‰‡å¤§å°æ¥æ–­å®šæ˜¯å¦æœ‰ä½¿ç”¨é«˜å¾·æ•°æ®ï¼Œå›¾ç‰‡å¤§å°éƒ½æ˜¯ï¼ˆ45.5 x 10.5ï¼‰ã€‚å¯èƒ½ä¸åŒæ‰‹æœºä¼šä¸åŒï¼Œè¿™ä¸ªæœ‰å¾…æµ‹è¯•ã€‚ 4ã€ä½¿ç”¨å›½å†…ç‰ˆå’Œå›½é™…ç‰ˆ åœ¨å›½å†…ä¸Šæ¶å›½å†…ç‰ˆï¼Œä½¿ç”¨ GCJ02 åæ ‡ç³»ã€‚å›½é™…åˆ™ä½¿ç”¨å›½é™…ç‰ˆï¼ˆWGS84 åæ ‡ç³»ï¼‰ã€‚è¿™é‡Œç”±äºæ¸¯æ¾³å°ä½¿ç”¨çš„æ˜¯ WGS84 åæ ‡ç³»ï¼Œæ‰€ä»¥ä¹Ÿåˆ’åˆ†åˆ°å›½é™…ç‰ˆé‡Œé¢ã€‚ç¼ºç‚¹ï¼šå›½å†…ç‰ˆåªèƒ½åœ¨å›½å†…ä½¿ç”¨ï¼Œåˆ°äº†å›½å¤–å°±ä¼šæœ‰åå·®ï¼Œåä¹‹äº¦ç„¶ã€‚ 5ã€ç™»å½•ç•Œé¢æ·»åŠ é€‰æ‹©æ¡† è®©ç”¨æˆ·å»é€‰æ‹©åœ°åŒºï¼Œç±»ä¼¼äº Android åœ¨ç™»å½•é¡µé¢è®©ç”¨æˆ·å»é€‰æ‹©ä½¿ç”¨é«˜å¾·åœ°å›¾è¿˜æ˜¯è°·æ­Œåœ°å›¾ã€‚ç¼ºç‚¹ï¼šUIéœ€è¦æ”¹åŠ¨ã€‚ ç»“æŸ ä½¿ç”¨ä¸Šé¢çš„å‡ ç§æ–¹æ³•éƒ½å¯ä»¥â€œè§£å†³â€åœ°å›¾å®šä½åæ ‡åå·®çš„é—®é¢˜ã€‚ç½‘ä¸Šæœ‰ä¸ªç»çº¬åº¦åæ ‡è½¬æ¢çš„åº“ï¼Œåæ ‡ç³»è½¬æ¢æ²¡é—®é¢˜ï¼Œä½†åˆ¤æ–­æ˜¯å¦åœ¨å›½å†…çš„è¯¯å·®æ¯”è¾ƒå¤§ï¼Œæ²¡æœ‰åˆ†ç¦»æ¸¯æ¾³å°ã€‚æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ï¼ŒJZLocationConverterã€‚ç›®å‰æˆ‘ç”¨è¿™ä¸ªåº“æ¥å®ç°åæ ‡ç³»è½¬æ¢ï¼Œä½†åˆ¤æ–­æ˜¯å¦åœ¨å›½å†…ä½¿ç”¨çš„æ˜¯ä¸Šé¢çš„æ–¹æ³•3ã€‚è™½ç„¶æˆ‘ä»¬çš„ç”¨æˆ·ä¸å¤šï¼Œä½†ä»ç›®å‰åå°æ”¶é›†åˆ°çš„æ•°æ®çœ‹æ¥ï¼Œæ–¹æ³•2å’Œæ–¹æ³•3éƒ½æ˜¯å¯ä»¥å‡†ç¡®åˆ¤æ–­çš„ã€‚ "},"iOS/åŠ å¯†è§£å¯†.html":{"url":"iOS/åŠ å¯†è§£å¯†.html","title":"åŠ å¯†è§£å¯†","keywords":"","body":"åŠ å¯†è§£å¯† Base64 ç¼–ç  åŸç† Base64 ç¼–ç ä¼šæŠŠ 3 å­—èŠ‚çš„äºŒè¿›åˆ¶æ•°æ®ç¼–ç ä¸º 4 å­—èŠ‚çš„æ•°æ®ï¼Œé•¿åº¦å¢åŠ  33% ã€‚å¦‚æœè¦ç¼–ç çš„äºŒè¿›åˆ¶æ•°æ®ä¸æ˜¯ 3 çš„å€æ•°ï¼ŒBase64 ä¼šç”¨ \\x00 å­—èŠ‚åœ¨æœ«å°¾è¡¥é½ï¼Œç„¶ååœ¨æœ«å°¾åŠ ä¸Š1ã€2ä¸ª = å·ï¼Œè¡¨ç¤ºè¡¥çš„å­—èŠ‚æ•°ã€‚ä¾‹å¦‚ï¼š éœ€è¦åŠ å¯†çš„æ•°æ®ï¼šs 1 3å¯¹åº”çš„ asciiï¼š115 49 512è¿›åˆ¶ï¼š 01110011 00110001 00110011è½¬æ¢ï¼šæ¯ä¸‰ä¸ªå­—èŠ‚è½¬æ¢æˆå››ä¸ªå­—èŠ‚è½¬æ¢åï¼š 011100.11 0011.0001 00.110011 (æ ‡ç‚¹å¤„åˆ†å‰²)è½¬æ¢åï¼š 011100 110011 000100 110011é«˜ä¸¤ä½è‡ªåŠ¨è¡¥0æœ€ç»ˆæ•°æ®ï¼š 00011100 00110011 00000100 00110011å¾—åˆ° 28 51 4 51æŸ¥å¯¹ä¸‹ç…§è¡¨ c z E z iOSä¸‹æœ‰ä¸¤ç§æ¯”è¾ƒå¸¸è§çš„ Base64 ç¼–ç æ–¹å¼ç¬¬ä¸€ç§ï¼šiOSè‡ªå¸¦çš„ç¼–ç æ–¹å¼è¿™é‡Œæˆ‘å†™äº†ä¸€ä¸ªåˆ†ç±»ï¼Œå¯ä»¥ç›´æ¥å¯¹å­—ç¬¦ä¸²ç¼–ç ã€è§£ç ã€‚ #import \"NSString+VCHBase64.h\" @implementation NSString (VCHBase64) - (NSString *)vch_base64Encode { NSData *data = [self dataUsingEncoding:NSUTF8StringEncoding]; return [data base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength]; } - (NSString *)vch_base64Decode { NSData *data = [[NSData alloc] initWithBase64EncodedString:self options:NSDataBase64DecodingIgnoreUnknownCharacters]; return [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding]; } @end ç¬¬äºŒç§ï¼šç”¨ Google çš„ GTMBase64å¯ä»¥ç›´æ¥åœ¨GitHubä¸Šæœç´¢ã€‚ä¸‹é¢çš„ Demo é‡Œé¢ä¹Ÿæœ‰ã€‚ MD5 åŠ å¯† åŠ å¯†ä»£ç  #import - (NSString *)vch_md5 { const char *cStr = [self UTF8String]; unsigned char digest[CC_MD5_DIGEST_LENGTH]; CC_MD5(cStr, (uint32_t)strlen(cStr), digest); NSMutableString *output = [NSMutableString stringWithCapacity:CC_MD5_DIGEST_LENGTH * 2]; for(int i = 0; i MD5 åŠ å¯†ä¸€èˆ¬æ˜¯ä¸å¯è§£å¯†çš„ï¼Œä½†å¯ä»¥é€šè¿‡ç©·ä¸¾æ³•è§£å¯†ï¼ˆå°±æ˜¯ä¸€ä¸ªä¸€ä¸ªå»åŒ¹é…ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥ç»™ MD5 åŠ ä¸ªæ•°å­—ï¼Œç„¶åå†åŠ å¯†ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™æ ·åŠ å¯†åå°±åŸºæœ¬æ— æ³•å†è§£å¯†å‡ºæ¥äº†ã€‚ AES åŠ å¯† AES åŠ å¯†ã€è§£å¯†éœ€è¦åŒä¸€ä¸ªå¯†é’¥ï¼Œè¿™ç§åŠ å¯†æ–¹æ³•ç§°ä¸ºå•å¯†é’¥åŠ å¯†ï¼Œä¹Ÿç§°å¯¹ç§°åŠ å¯†ã€‚AES æœ‰å¤šç§åŠ å¯†æ–¹å¼ï¼ˆECBã€CBCã€CFBã€OFBï¼‰ï¼Œå¦‚æœä½¿ç”¨ CBC æ–¹å¼åŠ å¯†ï¼Œé‚£ä¹ˆè¿˜éœ€è¦æä¾›å¯†é’¥åç§»é‡ IV è¿™ä¸ªå€¼ã€‚AES å¯ä»¥é‡‡ç”¨128ä½ æˆ–è€… 256ä½çš„åŠ å¯†æ–¹å¼ã€‚ ä¸‹é¢ä»£ç é‡‡ç”¨äº† AES256 CBC æ¨¡å¼ã€‚ #import \"NSString+VCHAES.h\" #import @implementation NSString (VCHAES) - (NSString *)vch_AESEncryptWithKey:(NSString *)key iv:(NSString *)iv { NSData *data = [self dataUsingEncoding:NSUTF8StringEncoding]; NSData *encryptData = [self AES256operation:kCCEncrypt data:data key:key iv:iv]; NSString *encryptString = [encryptData base64EncodedStringWithOptions:NSDataBase64Encoding64CharacterLineLength]; return encryptString; } - (NSString *)vch_AESDecryptWithKey:(NSString *)key iv:(NSString *)iv { NSData *data = [[NSData alloc] initWithBase64EncodedString:self options:NSDataBase64DecodingIgnoreUnknownCharacters]; NSData *decryptData = [self AES256operation:kCCDecrypt data:data key:key iv:iv]; NSString *decryptString = [[NSString alloc] initWithData:decryptData encoding:NSUTF8StringEncoding]; return decryptString; } - (NSData *)AES256operation:(CCOperation)operation data:(NSData *)data key:(NSString *)key iv:(NSString *)iv { char keyPtr[kCCKeySizeAES256 + 1]; bzero(keyPtr, sizeof(keyPtr)); [key getCString:keyPtr maxLength:sizeof(keyPtr) encoding:NSUTF8StringEncoding]; char ivPtr[kCCKeySizeAES256 + 1]; bzero(ivPtr, sizeof(ivPtr)); [iv getCString:ivPtr maxLength:sizeof(ivPtr) encoding:NSUTF8StringEncoding]; size_t bufferSize = [data length] + kCCKeySizeAES256; void *buffer = malloc(bufferSize); size_t numBytesEncrypted = 0; CCCryptorStatus cryptorStatus = CCCrypt(operation, kCCAlgorithmAES, kCCOptionPKCS7Padding, keyPtr, kCCKeySizeAES256, ivPtr, [data bytes], [data length], buffer, bufferSize, &numBytesEncrypted); if(cryptorStatus == kCCSuccess) { return [NSData dataWithBytesNoCopy:buffer length:numBytesEncrypted]; } free(buffer); return nil; } @end è¿™é‡Œçš„ key å’Œ iv ï¼Œæ˜¯ç”±åŠ å¯†è€…æä¾›çš„ã€‚ "},"iOS/Notification.html":{"url":"iOS/Notification.html","title":"Notification","keywords":"","body":"Notification iOSè¿œç¨‹æ¨é€æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ è¿œç¨‹æ¨é€é€»è¾‘å›¾ 1ã€ APPå‘iOSè®¾å¤‡ï¼ˆiPhoneæ‰‹æœºï¼‰å‘é€ä¸€ä¸ªæ³¨å†Œé€šçŸ¥ã€‚ç„¶åiOSè®¾å¤‡å‘APNSè¿œç¨‹æ¨é€æœåŠ¡å™¨å‘é€APPçš„ Bundle ID å’Œè®¾å¤‡çš„UDIDã€‚2ã€ APNSæ ¹æ®ä¸Šä¼ çš„ Bundle ID å’Œ UDID ç”Ÿæˆ Device Token å†è¿”å›ç»™APPã€‚3ã€ APP å°† Device Token å‘é€ç»™è‡ªå·±çš„æœåŠ¡å™¨ã€‚4ã€ å½“æœåŠ¡å™¨å‘ç”ŸAPPæ„Ÿå…´è¶£äº‹ä»¶çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å°†è¯¥æ¶ˆæ¯ä»¥åŠå¯¹åº”çš„ Device Token å‘é€ç»™APNSã€‚5ã€ APNS å†æ ¹æ® Device Token å°†æ¶ˆæ¯å‘é€ç»™å¯¹åº”çš„APPï¼ˆç”¨æˆ·ï¼‰ã€‚ "},"Swift/Swift.html":{"url":"Swift/Swift.html","title":"Swift","keywords":"","body":"Swift "},"Swift/è®¿é—®æƒé™ä¿®é¥°ç¬¦.html":{"url":"Swift/è®¿é—®æƒé™ä¿®é¥°ç¬¦.html","title":"è®¿é—®æƒé™ä¿®é¥°ç¬¦","keywords":"","body":"Swift è®¿é—®æƒé™ä¿®é¥°ç¬¦ Swift è®¿é—®æƒé™ä¿®é¥°ç¬¦ swift çš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€å°±æ˜¯å®‰å…¨ç±»å‹è¯­è¨€ï¼ˆDesigned for Safetyï¼‰ï¼Œæ‰€ä»¥å¤šå‡ ä¸ªè®¿é—®ä¿®é¥°ç¬¦ä¹Ÿæ˜¯åˆæƒ…åˆç†çš„ã€‚è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥ç”¨æ¥ä¿®é¥°å±æ€§ã€æ–¹æ³•ã€ç±»ã€ç»“æ„ä½“ private åªèƒ½åœ¨å½“å‰ç±»é‡Œä½¿ç”¨ï¼Œä¸å…è®¸å¤–éƒ¨æˆ–è€…å…¶å­ç±»è®¿é—®ã€‚å¦‚æœç”¨æ¥ä¿®é¥°ç±»ã€ç»“æ„ä½“ï¼Œé‚£ä¹ˆä½œç”¨ç›¸å½“äºfileprivate private(set) è¡¨ç¤ºç¦æ­¢è®¾ç½®ï¼Œå³åªè¯»ï¼Œå¯è®¿é—® fileprivate åªèƒ½åœ¨å½“å‰çš„æºæ–‡ä»¶é‡Œä½¿ç”¨ internalï¼ˆé»˜è®¤ï¼‰ å¯ä»¥åœ¨æºä»£ç æ‰€åœ¨çš„æ¨¡å—ä½¿ç”¨ public å¯ä»¥åœ¨æ¨¡å—ä¹‹å¤–ä½¿ç”¨ï¼Œä½†ä¸å¯ä»¥åœ¨å…¶å®ƒæ¨¡å—ä¸­é‡å†™å’Œç»§æ‰¿ open å¯ä»¥åœ¨æ¨¡å—ä¹‹å¤–ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæ¨¡å—ä¸­é‡å†™å’Œç»§æ‰¿ è¡¥å…… åœ¨ä¸€ä¸ª Framework é‡Œï¼Œæ—¢æœ‰ Swift åˆæœ‰ OC ä»£ç æ—¶ï¼Œç¼–è¯‘å™¨ä¼šå°† Swift å’Œ OC åˆ†åˆ«å½“æˆä¸€ä¸ª Module ã€‚Swift ä»£ç é™¤äº†ä½¿ç”¨å…³é”®å­— @objc å¤–ï¼Œè¿˜å¿…é¡»ä½¿ç”¨ public çº§åˆ«çš„å…³é”®å­—æ‰èƒ½è¢«åŒä¸€ä¸ª Framework é‡Œçš„ OC ä»£ç ä½¿ç”¨ "},"Swift/ABIç¨³å®šã€æ¨¡å—ç¨³å®š.html":{"url":"Swift/ABIç¨³å®šã€æ¨¡å—ç¨³å®š.html","title":"ABIç¨³å®šã€æ¨¡å—ç¨³å®š","keywords":"","body":"ä»€ä¹ˆæ˜¯ABIç¨³å®šã€æ¨¡å—ç¨³å®š ä»€ä¹ˆæ˜¯ABI åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼ŒABIï¼‰æ˜¯æŒ‡ä¸¤ç¨‹åºæ¨¡å—é—´çš„æ¥å£ï¼Œé€šå¸¸å…¶ä¸­ä¸€ä¸ªç¨‹åºæ¨¡å—ä¼šæ˜¯åº“æˆ–æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„æœåŠ¡ï¼Œè€Œå¦ä¸€è¾¹çš„æ¨¡å—åˆ™æ˜¯ç”¨æˆ·æ‰€è¿è¡Œçš„ç¨‹åºã€‚ ABI çº¦å®šäº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ€æ ·è·å–æ•°æ®ä»¥åŠæ“ä½œæ•°æ®ã€‚åº”ç”¨ç¨‹åºå°±æ˜¯é€šè¿‡è¿™äº›ABIè·Ÿç³»ç»Ÿé€šä¿¡çš„ã€‚ ABIç¨³å®š Swift 5.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œåº”ç”¨ç¨‹åºæ‰“åŒ…æ—¶ï¼Œéƒ½ä¼šå°† Swift æ ‡å‡†åº“å¯¼å…¥åˆ°äºŒè¿›åˆ¶åŒ…ä¸­ï¼ŒåŸå› æ˜¯ä¸åŒçš„ Swift ç‰ˆæœ¬ä¹‹é—´å·®å¼‚å¤§ï¼ŒABIæ¥å£ä¸å…¼å®¹ã€‚ Swift 5.0 å¼€å§‹ ABI ä»¥åŠç¨³å®šã€‚ä» 5.0 ç‰ˆæœ¬å¼€å§‹ Swift å…±ç”¨ä¸€ä¸ª ABI æ¥å£ï¼Œæ‰€ä»¥ä» 5.0 ç‰ˆæœ¬å¼€å§‹æ‰“åŒ…æ—¶å°±ä¸éœ€è¦å°† SWift åŸºç¡€åº“æ‰“è¿›äºŒè¿›åˆ¶åŒ…ä¸­ï¼Œæ­¤æ—¶iOSç³»ç»Ÿä»¥åŠåŒ…å«äº†è¿™äº›åŸºç¡€åº“ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ä¹‹ä¸€å°±æ˜¯åŒ…ä½“ç§¯å˜å°äº†ï¼Œå¯åŠ¨æ—¶é—´å˜å°‘äº†ï¼Œæ›´çœå†…å­˜äº†ã€‚ äº‹å®ä¸Šï¼Œæ‰“åŒ…æ—¶è¿˜æ˜¯ä¼šåŒ…å« Swift åŸºç¡€åº“ï¼ŒåŸå› æ˜¯åœ¨ iOS 12.2 ä¹‹å‰ä¾ç„¶éœ€è¦ Swift åŸºç¡€åº“ï¼Œä½†ä¹‹åçš„ç‰ˆæœ¬ App Store ä¼šè‡ªåŠ¨ç§»é™¤ã€‚ æ¨¡å—ç¨³å®š Swift 5.1 ä¹‹å‰ï¼Œä¸åŒçš„ç‰ˆæœ¬ç”Ÿæˆçš„ Moduleï¼ˆæ¨¡å—ï¼‰åªèƒ½åœ¨å¯¹åº”çš„ç‰ˆæœ¬ä¸Šè¿è¡Œï¼Œä¸ç„¶å°±ä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ Module compiled with Swift 5.0.1 cannot be imported by the Swift 5.1 compiler è€Œä» 5.1 ç‰ˆæœ¬å¼€å§‹ï¼Œ Module Stability å…è®¸ 5.1 ç‰ˆæœ¬æ‰“çš„ Module åœ¨ 5.1 ä¹‹åçš„ä»»æ„ç‰ˆæœ¬è¿è¡Œã€‚ å¼€å¯ Module Stability åï¼ŒFramework å¼•å…¥äº†ä¸€ä¸ªå…¨æ–°çš„æ–‡ä»¶å¤¹ .swiftmoduleï¼ŒåŒ…å« .swiftinterface å’Œ .swiftmodule æ–‡ä»¶ï¼Œswiftinterface æ–‡ä»¶ä½œä¸º swiftmodule çš„ä¸€ä¸ªè¡¥å……ï¼Œç”¨æ¥æè¿° module å…¬å¼€æ¥å£çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸å—ç¼–è¯‘å™¨ç‰ˆæœ¬é™åˆ¶ï¼Œæ—¢é€šè¿‡ swiftinterface æ–‡ä»¶å¯ä»¥å°† Swift 6 æ‰“åŒ…çš„ framework åœ¨ swift 7 ç‰ˆæœ¬ä¸‹è¿è¡Œã€‚ éœ€è¦è®¾ç½® //BUILD_LIBRARY_FOR_DISTRIBUTION //Ensures that your libraries are built for distribution. //For Swift, this enables support for library evolution and generation of a module interface file. Build Libraries for Distribution = YES å¼€å¯ Build Libraries for Distribution åç¼–è¯‘çš„æ–‡ä»¶å¦‚ä¸‹ å¦‚æœä¸å¼€å¯ Build Libraries for Distribution ï¼Œé‚£ä¹ˆç¼–è¯‘åä¼šå°‘äº† swiftinterfaceï¼Œ æ­¤æ—¶çš„ Module æ˜¯å—ç‰ˆæœ¬é™åˆ¶çš„ã€‚ ä»€ä¹ˆæ˜¯ Library Evolution å¼€å¯ Library Evolution åï¼Œä¹Ÿå°±æ˜¯Build Libraries for Distributionï¼Œå½“ä¸€ä¸ªæ¡†æ¶ä¾èµ–å¦ä¸€ä¸ªæ¡†æ¶æ—¶ï¼Œå¦‚æœå¦ä¸€ä¸ªæ¡†æ¶å‘ç”Ÿæ”¹åŠ¨ï¼Œé‚£ä¹ˆä¸éœ€è¦é‡æ–°ç¼–è¯‘ç¬¬ä¸€ä¸ªæ¡†æ¶ã€‚ä¹Ÿå°±æ˜¯æ›´æ–°ç¬¬äºŒä¸ªæ¡†æ¶ä¸éœ€è¦é‡æ–°ç¼–è¯‘ç¬¬ä¸€ä¸ªæ¡†æ¶ã€‚ç±»ä¼¼äº @frozen ? å‚è€ƒ Swift ABI ç¨³å®šå¯¹æˆ‘ä»¬åˆ°åº•æ„å‘³ç€ä»€ä¹ˆABI Stability and MoreWhat is Module Stability in Swift and why should you care? "},"Swift/as as! as?.html":{"url":"Swift/as as! as?.html","title":"as as! as?","keywords":"","body":"Swift as as! as? çš„ç†è§£ ç›®å‰å…¬å¸é¡¹ç›®ä¸­ç”¨åˆ°çš„ Swift æ¯”è¾ƒå°‘ï¼Œæ‰€ä»¥å¯¹ Swift çš„ç†è§£ä¹Ÿå¾ˆå±€é™ã€‚è¿™é‡ŒæŠŠä¸€äº›æ”¾åœ¨ç¬”è®°ä¸­çš„å†…å®¹æ•´ç†ä¸‹åˆ†äº«å‡ºæ¥ã€‚ as ç¼–è¯‘æ—¶æ£€æµ‹,æœ‰ä¸¤ä¸ªæ„æ€1ã€æŒ‡å®šæ–‡å­—è¡¨è¾¾ç±»å‹2ã€upcastï¼ˆå‘ä¸Šè½¬å‹ï¼Œè½¬æ¢æˆå…¶çˆ¶ç±»ç±»å‹ï¼‰ //æŒ‡å®š 1 çš„ç±»å‹ä¸º CGFloat ç±»å‹ï¼Œæ—¢å˜é‡ num ä¸º CGFloat ç±»å‹ let num = 1 as CGFloat // class Animal {} class Dog: Animal {} let dog = Dog() dog as Animal //æŠŠ dog è½¬æ¢ä¸º Animal ç±»å‹ï¼Œå‘ä¸Šè½¬å‹æˆåŠŸï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ // let dog: Animal = Dog() dog as Dog //ç¼–è¯‘é”™è¯¯ï¼Œæ­¤æ—¶çš„å˜é‡ dog åœ¨ç¼–è¯‘æ—¶æ˜¯ Animal ç±»å‹ï¼Œåªèƒ½å‘ä¸Šè½¬æ¢ï¼Œæ— æ³•å‘ä¸‹è½¬æ¢ã€‚ as! as? è¿è¡Œæ—¶æ£€æµ‹ï¼Œdowncastï¼ˆå‘ä¸‹è½¬å‹ï¼Œè½¬æ¢æˆå…¶å­ç±»ç±»å‹ï¼‰åªä¸è¿‡å‰è€…æ˜¯å¼ºåˆ¶è§£åŒ…ï¼Œè§£åŒ…å¤±è´¥å°±å´©æºƒåè€…æ˜¯å¯é€‰ç±»å‹ //ä¸‹é¢ä»£ç ç¼–è¯‘æ—¶å‡ä¸ä¼šæŠ¥é”™ï¼Œå› ä¸º as! å’Œ as? éƒ½æ˜¯è¿è¡Œæ—¶æ£€æŸ¥çš„ let a: Animal = Animal() a as! Dog 1 as! Dog 1 as? Dog class Dog: Animal { var name = \"Spot\" } let dog: Animal = Dog() let dog1 = dog as? Dog //å¯é€‰å€¼ let dog2 = dog as! Dog //å¼ºåˆ¶è§£å‹ dog1?.name //å¯é€‰è°ƒç”¨ dog2.name //ç›´æ¥è°ƒç”¨ æ€»ç»“ 1ã€as åœ¨ç¼–è¯‘æ—¶æ£€æµ‹ï¼Œas! as? åœ¨è¿è¡Œæ—¶æ£€æµ‹2ã€as å¯ä»¥ç”¨æ¥æŒ‡å®šæ–‡å­—è¡¨è¾¾ç±»å‹ä»¥åŠå‘ä¸Šè½¬å‹3ã€as! as? ç”¨æ¥å‘ä¸‹è½¬å‹ï¼Œas? è½¬å‹åä¸ºå¯é€‰å€¼ï¼Œas! ç›¸å½“äºåœ¨è¿™ä¸ªå¯é€‰å€¼ä¸Šå¼ºåˆ¶è§£å‹ï¼ˆå¯èƒ½ä¼šå¯¼è‡´å´©æºƒï¼‰ "},"WebRTC/WebRTC.html":{"url":"WebRTC/WebRTC.html","title":"WebRTC","keywords":"","body":"WebRTC "},"WebRTC/CritScopeé”.html":{"url":"WebRTC/CritScopeé”.html","title":"CritScopeé”","keywords":"","body":"WebRTC CritScope é” webrtc::Mutex cs_ff_ctx_; webrtc::MutexLock cs(&cs_ff_ctx_); #ç­‰ä»·äº webrtc::MutexLock *cs = new webrtc::MutexLock(&cs_ff_ctx_); csä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œnewå‡ºå¯¹è±¡æ—¶é€šè¿‡æ„é€ å‡½æ•°åŠ é”ï¼Œç­‰è¿™ä¸ªå˜é‡ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå¯¹è±¡é”€æ¯ï¼Œè°ƒç”¨ææ„å‡½æ•°å¹¶åœ¨é‡Œé¢é‡Šæ”¾é” "},"ç½‘ç»œåè®®/ç½‘ç»œåè®®.html":{"url":"ç½‘ç»œåè®®/ç½‘ç»œåè®®.html","title":"ç½‘ç»œåè®®","keywords":"","body":"ç½‘ç»œåè®® "},"ç½‘ç»œåè®®/HTTP.html":{"url":"ç½‘ç»œåè®®/HTTP.html","title":"HTTP","keywords":"","body":"HTTPåè®® HTTP å³è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHyperText Transfer Protocolï¼‰ HTTP è¿æ¥æµç¨‹ åŸŸåè§£æ å‘èµ·TCPçš„3æ¬¡æ¡æ‰‹ Webæµè§ˆå™¨å‘WebæœåŠ¡å™¨å‘é€httpè¯·æ±‚å‘½ä»¤ Webæµè§ˆå™¨å‘é€httpè¯·æ±‚å¤´ä¿¡æ¯ WebæœåŠ¡å™¨åº”ç­” WebæœåŠ¡å™¨å‘é€åº”ç­”å¤´ä¿¡æ¯ WebæœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€æ•°æ® WebæœåŠ¡å™¨å…³é—­TCPè¿æ¥ TCPè¿æ¥åœ¨å‘é€åå°†ä»ç„¶ä¿æŒæ‰“å¼€çŠ¶æ€ï¼Œæµè§ˆå™¨å¯ä»¥ç»§ç»­é€šè¿‡ç›¸åŒçš„è¿æ¥å‘é€è¯·æ±‚ã€‚ä¿æŒè¿æ¥èŠ‚çœäº†ä¸ºæ¯ä¸ªè¯·æ±‚å»ºç«‹æ–°è¿æ¥æ‰€éœ€çš„æ—¶é—´ï¼Œè¿˜èŠ‚çº¦äº†ç½‘ç»œå¸¦å®½ã€‚ HTTPå­˜åœ¨çš„é—®é¢˜ çªƒå¬é£é™© ç¯¡æ”¹é£é™© å†’å……é£é™© HTTPå„ç‰ˆæœ¬åŒºåˆ« HTTP1.x ç‰ˆæœ¬æ•°æ®ä¼ è¾“æ˜¯é€šè¿‡å¤šä¸ªTCPå®ç°çš„ï¼ŒåŒæ—¶æœ€å¤šå¼€å¯çš„TCPå¯ä»¥è¾¾åˆ°6~8ä¸ª 1.0 æ— æ³•é•¿è¿æ¥ï¼Œè¯·æ±‚å®Œæ•°æ®ç«‹å³æ–­å¼€TCP 1.1 å¼•å…¥äº†é•¿è¿æ¥ï¼ŒTCPå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ŒåŒä¸€ä¸ªTCPé‡Œé¢å¯ä»¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œä½†æœåŠ¡å™¨è¿˜æ˜¯é¡ºåºæ‰§è¡Œï¼Œå¯èƒ½ä¼šå‡ºç°â€œé˜Ÿå¤´é˜»å¡â€ HTTP1.1 é—ç•™é—®é¢˜ï¼š 1ã€å¤´éƒ¨æ²¡æœ‰å‹ç¼©å°±å‘é€ï¼Œæ•°æ®é‡å¤§ã€‚å¤šä¸ªè¯·æ±‚çš„å¤´éƒ¨æ˜¯ä¸€æ ·çš„ 2ã€æœåŠ¡å™¨æ˜¯æŒ‰ç…§è¯·æ±‚çš„é¡ºåºå“åº”çš„ï¼Œä¼šå‡ºç°â€œé˜Ÿå¤´é˜»å¡â€ 3ã€æ²¡æœ‰è¯·æ±‚ä¼˜å…ˆçº§æ§åˆ¶ 4ã€æœåŠ¡å™¨æ— æ³•ä¸»åŠ¨ä¸‹å‘æ•°æ® 2.0 äºŒè¿›åˆ¶æ ¼å¼ å¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸ºå¸§(frame)ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚ æ•°æ®æµ æ¯ä¸ªæ•°æ®æµéƒ½æ ‡è®°ç€ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ï¼Œå…¶ä¸­è§„å®šå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æµç¼–å·ä¸ºå¥‡æ•°ï¼Œ æœåŠ¡å™¨å‘å‡ºçš„æ•°æ®æµç¼–å·ä¸ºå¶æ•°ã€‚ ä¼˜å…ˆçº§ å®¢æˆ·ç«¯è¿˜å¯ä»¥æŒ‡å®šæ•°æ®æµçš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§é«˜çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±å…ˆå“åº”è¯¥è¯·æ±‚ã€‚ å¤šè·¯å¤ç”¨ä¸€ä¸ªè¿æ¥ä¸­å¹¶å‘å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œè€Œä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ã€‚ å¤´éƒ¨å‹ç¼©åŒæ—¶å‘å‡ºå¤šä¸ªè¯·æ±‚ï¼Œä»–ä»¬çš„å¤´æ˜¯ä¸€æ ·çš„æˆ–æ˜¯ç›¸ä¼¼çš„ï¼Œé‚£ä¹ˆï¼Œåè®®ä¼šå¸®ä½ æ¶ˆé™¤é‡å¤çš„éƒ¨åˆ†ã€‚ æœåŠ¡å™¨æ¨é€è¯·æ±‚ HTML çš„æ—¶å€™ï¼Œå°±æå‰æŠŠå¯èƒ½ä¼šç”¨åˆ°çš„ JSã€CSS æ–‡ä»¶ç­‰é™æ€èµ„æºä¸»åŠ¨å‘ç»™å®¢æˆ·ç«¯ï¼Œå‡å°‘å»¶æ—¶çš„ç­‰å¾… é—ç•™é—®é¢˜ï¼š 1.x æ˜¯é€šè¿‡å¤šä¸ªTCPä¼ è¾“æ•°æ®çš„ï¼Œ2.0 æ”¹ä¸ºå•ä¸ªTCPä¼ è¾“æ•°æ®ï¼Œå½“ä¸€ä¸ªTCPä¸¢åŒ…éœ€è¦é‡å‘æ—¶ï¼Œä¼šé˜»å¡HTTPè¯·æ±‚ 3.0 å°† TCP æ”¹ä¸º UDP HTTPS HTTPS = HTTP + SSL/TLS æ”¹å–„ ä¿¡æ¯åŠ å¯†æ··åˆåŠ å¯†çš„æ–¹å¼å®ç°ä¿¡æ¯çš„æœºå¯†æ€§ï¼Œè§£å†³äº†çªƒå¬çš„é£é™©ã€‚ æ ¡éªŒæœºåˆ¶æ‘˜è¦ç®—æ³•çš„æ–¹å¼æ¥å®ç°å®Œæ•´æ€§ï¼Œå®ƒèƒ½å¤Ÿä¸ºæ•°æ®ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„ã€ŒæŒ‡çº¹ã€ï¼ŒæŒ‡çº¹ç”¨äºæ ¡éªŒæ•°æ®çš„å®Œæ•´æ€§ï¼Œè§£å†³äº†ç¯¡æ”¹çš„é£é™©ã€‚ èº«ä»½è¯ä¹¦å°†æœåŠ¡å™¨å…¬é’¥æ”¾å…¥åˆ°æ•°å­—è¯ä¹¦ä¸­ï¼Œè§£å†³äº†å†’å……çš„é£é™©ã€‚ æ¦‚å¿µ HTTS é‡‡ç”¨æ··åˆåŠ å¯†æ–¹å¼ï¼ˆéå¯¹ç§°åŠ å¯† + å¯¹ç§°åŠ å¯†ï¼‰ï¼Œå»ºç«‹è¿æ¥æ—¶ä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œå»ºç«‹è¿æ¥åä½¿ç”¨å¯¹ç§°åŠ å¯†ã€‚ éå¯¹ç§°åŠ å¯† æ‹¥æœ‰ä¸¤ä¸ªå¯†é’¥ï¼Œå…¬é’¥å’Œç§é’¥ã€‚å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ï¼Œåè¿‡æ¥ï¼Œç§é’¥åŠ å¯†ï¼Œå…¬é’¥è§£å¯†ã€‚ç‰¹æ€§ï¼šåŠ è§£å¯†æ…¢ï¼ˆä½¿ç”¨äº†å¤§é‡çš„ä¹˜é™¤æ³•ï¼‰ã€‚é€‚ç”¨äºä¸€å¯¹å¤šé€šä¿¡ã€‚å®‰å…¨æ€§é«˜ï¼Œç§é’¥æ˜¯ä¿å¯†çš„ã€‚ å¯¹ç§°åŠ å¯† åŠ å¯†å’Œè§£å¯†ä½¿ç”¨åŒä¸€ä¸ªç§˜é’¥ ç‰¹æ€§ï¼šåŠ è§£å¯†å¿«ï¼ˆåªä½¿ç”¨äº†ä½ç§»æ“ä½œï¼‰ã€‚é€‚ç”¨äºä¸€å¯¹ä¸€é€šä¿¡ã€‚ç§˜é’¥éš¾åˆ†å‘ï¼Œéš¾ç®¡ç†ã€‚ æ•°å­—æ‘˜è¦ï¼ˆæ‘˜è¦ç®—æ³•ã€å“ˆå¸Œç®—æ³•ã€æ•£åˆ—ç®—æ³•ï¼‰ é‡‡ç”¨å•å‘Hashå‡½æ•°ç”Ÿæˆä¸€ä¸ªä¸å¯é€†çš„â€œæ‘˜è¦â€ã€‚å¸¸ç”¨çš„æ•°å­—æ‘˜è¦ç®—æ³•ï¼šMD5ã€SHA-1ã€SHA-2ç‰¹ç‚¹ï¼šå•å‘ï¼Œä¸å¯é€† æ•°å­—æ‘˜è¦ä¿è¯äº†æ•°æ®çš„å”¯ä¸€æ€§ï¼Œç›¸åŒçš„æ–‡æœ¬å¾—åˆ°çš„â€œæ‘˜è¦â€ä¸€å®šç›¸ç­‰ï¼Œä¸ç›¸ç­‰çš„æ–‡æœ¬å¾—åˆ°çš„â€œæ‘˜è¦â€æå°æ¦‚ç‡ç›¸ç­‰ï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ æ•°å­—ç­¾å å¯¹ æ˜æ–‡ + æ•°å­—æ‘˜è¦ è¿›è¡ŒåŠ å¯†ï¼Œå¾—åˆ°çš„å°±æ˜¯æ•°å­—ç­¾å æ•°å­—ç­¾åä¿è¯äº†æ•°æ®çš„å®Œæ•´æ€§ æ•°å­—è¯ä¹¦ æ•°å­—ç­¾åç”¨CAï¼ˆæƒå¨çš„è®¤è¯æœºæ„ï¼‰çš„ç§é’¥åŠ å¯†ï¼Œå¾—åˆ°æ•°å­—è¯ä¹¦ æ•°å­—è¯ä¹¦ä¿è¯å’Œæ•°æ®çš„å®‰å…¨æ€§ è¯ä¹¦è®¤è¯æµç¨‹ è¯ä¹¦è§£ææµç¨‹ è¿æ¥æµç¨‹ å‚è€ƒæ–‡ç«  https://www.toutiao.com/a6802216564595622408 "},"ç½‘ç»œåè®®/TCP.html":{"url":"ç½‘ç»œåè®®/TCP.html","title":"TCP","keywords":"","body":"TCPåè®® TCP å…¨ç§°ä¼ è¾“æ§åˆ¶åè®®ï¼ˆTransmission Control Protocolï¼‰ï¼Œæ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„ä¼ è¾“å±‚é€šä¿¡åè®® æ¦‚å¿µ åœæ­¢ç­‰å¾…åè®® A æ¯å‘ä¸€ä¸ªåŒ…ç»™ Bï¼Œéƒ½å¿…é¡»æ”¶åˆ° B çš„ç¡®è®¤ï¼ˆACKï¼‰ ï¼Œåœ¨è§„å®šçš„æ—¶é—´å†… A æ²¡æœ‰æ”¶åˆ° ACK åŒ…ï¼Œåˆ™é‡ä¼ ã€‚ åœæ­¢ç­‰å¾…åè®®æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ B æ”¶åˆ°äº† A çš„åŒ…ï¼Œä½†æ˜¯è¿”å›çš„ ACK åŒ…ä¸¢å¤±äº†ï¼Œæ­¤æ—¶ä¾ç„¶ä¼šè§¦å‘ A é‡ä¼  ç´¯è®¡ç¡®è®¤(ç´¯è®¡åº”ç­”) AåŒæ—¶å‘é€5ä¸ªæ•°æ®åŒ…ï¼Œå¹¶ç»™è¿™5ä¸ªæ•°æ®åŒ…åºå·ï¼ˆseqï¼‰ï¼ˆ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼‰ï¼ŒBå†æ”¶åˆ°æ•°æ®åŒ…åå†è¿”å›çš„ ACK åŒ…ä¸­è¿”å›ç¡®è®¤å·(ack)ï¼Œè¡¨ç¤ºå½“å‰æœªæ”¶åˆ°çš„æœ€å°ç¼–å·ã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±å¯ä»¥å¤„ç†åœæ­¢ç­‰å¾…åè®®å¸¦æ¥çš„é—®é¢˜ã€‚ å¦‚æœBé¡ºåºæ”¶åˆ°1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ç¼–å·çš„åŒ…ï¼Œé‚£ä¹ˆè¿”å›çš„ackå·åˆ†åˆ«ä¸º2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œ6 å¦‚æœBé¡ºåºæ”¶åˆ°3ï¼Œ5ï¼Œ1ï¼Œ4ï¼Œ2ç¼–å·çš„åŒ…ï¼Œé‚£ä¹ˆè¿”å›çš„ackå·åˆ†åˆ«ä¸º1ï¼Œ1ï¼Œ2ï¼Œ2ï¼Œ6 å‡å¦‚3æ•°æ®åŒ…å‘é€æ—¶ä¸¢åŒ…äº† å¦‚æœBé¡ºåºæ”¶åˆ°1ï¼Œ2ï¼Œ4ï¼Œ5ç¼–å·çš„åŒ…ï¼Œé‚£ä¹ˆè¿”å›çš„ackå·åˆ†åˆ«ä¸º2ï¼Œ3ï¼Œ3ï¼Œ3 å¦‚æœBé¡ºåºæ”¶åˆ°4ï¼Œ5ï¼Œ1ï¼Œ2ç¼–å·çš„åŒ…ï¼Œé‚£ä¹ˆè¿”å›çš„ackå·åˆ†åˆ«ä¸º1ï¼Œ1ï¼Œ2ï¼Œ3 æµé‡æ§åˆ¶ æ¯ä¸ªè®¡ç®—æœºå¤„ç†èƒ½åŠ›ä¸ä¸€æ ·ï¼Œå¦‚æœå‘é€å¤ªå¿«ï¼Œæ¥å—å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ Aã€B åœ¨æ¯ä¸ªæ•°æ®åŒ…ä¸­åŠ ä¸Šä¸€ä¸ªå€¼ï¼Œå«çª—å£å¤§å°ï¼ˆwin)ï¼Œè¡¨ç¤ºæ¥æ”¶èƒ½åŠ› æ‹¥å¡æ§åˆ¶ ç½‘ç»œå¾ˆå·®æ—¶ï¼Œé€ æˆäº†ç½‘ç»œæ‹¥å¡ï¼Œå‡è®¾æ‹¥å¡çª—å£çš„å¤§å°ä¸ºcwndï¼Œæµé‡æ§åˆ¶çš„æ»‘åŠ¨çª—å£çš„å¤§å°ä¸ºrwndï¼Œ é‚£ä¹ˆçª—å£å¤§å° = min(cwnd, rwnd)ã€‚ æ…¢å¯åŠ¨ å¦‚ä½•çŸ¥é“æ‹¥å¡çª—å£çš„å¤§å°å‘¢ï¼Ÿå¯ä»¥é‡‡ç”¨è¯•æ¢æ³•ï¼Œå…ˆå‘çª—å£å¤§å°ä¸º1çš„åŒ…ï¼Œå¦‚æœä¸ä¸¢åŒ…ï¼Œå°±å‘é€çª—å£ä¸º2ã€4ã€8çš„åŒ…ï¼Œç›´åˆ°å‡ºç°ä¸¢åŒ…ï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„æ‹¥å¡çª—å£ã€‚ æ»‘åŠ¨çª—å£ å‘é€ä¸€ä¸ªæ•°æ®åŒ…è¿‡å»ï¼Œä¸éœ€è¦ç­‰å¾…æ•°æ®åŒ…å›æ¥å†å‘é€ æ‹¥å¡æœºåˆ¶ ä¸€æ—¦å‡ºç°ä¸¢åŒ…ï¼Œå°±ä¼šè§¦å‘æ‹¥å¡æœºåˆ¶ï¼ˆæ…¢å¯åŠ¨ã€æ‹¥å¡è§„é¿ã€å¿«é€Ÿå¯åŠ¨ã€å¿«é€Ÿæ¢å¤ï¼‰ TCPä¸‰æ¬¡æ¡æ‰‹ å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼ŒåŒéƒ¨ä½SYN=1ï¼Œåˆå§‹åºåˆ—å·seq=xï¼Œæ­¤æ—¶å®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº†SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼Œç¡®è®¤æŠ¥æ–‡ä¸­ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯ack=x+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· seq=yï¼Œæ­¤æ—¶æœåŠ¡å™¨è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æŠ¥æ–‡åï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼Œack=y+1ï¼Œè‡ªå·±çš„åºåˆ—å·seq=x+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚ å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ ESTABLISHED çŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡ 1ã€é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡çªç„¶åˆä¼ é€åˆ°äº†æœåŠ¡å™¨ï¼Œä»è€Œäº§ç”Ÿé”™è¯¯ï¼Œä¸¤æ¬¡æ¡æ‰‹ä¼šä½¿å¾—å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å†æ¬¡å»ºç«‹è¿æ¥ï¼Œå¯¼è‡´ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚2ã€å…¶å®ä¹Ÿå¯ä»¥è¯´æ˜¯å››æ¬¡ï¼Œåªæ˜¯ä¸­é—´ä¸¤æ¬¡åˆå¹¶æˆä¸€æ¬¡å‘é€äº†ã€‚ç†ç”±æ˜¯TCPä¸å…è®¸åŠè¿æ¥çŠ¶æ€ä¸‹ä¼ è¾“æ•°æ®ã€‚ SYNæ”»å‡» å®¢æˆ·ç«¯åœ¨çŸ­æ—¶é—´å†…ä¼ªé€ äº†å¤§é‡çš„IPè¿›è¡Œè¿æ¥ï¼ŒæœåŠ¡å™¨å›å¤å“åº”åŒ…ï¼Œä½†æ˜¯æºåœ°å€æ˜¯ä¸å­˜åœ¨çš„ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä¼šä¸æ–­çš„é‡å‘ï¼Œç›´åˆ°é‡å‘è¶…æ—¶ã€‚è¿™äº›ä¼ªé€ çš„SYNåŒ…å°†é•¿æ—¶é—´å ç”¨æœªè¿æ¥é˜Ÿåˆ—ï¼Œå½±å“äº†æ­£å¸¸çš„SYNï¼Œç›®æ ‡ç³»ç»Ÿè¿è¡Œç¼“æ…¢ï¼Œä¸¥é‡è€…å¼•èµ·ç½‘ç»œå µå¡ç”šè‡³ç³»ç»Ÿç˜«ç—ªã€‚ éƒ¨åˆ†è§£å†³æ–¹æ¡ˆï¼š 1ã€å»¶è¿ŸTCBåˆ†é…æ–¹æ³•ï¼Œç¼“å­˜åŠè¿æ¥çŠ¶æ€ä¿¡æ¯ï¼Œå»ºç«‹è¿æ¥ååœ¨åˆ†é… 2ã€å¢åŠ æœ€å¤§åŠè¿æ¥æ•° 3ã€ç¼©çŸ­è¶…æ—¶æ—¶é—´ å››æ¬¡æŒ¥æ‰‹ å®¢æˆ·ç«¯å‘å‡ºæ–­å¼€è¿æ¥æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚FIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚è¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚ æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wã€‚æœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚å¿…é¡»ç»è¿‡2*MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚ æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚æœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚ ä¸ºä»€ä¹ˆè¦ TIME_WAITï¼Œç­‰å¾…2ä¸ªMSLåæ‰å…³é—­TCP ï¼ˆ2ä¸ªMSL(Max Segment Lifetimeï¼Œçº¦240ç§’)ï¼‰ é˜²æ­¢ä¸Šä¸€æ¬¡è¿æ¥ä¸­çš„åŒ…ï¼Œé‡æ–°å‡ºç°ï¼Œå½±å“æ–°è¿æ¥ï¼ˆç»è¿‡2MSLï¼Œä¸Šä¸€æ¬¡è¿æ¥ä¸­æ‰€æœ‰çš„é‡å¤åŒ…éƒ½ä¼šæ¶ˆå¤±ï¼‰ å‘é€çš„æœ€åä¸€ä¸ªack(fin) ï¼Œæœ‰å¯èƒ½ä¸¢å¤±ï¼Œè¿™æ—¶è¢«åŠ¨æ–¹ä¼šé‡æ–°å‘finã€‚ ä¸ºä»€ä¹ˆæ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œå››æ¬¡æŒ¥æ‰‹ï¼Ÿå…³é—­ä¸€å®šæ˜¯å››æ¬¡å—ï¼Ÿ è¿æ¥ä¸‰æ¬¡æ˜¯å› ä¸ºä¸­é—´ä¸¤æ¬¡åˆå¹¶æˆä¸€æ¬¡äº† TCPæ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡å‘é€FINæŠ¥æ–‡ï¼Œåªè¡¨ç¤ºä¸ä¼šå†è¯·æ±‚æ•°æ®ï¼Œä½†æ­¤æ—¶æœåŠ¡å™¨è¿˜å¯èƒ½éœ€è¦ç»§ç»­å‘é€æ•°æ®ï¼Œç­‰æœåŠ¡å™¨æ•°æ®å‘é€å®Œï¼ŒæœåŠ¡å™¨æ‰ä¼šå‘é€FINæŠ¥æ–‡ã€‚ å¦‚æœä¸€ç«¯å‘é€FINæŠ¥æ–‡åï¼Œå¦ä¸€ç«¯ä¸å†éœ€è¦ä¼ è¾“æ•°æ®ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡æŒ¥æ‰‹çš„ACKæŠ¥æ–‡ä¼šå’Œç¬¬ä¸‰æ¬¡æŒ¥æ‰‹çš„FINæŠ¥æ–‡åˆå¹¶å‘é€è¿‡å»ï¼Œæ­¤æ—¶å…³é—­è¿æ¥åªéœ€è¦ä¸‰æ¬¡æŒ¥æ‰‹ã€‚ å®¢æˆ·ç«¯çªç„¶å‡ºç°æ•…éšœæ€ä¹ˆå¤„ç† æœåŠ¡å™¨æ¯æ”¶åˆ°ä¸€æ¬¡å®¢æˆ·ç«¯çš„è¯·æ±‚åéƒ½ä¼šé‡æ–°å¤ä½ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæ—¶é—´é€šå¸¸æ˜¯è®¾ç½®ä¸º2å°æ—¶ï¼Œè‹¥ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·ç«¯çš„ä»»ä½•æ•°æ®ï¼ŒæœåŠ¡å™¨å°±ä¼šå‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œä»¥åæ¯éš”75ç§’å‘é€ä¸€æ¬¡ã€‚è‹¥ä¸€è¿å‘é€10ä¸ªæ¢æµ‹æŠ¥æ–‡ä»ç„¶æ²¡ååº”ï¼ŒæœåŠ¡å™¨å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œæ¥ç€å°±å…³é—­è¿æ¥ã€‚ TCP æŠ¥æ–‡æ ¼å¼ TCPæ˜¯æ€ä¹ˆä¿è¯æ•°æ®å¯é æ€§ä¼ è¾“çš„ åºåˆ—å·å’Œç¡®è®¤åº”ç­”ä¿¡å· è¶…æ—¶é‡å‘æ§åˆ¶ æ•°æ®æ ¡éªŒ è¿æ¥ç®¡ç† ç²˜åŒ…ã€æ‹†åŒ… æŠ¥æ–‡å¤ªçŸ­ï¼Œéœ€è¦åˆå¹¶åå‘é€ï¼ŒæŠ¥æ–‡å¤ªé•¿ï¼Œéœ€è¦åˆ†å¼€å‘é€ è§£å†³æ–¹æ¡ˆ æŒ‡æ˜æ•°æ®åŒ…é•¿åº¦ ç»“å°¾åŠ å…¥ç‰¹æ®Šå­—ç¬¦'\\n'ä¹‹ç±»çš„ å‚è€ƒæ–‡ç«  https://www.cnblogs.com/xiaolincoding/p/12732052.htmlhttps://www.toutiao.com/i6862639863104012814https://www.toutiao.com/i6893802302663033355https://mp.weixin.qq.com/s/Uf42QEL6WUSHOwJ403FwOA "},"ç½‘ç»œåè®®/KCP.html":{"url":"ç½‘ç»œåè®®/KCP.html","title":"KCP","keywords":"","body":"KCP åè®® ä»€ä¹ˆæ˜¯ KCP æˆ‘ä»¬çŸ¥é“ UDP æ˜¯ä¸å¯é ä¼ è¾“ï¼Œ è€Œ TCP æ˜¯å¯é ä¼ è¾“ï¼Œä½† TCP æœ¬èº«ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œä¾‹å¦‚ï¼š è¿ç»­ä¸¢åŒ…è¶…æ—¶ç­–ç•¥ï¼Œè¿ç»­ä¸¢åŒ…çš„RTO = RTO * 2ï¼Œè¿™ä¸ªå‚æ•°å¥½åƒæ— æ³•æ”¹åŠ¨ ï¼› ä¸¢åŒ…é‡ä¼ ç­–ç•¥ï¼Œåœ¨æ²¡æœ‰ SACK ä¹‹å‰ï¼ŒTCPåœ¨æ”¶åˆ°3ä¸ªç›¸åŒçš„ ack æ—¶ï¼Œæ‰ä¼šè§¦å‘ä¸¢åŒ…é‡ä¼ ç­–ç•¥ï¼Œå¹¶ä¸”ä¼šå°†åé¢æ‰€æœ‰çš„åŒ…å…¨éƒ¨é‡ä¼ ï¼ˆæœ‰äº›åŒ…å…¶å®å·²ç»æ”¶åˆ°äº†ï¼‰ï¼› é€€æµæ§åˆ¶ç­–ç•¥ï¼Œ ä¸ºäº†ä¿è¯ç½‘ç»œä¼ è¾“æ•ˆç‡ï¼ŒTCPæœ‰å‘é€çª—å£ã€æ¥æ”¶çª—å£ã€æ…¢å¯åŠ¨ã€ä¸¢åŒ…é€€è®©ç­–ç•¥ï¼Œè¿™æ ·ä½¿å¾—æ•°æ®ä¼ è¾“åœ¨ä¸€å®šç¨‹åº¦ä¸Šè¢«é˜»å¡äº†ï¼› å»¶æ—¶ack ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ é‚£é™¤äº† TCP ä»¥å¤–è¿˜æœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥å®ç°å¯é æ€§ä¼ è¾“å‘¢ï¼Ÿå°±æ˜¯ KCP ï¼ŒKCP æœ¬èº«åªæ˜¯ä¸€ä¸ªç®—æ³•å®ç°ï¼Œå¹³å°æ— å…³ï¼Œå¹¶æ²¡æœ‰æŒ‡å®šä¼ è¾“åè®®ï¼Œæ‰€ä»¥é€šè¿‡ KCP + UDP å°±å¯ä»¥å®ç°è·Ÿ TCP ä¸€æ ·çš„å¯é æ€§ä¼ è¾“ï¼› KCP åè®®å¤´ 0 4 5 6 8 (BYTE) +-----------------+-----+-----+----------+ 0 | conv | cmd | frg | wnd | +-----------------+-----+-----+----------+ 8 | ts | sn | +-----------------+----------------------+ 16 | una | len | +-----------------+----------------------+ 24 | | | DATA (optional) | | | +----------------------------------------+ conv è¿æ¥å·ï¼Œç”¨äºè¡¨ç¤ºå±äºå“ªä¸ªè¿æ¥ cmd å‘½ä»¤ç±»å‹ const IUINT32 IKCP_CMD_PUSH = 81; // cmd: push data const IUINT32 IKCP_CMD_ACK = 82; // cmd: ack const IUINT32 IKCP_CMD_WASK = 83; // cmd: window probe (ask) è¯·æ±‚å‘ŠçŸ¥çª—å£å¤§å° const IUINT32 IKCP_CMD_WINS = 84; // cmd: window size (tell) å‘ŠçŸ¥çª—å£å¤§å° frg åˆ†ç‰‡ï¼Œç›¸å½“äº TCP çš„æ‹†åŒ… wnd çª—å£å¤§å° ts æ—¶é—´æˆ³ï¼Œè®¡ç®—æ•°æ®åŒ…å¾€è¿”æ—¶é—´ï¼Ÿ sn å½“å‰åŒ…çš„åºåˆ—å· una ä¸‹ä¸€ä¸ªå¯æ¥æ”¶çš„åºåˆ—å·ï¼Œç›¸å½“äº TCP çš„ ACK len åŒ…é•¿åº¦ éƒ¨åˆ†ä»£ç  åˆ›å»º KCP å¯¹è±¡ /* conv ï¼šè¡¨ç¤ºä¼šè¯ç¼–å· user ï¼šå›è°ƒ */ ikcpcb* ikcp_create(IUINT32 conv, void *user) æ¨¡å¼é…ç½® /* nodelay ï¼šæ˜¯å¦å¯ç”¨ä¸å»¶è¿Ÿackæ¨¡å¼ï¼Œ0ï¼šä¸å¯ç”¨ï¼Œ1ï¼šå¯ç”¨ interval ï¼šåè®®å·¥ä½œé—´éš”ï¼Œ40ms resend ï¼šå¿«é€Ÿé‡ä¼ ï¼Œ0ï¼šå…³é—­ï¼Œ2ï¼šæ”¶åˆ° 2æ¬¡ ACK åˆ™ç›´æ¥é‡ä¼  nc ï¼šé€€æµæ§åˆ¶ï¼Œ0ï¼šä¸å…³é—­ï¼Œ1ï¼šå…³é—­ */ int ikcp_nodelay(ikcpcb *kcp, int nodelay, int interval, int resend, int nc) åˆ†ç‰‡åŒ…å›è°ƒ // å‘é€æ•°æ®åŒ…å›è°ƒï¼Œè¿™é‡Œé¢çš„åŒ…å°±æ˜¯å·²ç»åˆ†ç‰‡çš„äº†ï¼›ä¸€èˆ¬äº¤ç»™ UDP å‘é€ int c_udp_output(const char * buf, int len, ikcpcb * kcp, void * user) æ›´æ–°çŠ¶æ€ çŠ¶æ€æ›´æ–°æ˜¯ç”±å¤–éƒ¨å®ç°çš„ï¼Œåœ¨åˆé€‚çš„æ—¶æœºè§¦å‘ï¼ŒåŒæ—¶éœ€è¦ä¸€ä¸ªå®šæ—¶å™¨è§¦å‘ //current è¡¨ç¤ºæ—¶é—´æˆ³ void ikcp_update(ikcpcb *kcp, IUINT32 current) å‘é€æ•°æ® ç”¨æˆ·å‘é€æ•°æ®åŒ…ï¼Œæ–¹æ³•å†…ä¼šå°†æ•°æ®åˆ†ç‰‡ï¼Œå­˜å…¥å¾…å‘é€é˜Ÿåˆ—ä¸­ int ikcp_send(ikcpcb *kcp, const char *buffer, int len) æ¥æ”¶æ•°æ® æ‰€æœ‰ä»UDPä¼ å›æ¥çš„æ•°æ® int ikcp_input(ikcpcb *kcp, const char *data, long size) è¿”å›ç”¨æˆ·éœ€è¦çš„æ•°æ®åŒ… int ikcp_recv(ikcpcb *kcp, char *buffer, int len) å‘é€æµç¨‹ è°ƒç”¨ ikcp_sendï¼Œåˆ†ç‰‡ï¼Œå¹¶å°†åˆ†ç‰‡åçš„æ•°æ®å­˜å…¥å¾…å‘é€é˜Ÿåˆ— snd_queue ç­‰å¾…çŠ¶æ€æ›´æ–° ikcp_updateï¼Œè¿™ä¸ªé—´éš”å°±æ˜¯åˆå§‹åŒ–æ—¶çš„é—´éš” é—´éš”åˆ°æ¥æ—¶ï¼Œè°ƒç”¨ ikcp_flush ï¼Œå†…éƒ¨ä¼šå°†å¾…å‘é€é˜Ÿåˆ—çš„æ•°æ®ç§»åŠ¨åˆ°å‘é€é˜Ÿåˆ—ï¼ˆsnd_bufï¼‰ä¸­ï¼Œæœ‰çª—å£å¤§å°é™åˆ¶ï¼Œç„¶åå°†å‘é€é˜Ÿåˆ—ä¸­çš„æ•°æ®å…¨éƒ¨è°ƒç”¨åˆå§‹åŒ–æ—¶è®¾ç½®çš„å›è°ƒå‡½æ•° c_udp_output ï¼Œä¹Ÿå°±æ˜¯äº¤ç»™ UDP å¤„ç† æ¥æ”¶æµç¨‹ UDP æ¥æ”¶åˆ°æ•°æ®åŒ… è°ƒç”¨ ikcp_input è§£ææ•°æ®åŒ…ï¼Œæ›´æ–°æ¥æ”¶çª—å£å¤§å°ï¼Œæ›´æ–° unaï¼Œæ ¹æ®unaï¼Œåˆ é™¤ snd_buf ä¸­å·²ç¡®è®¤åˆ†ç‰‡ï¼Œå°† sn + ts å­˜æ”¾åœ¨ acklist ä¸­ï¼›åˆ¤æ–­æ˜¯å¦éœ€è¦é‡ä¼ ï¼Œæ˜¯å¦éœ€è¦æ›´æ–°å‘é€çª—å£ï¼› è°ƒç”¨ ikcp_parse_data æ–¹æ³•ï¼Œå°†åŒ…å­˜æ”¾åœ¨ rcv_buf ä¸­ï¼Œå¹¶å°† rcv_buf ä¸­å®Œæ•´çš„æ•°æ®ç§»åŠ¨åˆ° rcv_queue ä¸­ è°ƒç”¨ ikcp_recv åˆåŒ…ï¼Œå¹¶å°†å®Œæ•´çš„åŒ…å–å‡ºæ¥ï¼Œè¿”å›ç»™ä¸Šå±‚ä¸šåŠ¡ rcv_buf æ˜¯ä¸è¿ç»­çš„ï¼Œrcv_queue çš„æ•°æ®æ˜¯è¿ç»­çš„ KCPç‰¹ç‚¹ è¿ç»­è¶…æ—¶RTO = RTO * 1.5 ackå¯ä»¥è®¾ç½®æˆæ— å»¶è¿Ÿçš„ å¯ä»¥è®¾ç½®å¿«é€Ÿé‡ä¼ æ¨¡å¼ é€‰æ‹©é‡ä¼  å¯ä»¥é…ç½®éé€€æµæ§åˆ¶ æ€»ç»“ KCP è‡ªå·±å®ç°äº† ARQ åè®®ï¼›ç›¸å½“äºä¸€ä¸ªå®šåˆ¶åŒ–çš„ TCPï¼Œå¼±ç½‘ä¸‹ä¼ è¾“é€Ÿåº¦æ›´å¿«ï¼Œæµé‡æ¢æ—¶é—´ï¼›ä¹Ÿè·Ÿ HTTP3.0 çš„å®ç°æ–¹å¼å¾ˆç›¸ä¼¼ã€‚ "},"ç½‘ç»œåè®®/Socket.html":{"url":"ç½‘ç»œåè®®/Socket.html","title":"Socket","keywords":"","body":"Socket ç½‘ç»œä¸­ä¸åŒä¸»æœºä¸Šçš„åº”ç”¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒåŒå‘é€šä¿¡çš„ç«¯ç‚¹çš„æŠ½è±¡ã€‚Socket æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªåè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£ã€‚å®ƒå·¥ä½œåœ¨ OSI æ¨¡å‹ä¼šè¯å±‚ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç›´æ¥ä½¿ç”¨æ›´åº•å±‚åè®®ï¼ˆä¸€èˆ¬æ˜¯ TCP æˆ– UDP ï¼‰è€Œå­˜åœ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Socket æ˜¯å¯¹ TCP/IP åè®®çš„å°è£…ã€‚ Socket è¿æ¥æµç¨‹ åˆ›å»º Socket çš„æ—¶å€™ï¼Œå¯ä»¥æŒ‡å®šç½‘ç»œå±‚ä½¿ç”¨çš„æ˜¯ IPv4 è¿˜æ˜¯ IPv6ï¼Œä¼ è¾“å±‚ä½¿ç”¨çš„æ˜¯ TCP è¿˜æ˜¯ UDPã€‚ TCPæ–¹å¼ æœåŠ¡å™¨ åˆ›å»ºå¥—æ¥å­—ï¼ˆsocketï¼‰ å°†å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªæœ¬åœ°åœ°å€å’Œç«¯å£ä¸Šï¼ˆbindï¼‰ å½“å†…æ ¸æ”¶åˆ°TCPæŠ¥æ–‡ï¼Œä¼šé€šè¿‡ç«¯å£å·æ‰¾åˆ°å¯¹åº”çš„Socket å°†å¥—æ¥å­—è®¾ä¸ºç›‘å¬æ¨¡å¼ï¼Œå‡†å¤‡æ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆlistenï¼‰ ç­‰å¾…å®¢æˆ·è¯·æ±‚åˆ°æ¥ï¼Œå½“è¯·æ±‚åˆ°æ¥åï¼Œæ¥æ”¶è¿æ¥è¯·æ±‚ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹åº”äºæ­¤æ¬¡è¿æ¥çš„å¥—æ¥å­—ï¼ˆacceptï¼‰ ç›‘å¬ Socket å’ŒçœŸæ­£ç”¨æ¥ä¼ æ•°æ®çš„ Socket æ˜¯ä¸¤ä¸ªï¼Œç›‘å¬ Socket ä»¥åŠ å·²è¿æ¥ Socket ç”¨è¿”å›çš„å¥—æ¥å­—å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼ˆsend/recvï¼‰ è¿”å›ï¼Œç­‰å¾…å¦ä¸€å®¢æˆ·è¯·æ±‚ å…³é—­å¥—æ¥å­— åœ¨ TCP è¿æ¥æ—¶ï¼Œå†…æ ¸ä¸ºæ¯ä¸ª Socket ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ— TCP åŠè¿æ¥é˜Ÿåˆ—ï¼Œè¿˜æ²¡å®Œå…¨å»ºç«‹è¿æ¥çš„é˜Ÿåˆ— TCP å…¨è¿æ¥é˜Ÿåˆ—ï¼Œå·²ç»å»ºç«‹è¿æ¥çš„é˜Ÿåˆ— TCPæ–¹å¼ å®¢æˆ·ç«¯ åˆ›å»ºå¥—æ¥å­—ï¼ˆsocketï¼‰ å‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚ï¼ˆconnectï¼‰ å’ŒæœåŠ¡å™¨ç«¯è¿›è¡Œé€šä¿¡ï¼ˆsend/recvï¼‰ å…³é—­å¥—æ¥å­— UDPæ–¹å¼ æœåŠ¡å™¨ç«¯ åˆ›å»ºå¥—æ¥å­—ï¼ˆsocketï¼‰ å°†å¥—æ¥å­—ç»‘å®šåˆ°ä¸€ä¸ªæœ¬åœ°åœ°å€å’Œç«¯å£ä¸Šï¼ˆbindï¼‰ ç­‰å¾…æ¥æ”¶æ•°æ®ï¼ˆrecvfromï¼‰ å…³é—­å¥—æ¥å­— UDPæ–¹å¼ å®¢æˆ·ç«¯ åˆ›å»ºå¥—æ¥å­—ï¼ˆsocketï¼‰ å‘æœåŠ¡å™¨å‘é€æ•°æ®ï¼ˆsendtoï¼‰ å…³é—­å¥—æ¥å­— å¦‚ä½•ä¿è¯ Socket çš„é•¿è¿æ¥ åº”ç”¨å±‚è‡ªå·±å®ç°å¿ƒè·³åŒ… "},"ç½‘ç»œåè®®/WebSocket.html":{"url":"ç½‘ç»œåè®®/WebSocket.html","title":"WebSocket","keywords":"","body":"WebSocket ç®€ä»‹ Websocket åŸºäº TCP çš„å…¨åŒå·¥é€šä¿¡åè®®ï¼Œå±äºåº”ç”¨å±‚åè®®ï¼Œä»–å¿…é¡»ä¾èµ– HTTP åè®®è¿›è¡Œä¸€æ¬¡æ¡æ‰‹ï¼Œæ¡æ‰‹æˆåŠŸåç›´æ¥é€šè¿‡å•ä¸ª TCP ä¼ è¾“æ•°æ®ã€‚ ç‰¹ç‚¹ æ¡æ‰‹é˜¶æ®µä½¿ç”¨HTTPè¿æ¥ï¼› å¯ä»¥å‘é€æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥å‘é€äºŒè¿›åˆ¶æ•°æ®ï¼› å…¨åŒå·¥é€šä¿¡ï¼› åè®®æ ‡è¯†ç¬¦wsï¼ŒåŠ å¯†æ˜¯wssï¼› è§£å†³äº†ä»€ä¹ˆé—®é¢˜ åœ¨æ²¡æœ‰ Websocket ä¹‹å‰ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ HTTP è½®è¯¢æˆ–è€…é•¿è½®è¯¢æ¥å®ç°æ•°æ®æ¨é€ è½®è¯¢ï¼šæ¯éš”ä¸€å®šæ—¶é—´å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œè€—èµ„æº é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¶…é•¿æ—¶é—´çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨ hold ä½è¿™ä¸ªè¯·æ±‚ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®æ—¶è¿”å› è¿™ä¸¤ç§æ–¹å¼éƒ½æ¯”è¾ƒè€—èµ„æºï¼Œè€Œ Websocket å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ç±»é—®é¢˜ ä¸»è¦ä½¿ç”¨åœºæ™¯ è‚¡ç¥¨è¡Œæƒ…æ¨é€ æ¶ˆæ¯æ¨é€ IMèŠå¤© WebSocket å¯¹æ¯” Websocket å¤„äºåº”ç”¨å±‚åè®®ï¼Œä»–å¿…é¡»ä¾èµ– HTTP åè®®è¿›è¡Œä¸€æ¬¡æ¡æ‰‹ï¼Œæ¡æ‰‹æˆåŠŸåç›´æ¥é€šè¿‡å•ä¸ª TCP ä¼ è¾“æ•°æ®ã€‚ Websocket æ˜¯ä¸ºäº†è§£å†³ HTTP è½®è¯¢ã€é•¿è½®è¯¢çš„é—®é¢˜ è½®è¯¢ï¼šæ¯éš”ä¸€å®šæ—¶é—´å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œè€—èµ„æº é•¿è½®è¯¢ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¶…é•¿æ—¶é—´çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨holdä½è¿™ä¸ªè¯·æ±‚ï¼Œç›´åˆ°æœ‰æ–°æ•°æ®æ—¶è¿”å› WebSocket & Socket Socket æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªåè®®ã€‚å®ƒå·¥ä½œåœ¨ OSI æ¨¡å‹ä¼šè¯å±‚ï¼ˆç¬¬5å±‚ï¼‰ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿å¤§å®¶ç›´æ¥ä½¿ç”¨æ›´åº•å±‚åè®®ï¼ˆä¸€èˆ¬æ˜¯ TCP æˆ– UDP ï¼‰è€Œå­˜åœ¨çš„ä¸€ä¸ªæŠ½è±¡å±‚ã€‚Socketæ˜¯å¯¹TCP/IPåè®®çš„å°è£…ï¼ŒSocketæœ¬èº«å¹¶ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ªè°ƒç”¨æ¥å£(API)ã€‚Socket å¯ä»¥æŒ‡å®šä¸åŒçš„ä¼ è¾“åè®®ï¼ˆTCP ã€UDPï¼‰ WebSocket å’Œ Socket æœ¬è´¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚WebSocket åŸºäº TCP ï¼ŒSocket å¯ä»¥åŸºäº TCPã€UDP WebSocket & HTTP HTTP æ˜¯åŸºäºè¯·æ±‚-åº”ç­”çš„æ–¹å¼ï¼ŒWebSocketæ˜¯åŒå‘é€šä¿¡çš„ WebSocket è¿æ¥ä½¿ç”¨çš„æ˜¯HTTPåè®®è¿›è¡Œè¿æ¥çš„ï¼Œå‘é€äº†ä¸€ä¸ªæ ‡è®°äº† Upgrade å­—æ®µçš„è¯·æ±‚ï¼Œå®šä¹‰äº†ä¸€ç³»åˆ—æ–°çš„headeråŸŸï¼Œæ ‡æ˜æ˜¯ WebSocket è¿æ¥ã€‚ éƒ½æ˜¯åŸºäºTCPçš„åº”ç”¨å±‚åè®®ã€‚ æ¡æ‰‹æµç¨‹ é€šè¿‡ HTTP è¿æ¥ï¼Œè¿æ¥å®Œæˆåç”¨ TCP é€šä¿¡ è¯·æ±‚å¤´ å®¢æˆ·ç«¯å‘èµ·å¸¦æœ‰ Upgrade å­—æ®µçš„ Get è¯·æ±‚ï¼Œè¯·æ±‚å¤´å­—æ®µå¦‚ä¸‹ï¼š Connection: Upgrade Upgrade: websocket Sec-WebSocket-Extensions: permessage-deflate; client_max_window_bits Sec-WebSocket-Key: AAAAAAAA== Sec-WebSocket-Version: 13 Connection ï¼šè¡¨ç¤ºè¦å‡çº§åè®® Upgrade ï¼šè¦å‡çº§çš„åè®®æ˜¯ websocket Sec-WebSocket-Extensions ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯æ‰€å¸Œæœ›æ‰§è¡Œçš„æ‰©å±•ï¼ˆå¦‚æ¶ˆæ¯å‹ç¼©æ’ä»¶ï¼‰ Sec-WebSocket-Key ï¼šwebSocket åè®®æ ¡éªŒå€¼ï¼ŒæœåŠ¡ç«¯æ‹¼æ¥ä¸€æ®µå›ºå®šå­—ç¬¦ä¸²ååŠ å¯†è¿”å›å›æ¥ï¼Œé˜²æ­¢é”™è¯¯è¿æ¥ Sec-WebSocket-Version ï¼šwebsocket çš„ç‰ˆæœ¬å“åº”å¤´ HTTPè¿”å›101çŠ¶æ€ç ï¼Œè¡¨ç¤ºåŒæ„å‡çº§åè®® Connection: Upgrade Upgrade: websocket Sec-Websocket-Accept: XXXXXXXX== Connection ï¼šè¡¨ç¤ºè¦å‡çº§åè®® Upgradeï¼š è¡¨ç¤ºè¦å‡çº§åˆ°å¯¹åº”çš„åè®® Sec-Websocket-Acceptï¼š Sec-WebSocket-Key çš„å€¼åŠ å¯†åå¾—åˆ°çš„å€¼ï¼Œç”¨æ¥ç»™å®¢æˆ·ç«¯æ ¡éªŒ WebSocket åè®®å¤´ åè®®å¤´æœ€å°‘2ä¸ªå­—èŠ‚ï¼Œæœ€å¤š14ä¸ªå­—èŠ‚ï¼ˆåŸºæœ¬å¤´2å­—èŠ‚ + Extended payload 8å­—èŠ‚ + Masking-key 4å­—èŠ‚ï¼‰ FIN 0 ï¼šè¡¨ç¤ºä¸æ˜¯æ¶ˆæ¯çš„æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼ˆfragmentï¼‰ 1 ï¼šè¡¨ç¤ºæ¶ˆæ¯çš„æœ€åä¸€ä¸ªåˆ†ç‰‡ RSV1ã€RSV2ã€RSV3 åº”è¯¥æ˜¯ reserve çš„ç®€ç§°ï¼Œè¡¨ç¤ºä¿ç•™å­—æ®µï¼›ç”¨æ¥ç»™æ‰©å±•ç”¨çš„ Opcode æ“ä½œç  0ï¼šè¡¨ç¤ºå»¶ç»­å¸§ï¼›0 ï¼šè¡¨ç¤ºæœ¬æ¬¡æ•°æ®ä¼ è¾“é‡‡ç”¨äº†æ•°æ®åˆ†ç‰‡ï¼Œé™¤äº†é¦–ä½åˆ†ç‰‡ï¼Œå…¶ä»–çš„ä¸­é—´åˆ†ç‰‡éœ€è¦ä½¿ç”¨è¿™ä¸ªæ ‡å¿—ä½ 1ï¼šè¡¨ç¤ºæ–‡æœ¬å¸§ 2ï¼šè¡¨ç¤ºäºŒè¿›åˆ¶å¸§ 3-7ï¼šä¿ç•™ 8ï¼šè¡¨ç¤ºè¿æ¥æ–­å¼€ 9ï¼šè¡¨ç¤º ping æ“ä½œ Aï¼šè¡¨ç¤º pong æ“ä½œ B-Fï¼šä¿ç•™ Mask 0 ï¼šæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€æ•°æ® 1 ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€æ•°æ®ï¼Œæ­¤æ—¶ä¼šå®šä¹‰ä¸€ä¸ªæ©ç é”®ï¼ˆMasking keyï¼‰ï¼Œç”¨æ¥å¯¹æ•°æ®åæ©ç  Payload len å‡è®¾ Payload len == xï¼Œé‚£ä¹ˆå½“ x == 0 ~ 126 ï¼šè¡¨ç¤ºæ•°æ®çš„é•¿åº¦ä¸º x å­—èŠ‚ï¼› x == 126 ï¼šè¡¨ç¤ºåç»­2ä¸ªå­—èŠ‚çš„å€¼ä¸ºæ•°æ®çš„é•¿åº¦ï¼ˆå¤§ç«¯æ¨¡å¼ï¼‰ï¼› x == 127 ï¼šè¡¨ç¤ºåç»­8ä¸ªå­—èŠ‚çš„å€¼ä¸ºæ•°æ®çš„é•¿åº¦ï¼› Masking-key ç”¨æ¥å¯¹æ•°æ®åæ©ç  Payload data æ‰©å±•æ•°æ®ï¼šå¦‚æœéœ€è¦ä½¿ç”¨å¿…é¡»åœ¨æ¡æ‰‹é˜¶æ®µåå•†å¥½æ•°æ®é•¿åº¦ï¼› åº”ç”¨æ•°æ®ï¼šå‰©ä¸‹çš„å°±æ˜¯åº”ç”¨æ•°æ®é•¿åº¦äº†ï¼› å®¢æˆ·ç«¯å¼‚å¸¸æ ¡éªŒæµç¨‹ æ£€æŸ¥æœåŠ¡ç«¯è¿”å›çš„çŠ¶æ€ç æ˜¯å¦ä¸º 101, ä»£è¡¨æœåŠ¡ç«¯åŒæ„äº†åè®®å‡çº§ æ£€æŸ¥æœåŠ¡ç«¯å“åº”æ˜¯å¦åŒ…å« Upgrade å­—æ®µ, è‹¥ç¼ºå¤±, åˆ™ç»ˆæ­¢æ¡æ‰‹ æ£€æŸ¥ Upgrade å­—æ®µçš„å€¼æ˜¯å¦ä¸º websocket ï¼Œè‹¥ä¸æ˜¯, åˆ™ç»ˆæ­¢æ¡æ‰‹ æ ¡éªŒæœåŠ¡ç«¯è¿”å›çš„ Sec-WebSocket-Accept å­—æ®µçš„å€¼æ˜¯å¦åˆæ³•, è‹¥ä¸åˆæ³•åˆ™ï¼Œç»ˆæ­¢æ¡æ‰‹ è‹¥æœåŠ¡ç«¯è¿”å›çš„ Header ä¸­åŒ…å« Sec-WebSocket-Extensions, ä½†è¯¥å­—æ®µå€¼å¹¶ä¸åœ¨å‘èµ·æ¡æ‰‹æ—¶ä¼ é€’çš„ Sec-WebSocket-Extensions çš„åˆ—è¡¨ä¸­, åˆ™ç»ˆæ­¢æ¡æ‰‹ è‹¥æœåŠ¡ç«¯è¿”å›çš„ Header ä¸­åŒ…å« Sec-WebSocket-Protocol, ä½†è¯¥å­—æ®µå€¼å¹¶ä¸åœ¨å‘èµ·æ¡æ‰‹æ—¶ä¼ é€’çš„ Sec-WebSocket-Protocol çš„å€¼åˆ—è¡¨ä¸­, åˆ™ç»ˆæ­¢æ¡æ‰‹ åˆ†ç‰‡é€»è¾‘ ä¸åˆ†ç‰‡ï¼šFIN = 1 ï¼› Opcode = æ–‡æœ¬ç±»å‹åˆ†ç‰‡ï¼š ç¬¬ä¸€ç‰‡ï¼š FIN = 0 ï¼› Opcode = æ–‡æœ¬ç±»å‹ä¸­é—´ç‰‡ï¼š FIN = 0 ï¼› Opcode = 0æœ€åä¸€ç‰‡ï¼š FIN = 1 ï¼› Opcode = æ–‡æœ¬ç±»å‹ æ§åˆ¶å‘½ä»¤ Close frame ï¼šæ¥æ”¶åˆ°ä¸€æ–¹å‘æ¥çš„ close frame åï¼Œéœ€è¦è¿”å› close frameï¼› Ping frame ï¼šå¿ƒè·³æœºåˆ¶ï¼Œwebsocket çš„ Keep-Alive æœºåˆ¶ Pong frame ï¼šæ¥æ”¶åˆ° ping åï¼Œéœ€è¦ç«‹å³è¿”å›pong å¿ƒè·³æœºåˆ¶ å®¢æˆ·ç«¯å‘èµ· Ping å‘½ä»¤ï¼ŒæœåŠ¡ç«¯è¿”å› Pong å‘½ä»¤ï¼›è¶…æ—¶åˆ™è®¤ä¸ºæ–­å¼€è¿æ¥äº† å®‰å…¨ å»ºç«‹è¿æ¥æ—¶å¿…é¡»åœ¨è¯·æ±‚å¤´åŠ ä¸Š Origin å­—æ®µï¼Œå€¼ä¸ºå¯¹åº”çš„åŸŸåï¼›æœåŠ¡ç«¯ä¼šå¯¹ Origin è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æœéªŒè¯ä¸é€šè¿‡è¿”å›403 [request setValue:@\"https://online.xxxx.xxxx\" forHTTPHeaderField:@\"Origin\"]; ç–‘é—® 1. TCP UDP åè®®å¤´éƒ¨éƒ½æœ‰ç«¯å£ã€å’Œæ ¡éªŒè¿™äº›ï¼Œä¸ºä»€ä¹ˆ websocket æ²¡æœ‰ å› ä¸º websocket æ˜¯åŸºäº TCP çš„ï¼Œåº•å±‚ TCP ä¼ è¾“ï¼›websocket åº”ç”¨å±‚åè®®ï¼ŒTCPä¼ è¾“å±‚åè®® 2. ä¸ºä»€ä¹ˆå®¢æˆ·ç«¯å‘é€æ•°æ®éœ€è¦æ©ç ï¼ŒæœåŠ¡ç«¯å‘é€æ•°æ®åˆä¸éœ€è¦æ©ç  æ©ç å®é™…ä¸Šå°±æ˜¯ç®€å•å¼‚æˆ–è®¡ç®—å‡ºæ¥çš„å€¼ï¼Œæœ¬èº«å¹¶ä¸å…·å¤‡å¾ˆå¼ºçš„å®‰å…¨æ€§ï¼›ä¹‹æ‰€ä»¥éœ€è¦æ©ç ï¼Œä¸ºäº†é˜²æ­¢æ—©æœŸç‰ˆæœ¬çš„åè®®ä¸­å­˜åœ¨çš„ä»£ç†ç¼“å­˜æ±¡æŸ“æ”»å‡»ï¼ˆproxy cache poisoning attacksï¼‰ç­‰é—®é¢˜ã€‚ 3. websocket æ€ä¹ˆå¤„ç†ç²˜åŒ…æ‹†åŒ…é—®é¢˜çš„ é€šè¿‡ FIN è·Ÿ Opcode æ¥åˆ¤æ–­ å‚è€ƒ WebSocket åè®®å®Œæ•´è§£æWebSocketåè®®ï¼š5åˆ†é’Ÿä»å…¥é—¨åˆ°ç²¾é€šRFC-6455 WebSocket åè®®ç¿»è¯‘ "},"ç½‘ç»œåè®®/SRWebSocketæºç è§£æ.html":{"url":"ç½‘ç»œåè®®/SRWebSocketæºç è§£æ.html","title":"SRWebSocketæºç è§£æ","keywords":"","body":"SRWebSocket æºç è§£æ åˆå§‹åŒ–æµç¨‹ - (id)initWithURLRequest:(NSURLRequest *)request protocols:(NSArray *)protocols allowsUntrustedSSLCertificates:(BOOL)allowsUntrustedSSLCertificates; åˆå§‹åŒ–å…¥å£ - (void)_SR_commonInit; é˜Ÿåˆ—ä¹‹ç±»çš„æ•°æ®åˆå§‹åŒ–ã€‚ è¿™é‡Œè¦è¯´çš„æ˜¯ï¼ŒSRWebSocket å†…éƒ¨åˆ›å»ºä¸€ä¸ªå¸¸é©»çº¿ç¨‹ï¼Œç”¨æ¥æ¥æ”¶æ•°æ®æµï¼Œè¿˜æœ‰ä¸€ä¸ªä¸“é—¨ç”¨æ¥å¤„ç†ä¸šåŠ¡çš„é˜Ÿåˆ—ï¼›å½“æ²¡æœ‰æ•°æ®ä¼ è¾“æ—¶å¸¸é©»çº¿ç¨‹ä¼šè¿›å…¥ä¼‘çœ ï¼Œæ­¤æ—¶é˜Ÿåˆ—ä»»åŠ¡å‘ç°_readBufferæ²¡æœ‰æ•°æ®ï¼Œä¹Ÿä¼šè·³å‡ºå¾ªç¯ç­‰å¾…ï¼Œè¿™æ ·æ²¡æœ‰æ•°æ®æ—¶ä¹Ÿå°±ä¸éœ€è¦æ¶ˆè€—å¤šå°‘èµ„æºäº†ã€‚ - (void)_initializeStreams; åˆå§‹åŒ–è¾“å…¥è¾“å‡ºæµ - (void)_initializeStreams { uint32_t port = _url.port.unsignedIntValue; if (port == 0) { if (!_secure) { port = 80; } else { port = 443; } } NSString *host = _url.host; CFReadStreamRef readStream = NULL; CFWriteStreamRef writeStream = NULL; //å°† host port ä¸è¾“å…¥è¾“å‡ºæµç»‘å®šåœ¨ä¸€èµ· CFStreamCreatePairWithSocketToHost(NULL, (__bridge CFStringRef)host, port, &readStream, &writeStream); _outputStream = CFBridgingRelease(writeStream); _inputStream = CFBridgingRelease(readStream); _inputStream.delegate = self; _outputStream.delegate = self; } è¿æ¥æµç¨‹ - (void)open; è¿æ¥å…¥å£ - (void)openConnection; å°†è¾“å…¥è¾“å‡ºæµæ³¨å†Œåˆ°å¸¸é©»çº¿ç¨‹ å¼€å¯è¾“å…¥è¾“å‡ºæµ [_outputStream scheduleInRunLoop:aRunLoop forMode:mode]; [_inputStream scheduleInRunLoop:aRunLoop forMode:mode]; [_outputStream open]; [_inputStream open]; - (void)stream:(NSStream *)aStream handleEvent:(NSStreamEvent)eventCode; æ‰“å¼€æµæˆåŠŸåçš„å›è°ƒ - (void)stream:(NSStream *)aStream handleEvent:(NSStreamEvent)eventCode { __weak typeof(self) weakSelf = self; //ç¬¬ä¸€æ¬¡è¿›æ¥æ²¡è®¤è¯ï¼Œåˆ™è¿›å…¥ï¼Œè®¤è¯ä¸€æ¬¡ if (_secure && !_pinnedCertFound && (eventCode == NSStreamEventHasBytesAvailable || eventCode == NSStreamEventHasSpaceAvailable)) { NSArray *sslCerts = [_urlRequest SR_SSLPinnedCertificates]; if (sslCerts) { SecTrustRef secTrust = (__bridge SecTrustRef)[aStream propertyForKey:(__bridge id)kCFStreamPropertySSLPeerTrust]; if (secTrust) { NSInteger numCerts = SecTrustGetCertificateCount(secTrust); for (NSInteger i = 0; i - (void)didConnect; websocket è¿æ¥è¯·æ±‚ - (void)didConnect { CFHTTPMessageRef request = CFHTTPMessageCreateRequest(NULL, CFSTR(\"GET\"), (__bridge CFURLRef)_url, kCFHTTPVersion1_1); // Set host first so it defaults CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Host\"), (__bridge CFStringRef)(_url.port ? [NSString stringWithFormat:@\"%@:%@\", _url.host, _url.port] : _url.host)); NSMutableData *keyBytes = [[NSMutableData alloc] initWithLength:16]; SecRandomCopyBytes(kSecRandomDefault, keyBytes.length, keyBytes.mutableBytes); if ([keyBytes respondsToSelector:@selector(base64EncodedStringWithOptions:)]) { _secKey = [keyBytes base64EncodedStringWithOptions:0]; } else { _secKey = [keyBytes base64Encoding]; } // Apply cookies if any have been provided NSDictionary * cookies = [NSHTTPCookie requestHeaderFieldsWithCookies:[self requestCookies]]; for (NSString * cookieKey in cookies) { NSString * cookieValue = [cookies objectForKey:cookieKey]; if ([cookieKey length] && [cookieValue length]) { CFHTTPMessageSetHeaderFieldValue(request, (__bridge CFStringRef)cookieKey, (__bridge CFStringRef)cookieValue); } } // set header for http basic auth if (_url.user.length && _url.password.length) { NSData *userAndPassword = [[NSString stringWithFormat:@\"%@:%@\", _url.user, _url.password] dataUsingEncoding:NSUTF8StringEncoding]; NSString *userAndPasswordBase64Encoded; if ([keyBytes respondsToSelector:@selector(base64EncodedStringWithOptions:)]) { userAndPasswordBase64Encoded = [userAndPassword base64EncodedStringWithOptions:0]; } else { userAndPasswordBase64Encoded = [userAndPassword base64Encoding]; } _basicAuthorizationString = [NSString stringWithFormat:@\"Basic %@\", userAndPasswordBase64Encoded]; CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Authorization\"), (__bridge CFStringRef)_basicAuthorizationString); } CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Upgrade\"), CFSTR(\"websocket\")); CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Connection\"), CFSTR(\"Upgrade\")); CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Sec-WebSocket-Key\"), (__bridge CFStringRef)_secKey); CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Sec-WebSocket-Version\"), (__bridge CFStringRef)[NSString stringWithFormat:@\"%ld\", (long)_webSocketVersion]); CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Origin\"), (__bridge CFStringRef)_url.SR_origin); if (_requestedProtocols) { CFHTTPMessageSetHeaderFieldValue(request, CFSTR(\"Sec-WebSocket-Protocol\"), (__bridge CFStringRef)[_requestedProtocols componentsJoinedByString:@\", \"]); } [_urlRequest.allHTTPHeaderFields enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) { CFHTTPMessageSetHeaderFieldValue(request, (__bridge CFStringRef)key, (__bridge CFStringRef)obj); }]; NSData *message = CFBridgingRelease(CFHTTPMessageCopySerializedMessage(request)); CFRelease(request); // é€šè¿‡è¾“å…¥è¾“å‡ºæµå‘èµ·è¿æ¥ [self _writeData:message]; //è¯»å– HTTP å“åº”å¤´ [self _readHTTPHeader]; } - (void)_readHTTPHeader; å¾ªç¯è¯»å–HTTPå¤´éƒ¨æ•°æ®ï¼Œåˆ†éš”ç¬¦ \\r\\n\\r\\n - (void)_readHTTPHeader { if (_receivedHTTPHeaders == NULL) { _receivedHTTPHeaders = CFHTTPMessageCreateEmpty(NULL, NO); } [self _readUntilHeaderCompleteWithCallback:^(SRWebSocket *self, NSData *data) { CFHTTPMessageAppendBytes(_receivedHTTPHeaders, (const UInt8 *)data.bytes, data.length); if (CFHTTPMessageIsHeaderComplete(_receivedHTTPHeaders)) { //è¯»å–åˆ°å¤´éƒ¨ [self _HTTPHeadersDidFinish]; } else { [self _readHTTPHeader]; } }]; } - (void)_HTTPHeadersDidFinish; åˆ¤æ–­è¿æ¥æ˜¯å¦æˆåŠŸ - (void)_HTTPHeadersDidFinish { NSInteger responseCode = CFHTTPMessageGetResponseStatusCode(_receivedHTTPHeaders); // key æ ¡éªŒ if(![self _checkHandshake:_receivedHTTPHeaders]) { return; } NSString *negotiatedProtocol = CFBridgingRelease(CFHTTPMessageCopyHeaderFieldValue(_receivedHTTPHeaders, CFSTR(\"Sec-WebSocket-Protocol\"))); if (negotiatedProtocol) { // Make sure we requested the protocol if ([_requestedProtocols indexOfObject:negotiatedProtocol] == NSNotFound) { //å­åè®®æ ¡éªŒ return; } _protocol = negotiatedProtocol; } self.readyState = SR_OPEN; if (!_didFail) { // è¿æ¥æˆåŠŸäº†ï¼Œå¼€å§‹æ¥æ”¶æ•°æ® [self _readFrameNew]; } // å›è°ƒç»™å¼•ç”¨å±‚ [self _performDelegateBlock:^{ if ([self.delegate respondsToSelector:@selector(webSocketDidOpen:)]) { [self.delegate webSocketDidOpen:self]; }; }]; } æ•°æ®æµæ¥æ”¶æµç¨‹ - (void)safeHandleEvent:(NSStreamEvent)eventCode stream:(NSStream *)aStream è¿™é‡Œä¼šå°†è¾“å…¥æµä¸­çš„æ•°æ®è¯»å–åˆ°_readBuffer - (void)safeHandleEvent:(NSStreamEvent)eventCode stream:(NSStream *)aStream { switch (eventCode) { case NSStreamEventOpenCompleted: { // didConnect fires after certificate verification if we're using pinned certificates. BOOL usingPinnedCerts = [[_urlRequest SR_SSLPinnedCertificates] count] > 0; if ((!_secure || !usingPinnedCerts) && self.readyState == SR_CONNECTING && aStream == _inputStream) { [self didConnect]; } [self _pumpWriting]; [self _pumpScanner]; break; } case NSStreamEventErrorOccurred: { break; } case NSStreamEventEndEncountered: { break; } // æ¥æ”¶åˆ°æ•°æ® case NSStreamEventHasBytesAvailable: { const int bufferSize = 2048; uint8_t buffer[bufferSize]; while (_inputStream.hasBytesAvailable) { NSInteger bytes_read = [_inputStream read:buffer maxLength:bufferSize]; if (bytes_read > 0) { [_readBuffer appendBytes:buffer length:bytes_read]; } else if (bytes_read -(void)_pumpScanner { if (!_isPumping) { _isPumping = YES; } else { return; } // å¾ªç¯è¯»å–æ¶ˆè´¹è€…éœ€è¦çš„æ•°æ®,å¦‚æœæ²¡æœ‰æ•°æ®åˆ™è¿”å›NO while ([self _innerPumpScanner]) { } _isPumping = NO; } - (BOOL)_innerPumpScanner è¯»å–åˆ°æ¶ˆè´¹è€…éœ€è¦çš„æ•°æ® - (BOOL)_innerPumpScanner { //å¦‚æœæ¶ˆè´¹è€…ä¸ºç©ºï¼Œåˆ™ç›´æ¥è¿”å› //è¯»åˆ°æ¶ˆè´¹è€…éœ€è¦çš„æ•°æ®é•¿åº¦æ—¶ï¼Œè¿”å›TRUE } æ•°æ®è¯»å–æµç¨‹ - (void)_readFrameNew; æ¸…ç©ºä¸Šä¸€å¸§ä¸Šä¸€å¸§æ•°æ®ï¼Œéšåè°ƒç”¨ _readFrameContinue - (void)_readFrameContinue; æ·»åŠ ä¸€ä¸ªæ¶ˆè´¹è€… //æ·»åŠ æ¶ˆè´¹è€…ï¼Œç”¨ä¸€ä¸ªæŒ‡å®šçš„é•¿åº¦ï¼Œæ˜¯å¦è¯»åˆ°å½“å‰å¸§ - (void)_addConsumerWithDataLength:(size_t)dataLength callback:(data_callback)callback readToCurrentFrame:(BOOL)readToCurrentFrame unmaskBytes:(BOOL)unmaskBytes { //æ·»åŠ åˆ°æ¶ˆè´¹è€…é˜Ÿåˆ— [_consumers addObject:[_consumerPool consumerWithScanner:nil handler:callback bytesNeeded:dataLength readToCurrentFrame:readToCurrentFrame unmaskBytes:unmaskBytes]]; //æ‰«ææ¶ˆè´¹è€…æ‰€éœ€è¦çš„å­—èŠ‚æ•° [self _pumpScanner]; } - (void)_readFrameContinue { // æ·»åŠ ä¸€ä¸ªæ¶ˆè´¹è€… [self _addConsumerWithDataLength:2 callback:^(SRWebSocket *self, NSData *data) { __block frame_header header = {0}; const uint8_t *headerBuffer = data.bytes; uint8_t receivedOpcode = (SROpCodeMask & headerBuffer[0]); BOOL isControlFrame = (receivedOpcode == SROpCodePing || receivedOpcode == SROpCodePong || receivedOpcode == SROpCodeConnectionClose); header.opcode = receivedOpcode == 0 ? self->_currentFrameOpcode : receivedOpcode; header.fin = !!(SRFinMask & headerBuffer[0]); header.masked = !!(SRMaskMask & headerBuffer[1]); header.payload_length = SRPayloadLenMask & headerBuffer[1]; headerBuffer = NULL; size_t extra_bytes_needed = header.masked ? sizeof(_currentReadMaskKey) : 0; if (header.payload_length == 126) { extra_bytes_needed += sizeof(uint16_t); } else if (header.payload_length == 127) { extra_bytes_needed += sizeof(uint64_t); } if (extra_bytes_needed == 0) { // ä¸éœ€è¦è¯»å–æ‰©å±•å­—æ®µï¼Œåˆ™å¼€å§‹è¯»å–æ•°æ®æ®µ [self _handleFrameHeader:header curData:self->_currentFrameData]; } else { // è¯»å–æ‰©å±•å­—æ®µ [self _addConsumerWithDataLength:extra_bytes_needed callback:^(SRWebSocket *self, NSData *data) { size_t mapped_size = data.length; const void *mapped_buffer = data.bytes; size_t offset = 0; if (header.payload_length == 126) { uint16_t newLen = EndianU16_BtoN(*(uint16_t *)(mapped_buffer)); header.payload_length = newLen; offset += sizeof(uint16_t); } else if (header.payload_length == 127) { header.payload_length = EndianU64_BtoN(*(uint64_t *)(mapped_buffer)); offset += sizeof(uint64_t); } if (header.masked) { memcpy(self->_currentReadMaskKey, ((uint8_t *)mapped_buffer) + offset, sizeof(self->_currentReadMaskKey)); } // è¯»å–åˆ°æ‰©å±•å­—æ®µåï¼Œå†è¯»å– Data æ•°æ® [self _handleFrameHeader:header curData:self->_currentFrameData]; } readToCurrentFrame:NO unmaskBytes:NO]; } } readToCurrentFrame:NO unmaskBytes:NO]; } è¯»å–å¸§çš„æ•°æ®æ®µ - (void)_handleFrameHeader:(frame_header)frame_header curData:(NSData *)curData { BOOL isControlFrame = (frame_header.opcode == SROpCodePing || frame_header.opcode == SROpCodePong || frame_header.opcode == SROpCodeConnectionClose); if (!isControlFrame) { _currentFrameOpcode = frame_header.opcode; _currentFrameCount += 1; } //å¦‚æœæ•°æ®é•¿åº¦ä¸º0 if (frame_header.payload_length == 0) { if (isControlFrame) { // æ•°æ®è¯»å®Œï¼Œå¼€å§‹å¤„ç†æ•°æ® [self _handleFrameWithData:curData opCode:frame_header.opcode]; } else { if (frame_header.fin) { // æ•°æ®è¯»å®Œï¼Œå¼€å§‹å¤„ç†æ•°æ® [self _handleFrameWithData:_currentFrameData opCode:frame_header.opcode]; } else { // TODO add assert that opcode is not a control; // æ•°æ®è¿˜æ²¡è¯»å®Œï¼Œæ®éœ€è¯»å–æ•°æ® [self _readFrameContinue]; } } } else { // è¯»å–æ•°æ®ï¼Œå›è°ƒåçš„å¤„ç†æµç¨‹åŒä¸Š [self _addConsumerWithDataLength:(size_t)frame_header.payload_length callback:^(SRWebSocket *self, NSData *newData) { if (isControlFrame) { [self _handleFrameWithData:newData opCode:frame_header.opcode]; } else { if (frame_header.fin) { [self _handleFrameWithData:self->_currentFrameData opCode:frame_header.opcode]; } else { // TODO add assert that opcode is not a control; [self _readFrameContinue]; } } } readToCurrentFrame:!isControlFrame unmaskBytes:frame_header.masked]; } } å¼€å§‹å¤„ç†æ•°æ® - (void)_handleFrameWithData:(NSData *)frameData opCode:(NSInteger)opcode { BOOL isControlFrame = (opcode == SROpCodePing || opcode == SROpCodePong || opcode == SROpCodeConnectionClose); if (!isControlFrame) { // é‡Œé¢æ˜¯å¼‚æ­¥è¯»å–æ•°æ®å¸§ï¼Œè·Ÿä¸‹é¢çš„åŒºåˆ«å°±æ˜¯ï¼Œéæ•°æ®å¸§ï¼Œéœ€è¦å…ˆæ¸…ç†æ•°æ®æ‰èƒ½ç»§ç»­è¯»å– [self _readFrameNew]; } else { dispatch_async(_workQueue, ^{ // æ•°æ®å¸§ä¸éœ€è¦æ¸…ç†æ•°æ®ï¼Œç›´æ¥è¯»å– [self _readFrameContinue]; }); } //frameData will be copied before passing to handlers //otherwise there can be misbehaviours when value at the pointer is changed // å¼€å§‹å¤„ç†æ•°æ®ï¼Œåˆ°è¿™é‡Œæ•´ä¸ªæ¥æ”¶æµç¨‹ä¹Ÿå°±èµ°å®Œäº† switch (opcode) { case SROpCodeTextFrame: { if ([self.delegate respondsToSelector:@selector(webSocketShouldConvertTextFrameToString:)] && ![self.delegate webSocketShouldConvertTextFrameToString:self]) { [self _handleMessage:[frameData copy]]; } else { NSString *str = [[NSString alloc] initWithData:frameData encoding:NSUTF8StringEncoding]; if (str == nil && frameData) { [self closeWithCode:SRStatusCodeInvalidUTF8 reason:@\"Text frames must be valid UTF-8\"]; dispatch_async(_workQueue, ^{ [self closeConnection]; }); return; } [self _handleMessage:str]; } break; } case SROpCodeBinaryFrame: [self _handleMessage:[frameData copy]]; break; case SROpCodeConnectionClose: [self handleCloseWithData:[frameData copy]]; break; case SROpCodePing: [self handlePing:[frameData copy]]; break; case SROpCodePong: [self handlePong:[frameData copy]]; break; } } å‘é€æ•°æ®æµç¨‹ (void)send:(id)data; (void)_sendFrameWithOpcode:(SROpCode)opcode data:(id)data; (void)_writeData:(NSData *)data; (void)_pumpWriting; // å¼€å§‹å†™æ•°æ®ï¼Œæ•°æ®é‡å¾ˆå¤§çš„è¯ï¼Œå•æ¬¡å†™ä¸å®Œï¼Œä¼šåœ¨æµå›è°ƒä¸­ç»§ç»­å†™æ•°æ® - (void)_pumpWriting { NSUInteger dataLength = _outputBuffer.length; if (dataLength - _outputBufferOffset > 0 && _outputStream.hasSpaceAvailable) { // è¿™é‡Œå†™æ•°æ®ä¸ä¸€å®šå…¨éƒ¨å†™å®Œ NSInteger bytesWritten = [_outputStream write:_outputBuffer.bytes + _outputBufferOffset maxLength:dataLength - _outputBufferOffset]; if (bytesWritten == -1) { return; } //è¡¨ç¤ºå·²ç»å†™å…¥çš„å¤§å° _outputBufferOffset += bytesWritten; //è¶…è¿‡ä¸€å®šå€¼ï¼Œåˆ™é‡ç½® if (_outputBufferOffset > 4096 && _outputBufferOffset > (_outputBuffer.length >> 1)) { //æ›´æ–°åç§»é‡ï¼Œé‡æ–°ç”Ÿæˆæ–°çš„buffer _outputBuffer = [[NSMutableData alloc] initWithBytes:(char *)_outputBuffer.bytes + _outputBufferOffset length:_outputBuffer.length - _outputBufferOffset]; _outputBufferOffset = 0; } } } æ€»ç»“ ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£ç”Ÿäº§ï¼Œä¸€ä¸ªè´Ÿè´£æ¶ˆè´¹ï¼Œè¿™ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼è¿ç”¨çš„å¾ˆå·§å¦™ã€‚NSMutableData è¿ç”¨çš„å¾ˆå¥½ï¼Œé¿å…äº†é¢‘ç¹ç”Ÿæˆ NSMutableData å¯¹è±¡ï¼› "},"æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»Ÿ.html":{"url":"æ“ä½œç³»ç»Ÿ/æ“ä½œç³»ç»Ÿ.html","title":"æ“ä½œç³»ç»Ÿ","keywords":"","body":"æ“ä½œç³»ç»Ÿ "},"æ“ä½œç³»ç»Ÿ/çº¿ç¨‹&è¿›ç¨‹.html":{"url":"æ“ä½œç³»ç»Ÿ/çº¿ç¨‹&è¿›ç¨‹.html","title":"çº¿ç¨‹&è¿›ç¨‹","keywords":"","body":"çº¿ç¨‹&è¿›ç¨‹ è¿›ç¨‹ ç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªå®ä¾‹ï¼Œè¡¨ç¤ºä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…çš„åŸºæœ¬å•å…ƒï¼Œæ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ çº¿ç¨‹ è½»é‡çº§è¿›ç¨‹ï¼Œç¨‹åºæ‰§è¡Œçš„æœ€å°å•å…ƒï¼Œæ˜¯è¿›ç¨‹é‡Œé¢çš„ä¸€ä¸ªå®ä½“ï¼Œçº¿ç¨‹ä¸èµ„æºåˆ†é…æ— å…³ï¼Œçº¿ç¨‹è‡ªå·±ä¸æ‹¥æœ‰èµ„æºï¼ˆåªæœ‰å°‘é‡å¯„å­˜å™¨ã€æ ˆã€çº¿ç¨‹æ§åˆ¶è¡¨TCBï¼‰ï¼Œçº¿ç¨‹ä¾èµ–è¿›ç¨‹ï¼Œå¹¶ä¸è¿›ç¨‹å†…å…¶ä»–çº¿ç¨‹å…±äº«èµ„æºã€‚ åŒºåˆ« è°ƒåº¦ï¼šçº¿ç¨‹æ˜¯ç¨‹åºè°ƒåº¦ã€åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹æ‹¥æœ‰èµ„æºï¼Œå„å¸å…¶èŒï¼Œæ˜¾è‘—çš„æé«˜ç³»ç»Ÿçš„å¹¶å‘è¿è¡Œã€‚åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œçº¿ç¨‹åˆ‡æ¢ï¼Œè¿›ç¨‹ä¸éœ€è¦åˆ‡æ¢ï¼Œè€Œè¿›ç¨‹åˆ‡æ¢ï¼Œçº¿ç¨‹ä¹Ÿå¿…é¡»åˆ‡æ¢ã€‚çº¿ç¨‹åˆ‡æ¢åªéœ€è¦ä¿å­˜è‡ªå·±çš„å¯„å­˜å™¨ä»¥åŠå †æ ˆæ•°æ®ï¼Œçº¿ç¨‹åˆ‡æ¢è¿˜éœ€è¦åˆ†é…æ–°çš„èµ„æºã€‚å¹¶å‘æ€§ï¼šè¿›ç¨‹ä¹‹é—´å¯ä»¥å¹¶å‘ï¼Œä¸€ä¸ªè¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹äº¦å¯å¹¶å‘ï¼Œåˆ©ç”¨å¥½çº¿ç¨‹çš„å¹¶å‘æ€§å¯ä»¥æ›´å¥½åœ°åˆ©ç”¨èµ„æºèµ„æºï¼šçº¿ç¨‹åªæ‹¥æœ‰å°‘é‡èµ„æºï¼ˆå¯„å­˜å™¨ã€æ ˆï¼‰ï¼Œä½†å¯ä»¥ä½¿ç”¨è¿›ç¨‹çš„èµ„æºç³»ç»Ÿå¼€é”€ï¼šè¿›ç¨‹åˆ‡æ¢å¼€é”€å¤§äºçº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼ˆè¿›ç¨‹ï¼šåˆ‡æ¢è™šæ‹Ÿåœ°å€ç©ºé—´ã€åˆ‡æ¢CPUä¸Šä¸‹æ–‡ã€åˆ‡æ¢å†…æ ¸æ ˆ çº¿ç¨‹ï¼šåˆ‡æ¢CPUä¸Šä¸‹æ–‡ã€åˆ‡æ¢å†…æ ¸æ ˆï¼‰é€šä¿¡æ–¹å¼ï¼šè¿›ç¨‹é—´é€šä¿¡éœ€è¦é€šè¿‡IPCï¼ˆæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç¨‹åºï¼‰ï¼Œè€Œçº¿ç¨‹é—´é€šä¿¡åªæ˜¯ç®€å•çš„è¯»å†™æ•°æ®æ®µã€‚è¿›ç¨‹èµ„æºäº’ä¸å½±å“ï¼Œè€Œçº¿ç¨‹èµ„æºåˆ™è¦è€ƒè™‘åŒæ­¥ã€äº’æ–¥çš„é—®é¢˜ é¡µè¡¨å¯ä»¥å°†è™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†å†…å­˜åœ°å€ï¼Œé¡µè¡¨æŸ¥æ‰¾å¾ˆæ…¢ï¼Œé€šå¸¸ä½¿ç”¨ç¼“å­˜æ¥åŠ å¿«æŸ¥æ‰¾ï¼Œåˆ‡æ¢è¿›ç¨‹ï¼Œæ„å‘³ç€è™šæ‹Ÿå†…å­˜åˆ‡æ¢ã€é¡µè¡¨åˆ‡æ¢ï¼Œä»è€Œå¯¼è‡´ç¼“å­˜å‘½ä¸­ç‡ä½ï¼ŒæŸ¥æ‰¾å˜æ…¢ é¡µè¡¨: ç±»ä¼¼äºå­—å…¸ä¸€ä¸ªè™šæ‹Ÿåœ°å€å¯¹åº”ä¸€ä¸ªç‰©ç†åœ°å€ï¼ŒçœŸå®æœºåˆ¶æ²¡ææ‡‚ è™šå®åœ°å€çš„æ˜ å°„å…³ç³»æ˜¯é€šè¿‡é¡µè¡¨æ¥æè¿°çš„ï¼Œè€Œmmuæ­£æ˜¯é€šè¿‡é¡µè¡¨æ¥æŸ¥æ‰¾è™šåœ°å€æ‰€å¯¹åº”çš„ç‰©ç†åœ°å€ã€‚ è¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚ æˆ‘è‡ªå·±ç†è§£çš„çº¿ç¨‹&è¿›ç¨‹ è¿›ç¨‹å°±æ˜¯æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œçº¿ç¨‹å°±æ˜¯è¿™ä¸ªç¨‹åºçš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹é€šå¸¸æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„èµ„æºä»¥åŠè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè€Œçº¿ç¨‹åªæ‹¥æœ‰å¯„å­˜å™¨ã€æ ˆç­‰å°‘é‡èµ„æºï¼Œä½†è¿›ç¨‹å†…éƒ¨çš„çº¿ç¨‹å¯ä»¥å…±äº«è¿›ç¨‹çš„èµ„æºï¼ŒåŒ…æ‹¬è™šæ‹Ÿå†…å­˜åœ°å€ã€‚ ä¸ºä»€ä¹ˆè¿›ç¨‹åˆ‡æ¢æ¯”çº¿ç¨‹åˆ‡æ¢è€—èµ„æº çº¿ç¨‹åˆ‡æ¢å°±æ˜¯æ ˆã€å¯„å­˜å™¨çš„åˆ‡æ¢ã€‚ è¿›ç¨‹çš„åˆ‡æ¢ä¸ä»…åŒ…å«äº†è™šæ‹Ÿå†…å­˜ã€æ ˆã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·ç©ºé—´çš„èµ„æºï¼Œè¿˜åŒ…æ‹¬äº†å†…æ ¸å †æ ˆã€å¯„å­˜å™¨ç­‰å†…æ ¸ç©ºé—´çš„èµ„æºã€‚ "},"Cè¯­è¨€/Cè¯­è¨€.html":{"url":"Cè¯­è¨€/Cè¯­è¨€.html","title":"Cè¯­è¨€","keywords":"","body":"C Language "},"Cè¯­è¨€/time.html":{"url":"Cè¯­è¨€/time.html","title":"time.h","keywords":"","body":"time.h è·å–ç§’çº§åˆ«æ—¶é—´ //è¿™ç§æ–¹å¼åªèƒ½è·å–ç§’å•ä½æ—¶é—´ time_t start, end; start = time(NULL); sleep(1000); end = time(NULL); printf(\"start=%ld;end=%ld;interval=%ld\\n\", start, end, end - start); "},"Algorithm/Algorithm.html":{"url":"Algorithm/Algorithm.html","title":"ç®—æ³•","keywords":"","body":"C Language "},"Algorithm/æ—¶é—´å¤æ‚åº¦.html":{"url":"Algorithm/æ—¶é—´å¤æ‚åº¦.html","title":"æ—¶é—´å¤æ‚åº¦","keywords":"","body":"æ—¶é—´å¤æ‚åº¦ ä¸€ä¸ªç®—æ³•éœ€è¦æ‰§è¡Œçš„æ¬¡æ•°æˆ‘ä»¬è®°ä¸ºT(n)ï¼Œå…¶ä¸­nä¸ºç®—æ³•çš„è§„æ¨¡ã€‚ç°åœ¨å¼•å…¥æŸä¸ªè¾…åŠ©å‡½æ•°f(n)ï¼Œå½“nè¶‹è¿‘äºæ— ç©·å¤§æ—¶ï¼ŒT(n)/f(n) = C (C â‰  0)ã€‚åˆ™f(n)å’ŒT(n)æ˜¯åŒé‡çº§å‡½æ•°ï¼Œè®°ä¸ºT(n) = O(f(n))ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªä¸ºæ—¶é—´å¤æ‚åº¦ã€‚ æ¯ç§æ—¶é—´å¤æ‚åº¦è¡¨ç¤ºçš„æ„æ€ T(n) = O(1) - (void)aFunction0:(int)n { NSLog(@\"%zd\",n); // æ‰§è¡Œ 1 æ¬¡ } ä¸ç®¡è¾“å…¥çš„næ˜¯å¤šå°‘ï¼Œæ‰§è¡Œæ¬¡æ•°éƒ½æ˜¯å¸¸æ•°ã€‚æ‰§è¡Œæ¬¡æ•°å’Œè¾“å…¥nå€¼æ²¡æœ‰ä»»ä½•å…³ç³»ã€‚T(n) = 1 = O(1) T(n) = O(n) - (void)aFunction1:(int)n { for (int i = 0; i æ‰§è¡Œæ¬¡æ•°å’Œè¾“å…¥çš„nå€¼æˆçº¿æ€§å…³ç³»ã€‚T(n) = n + 1 + n = 2n + 1 = O(n) T(n) = O(n^2) - (void)aFunction2:(int)n { for (int i = 0; i æ‰§è¡Œæ¬¡æ•°å’Œè¾“å…¥çš„nå€¼æˆçº¿æ€§å…³ç³»ã€‚T(n) = (n + 1) * (n + 1 + n) = 2n^2 + 3n + 1 = O(n^2) T(n) = O(log(n)) - (int)aFunction3:(int *)nums count:(int)count target:(int)target { int left = 0; int right = count - 1; int mid = 0; while(left > 1; if (nums[mid] target) { right = mid - 1; } else { return mid; } } return -1; } ç¬¬1æ¬¡æŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„æ¦‚ç‡ä¸º 1/nç¬¬2æ¬¡æŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„æ¦‚ç‡ä¸º 2/nç¬¬3æ¬¡æŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„æ¦‚ç‡ä¸º 4/nç¬¬mæ¬¡æŸ¥æ‰¾ï¼Œæ‰¾åˆ°çš„æ¦‚ç‡ä¸º 2^(m - 1)/nå‡è®¾æœ€å¤šéœ€è¦æŸ¥æ‰¾mæ¬¡ï¼Œé‚£ä¹ˆå­˜åœ¨ï¼š1/n + 2/n + 4/n + ... + 2^(m - 1)/n = 1ï¼Œå¯ä»¥æ¨å¯¼å‡º m å³ T(n) = O(log(n)) T(n) = O(nlog(n)) // å¿«é€Ÿæ’åº - (void)quickSort:(int *)nums count:(int)count { int start = 0; int end = count - 1; int value = nums[start]; if (count value) { nums[end] = nums[start]; end--; break; } else { start++; } } } nums[start] = value; [self quickSort:nums count:start]; [self quickSort:nums + start + 1 count:count - start - 1]; } ç¬¬1æ¬¡é€’å½’ï¼šT[n] = 2T[n/2] + nç¬¬2æ¬¡é€’å½’ï¼šT[n] = 2{ 2T[n/4] + (n/2) } + n = 2^2 T[n/(2^2)] + 2n ç¬¬mæ¬¡é€’å½’ï¼šT[n] = 2^m T[n/(2^m)] + mnå‡è®¾æœ€å¤šéœ€è¦mæ¬¡é€’å½’å®Œï¼Œé‚£ä¹ˆï¼šT[n/(2^m)] = T(1) ==> m = log2(n)å¾—åˆ°ï¼šT[n] = 2^m T[1] + mn = 2^(log2(n))T[1] + (log2(n))n = nT[1] + (log2(n))nå½“nè¶‹è¿‘äºæ— ç©·å¤§çš„æ—¶å€™ T[n] = nT[1] + (log2(n))n = (log2(n))n = O(nlogn)å³ï¼šT(n) = O(nlog(n)) "},"Algorithm/å°¾è°ƒç”¨ä¼˜åŒ–.html":{"url":"Algorithm/å°¾è°ƒç”¨ä¼˜åŒ–.html","title":"å°¾è°ƒç”¨ä¼˜åŒ–","keywords":"","body":"å°¾è°ƒç”¨ä¼˜åŒ– çœ‹ã€ŠEffective Objective-C 2.0ã€‹è¿™æœ¬ä¹¦å‘ç°â€œå°¾è°ƒç”¨â€è¿™ä¸ªè¯æ±‡ï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡ï¼Œè®°å½•ä¸‹æ¥ã€‚ ä»€ä¹ˆæ˜¯å°¾è°ƒç”¨ â€œå°¾è°ƒç”¨â€æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°çš„æœ€åä¸€é¡¹æ“ä½œæ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ï¼Œå³è¢«è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼å°±æ˜¯å½“å‰å‡½æ•°çš„è¿”å›å€¼ã€‚ä¾‹å¦‚ï¼š - (int)func0:(int)i { // do anything return [self func1:i]; } - (int)func0:(int)i { // do anything if (i == 0) { return [self func2:i]; } else { return [self func1:i]; } } ä¸‹é¢çš„ä¾‹å­ä¸å±äºå°¾è°ƒç”¨ - (int)func0:(int)i { // do anything return [self func1:i] + 1; } - (int)func0:(int)i { // do anything int value = [self func1:i] return value; } å°¾é€’å½’ å¦‚æœå‡½æ•°åœ¨å°¾éƒ¨è°ƒç”¨çš„æ˜¯è‡ªèº«ï¼Œé‚£ä¹ˆå°±å«åšâ€œå°¾é€’å½’â€ã€‚ - (int)func0:(int)i { // do anything return [self func0:i]; } å°¾è°ƒç”¨ä¼˜åŒ– å½“ä¸€ä¸ªå‡½æ•°æ˜¯å°¾è°ƒç”¨æ—¶ï¼Œé‚£ä¹ˆå½“å‰å‡½æ•°å¼€è¾Ÿçš„æ ˆç©ºé—´å°±å·²ç»ä¸éœ€è¦å†ä½¿ç”¨äº†ã€‚è¢«è°ƒç”¨å‡½æ•°ä¸éœ€è¦å¼€è¾Ÿæ–°çš„æ ˆç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨å½“å‰å‡½æ•°çš„æ ˆç©ºé—´ï¼ˆæ›´æ–°åŸæœ‰æ ˆï¼‰ï¼Œå†æŠŠè¢«è°ƒç”¨å‡½æ•°çš„è¿”å›åœ°å€æ›¿æ¢æˆå½“å‰å‡½æ•°çš„è¿”å›åœ°å€ï¼Œè¿™å°±æ˜¯â€œå°¾è°ƒç”¨ä¼˜åŒ–â€ã€‚ä½¿ç”¨â€œå°¾è°ƒç”¨ä¼˜åŒ–â€æŠ€æœ¯ï¼Œå¯ä»¥é¿å…æ ˆæº¢å‡ºã€‚ å°¾é€’å½’ä¼˜åŒ–ï¼ˆä¾‹å­ï¼‰ æ±‚n! æ²¡æœ‰ä½¿ç”¨å°¾è°ƒç”¨æ—¶ä»£ç æ˜¯è¿™æ ·å†™çš„ï¼š - (int)factorial0:(int)n { if (n ç¨‹åºç¬¬ä¸€æ¬¡è¿›å…¥ factorial0 å‡½æ•°æ—¶éœ€è¦åœ¨æ ˆä¸­åˆ†é…å†…å­˜ç”¨æ¥ä¿å­˜ n å€¼ã€‚ç„¶ååœ¨æ¯ä¸€æ¬¡é€’å½’è°ƒç”¨ factorial0 æ—¶éƒ½éœ€è¦å†åˆ†é…æ–°çš„å†…å­˜æ¥ä¿å­˜æ–°çš„å˜é‡ nï¼ˆè¿™é‡Œçš„æ¯ä¸€ä¸ª n å€¼éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå†…å­˜ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼‰ï¼Œç©ºé—´å¤æ‚åº¦O(n)ã€‚è¿™æ ·æ ˆå°±ä¼šä¸€ç›´å åŠ ï¼Œæœ€åå¯èƒ½é€ æˆæ ˆæº¢å‡ºã€‚ ä½¿ç”¨äº†å°¾è°ƒç”¨æ—¶ä»£ç æ˜¯è¿™æ ·å†™çš„ï¼š - (int)factorial1:(int)n { if (n factorial1 åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸å½±å“ï¼Œç©ºé—´å¤æ‚åº¦O(1)ã€‚ç¨‹åºç¬¬ä¸€æ¬¡è¿›å…¥ factorial1:count å‡½æ•°æ—¶éœ€è¦åœ¨æ ˆä¸­åˆ†é…å†…å­˜ç”¨æ¥ä¿å­˜ n å€¼ã€‚å½“ç¬¬äºŒæ¬¡è°ƒç”¨ factorial1:count æ—¶ï¼Œç”±äºæ˜¯å°¾è°ƒç”¨ï¼Œæ­¤æ—¶ç¬¬ä¸€æ¬¡åˆ†é…çš„æ ˆç©ºé—´å·²ç»ä¸éœ€è¦å†ç”¨äº†ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡è°ƒç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨åŸæœ‰æ ˆï¼Œä¸éœ€è¦åˆ†é…é¢å¤–çš„å†…å­˜ã€‚ç©ºé—´å¤æ‚åº¦O(1)ã€‚ "},"DesignPattern/DesignPattern.html":{"url":"DesignPattern/DesignPattern.html","title":"è®¾è®¡æ¨¡å¼","keywords":"","body":"è®¾è®¡æ¨¡å¼ å¸¸ç”¨çš„23ä¸­è®¾è®¡æ¨¡å¼ "},"é‡æ„/é‡æ„.html":{"url":"é‡æ„/é‡æ„.html","title":"é‡æ„","keywords":"","body":"æµåª’ä½“ åª’ä½“æœåŠ¡å™¨ä¸æ™®é€šçš„æœåŠ¡å™¨åŒºåˆ« åª’ä½“æœåŠ¡å™¨ï¼šæ”¯æŒæµå¼éŸ³é¢‘å’Œè§†é¢‘çš„ä¼ é€ï¼Œå®¢æˆ·ç«¯å¯ä»¥è¾¹ä¸‹è½½è¾¹æ’­æ”¾ã€‚ æ™®é€šæœåŠ¡å™¨ï¼šä¸‹è½½éŸ³è§†é¢‘éœ€è¦å°†æ•´ä¸ªæ–‡ä»¶ä¸‹è½½å®Œæ‰èƒ½è¿›è¡Œæ’­æ”¾ã€‚ "},"é‡æ„/ä¸‹æ‹‰åˆ·æ–°é€»è¾‘é‡æ„.html":{"url":"é‡æ„/ä¸‹æ‹‰åˆ·æ–°é€»è¾‘é‡æ„.html","title":"ä¸‹æ‹‰åˆ·æ–°é€»è¾‘é‡æ„","keywords":"","body":"ä»£ç ä¼˜åŒ–-2019.05.03 éœ€æ±‚ ä¸‹æ‹‰åˆ·æ–°æŸä¸ªä¸»é¡µé¢ï¼Œéœ€è¦åˆ·æ–°è¿™ä¸ªä¸»é¡µé¢é‡Œçš„æ‰€æœ‰å­é¡µé¢ï¼Œæ¯ä¸ªå­é¡µé¢éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¦ç­‰åˆ°æ‰€æœ‰çš„æ¨¡å—éƒ½è¯·æ±‚å®Œæˆæ—¶ï¼Œä¸»é¡µé¢çš„åˆ·æ–°æ‰èƒ½ç»“æŸ,å¹¶æ‰§è¡Œä¸€ç³»åˆ—ç›¸åº”çš„æ“ä½œã€‚ ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªå®Œæˆçš„éœ€æ±‚ï¼Œå¼€å§‹å†™ä»£ç ï¼Œç¬¬ä¸€ç‰ˆçš„ä»£ç æ€è·¯æ˜¯è¿™æ ·çš„ @property (nonatomic, assign) NSInteger dataCallbackCount; - (void)refreshView { self.dataCallbackCount = 0; [self.viewModel fetchData0lWithComplete:^{ self.dataCallbackCount++; [self shouldEndRefresh:dataCallbackCount]; }]; [self.viewModel fetchData1lWithComplete:^{ self.dataCallbackCount++; [self shouldEndRefresh:dataCallbackCount]; }]; [self.viewModel fetchData2lWithComplete:^{ self.dataCallbackCount++; [self shouldEndRefresh:dataCallbackCount]; }]; } - (void)shouldEndRefresh:(NSInteger)count { if (count >= 3) { [self.refreshView endRefresh]; } } ç¬¬ä¸€ç‰ˆçš„ä»£ç æœ‰ä¸ªé—®é¢˜ï¼ŒdataCallbackCount å±æ€§å’Œ shouldEndRefresh æ–¹æ³• éƒ½æ˜¯åˆ·æ–°æ–¹æ³•å†…éƒ¨æ‰éœ€è¦ä½¿ç”¨çš„ï¼Œç°åœ¨éƒ½å˜æˆç±»å†…éƒ¨å…¨å±€çš„äº†ï¼Œå…¶ä»–çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§å’Œæ–¹æ³•ï¼Œè€Œä¸” dataCallbackCount è¿˜ä¸€ç›´å ç”¨å†…å­˜ï¼Œè¿™æ˜¯ä¸åº”è¯¥çš„ã€‚æˆ‘ä»¬çŸ¥é“blockå¯ä»¥æ•è·å˜é‡ï¼Œæ–¹æ³•ä¹Ÿå¯ä»¥ç”¨blockä»£æ›¿ã€‚é‚£ä¹ˆç¬¬äºŒç‰ˆæ”¹åŠ¨å¦‚ä¸‹ï¼š - (void)refreshView { __block NSInteger dataCallbackCount = 0; void (^shouldEndRefresh)(void) = ^(void) { if (++dataCallbackCount >= 3) { [self.refreshView endRefresh]; } }; [self.viewModel fetchData0lWithComplete:^{ shouldEndRefresh(); }]; [self.viewModel fetchData1lWithComplete:^{ shouldEndRefresh(); }]; [self.viewModel fetchData2lWithComplete:^{ shouldEndRefresh(); }]; } ç¬¬äºŒç‰ˆæˆ‘ä»¬å°†æ‰€æœ‰çš„ä»£ç éƒ½æ”¾åˆ°ä¸€ä¸ªæ–¹æ³•å†…äº†ï¼ŒåŒæ—¶ä¹Ÿå°† self.dataCallbackCount++; æ”¾åˆ°äº†blockå†…éƒ¨ï¼Œé¿å…å¤šæ¬¡è°ƒç”¨ã€‚dataCallbackCount è¿™ä¸ªå˜é‡ä¹Ÿä¼šåœ¨ç»“æŸåˆ·æ–°åé‡Šæ”¾å†…å­˜ï¼Œå¯¹äºå¤–éƒ¨æ¥è¯´åªéœ€è¦è°ƒç”¨ refreshView å°±å¯ä»¥äº†ï¼Œè¿™æ ·æ˜¾å¾—å†…èšå¾ˆå¤šã€‚ä½†æ˜¯ä»”ç»†çœ‹çš„è¯ï¼Œåˆä¼šå‘ç°ç°åœ¨çš„ dataCallbackCount ä¹Ÿåªæ˜¯ shouldEndRefresh å†…éƒ¨éœ€è¦ä½¿ç”¨è€Œå·² å¯¹äº [self.viewModel fetchxxx] æ–¹æ³•æ¥è¯´ä¹Ÿåº”è¯¥æ˜¯ä¸å¯è§çš„ï¼Œä½†æ˜¾ç„¶ç›®å‰çš„è¿™ç§å†™æ³•æ˜¯å¯è§çš„ã€‚äºæ˜¯ç¬¬ä¸‰ç‰ˆæ”¹åŠ¨å¦‚ä¸‹ï¼š - (void)refreshView { void (^_shouldEndRefresh)(void) = ^(NSInteger dataCallbackCountMax) { __block NSInteger dataCallbackCount = 0; return ^{ if (++dataCallbackCount >= dataCallbackCountMax) { [self.refreshView endRefresh]; } }; }(3); [self.viewModel fetchData0lWithComplete:^{ _shouldEndRefresh(); }]; [self.viewModel fetchData1lWithComplete:^{ _shouldEndRefresh(); }]; [self.viewModel fetchData2lWithComplete:^{ _shouldEndRefresh(); }]; } ä¼˜åŒ–ç»“æŸï¼Œå¦‚æœéœ€è¦ä¼˜åŒ–çš„è¯å¯ä»¥å°† [self.refreshView endRefresh]; æ–¹æ³•æŠ½å‡ºæ¥ã€‚æœ€ç»ˆä»£ç å¦‚ä¸‹ï¼š - (void)refreshViewWithCallBack:(void(^)(void))callback { void (^_shouldEndRefresh)(void) = ^(NSInteger dataCallbackCountMax) { __block NSInteger dataCallbackCount = 0; return ^{ if (++dataCallbackCount >= dataCallbackCountMax) { callback ? callback() : nil; } }; }(3); [self.viewModel fetchData0lWithComplete:^{ _shouldEndRefresh(); }]; [self.viewModel fetchData1lWithComplete:^{ _shouldEndRefresh(); }]; [self.viewModel fetchData2lWithComplete:^{ _shouldEndRefresh(); }]; } -END- "},"Flutter/Flutter.html":{"url":"Flutter/Flutter.html","title":"Flutter","keywords":"","body":"Flutter "},"Flutter/é—®é¢˜é›†.html":{"url":"Flutter/é—®é¢˜é›†.html","title":"é—®é¢˜é›†","keywords":"","body":"é—®é¢˜é›† Exception attempting to connect to the VM Service: SocketException: Connection refused (OS Error: Connection refused, errno = 61), address = 127.0.0.1, port = 51721 ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶æŠ¥ä»¥ä¸Šå¼‚å¸¸ï¼Œè§£å†³æ–¹å¼ï¼šé‡å¯ç”µè„‘ã€‚ Exception: CocoaPods not installed or not in valid state. ç¯å¢ƒï¼šMacbook VSCode è¿è¡Œ flutter doctor -v å‘ç° CocoaPods å·²ç»å®‰è£…ã€‚ æœ€ç»ˆå…³é—­ VSCodeï¼Œå¹¶é€šè¿‡ open /Applications/Visual\\ Studio\\ Code.appæ‰“å¼€ VSCode åï¼Œé—®é¢˜æ¶ˆå¤±ã€‚ "},"Shell/Shell.html":{"url":"Shell/Shell.html","title":"Shell","keywords":"","body":"Shell Shell æ˜¯ C è¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œæ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ï¼ŒLinuxä¸‹ç”¨äºè¿æ¥ç”¨æˆ·å’Œå†…æ ¸ã€‚ ç”¨é€” æé«˜å·¥ä½œæ•ˆç‡ï¼›å¾ˆå¤šé‡å¤çš„æµç¨‹æ€§æ“ä½œå¯ä»¥ç¼–å†™æˆä¸€ä¸ªè„šæœ¬ï¼ŒåŒå‡»å³å¯è¿è¡Œã€‚ å¤‡æ³¨ï¼šæ‰€æœ‰çš„ shell è„šæœ¬éƒ½æ˜¯åŸºäº Mac å¹³å°çš„ï¼Œå…¶ä»–å¹³å°ä¸ä¸€å®šå…¼å®¹ï¼Œä¼šæœ‰ä¸€å®šçš„å·®å¼‚æ€§ã€‚ #!/bin/bash è„šæœ¬æ–‡ä»¶å¼€å§‹ç¬¬ä¸€è¡Œç”¨ #! å¼€å¤´ï¼Œå‘Šè¯‰ç³»ç»Ÿç”¨è·¯å¾„ /bin/bash æ‰€æŒ‡å‘çš„ç¨‹åºæ¥è§£é‡Šå½“å‰è„šæœ¬ã€‚ å˜é‡èµ‹å€¼ Shell çš„å˜é‡èµ‹å€¼æ˜¯ä¸å…è®¸ç­‰å·å·¦å³ä¸¤è¾¹æœ‰ç©ºæ ¼çš„ Name=\"temp-bakup\" sum=0 å‘½ä»¤å¤ªé•¿æ¢è¡Œ \\åé¢ä¸è·Ÿç©ºæ ¼ echo \"Convert to utf-8\" && \\ mkdir -p $1/tempName && \\ rm -rf $1/tempName è¾“å‡ºå½“å‰è·¯å¾„ //PWD ä¸€å®šè¦å¤§å†™ path=$PWD echo $path è„šæœ¬æ‰§è¡Œæ—¶è¾“å…¥å¯†ç  æ–¹å¼ä¸€ï¼š //æ‰§è¡Œ sudo éœ€è¦è¾“å…¥å¯†ç  echo \"123456\" | sudo -S killall -STOP -c usbd æ–¹å¼äºŒï¼š #EOFå¯ä»¥ç”¨ä»»æ„ç¬¦å·æ›¿æ¢ sudo -S killall -STOP -c usbd å…³é—­å½“å‰æ‰§è¡Œçš„ç»ˆç«¯ //è¿™ä¸ªå‘½ä»¤ä¼šå…³é—­æ‰€æœ‰åä¸º name.command çš„ç»ˆç«¯ osascript -e 'tell application \"Terminal\" to close (every window whose name contains \"name.command\")' & exit "},"Shell/ç»„åˆå‘½ä»¤.html":{"url":"Shell/ç»„åˆå‘½ä»¤.html","title":"ç»„åˆå‘½ä»¤","keywords":"","body":"ç»„åˆå‘½ä»¤ æŸ¥æ‰¾æŸç›®å½•ä¸‹çš„.oæ–‡ä»¶ï¼Œå¹¶åˆ é™¤ find . -name \"*.o\" | xargs rm -f find /root -name *.o | xargs rm -f ls -t | tail -10 | xargs rm -rf ls -lt | tail -100 | awk '{ print $9 }' | xargs rm -rf file $1/$file | grep -i \"ISO-8859 text\" "},"Shell/å‘½ä»¤/cp.html":{"url":"Shell/å‘½ä»¤/cp.html","title":"cp","keywords":"","body":"cp å•ä¸ªæ–‡ä»¶å¤åˆ¶ cp src_file dest_file å°†æ–‡ä»¶å¤åˆ¶åˆ°æ–‡ä»¶å¤¹å†… cp a.txt dir cp a.txt dir/ å°†æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ //dir2 ç›®å½•å¿…é¡»å­˜åœ¨ cp dir1/* dir2 //å¦‚æœ dir2 ç›®å½•ä¸å­˜åœ¨åˆ™å…ˆåˆ›å»º cp -r ~/NoteBook/GitBook/_book/* ~/NoteBook/gh-pages å°†æŸç§ç±»å‹çš„æ–‡ä»¶å¤åˆ¶åˆ°æŸä¸ªæ–‡ä»¶å¤¹ä¸‹ï¼ˆä½¿ç”¨é€šé…ç¬¦ï¼‰ cp dir/*.txt dir "},"Shell/å‘½ä»¤/echo.html":{"url":"Shell/å‘½ä»¤/echo.html","title":"echo","keywords":"","body":"echo è¾“å‡ºåˆ°æŸä¸ªæ–‡ä»¶ ä¼šåœ¨è¾“å‡ºå†…å®¹åé¢è‡ªåŠ¨åŠ ä¸Šæ¢è¡Œç¬¦ï¼Œå¦‚æœè¾“å‡ºæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»º echo 'hello word' > file.txt æ‹¼æ¥åˆ°æŸä¸ªæ–‡ä»¶æœ«å°¾ echo 'hello word' >> file.txt "},"Shell/å‘½ä»¤/find.html":{"url":"Shell/å‘½ä»¤/find.html","title":"find","keywords":"","body":"find æŸ¥æ‰¾å‘½ä»¤ find . -name \"*.o\" "},"Shell/å‘½ä»¤/for.html":{"url":"Shell/å‘½ä»¤/for.html","title":"for","keywords":"","body":"for for in sum=0 for i in {1..100} do sum=$[$i+$sum] done echo \"0-100çš„å’Œä¸ºï¼š\" $sum for sum=0 for ((i=1;ifor in seq sum=0 for i in $(seq 1 100) do sum=$[$i+$sum] done echo \"0-100çš„å’Œä¸º:\"$sum "},"Shell/å‘½ä»¤/grep.html":{"url":"Shell/å‘½ä»¤/grep.html","title":"grep","keywords":"","body":"grep æ­£åˆ™åŒ¹é… # grep \"å­—ç¬¦ä¸²\" å‚æ•° åŒ¹é…ç›®å½• grep \"å­—ç¬¦ä¸²\" -rl ./ -R -r ï¼šè¡¨ç¤ºé€’å½’ -l : åªåˆ—å‡ºåŒ¹é…çš„æ–‡ä»¶å -L : åªåˆ—å‡ºä¸åŒ¹é…çš„æ–‡ä»¶å "},"Shell/å‘½ä»¤/iconv.html":{"url":"Shell/å‘½ä»¤/iconv.html","title":"iconv","keywords":"","body":"iconv ç”¨æ¥æ ¼å¼è½¬æ¢ //å°† gbk æ ¼å¼çš„ file0 è½¬æ¢ä¸º utf-8 æ ¼å¼çš„ file1 iconv -f gbk -t utf-8 $file0 > $file1 ç¤ºä¾‹ å°† $1 ç›®å½•ä¸‹æ‰€æœ‰ gbk æ ¼å¼æ–‡ä»¶è½¬æ¢ä¸º utf-8 æ ¼å¼ #!/bin/bash echo \"å¼€å§‹æ‰§è¡Œ...\" cp -r $1 $1-bakup echo \"å¤‡ä»½æºæ–‡ä»¶...\" tempName=\".temp-bakup-\" downdir() { for file in `ls $1` do if [ -d $1/$file ] then downdir $1/$file else file $1/$file | grep -i \"ISO-8859 text\" && \\ echo \"Convert to utf-8\":$1 && \\ mkdir -p $1/tempName && \\ iconv -f gbk -t utf-8 $1/$file > $1/tempName/$file && \\ mv $1/tempName/$file $1/$file && \\ rm -rf $1/tempName fi done } downdir $1 echo \"æ‰§è¡Œå®Œæ¯•...\" "},"Shell/å‘½ä»¤/if.html":{"url":"Shell/å‘½ä»¤/if.html","title":"if","keywords":"","body":"if ç”¨æ³• // éå†æŸä¸ªç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ downdir() { for file in `ls $1` do if [ -d $1/$file ] then downdir $1/$file else echo $1/$file fi done } ä¸»è¦å‚æ•° -e å¦‚æœ file å­˜åœ¨ï¼Œåˆ™çœŸ -d å¦‚æœ file ä¸ºç›®å½•ï¼Œåˆ™çœŸ -eq ç­‰äº -ne ä¸ç­‰äº -gt å¤§äº -ge å¤§äºç­‰äº -lt å°äº -le å°äºç­‰äº "},"Shell/å‘½ä»¤/rm.html":{"url":"Shell/å‘½ä»¤/rm.html","title":"rm","keywords":"","body":"rm åˆ é™¤æ–‡ä»¶ -f å¼ºåˆ¶åˆ é™¤ï¼Œå¿½ç•¥ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¸æç¤ºç¡®è®¤ -i åœ¨åˆ é™¤å‰éœ€è¦ç¡®è®¤ -I åˆ é™¤è¶…è¿‡ä¸‰ä¸ªæ–‡ä»¶æˆ–è€…é€’å½’åˆ é™¤å‰è¦æ±‚ç¡®è®¤ -r é€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹ export GLOBIGNORE=.git rm -rf * unset GLOBIGNORE "},"Shell/å‘½ä»¤/sed.html":{"url":"Shell/å‘½ä»¤/sed.html","title":"sed","keywords":"","body":"sed å­—ç¬¦ä¸²æ›¿æ¢ # å…ˆç”¨ grep æŸ¥æ‰¾åŒ…å«æºå­—ç¬¦ä¸²çš„æ–‡ä»¶ # å†ç”¨ sed -i å‘½ä»¤æ›¿æ¢å¯¹åº”å†…å®¹ sed -i \"\" \"s/æºå­—ç¬¦ä¸²/ç›®æ ‡å­—ç¬¦ä¸²/g\" `grep \"æºå­—ç¬¦ä¸²\" -rl ./` //ä¸¤è€…åŒºåˆ«åœ¨äº,ç¬¬ä¸€æ¡å‘½ä»¤ä¼šæ›¿æ¢æ‰€æœ‰å­—ç¬¦ï¼Œç¬¬äºŒæ¡å‘½ä»¤åªä¼šæ›¿æ¢æ¯ä¸€è¡ŒåŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ sed -i \"\" \"s/æºå­—ç¬¦ä¸²/ç›®æ ‡å­—ç¬¦ä¸²/g\" ç›®æ ‡æ–‡ä»¶ sed -i \"\" \"s/æºå­—ç¬¦ä¸²/ç›®æ ‡å­—ç¬¦ä¸²\" ç›®æ ‡æ–‡ä»¶ "},"Shell/å‘½ä»¤/unzip.html":{"url":"Shell/å‘½ä»¤/unzip.html","title":"unzip","keywords":"","body":"unzip å‹ç¼©æŸä¸ªæ–‡ä»¶æˆ–è€…ç›®å½• zip test.zip file.txt è§£å‹ç¼© unzip test.zip # -n è§£å‹åˆ°æŒ‡å®šç›®å½•ï¼Œå¦‚æœæœ‰ç›¸åŒçš„ä¸ä¼šè¦†ç›–åŸå…ˆçš„æ–‡ä»¶ unzip -n test.zip -d /temp # -o è§£å‹åˆ°æŒ‡å®šç›®å½•ï¼Œå¦‚æœæœ‰ç›¸åŒçš„ä¼šè¦†ç›–åŸå…ˆçš„æ–‡ä»¶ unzip -o test.zip -d /temp æŸ¥çœ‹å‹ç¼©æ–‡ä»¶ç›®å½• unzip -v test.zip "},"Shell/å‘½ä»¤/xargs.html":{"url":"Shell/å‘½ä»¤/xargs.html","title":"xargs","keywords":"","body":"xargs å¯ä»¥æ•è·ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºï¼Œç„¶åä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå‘½ä»¤ find . -name \"*.o\" | xargs rm -f "},"å·¥å…·è½¯ä»¶/å·¥å…·è½¯ä»¶.html":{"url":"å·¥å…·è½¯ä»¶/å·¥å…·è½¯ä»¶.html","title":"å·¥å…·è½¯ä»¶","keywords":"","body":"å·¥å…·è½¯ä»¶ "},"å·¥å…·è½¯ä»¶/VSCode/VSCode.html":{"url":"å·¥å…·è½¯ä»¶/VSCode/VSCode.html","title":"VSCode","keywords":"","body":"VSCode "},"Fastlane/Fastlane.html":{"url":"Fastlane/Fastlane.html","title":"Fastlane","keywords":"","body":"Fastlane æ‰“åŒ…å¤±è´¥åŸå› è®°å½• Fastfile æ–‡ä»¶ä¸º utf-8 æ ¼å¼çš„ï¼Œä¸å°å¿ƒå¼„æˆå…¶ä»–æ ¼å¼åï¼Œæ‰“åŒ…å¤±è´¥ è§£å†³æ–¹å¼ï¼šå…ˆå°†æ–‡ä»¶è½¬ä¸º utf-8 æ ¼å¼å¹¶ä¿å­˜åœ¨åˆ«çš„åœ°æ–¹ï¼ˆç›´æ¥æ›¿æ¢ git ä¼šå½“æˆåŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ— æ³•æäº¤åˆ°è¿œç¨‹æ‰“åŒ…æœºï¼‰ï¼Œå°†æ—§çš„æ–‡ä»¶ç§»é™¤å¹¶ git æäº¤æ”¹åŠ¨ï¼Œå†å°† utf-8 æ ¼å¼æ–‡ä»¶æ”¾è¿›æ¥åå†æ¬¡ git æäº¤æ”¹åŠ¨å³å¯ã€‚ "},"Fastlane/Fastlaneé—®é¢˜è®°å½•.html":{"url":"Fastlane/Fastlaneé—®é¢˜è®°å½•.html","title":"Fastlaneé—®é¢˜è®°å½•","keywords":"","body":"Fastlane æ‰“åŒ…å¤±è´¥åŸå› è®°å½• Fastfile æ–‡ä»¶ä¸º utf-8 æ ¼å¼çš„ï¼Œä¸å°å¿ƒå¼„æˆå…¶ä»–æ ¼å¼åï¼Œæ‰“åŒ…å¤±è´¥ è§£å†³æ–¹å¼ï¼šå…ˆå°†æ–‡ä»¶è½¬ä¸º utf-8 æ ¼å¼å¹¶ä¿å­˜åœ¨åˆ«çš„åœ°æ–¹ï¼ˆç›´æ¥æ›¿æ¢ git ä¼šå½“æˆåŒä¸€ä¸ªæ–‡ä»¶ï¼Œæ— æ³•æäº¤åˆ°è¿œç¨‹æ‰“åŒ…æœºï¼‰ï¼Œå°†æ—§çš„æ–‡ä»¶ç§»é™¤å¹¶ git æäº¤æ”¹åŠ¨ï¼Œå†å°† utf-8 æ ¼å¼æ–‡ä»¶æ”¾è¿›æ¥åå†æ¬¡ git æäº¤æ”¹åŠ¨å³å¯ã€‚ "},"åšå®¢æ­å»º/åšå®¢æ­å»º.html":{"url":"åšå®¢æ­å»º/åšå®¢æ­å»º.html","title":"åšå®¢æ­å»º","keywords":"","body":"åšå®¢æ­å»º å¾ˆä¹…ä»¥å‰ç”¨ Hexo + GitHub æ­å»ºåšå®¢ï¼Œå‰å‰ååèŠ±äº†å¾ˆå¤šæ—¶é—´ï¼Œåæ¥æ¥è§¦åˆ°äº† GitBook ï¼Œç”¨ GitBook + GitHub æ­å»ºåšå®¢ï¼Œå‘ç°å¥½ç®€å•ï¼Œè¿™é‡Œç®€å•å¯¹æ¯”ä¸‹ï¼š æ­å»ºæ—¶é—´ï¼ŒHexo è¦è¿œè¿œå¤šäº GitBookï¼ŒHexo å„ç§é—®é¢˜ï¼ŒGitBook åŸºæœ¬ä¸Šæ²¡é‡åˆ°é—®é¢˜ã€‚ ç»´æŠ¤æ—¶é—´ï¼ŒHexo èŠ±äº†å¥½å¤šæ—¶é—´ç»´æŠ¤ï¼Œæ—¶ä¸æ—¶ä¼šç¢°åˆ°é—®é¢˜ï¼ŒGitBook ç›®å‰æ¥çœ‹ä¸éœ€è¦èŠ±æ—¶é—´ç»´æŠ¤ã€‚ å›¾ç‰‡å¤„ç†ï¼ŒHexo éœ€è¦ä½¿ç”¨å¤–éƒ¨æœåŠ¡å™¨æ¥å­˜å‚¨å›¾ç‰‡ï¼Œæ—¶ä¸æ—¶åˆä¼šå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œæ”¾æœ¬åœ°å¼„å¥½å¥½ä¹…æ²¡æˆåŠŸï¼Œå„ç§æ’ä»¶é—®é¢˜ï¼ŒGitBook å›¾ç‰‡ç›´æ¥æ”¾æœ¬åœ°ï¼Œä¸éœ€è¦ä»»ä½•å¤„ç†ã€‚ é¡µé¢è®¿é—®é€Ÿåº¦ï¼ŒHexo æ‰“å¼€é¡µé¢ï¼Œè·Ÿåˆ‡æ¢é¡µé¢æ„Ÿè§‰æœ‰ç‚¹æ…¢ï¼ŒGitBook é¦–æ¬¡æ‰“å¼€ç¨å¾®æ…¢ä¸€ç‚¹ï¼Œåé¢åˆ‡æ¢é¡µé¢å¾ˆå¿«ã€‚ å¯è¯»æ€§ï¼ŒHexo åªèƒ½å¿«é€Ÿçœ‹åˆ°å‰é¢å‡ ç¯‡æ–‡ç« ï¼Œæˆ–è€…éœ€è¦åˆ‡æ¢é¡µé¢æµè§ˆï¼Œä¸æ–¹ä¾¿æµè§ˆæŸä¸€ä¸ªç›®å½•ï¼ŒGitBook æ˜¯ä»¥ä¹¦çš„å½¢å¼å±•ç¤ºçš„ï¼Œå¯ä»¥æ¸…æ™°çœ‹åˆ°æ‰€æœ‰ç›®å½•ï¼Œæ–¹ä¾¿è®¿é—®æ¯ä¸ªç›®å½•ã€‚ å¯ç»´æŠ¤æ€§ï¼ŒHexoæ–‡ç« å†™å¥½åå‡ ä¹æ²¡æœ‰ç»´æŠ¤è¿‡ï¼Œä½† GitBook æ­é… Typora å¯ä»¥å¾ˆå¥½çš„ç»´æŠ¤æ—§æ–‡ç« ã€‚ ç¾è§‚ï¼ŒHexo å¯ä»¥é€šè¿‡å„ç§ä¸åŒçš„ä¸»é¢˜æ­å»ºå‡ºå¾ˆæ¼‚äº®çš„ç½‘é¡µï¼ŒGitBook åå‘äºç®€å•ã€‚ æ€»ä¹‹ GitBook é™¤äº†ç¾è§‚ä¸Šæ²¡æœ‰ Hexo æ­å»ºå‡ºæ¥çš„å¥½çœ‹ï¼Œå…¶ä»–çš„å®Œèƒœ Hexoã€‚ "},"åšå®¢æ­å»º/GitBook/GitBook.html":{"url":"åšå®¢æ­å»º/GitBook/GitBook.html","title":"GitBook","keywords":"","body":"GitBook GitBook æ˜¯ä¸€ä¸ªåŸºäº Node.js çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç»“åˆ Github/Git å’Œ Markdown å¯ä»¥å¿«é€Ÿåˆ¶ä½œç²¾ç¾çš„ç”µå­ä¹¦ã€å¸®åŠ©æ–‡æ¡£ç­‰ã€‚ å¯ä»¥ç”¨æ¥å®ç°å¤šäººåä½œï¼Œè¾“å‡º HTMLã€PDF ç­‰æ ¼å¼ã€‚ å¤‡æ³¨ï¼šGitBookå®˜ç½‘æä¾›äº†åœ¨çº¿ç¼–è¾‘åŠŸèƒ½ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä¸ç”¨å®˜ç½‘æä¾›çš„å„ç§åŠŸèƒ½ï¼Œä»…ä»…ä½¿ç”¨æä¾›çš„ Node.js å‘½ä»¤è¡Œå·¥å…·ã€‚ Markdown + GitBook + GitHub + GitHub Pages Markdown ç”¨äºå†™ä½œï¼› GitBook å°†ç¼–å†™çš„æ–‡ç« è¾“å‡º HTML æ ¼å¼ï¼› GitHub ç”¨äºåˆ†å¸ƒå¼ç‰ˆæœ¬ç®¡ç†ï¼› GitHub Pages ç”¨äºæä¾›ç½‘é¡µæµè§ˆæœåŠ¡ï¼› å®‰è£…åŠä½¿ç”¨ 0. å®‰è£…node node çš„ç‰ˆæœ¬ä¸èƒ½å¤ªæ–°ï¼Œä¸ç„¶ä¸€å †é—®é¢˜ï¼Œæˆ‘æœ€ç»ˆå®‰è£…çš„æ˜¯ v12.18.4 ç‰ˆæœ¬ã€‚ç‰ˆæœ¬å¯ä»¥å»å®˜ç½‘ http://nodejs.cn/download/ ä¸‹è½½ï¼Œnode -vå¯ä»¥æŸ¥çœ‹å½“å‰ç‰ˆæœ¬ 1. å®‰è£… gitbook-cli æ’ä»¶ npm install -g gitbook-cli 2. åˆå§‹åŒ–ä¸€æœ¬ä¹¦ç± gitbook init ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ README.md ï¼ˆä¹¦ç±ä»‹ç»ï¼‰ SUMMARY.md ï¼ˆä¹¦ç±ç›®å½•ç»“æ„é…ç½®ï¼‰ SUMMARY.md çš„ç»“æ„å¦‚ä¸‹ # Summary * [Introduction](README.md) * [Shell](Shell/Shell.md) * [cp](Shell/cp.md) * [GitBook](GitBookLearning/GitBook.md) ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»º book.json æ–‡ä»¶ï¼Œç”¨äºé…ç½®æ’ä»¶ 3. ç”ŸæˆHTML gitbook build build ä¹‹åä¼šç”Ÿæˆä¸€ä¸ª _book ç›®å½•ï¼Œé‡Œé¢å­˜æ”¾ç€HTMLæ–‡ä»¶ 4. GitHub åˆ›å»ºä»“åº“ï¼Œå¹¶åˆ›å»º gh-pages åˆ†æ”¯ï¼Œç”¨äºä½¿ç”¨ GitHub Pages æœåŠ¡ å‡å¦‚åˆ›å»ºä»“åº“åä¸º notebook ï¼Œé‚£ä¹ˆæœ€ç»ˆç”Ÿæˆé¢ç½‘é¡µè·¯å¾„ä¸ºhttps://username.github.io/notebook/index.htmlã€‚ åˆ›å»º gh-pages åˆ†æ”¯ï¼Œç”¨äºæä¾› GitHub Pages æœåŠ¡ï¼Œå¹¶å°† _book ç›®å½•ä¸‹çš„æ–‡ä»¶æ”¾åœ¨è¿™ä¸ªåˆ†æ”¯ä¸‹ã€‚ æœ€ç»ˆåœ¨ GitHub ä¸Šçœ‹åˆ°çš„æ•ˆæœå¦‚ä¸‹å›¾ 5. ä½¿ç”¨è„šæœ¬ å°† _book ç›®å½•ä¸‹çš„æ–‡ä»¶æ”¾åœ¨ gh-pages åˆ†æ”¯ä¸‹ï¼Œå¹¶æ¨é€åˆ°GitHubï¼Œè„šæœ¬å¦‚ä¸‹ #!/bin/bash # cd åˆ°å¯¹åº”çš„ç›®å½• cd ~/NoteBook/gh-pages # ç§»é™¤ gh-pages ç›®å½•ä¸‹é™¤äº† .git ä»¥å¤–çš„æ–‡ä»¶ export GLOBIGNORE=.git rm -rf * unset GLOBIGNORE # å°† _book ç›®å½•ä¸‹çš„æ–‡ä»¶ copy åˆ° gh-pages ç›®å½• cp -r ~/NoteBook/GitBook/_book/* ~/NoteBook/gh-pages # git æäº¤ git add . git commit -m \"update note book\" git push origin gh-pages 6. ç­‰å¾…ç”Ÿæˆç½‘é¡µ ç­‰å¾…å‡ åˆ†é’Ÿåï¼Œæ‰“å¼€ https://username.github.io/notebook/index.html ç½‘é¡µæµè§ˆã€‚ é‡åˆ°çš„é—®é¢˜ gitbook initæ—¶æŠ¥é”™ /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287 if (cb) cb.apply(this, arguments) ^ TypeError: cb.apply is not a function at /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs/polyfills.js:287:18 at FSReqCallback.oncomplete (fs.js:169:5) å¤„ç†æ–¹å¼ cd /usr/local/lib/node_modules/gitbook-cli/node_modules/npm/node_modules/graceful-fs sudo chmod 777 polyfills.js vi polyfills.js æ³¨é‡Šä¸‹é¢ä¸‰è¡Œä»£ç  // fs.stat = statFix(fs.stat) // fs.fstat = statFix(fs.fstat) // fs.lstat = statFix(fs.lstat) æ–‡ä»¶ååŒ…å«è‹±æ–‡æ‹¬å·()ä¼šå¯¼è‡´æ— æ³•è¯†åˆ«æ–‡ä»¶è·¯å¾„ åŸå› æ˜¯ GitBook é”é‡Œé¢ä¹ŸåŒ…å«äº†å› ä¸ºæ‹¬å·ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æ‹¬å·è¯†åˆ«å¼‚å¸¸ * [è¿›é˜¶](åšå®¢æ­å»º/Hexo/è¿›é˜¶.md) //æ­£å¸¸ * [è¿›é˜¶](åšå®¢æ­å»º/Hexo/è¿›é˜¶(1).md) //å¼‚å¸¸ï¼Œæ‹¬å·å¯¼è‡´è¯†åˆ«è·¯å¾„å¤±è´¥ éšè—æ–‡ä»¶ æ— æ„ä¸­å‘ç°åªè¦å°†mdæ–‡ä»¶åä»¥_å¼€å¤´ï¼Œè¯¥æ–‡ä»¶å°±ç®—æœ‰ç´¢å¼•ä¹Ÿä¸èƒ½åœ¨ç½‘é¡µä¸­æ‰“å¼€ï¼Œå¦‚æœæ–‡ç« è¿˜æœªå†™å®Œæ˜¯ä¸æ˜¯å¯ä»¥ç”¨è¿™ç§æ–¹å¼æš‚æ—¶å…ˆéšè—èµ·æ¥ã€‚ "},"åšå®¢æ­å»º/GitBook/plugins.html":{"url":"åšå®¢æ­å»º/GitBook/plugins.html","title":"plugins","keywords":"","body":"plugins å®‰è£…æ’ä»¶éœ€è¦GitBookç›®å½•åˆ›å»º book.jsonæ–‡ä»¶ é»˜è®¤æ’ä»¶ { \"livereload\" çƒ­åŠ è½½æ’ä»¶ \"highlight\" è¯­æ³•é«˜äº®æ’ä»¶ \"search\" æœç´¢æ’ä»¶ \"lunr\" æœç´¢æ’ä»¶åå°æœåŠ¡ \"sharing\" åˆ†äº«æ’ä»¶ \"fontsettings\" å­—ä½“è®¾ç½®æ’ä»¶ \"theme-default\" ä¸»é¢˜ } å¦‚æœè¦ç§»é™¤é»˜è®¤æ’ä»¶ï¼Œåˆ™æ’ä»¶åç§°å‰é¢åŠ ä¸€ä¸ª- { \"-sharing\" ç§»é™¤åˆ†äº«æ’ä»¶ } å®‰è£…æ’ä»¶ gitbook install æ¨èæ–‡ç«  gitbookå¸¸ç”¨çš„æ’ä»¶ "},"åšå®¢æ­å»º/Hexo/Hexo.html":{"url":"åšå®¢æ­å»º/Hexo/Hexo.html","title":"Hexo","keywords":"","body":"Hexo æ­å»ºåšå®¢ "},"åšå®¢æ­å»º/Hexo/åŸºç¡€.html":{"url":"åšå®¢æ­å»º/Hexo/åŸºç¡€.html","title":"åŸºç¡€","keywords":"","body":"GitHub+Hexo+NexTæ­å»ºåšå®¢(åŸºç¡€) åºè¨€ ä¸€ç›´æƒ³æ‹¥æœ‰ä¸€ä¸ªè‡ªå·±çš„åšå®¢ï¼Œè®°å½•è‡ªå·±å­¦ä¹ å†…å®¹ä»¥åŠç”Ÿæ´»ç»éªŒã€‚æ­¤å‰åœ¨ç¾¤é‡Œçœ‹åˆ°ä¸€ä½å¤§ç‰›åˆ†äº«çš„è‡ªå·±çš„åšå®¢ï¼Œé©¬ä¸Šå°±å¿ä¸ä½äº†ï¼Œç§ä¿¡äº†é‚£ä¸ªå¤§ç‰›ï¼Œè¯¢é—®å»ºåšå®¢ç›¸å…³çš„é—®é¢˜ï¼Œäºæ˜¯ä¾¿å¼€å§‹äº†æ¼«é•¿çš„å»ºç«™ä¹‹è·¯ã€‚ æ€»ä½“è€Œè¨€å°±æ˜¯GitHubè´Ÿè´£æä¾›åŸŸåå’ŒæœåŠ¡å™¨ï¼ŒHexoè´Ÿè´£å»ºç«™ï¼ŒNexTè´Ÿè´£ä¸»é¢˜ã€‚ GitHub ç”³è¯·GitHubè´¦å·ï¼Œä½œä¸ºåŸŸåå’ŒæœåŠ¡å™¨ã€‚ç„¶ååˆ›å»ºåˆ›åº“repositoryï¼Œä»“åº“çš„åç§°ä¸ºyourmane.github.ioæˆ‘çš„ä»“åº“åç§°æ˜¯vhuichen.github.io è‡³äºä¸ºä»€ä¹ˆè¦è¿™æ ·ï¼Œæˆ‘è‡ªå·±ä¹Ÿä¸æ¸…æ¥šã€‚ Hexo ä»‹ç» Hexoæ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„é™æ€åšå®¢ï¼Œä¸éœ€è¦å­¦ä¹ ä»»ä½•ç½‘é¡µæŠ€æœ¯ï¼Œç›´æ¥ä½¿ç”¨MarkDownå†™æ–‡ç« ï¼Œç”Ÿæˆé™æ€ç½‘é¡µå¹¶æ‰˜ç®¡åˆ°GitHubä¸Šã€‚å®˜ç½‘ https://hexo.io/zh-cn/ ç¯å¢ƒæ­å»º å®‰è£…Homebrew ï¼ˆç®€ç§°brewï¼‰ çœ‹å®˜ç½‘http://brew.sh/index_zh-cn.html å®‰è£…åªéœ€è¦ä¸€æ¡è¯­å¥ /usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\" å®‰è£…node.js å®˜ç½‘https://nodejs.org/en/ brew install node å®‰è£…git sudo brew install git å®‰è£…Hexo npm install -g hexo æˆ–è€… npm install -g hexo-cli åˆå§‹åŒ–é…ç½® åœ¨æŒ‡å®šç›®å½•ä¸‹åˆå§‹åŒ–Hexo åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹ä¸éœ€è¦åŠ è·¯å¾„ï¼Œå¦‚æœä¸æ˜¯åˆ™åŠ ä¸Šhexoåˆå§‹åŒ–çš„è·¯å¾„ hexo inithexo init /blog å®‰è£…npm npm install åœ¨Hexoä¸­éƒ¨ç½²git npm install hexo-deployer-git --save æ²¡æœ‰è¿™æ¡è¯­å¥ä¼šå‡ºç°ERROR Deployer not found: gitçš„é”™è¯¯ ä½¿ç”¨NexTä¸»é¢˜ NexTå®˜ç½‘ http://theme-next.iissnan.com/ **PS:çœ‹å®˜æ–¹æ–‡æ¡£è¶³å¤Ÿäº†** ä¸‹è½½å®‰è£… æ‰“å¼€ç»ˆç«¯ï¼Œå®šä½åˆ°Hexoç«™ç‚¹ç›®å½•ï¼Œå°†ä¸»é¢˜ä»gitä¸Šä¸‹è½½æˆ‘çš„blogç›®å½•åœ¨/blog/ä¸‹ cd /blog/git clone https://github.com/iissnan/hexo-theme-next themes/next` é…ç½®ç«™ç‚¹_congif.yml ç¼–è¾‘Hexoç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶ 1.é…ç½®NexTä¸»é¢˜ # Extensions## Plugins: https://hexo.io/plugins/## Themes: https://hexo.io/themes/ **theme: next** 2.é…ç½®ä»“åº“åœ°å€ # Deployment## Docs: https://hexo.io/docs/deployment.htmldeploy: type: git repo: https://github.com/vhuichen/vhuichen.github.io.git branch: master ç”Ÿæˆé™æ€ç½‘é¡µå¹¶å¯åŠ¨æœ¬åœ°æœåŠ¡ //ç”Ÿæˆé™æ€ç½‘é¡µ//å¯åŠ¨æœ¬åœ°æœåŠ¡ hexo ghexo såœ¨æµè§ˆå™¨ä¸­è¾“å…¥http://localhost:4000/ å³å¯æŸ¥çœ‹ç½‘é¡µ éƒ¨ç½²ç½‘é¡µ sudo hexo gsudo hexo dåœ¨æµè§ˆå™¨ä¸­è¾“å…¥åœ°å€https://vhuichen.github.io/å³å¯æŸ¥çœ‹ç½‘é¡µ "},"åšå®¢æ­å»º/Hexo/è¿›é˜¶.html":{"url":"åšå®¢æ­å»º/Hexo/è¿›é˜¶.html","title":"è¿›é˜¶","keywords":"","body":"GitHub+Hexo+NexTæ­å»ºåšå®¢(è¿›é˜¶) è®¾ç½®ä¸»é¢˜æ¨¡å¼ æœ‰ä¸‰ç§ä¸»é¢˜æ¨¡å¼å¯ä¾›é€‰æ‹© # Schemes#scheme: Muse#scheme: Mistscheme: Pisces åˆ›å»ºåˆ†ç±»ã€æ ‡ç­¾ è¿›å…¥NexTä¸»é¢˜ç›®å½•çš„_config.ymlæ–‡ä»¶ 1.å»æ‰æ³¨é‡Šï¼ˆä¸€èˆ¬ä¹Ÿä¼šå»æ‰å›¾æ ‡æ³¨é‡Šï¼‰ menu: home: / archives: /archives categories: /categories tags: /tags about: /about search: /search commonweal: /404.html 2.åˆ›å»ºé¡µé¢ hexo new page \"tags\"hexo new page \"categories\"hexo new page \"about\" 3.ä¿®æ”¹æ–°åˆ›å»ºå¥½çš„é¡µé¢çš„å†…å®¹ æ‰“å¼€åˆšåˆ›å»ºå¥½çš„mdæ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š tagsæ–‡ä»¶ ---title: tagsdate: 2016-10-23 23:16:24type: \"tags\"--- categoriesæ–‡ä»¶ ---title: categoriesdate: 2016-10-23 23:15:24type: \"categories\"--- **typeçš„å€¼å¾—æ ‡å·å¿…é¡»ä¸ºè‹±æ–‡çŠ¶æ€ä¸‹çš„ \" \" å¦åˆ™æ— æ³•è¯†åˆ«ï¼ˆå¼„äº†æˆ‘å¥½ä¹…ã€‚ã€‚ã€‚**ï¼‰ 4.åœ¨å¯¹åº”çš„æ–‡ç« æ ‡é¢˜å¤„æ·»åŠ åˆ†ç±»ã€æ ‡ç­¾ > --- title: MarkdownåŸºç¡€è¯­æ³•date: 2016-10-18 00:13:58tags: [Markdown, Markdown1]category: \"Markdown\"--- 5. "},"é«˜æ•ˆå­¦ä¹ /é«˜æ•ˆå­¦ä¹ .html":{"url":"é«˜æ•ˆå­¦ä¹ /é«˜æ•ˆå­¦ä¹ .html","title":"é«˜æ•ˆå­¦ä¹ ","keywords":"","body":"é«˜æ•ˆå­¦ä¹  æŠŠçŸ¥è¯†ç‚¹æ‹†åˆ†æˆæ›´å°çš„çŸ¥è¯†ç‚¹ï¼Œç†è§£æ¸…æ¥šå¹¶æ•´ç†è®°å½•ï¼Œæœ€å¥½èƒ½å¤Ÿæ§å£å¤´è®²è¿°å‡ºæ¥ã€‚ å½“ä¸‹æ¬¡æœ‰éœ€è¦ä½¿ç”¨çŸ¥è¯†æ—¶ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°å¯¹åº”çš„ç¬”è®°ã€‚ ä¸æ–­æ›´æ–°ç¬”è®°ã€‚ "},"é«˜æ•ˆå­¦ä¹ /è´¹æ›¼å­¦ä¹ æ³•.html":{"url":"é«˜æ•ˆå­¦ä¹ /è´¹æ›¼å­¦ä¹ æ³•.html","title":"è´¹æ›¼å­¦ä¹ æ³•","keywords":"","body":"è´¹æ›¼å­¦ä¹ æ³• æŠŠæ‰€å­¦çš„çŸ¥è¯†ï¼Œç”¨è‡ªå·±çš„è¯è®²è¿°å‡ºæ¥ï¼›ä»¥æ–‡ç« æˆ–è€…è§†é¢‘æ–¹å¼åˆ†äº«ç»™åˆ«äºº å­¦ä¹ ç•™å­˜ç‡ å¬è®² -- 5% é˜…è¯» -- 10% è§†å¬ -- 20% æ¼”ç¤º -- 30% è®¨è®º -- 50% å®è·µ -- 75% æ•™æˆç»™ä»–äºº -- 90% å‰é¢4ä¸­å¯ä»¥ç§°ä¹‹ä¸º\"è¢«åŠ¨å­¦ä¹ \"ï¼Œåé¢3ç§ç§°ä¸º\"ä¸»åŠ¨å­¦ä¹ \" "}}